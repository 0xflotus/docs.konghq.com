<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/Article">
  

<head>
  <meta charset="utf-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"/>

  <title>Examples - v0.33-x | Kong - Open-Source API Management and Microservice Management</title>
  <meta name="description" content="Secure, Manage &amp; Extend your APIs or Microservices with plugins for authentication, logging, rate-limiting, transformations and more.">
  <meta name="author" content="KongHQ"/>
  <meta property="og:title" content="Open-Source API Management and Microservice Management"/>
  <meta property="og:site_name" content="Kong"/>
  <!-- use share link for facebook -->
  <meta property="og:url" content="https://docs.konghq.com"/>
  <meta property="og:description" content="Secure, Manage &amp; Extend your APIs or Microservices with plugins for authentication, logging, rate-limiting, transformations and more."/>
  <meta property="og:type" content="website"/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:image" content="https://docs.konghq.com/assets/images/share.png"/>
  <meta name="twitter:card" content="summary_large_image"/>
  <meta name="twitter:site" content="@thekonginc"/>
  <meta name="twitter:creator" content="@thekonginc"/>
  <meta name="twitter:url" content="https://docs.konghq.com"/>
  <meta name="twitter:description" content="Secure, Manage &amp; Extend your APIs or Microservices with plugins for authentication, logging, rate-limiting, transformations and more.">
  <meta name="twitter:image" content="https://docs.konghq.com/assets/images/share.png">
  <meta property="fb:admins" content="227304446"/>
  <meta property="fb:admins" content="576641408"/>
  <meta name="google-site-verification" content="CrU3zp02dNKTe8NSAipL4NCPkrIjDXG8fViTZ-MIzP4"/>

  <!-- New Relic -->
  <script type="text/javascript">
/* eslint-disable */
window.NREUM||(NREUM={}),__nr_require=function(t,e,n){function r(n){if(!e[n]){var o=e[n]={exports:{}};t[n][0].call(o.exports,function(e){var o=t[n][1][e];return r(o||e)},o,o.exports)}return e[n].exports}if("function"==typeof __nr_require)return __nr_require;for(var o=0;o<n.length;o++)r(n[o]);return r}({1:[function(t,e,n){function r(t){try{c.console&&console.log(t)}catch(e){}}var o,i=t("ee"),a=t(20),c={};try{o=localStorage.getItem("__nr_flags").split(","),console&&"function"==typeof console.log&&(c.console=!0,o.indexOf("dev")!==-1&&(c.dev=!0),o.indexOf("nr_dev")!==-1&&(c.nrDev=!0))}catch(s){}c.nrDev&&i.on("internal-error",function(t){r(t.stack)}),c.dev&&i.on("fn-err",function(t,e,n){r(n.stack)}),c.dev&&(r("NR AGENT IN DEVELOPMENT MODE"),r("flags: "+a(c,function(t,e){return t}).join(", ")))},{}],2:[function(t,e,n){function r(t,e,n,r,c){try{h?h-=1:o(c||new UncaughtException(t,e,n),!0)}catch(f){try{i("ierr",[f,s.now(),!0])}catch(d){}}return"function"==typeof u&&u.apply(this,a(arguments))}function UncaughtException(t,e,n){this.message=t||"Uncaught error with no additional information",this.sourceURL=e,this.line=n}function o(t,e){var n=e?null:s.now();i("err",[t,n])}var i=t("handle"),a=t(21),c=t("ee"),s=t("loader"),f=t("gos"),u=window.onerror,d=!1,p="nr@seenError",h=0;s.features.err=!0,t(1),window.onerror=r;try{throw new Error}catch(l){"stack"in l&&(t(13),t(12),"addEventListener"in window&&t(6),s.xhrWrappable&&t(14),d=!0)}c.on("fn-start",function(t,e,n){d&&(h+=1)}),c.on("fn-err",function(t,e,n){d&&!n[p]&&(f(n,p,function(){return!0}),this.thrown=!0,o(n))}),c.on("fn-end",function(){d&&!this.thrown&&h>0&&(h-=1)}),c.on("internal-error",function(t){i("ierr",[t,s.now(),!0])})},{}],3:[function(t,e,n){t("loader").features.ins=!0},{}],4:[function(t,e,n){function r(){M++,S=y.hash,this[u]=b.now()}function o(){M--,y.hash!==S&&i(0,!0);var t=b.now();this[l]=~~this[l]+t-this[u],this[d]=t}function i(t,e){E.emit("newURL",[""+y,e])}function a(t,e){t.on(e,function(){this[e]=b.now()})}var c="-start",s="-end",f="-body",u="fn"+c,d="fn"+s,p="cb"+c,h="cb"+s,l="jsTime",m="fetch",v="addEventListener",w=window,y=w.location,b=t("loader");if(w[v]&&b.xhrWrappable){var g=t(10),x=t(11),E=t(8),P=t(6),O=t(13),R=t(7),T=t(14),L=t(9),j=t("ee"),N=j.get("tracer");t(15),b.features.spa=!0;var S,M=0;j.on(u,r),j.on(p,r),j.on(d,o),j.on(h,o),j.buffer([u,d,"xhr-done","xhr-resolved"]),P.buffer([u]),O.buffer(["setTimeout"+s,"clearTimeout"+c,u]),T.buffer([u,"new-xhr","send-xhr"+c]),R.buffer([m+c,m+"-done",m+f+c,m+f+s]),E.buffer(["newURL"]),g.buffer([u]),x.buffer(["propagate",p,h,"executor-err","resolve"+c]),N.buffer([u,"no-"+u]),L.buffer(["new-jsonp","cb-start","jsonp-error","jsonp-end"]),a(T,"send-xhr"+c),a(j,"xhr-resolved"),a(j,"xhr-done"),a(R,m+c),a(R,m+"-done"),a(L,"new-jsonp"),a(L,"jsonp-end"),a(L,"cb-start"),E.on("pushState-end",i),E.on("replaceState-end",i),w[v]("hashchange",i,!0),w[v]("load",i,!0),w[v]("popstate",function(){i(0,M>1)},!0)}},{}],5:[function(t,e,n){function r(t){}if(window.performance&&window.performance.timing&&window.performance.getEntriesByType){var o=t("ee"),i=t("handle"),a=t(13),c=t(12),s="learResourceTimings",f="addEventListener",u="resourcetimingbufferfull",d="bstResource",p="resource",h="-start",l="-end",m="fn"+h,v="fn"+l,w="bstTimer",y="pushState",b=t("loader");b.features.stn=!0,t(8);var g=NREUM.o.EV;o.on(m,function(t,e){var n=t[0];n instanceof g&&(this.bstStart=b.now())}),o.on(v,function(t,e){var n=t[0];n instanceof g&&i("bst",[n,e,this.bstStart,b.now()])}),a.on(m,function(t,e,n){this.bstStart=b.now(),this.bstType=n}),a.on(v,function(t,e){i(w,[e,this.bstStart,b.now(),this.bstType])}),c.on(m,function(){this.bstStart=b.now()}),c.on(v,function(t,e){i(w,[e,this.bstStart,b.now(),"requestAnimationFrame"])}),o.on(y+h,function(t){this.time=b.now(),this.startPath=location.pathname+location.hash}),o.on(y+l,function(t){i("bstHist",[location.pathname+location.hash,this.startPath,this.time])}),f in window.performance&&(window.performance["c"+s]?window.performance[f](u,function(t){i(d,[window.performance.getEntriesByType(p)]),window.performance["c"+s]()},!1):window.performance[f]("webkit"+u,function(t){i(d,[window.performance.getEntriesByType(p)]),window.performance["webkitC"+s]()},!1)),document[f]("scroll",r,{passive:!0}),document[f]("keypress",r,!1),document[f]("click",r,!1)}},{}],6:[function(t,e,n){function r(t){for(var e=t;e&&!e.hasOwnProperty(u);)e=Object.getPrototypeOf(e);e&&o(e)}function o(t){c.inPlace(t,[u,d],"-",i)}function i(t,e){return t[1]}var a=t("ee").get("events"),c=t(23)(a,!0),s=t("gos"),f=XMLHttpRequest,u="addEventListener",d="removeEventListener";e.exports=a,"getPrototypeOf"in Object?(r(document),r(window),r(f.prototype)):f.prototype.hasOwnProperty(u)&&(o(window),o(f.prototype)),a.on(u+"-start",function(t,e){var n=t[1],r=s(n,"nr@wrapped",function(){function t(){if("function"==typeof n.handleEvent)return n.handleEvent.apply(n,arguments)}var e={object:t,"function":n}[typeof n];return e?c(e,"fn-",null,e.name||"anonymous"):n});this.wrapped=t[1]=r}),a.on(d+"-start",function(t){t[1]=this.wrapped||t[1]})},{}],7:[function(t,e,n){function r(t,e,n){var r=t[e];"function"==typeof r&&(t[e]=function(){var t=r.apply(this,arguments);return o.emit(n+"start",arguments,t),t.then(function(e){return o.emit(n+"end",[null,e],t),e},function(e){throw o.emit(n+"end",[e],t),e})})}var o=t("ee").get("fetch"),i=t(20);e.exports=o;var a=window,c="fetch-",s=c+"body-",f=["arrayBuffer","blob","json","text","formData"],u=a.Request,d=a.Response,p=a.fetch,h="prototype";u&&d&&p&&(i(f,function(t,e){r(u[h],e,s),r(d[h],e,s)}),r(a,"fetch",c),o.on(c+"end",function(t,e){var n=this;e?e.clone().arrayBuffer().then(function(t){n.rxSize=t.byteLength,o.emit(c+"done",[null,e],n)}):o.emit(c+"done",[t],n)}))},{}],8:[function(t,e,n){var r=t("ee").get("history"),o=t(23)(r);e.exports=r,o.inPlace(window.history,["pushState","replaceState"],"-")},{}],9:[function(t,e,n){function r(t){function e(){s.emit("jsonp-end",[],p),t.removeEventListener("load",e,!1),t.removeEventListener("error",n,!1)}function n(){s.emit("jsonp-error",[],p),s.emit("jsonp-end",[],p),t.removeEventListener("load",e,!1),t.removeEventListener("error",n,!1)}var r=t&&"string"==typeof t.nodeName&&"script"===t.nodeName.toLowerCase();if(r){var o="function"==typeof t.addEventListener;if(o){var a=i(t.src);if(a){var u=c(a),d="function"==typeof u.parent[u.key];if(d){var p={};f.inPlace(u.parent,[u.key],"cb-",p),t.addEventListener("load",e,!1),t.addEventListener("error",n,!1),s.emit("new-jsonp",[t.src],p)}}}}}function o(){return"addEventListener"in window}function i(t){var e=t.match(u);return e?e[1]:null}function a(t,e){var n=t.match(p),r=n[1],o=n[3];return o?a(o,e[r]):e[r]}function c(t){var e=t.match(d);return e&&e.length>=3?{key:e[2],parent:a(e[1],window)}:{key:t,parent:window}}var s=t("ee").get("jsonp"),f=t(23)(s);if(e.exports=s,o()){var u=/[?&](?:callback|cb)=([^&#]+)/,d=/(.*)\.([^.]+)/,p=/^(\w+)(\.|$)(.*)$/,h=["appendChild","insertBefore","replaceChild"];f.inPlace(HTMLElement.prototype,h,"dom-"),f.inPlace(HTMLHeadElement.prototype,h,"dom-"),f.inPlace(HTMLBodyElement.prototype,h,"dom-"),s.on("dom-start",function(t){r(t[0])})}},{}],10:[function(t,e,n){var r=t("ee").get("mutation"),o=t(23)(r),i=NREUM.o.MO;e.exports=r,i&&(window.MutationObserver=function(t){return this instanceof i?new i(o(t,"fn-")):i.apply(this,arguments)},MutationObserver.prototype=i.prototype)},{}],11:[function(t,e,n){function r(t){var e=a.context(),n=c(t,"executor-",e),r=new f(n);return a.context(r).getCtx=function(){return e},a.emit("new-promise",[r,e],e),r}function o(t,e){return e}var i=t(23),a=t("ee").get("promise"),c=i(a),s=t(20),f=NREUM.o.PR;e.exports=a,f&&(window.Promise=r,["all","race"].forEach(function(t){var e=f[t];f[t]=function(n){function r(t){return function(){a.emit("propagate",[null,!o],i),o=o||!t}}var o=!1;s(n,function(e,n){Promise.resolve(n).then(r("all"===t),r(!1))});var i=e.apply(f,arguments),c=f.resolve(i);return c}}),["resolve","reject"].forEach(function(t){var e=f[t];f[t]=function(t){var n=e.apply(f,arguments);return t!==n&&a.emit("propagate",[t,!0],n),n}}),f.prototype["catch"]=function(t){return this.then(null,t)},f.prototype=Object.create(f.prototype,{constructor:{value:r}}),s(Object.getOwnPropertyNames(f),function(t,e){try{r[e]=f[e]}catch(n){}}),a.on("executor-start",function(t){t[0]=c(t[0],"resolve-",this),t[1]=c(t[1],"resolve-",this)}),a.on("executor-err",function(t,e,n){t[1](n)}),c.inPlace(f.prototype,["then"],"then-",o),a.on("then-start",function(t,e){this.promise=e,t[0]=c(t[0],"cb-",this),t[1]=c(t[1],"cb-",this)}),a.on("then-end",function(t,e,n){this.nextPromise=n;var r=this.promise;a.emit("propagate",[r,!0],n)}),a.on("cb-end",function(t,e,n){a.emit("propagate",[n,!0],this.nextPromise)}),a.on("propagate",function(t,e,n){this.getCtx&&!e||(this.getCtx=function(){if(t instanceof Promise)var e=a.context(t);return e&&e.getCtx?e.getCtx():this})}),r.toString=function(){return""+f})},{}],12:[function(t,e,n){var r=t("ee").get("raf"),o=t(23)(r),i="equestAnimationFrame";e.exports=r,o.inPlace(window,["r"+i,"mozR"+i,"webkitR"+i,"msR"+i],"raf-"),r.on("raf-start",function(t){t[0]=o(t[0],"fn-")})},{}],13:[function(t,e,n){function r(t,e,n){t[0]=a(t[0],"fn-",null,n)}function o(t,e,n){this.method=n,this.timerDuration=isNaN(t[1])?0:+t[1],t[0]=a(t[0],"fn-",this,n)}var i=t("ee").get("timer"),a=t(23)(i),c="setTimeout",s="setInterval",f="clearTimeout",u="-start",d="-";e.exports=i,a.inPlace(window,[c,"setImmediate"],c+d),a.inPlace(window,[s],s+d),a.inPlace(window,[f,"clearImmediate"],f+d),i.on(s+u,r),i.on(c+u,o)},{}],14:[function(t,e,n){function r(t,e){d.inPlace(e,["onreadystatechange"],"fn-",c)}function o(){var t=this,e=u.context(t);t.readyState>3&&!e.resolved&&(e.resolved=!0,u.emit("xhr-resolved",[],t)),d.inPlace(t,y,"fn-",c)}function i(t){b.push(t),l&&(x?x.then(a):v?v(a):(E=-E,P.data=E))}function a(){for(var t=0;t<b.length;t++)r([],b[t]);b.length&&(b=[])}function c(t,e){return e}function s(t,e){for(var n in t)e[n]=t[n];return e}t(6);var f=t("ee"),u=f.get("xhr"),d=t(23)(u),p=NREUM.o,h=p.XHR,l=p.MO,m=p.PR,v=p.SI,w="readystatechange",y=["onload","onerror","onabort","onloadstart","onloadend","onprogress","ontimeout"],b=[];e.exports=u;var g=window.XMLHttpRequest=function(t){var e=new h(t);try{u.emit("new-xhr",[e],e),e.addEventListener(w,o,!1)}catch(n){try{u.emit("internal-error",[n])}catch(r){}}return e};if(s(h,g),g.prototype=h.prototype,d.inPlace(g.prototype,["open","send"],"-xhr-",c),u.on("send-xhr-start",function(t,e){r(t,e),i(e)}),u.on("open-xhr-start",r),l){var x=m&&m.resolve();if(!v&&!m){var E=1,P=document.createTextNode(E);new l(a).observe(P,{characterData:!0})}}else f.on("fn-end",function(t){t[0]&&t[0].type===w||a()})},{}],15:[function(t,e,n){function r(t){var e=this.params,n=this.metrics;if(!this.ended){this.ended=!0;for(var r=0;r<d;r++)t.removeEventListener(u[r],this.listener,!1);if(!e.aborted){if(n.duration=a.now()-this.startTime,4===t.readyState){e.status=t.status;var i=o(t,this.lastSize);if(i&&(n.rxSize=i),this.sameOrigin){var s=t.getResponseHeader("X-NewRelic-App-Data");s&&(e.cat=s.split(", ").pop())}}else e.status=0;n.cbTime=this.cbTime,f.emit("xhr-done",[t],t),c("xhr",[e,n,this.startTime])}}}function o(t,e){var n=t.responseType;if("json"===n&&null!==e)return e;var r="arraybuffer"===n||"blob"===n||"json"===n?t.response:t.responseText;return l(r)}function i(t,e){var n=s(e),r=t.params;r.host=n.hostname+":"+n.port,r.pathname=n.pathname,t.sameOrigin=n.sameOrigin}var a=t("loader");if(a.xhrWrappable){var c=t("handle"),s=t(16),f=t("ee"),u=["load","error","abort","timeout"],d=u.length,p=t("id"),h=t(19),l=t(18),m=window.XMLHttpRequest;a.features.xhr=!0,t(14),f.on("new-xhr",function(t){var e=this;e.totalCbs=0,e.called=0,e.cbTime=0,e.end=r,e.ended=!1,e.xhrGuids={},e.lastSize=null,h&&(h>34||h<10)||window.opera||t.addEventListener("progress",function(t){e.lastSize=t.loaded},!1)}),f.on("open-xhr-start",function(t){this.params={method:t[0]},i(this,t[1]),this.metrics={}}),f.on("open-xhr-end",function(t,e){"loader_config"in NREUM&&"xpid"in NREUM.loader_config&&this.sameOrigin&&e.setRequestHeader("X-NewRelic-ID",NREUM.loader_config.xpid)}),f.on("send-xhr-start",function(t,e){var n=this.metrics,r=t[0],o=this;if(n&&r){var i=l(r);i&&(n.txSize=i)}this.startTime=a.now(),this.listener=function(t){try{"abort"===t.type&&(o.params.aborted=!0),("load"!==t.type||o.called===o.totalCbs&&(o.onloadCalled||"function"!=typeof e.onload))&&o.end(e)}catch(n){try{f.emit("internal-error",[n])}catch(r){}}};for(var c=0;c<d;c++)e.addEventListener(u[c],this.listener,!1)}),f.on("xhr-cb-time",function(t,e,n){this.cbTime+=t,e?this.onloadCalled=!0:this.called+=1,this.called!==this.totalCbs||!this.onloadCalled&&"function"==typeof n.onload||this.end(n)}),f.on("xhr-load-added",function(t,e){var n=""+p(t)+!!e;this.xhrGuids&&!this.xhrGuids[n]&&(this.xhrGuids[n]=!0,this.totalCbs+=1)}),f.on("xhr-load-removed",function(t,e){var n=""+p(t)+!!e;this.xhrGuids&&this.xhrGuids[n]&&(delete this.xhrGuids[n],this.totalCbs-=1)}),f.on("addEventListener-end",function(t,e){e instanceof m&&"load"===t[0]&&f.emit("xhr-load-added",[t[1],t[2]],e)}),f.on("removeEventListener-end",function(t,e){e instanceof m&&"load"===t[0]&&f.emit("xhr-load-removed",[t[1],t[2]],e)}),f.on("fn-start",function(t,e,n){e instanceof m&&("onload"===n&&(this.onload=!0),("load"===(t[0]&&t[0].type)||this.onload)&&(this.xhrCbStart=a.now()))}),f.on("fn-end",function(t,e){this.xhrCbStart&&f.emit("xhr-cb-time",[a.now()-this.xhrCbStart,this.onload,e],e)})}},{}],16:[function(t,e,n){e.exports=function(t){var e=document.createElement("a"),n=window.location,r={};e.href=t,r.port=e.port;var o=e.href.split("://");!r.port&&o[1]&&(r.port=o[1].split("/")[0].split("@").pop().split(":")[1]),r.port&&"0"!==r.port||(r.port="https"===o[0]?"443":"80"),r.hostname=e.hostname||n.hostname,r.pathname=e.pathname,r.protocol=o[0],"/"!==r.pathname.charAt(0)&&(r.pathname="/"+r.pathname);var i=!e.protocol||":"===e.protocol||e.protocol===n.protocol,a=e.hostname===document.domain&&e.port===n.port;return r.sameOrigin=i&&(!e.hostname||a),r}},{}],17:[function(t,e,n){function r(){}function o(t,e,n){return function(){return i(t,[f.now()].concat(c(arguments)),e?null:this,n),e?void 0:this}}var i=t("handle"),a=t(20),c=t(21),s=t("ee").get("tracer"),f=t("loader"),u=NREUM;"undefined"==typeof window.newrelic&&(newrelic=u);var d=["setPageViewName","setCustomAttribute","setErrorHandler","finished","addToTrace","inlineHit","addRelease"],p="api-",h=p+"ixn-";a(d,function(t,e){u[e]=o(p+e,!0,"api")}),u.addPageAction=o(p+"addPageAction",!0),u.setCurrentRouteName=o(p+"routeName",!0),e.exports=newrelic,u.interaction=function(){return(new r).get()};var l=r.prototype={createTracer:function(t,e){var n={},r=this,o="function"==typeof e;return i(h+"tracer",[f.now(),t,n],r),function(){if(s.emit((o?"":"no-")+"fn-start",[f.now(),r,o],n),o)try{return e.apply(this,arguments)}catch(t){throw s.emit("fn-err",[arguments,this,t],n),t}finally{s.emit("fn-end",[f.now()],n)}}}};a("setName,setAttribute,save,ignore,onEnd,getContext,end,get".split(","),function(t,e){l[e]=o(h+e)}),newrelic.noticeError=function(t){"string"==typeof t&&(t=new Error(t)),i("err",[t,f.now()])}},{}],18:[function(t,e,n){e.exports=function(t){if("string"==typeof t&&t.length)return t.length;if("object"==typeof t){if("undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer&&t.byteLength)return t.byteLength;if("undefined"!=typeof Blob&&t instanceof Blob&&t.size)return t.size;if(!("undefined"!=typeof FormData&&t instanceof FormData))try{return JSON.stringify(t).length}catch(e){return}}}},{}],19:[function(t,e,n){var r=0,o=navigator.userAgent.match(/Firefox[\/\s](\d+\.\d+)/);o&&(r=+o[1]),e.exports=r},{}],20:[function(t,e,n){function r(t,e){var n=[],r="",i=0;for(r in t)o.call(t,r)&&(n[i]=e(r,t[r]),i+=1);return n}var o=Object.prototype.hasOwnProperty;e.exports=r},{}],21:[function(t,e,n){function r(t,e,n){e||(e=0),"undefined"==typeof n&&(n=t?t.length:0);for(var r=-1,o=n-e||0,i=Array(o<0?0:o);++r<o;)i[r]=t[e+r];return i}e.exports=r},{}],22:[function(t,e,n){e.exports={exists:"undefined"!=typeof window.performance&&window.performance.timing&&"undefined"!=typeof window.performance.timing.navigationStart}},{}],23:[function(t,e,n){function r(t){return!(t&&t instanceof Function&&t.apply&&!t[a])}var o=t("ee"),i=t(21),a="nr@original",c=Object.prototype.hasOwnProperty,s=!1;e.exports=function(t,e){function n(t,e,n,o){function nrWrapper(){var r,a,c,s;try{a=this,r=i(arguments),c="function"==typeof n?n(r,a):n||{}}catch(f){p([f,"",[r,a,o],c])}u(e+"start",[r,a,o],c);try{return s=t.apply(a,r)}catch(d){throw u(e+"err",[r,a,d],c),d}finally{u(e+"end",[r,a,s],c)}}return r(t)?t:(e||(e=""),nrWrapper[a]=t,d(t,nrWrapper),nrWrapper)}function f(t,e,o,i){o||(o="");var a,c,s,f="-"===o.charAt(0);for(s=0;s<e.length;s++)c=e[s],a=t[c],r(a)||(t[c]=n(a,f?c+o:o,i,c))}function u(n,r,o){if(!s||e){var i=s;s=!0;try{t.emit(n,r,o,e)}catch(a){p([a,n,r,o])}s=i}}function d(t,e){if(Object.defineProperty&&Object.keys)try{var n=Object.keys(t);return n.forEach(function(n){Object.defineProperty(e,n,{get:function(){return t[n]},set:function(e){return t[n]=e,e}})}),e}catch(r){p([r])}for(var o in t)c.call(t,o)&&(e[o]=t[o]);return e}function p(e){try{t.emit("internal-error",e)}catch(n){}}return t||(t=o),n.inPlace=f,n.flag=a,n}},{}],ee:[function(t,e,n){function r(){}function o(t){function e(t){return t&&t instanceof r?t:t?s(t,c,i):i()}function n(n,r,o,i){if(!p.aborted||i){t&&t(n,r,o);for(var a=e(o),c=l(n),s=c.length,f=0;f<s;f++)c[f].apply(a,r);var d=u[y[n]];return d&&d.push([b,n,r,a]),a}}function h(t,e){w[t]=l(t).concat(e)}function l(t){return w[t]||[]}function m(t){return d[t]=d[t]||o(n)}function v(t,e){f(t,function(t,n){e=e||"feature",y[n]=e,e in u||(u[e]=[])})}var w={},y={},b={on:h,emit:n,get:m,listeners:l,context:e,buffer:v,abort:a,aborted:!1};return b}function i(){return new r}function a(){(u.api||u.feature)&&(p.aborted=!0,u=p.backlog={})}var c="nr@context",s=t("gos"),f=t(20),u={},d={},p=e.exports=o();p.backlog=u},{}],gos:[function(t,e,n){function r(t,e,n){if(o.call(t,e))return t[e];var r=n();if(Object.defineProperty&&Object.keys)try{return Object.defineProperty(t,e,{value:r,writable:!0,enumerable:!1}),r}catch(i){}return t[e]=r,r}var o=Object.prototype.hasOwnProperty;e.exports=r},{}],handle:[function(t,e,n){function r(t,e,n,r){o.buffer([t],r),o.emit(t,e,n)}var o=t("ee").get("handle");e.exports=r,r.ee=o},{}],id:[function(t,e,n){function r(t){var e=typeof t;return!t||"object"!==e&&"function"!==e?-1:t===window?0:a(t,i,function(){return o++})}var o=1,i="nr@id",a=t("gos");e.exports=r},{}],loader:[function(t,e,n){function r(){if(!x++){var t=g.info=NREUM.info,e=p.getElementsByTagName("script")[0];if(setTimeout(u.abort,3e4),!(t&&t.licenseKey&&t.applicationID&&e))return u.abort();f(y,function(e,n){t[e]||(t[e]=n)}),s("mark",["onload",a()+g.offset],null,"api");var n=p.createElement("script");n.src="https://"+t.agent,e.parentNode.insertBefore(n,e)}}function o(){"complete"===p.readyState&&i()}function i(){s("mark",["domContent",a()+g.offset],null,"api")}function a(){return E.exists&&performance.now?Math.round(performance.now()):(c=Math.max((new Date).getTime(),c))-g.offset}var c=(new Date).getTime(),s=t("handle"),f=t(20),u=t("ee"),d=window,p=d.document,h="addEventListener",l="attachEvent",m=d.XMLHttpRequest,v=m&&m.prototype;NREUM.o={ST:setTimeout,SI:d.setImmediate,CT:clearTimeout,XHR:m,REQ:d.Request,EV:d.Event,PR:d.Promise,MO:d.MutationObserver};var w=""+location,y={beacon:"bam.nr-data.net",errorBeacon:"bam.nr-data.net",agent:"js-agent.newrelic.com/nr-spa-1071.min.js"},b=m&&v&&v[h]&&!/CriOS/.test(navigator.userAgent),g=e.exports={offset:c,now:a,origin:w,features:{},xhrWrappable:b};t(17),p[h]?(p[h]("DOMContentLoaded",i,!1),d[h]("load",r,!1)):(p[l]("onreadystatechange",o),d[l]("onload",r)),s("mark",["firstbyte",c],null,"api");var x=0,E=t(22)},{}]},{},["loader",2,15,5,3,4]);
;NREUM.info={beacon:"bam.nr-data.net",errorBeacon:"bam.nr-data.net",licenseKey:"13e44ec848",applicationID:"187820761",sa:1}
</script>


  <!-- FullStory -->
  <!-- <script>
/* eslint-disable */
window['_fs_debug'] = false;
window['_fs_host'] = 'fullstory.com';
window['_fs_org'] = '7JS2S';
window['_fs_namespace'] = 'FS';
(function(m,n,e,t,l,o,g,y){
    if (e in m) {if(m.console && m.console.log) { m.console.log('FullStory namespace conflict. Please set window["_fs_namespace"].');} return;}
    g=m[e]=function(a,b){g.q?g.q.push([a,b]):g._api(a,b);};g.q=[];
    o=n.createElement(t);o.async=1;o.src='https://'+_fs_host+'/s/fs.js';
    y=n.getElementsByTagName(t)[0];y.parentNode.insertBefore(o,y);
    g.identify=function(i,v){g(l,{uid:i});if(v)g(l,v)};g.setUserVars=function(v){g(l,v)};g.event=function(i,v){g('event',{n:i,p:v})};
    g.shutdown=function(){g("rec",!1)};g.restart=function(){g("rec",!0)};
    g.consent=function(a){g("consent",!arguments.length||a)};
    g.identifyAccount=function(i,v){o='account';v=v||{};v.acctId=i;g(o,v)};
    g.clearUserCookie=function(){};
})(window,document,window['_fs_namespace'],'script','user');
</script>
 -->

  <!-- Delighted -->
  <script type="text/javascript">
/* eslint-disable */
  !function(e,t,r,n,a){if(!e[a]){for(var i=e[a]=[],s=0;s<r.length;s++){var c=r[s];i[c]=i[c]||function(e){return function(){var t=Array.prototype.slice.call(arguments);i.push([e,t])}}(c)}i.SNIPPET_VERSION="1.0.1";var o=t.createElement("script");o.type="text/javascript",o.async=!0,o.src="https://d2yyd1h5u9mauk.cloudfront.net/integrations/web/v1/library/"+n+"/"+a+".js";var u=t.getElementsByTagName("script")[0];u.parentNode.insertBefore(o,u)}}(window,document,["survey","reset","config","init","set","get","event","identify","track","page","screen","group","alias"],"Mvwmq6n6DhInaFYu","delighted");

  delighted.survey();
</script>


  <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "Organization",
      "name": "KongHQ",
      "url": "https://docs.konghq.com",
      "logo": "https://docs.konghq.com/assets/images/logo.png",
      "sameAs": [
        "https://www.facebook.com/konginc",
        "https://twitter.com/thekonginc",
        "https://plus.google.com/+mashape"
      ]
    }
  </script>

  <!-- Preload assets -->
  <link rel="dns-prefetch" href="//cloud.typography.com">
  <link rel="dns-prefetch" href="//dev.visualwebsiteoptimizer.com">
  <link rel="dns-prefetch" href="//cdn.segment.com">
  <!-- ##gulp-resource-hints## -->

  <link rel="icon" type="image/x-icon" href="/assets/images/favicon.ico"/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
  <link rel="stylesheet" href="/assets/styles.css?v=1539384294"/>
  
</head>

<!-- Kong Cookie Policy -->
<div class="cookie-policy-container">
  <p>In order to give you better service we use cookies. By continuing to use our website, you agree to the use of cookies as described in our <a href=" https://konghq.com/cookie-policy/">Cookie Policy</a>
  <button class="cookie-policy-accept btn button" type="submit">I Agree</button>
</div>



  <body id=""  data-spy="scroll" data-target="#scroll-sidebar" data-offset="350">
    <header class="site-header fixed-top">
  <div class="enterprise">

    <!-- Kong Summit Announcement Banner -->

    <div class="container">
      <nav class="enterprise-sites one-half column">
        <ul>
          <li>
            <a href="https://konghq.com/kong-enterprise-edition">Enterprise</a>
          </li>
          <li>
            <a href="https://konghq.com/kong-community-edition">Kong API Gateway</a>
          </li>
        </ul>
      </nav>
      <nav class="enterprise-contact one-half column">
        <ul>
          <li>
            <a href="https://support.konghq.com/">Support</a>
          </li>
          <li>
            <a href="https://konghq.com/request-demo">Request Demo</a>
          </li>
        </ul>
      </nav>
    </div>
  </div>
  <!-- .enterprise -->
  <div class="navbar">
    <div class="container">
      <a href="https://konghq.com" class="navbar-brand">
        <img src="/assets/images/Kogo.svg" alt="Kong">
      </a>
      <iframe class="header-star" src="https://ghbtns.com/github-btn.html?user=Kong&amp;repo=kong&amp;type=star" frameborder="0"
        scrolling="0" width="55" height="20"></iframe>
      <button data-toggle="collapse" data-target="#navbar" aria-expanded="true" aria-controls="navbar" class="navbar-toggle">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <nav id="navbar" class="navbar-nav">
        <ul>
          <li>
            <a href="/" class="active">Docs</a>
          </li>
          <li>
            <a href="https://konghq.com/about-kong-inc/">About</a>
          </li>
          <li>
            <a href="/hub/">Hub</a>
          </li>
          <li>
            <a href="https://konghq.com/community-resources/">Community</a>
          </li>
          <li>
            <a href="https://konghq.com/kong-enterprise-edition/">Enterprise</a>
          </li>
          <li>
            <a href="https://github.com/Kong/kong" target="_blank">GitHub</a>
          </li>
          <li class="hidden-lg">
            <a href="https://support.konghq.com/">Support</a>
          </li>
          <li>
            <a href="https://konghq.com/install" class="button button-dark" data-analytics='{"event": "Clicked download", "type": "button", "location": "header"}'>Installation</a>
          </li>
        </ul>
      </nav>
    </div>
  </div>
  <!-- .navbar -->
</header>


    <div class="page ">
  <header class="page-header">
    <div class="container">
        <div class="edit-this-page">
            <a target="_blank" href="https://github.com/Kong/docs.konghq.com/tree/master/app/enterprise/0.33-x/rbac/examples.md"><i class="fa fa-github"></i> Edit this Page</a>
          </div>
      <nav class="docs-navigation">
        <a href="/" >Kong Community Edition (CE)</a>
        <a href="/enterprise"  class="active">Kong Enterprise Edition (EE)</a>
      </nav>
      <div class="page-header-icon">
        <img src="/assets/images/icons/icn-documentation-ee.svg" alt="Documentation" />
      </div>
      <div class="page-header-title">
        <p>Documentation</p>
        
        
        <div class="page-header-section-title">
            Enterprise Edition (0.33-x)
            
        </div>
        
      </div>

      
        <div class="dropdown page-header-right">
          <button class="page-header-btn" id="version-dropdown" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Version 0.33-x
            <em>(latest)</em>
            <span class="caret"></span>
          </button>

          <ul class="dropdown-menu dropdown-menu-right" role="menu" aria-labelledby="version-dropdown">
            
              
            
              
                <li>
                  <a href="/enterprise/0.32-x">
                    0.32-x
                  </a>
                </li>
              
            
              
                <li>
                  <a href="/enterprise/0.31-x">
                    0.31-x
                  </a>
                </li>
              
            
          </ul>
          
        </div>
      
    </div>
  </header>

  <div class="container">
    <aside class="page-navigation">
      

      

      
      <nav>
        
          <h5>Getting Started</h5>
        
        <ul>
          
          
          <li>
            <a href="/enterprise/0.33-x/getting-started/introduction" >
              Introduction
            </a>
            
          </li>
          
          
          <li>
            <a href="/enterprise/0.33-x/getting-started/quickstart" >
              Five-minute quickstart
            </a>
            
          </li>
          
          
          <li>
            <a href="/enterprise/0.33-x/getting-started/adding-your-api" >
              Adding your API
            </a>
            
          </li>
          
          
          <li>
            <a href="/enterprise/0.33-x/getting-started/enabling-plugins" >
              Enabling Plugins
            </a>
            
          </li>
          
          
          <li>
            <a href="/enterprise/0.33-x/getting-started/adding-consumers" >
              Adding Consumers
            </a>
            
          </li>
          
          
          <li>
            <a href="/enterprise/0.33-x/getting-started/licensing" >
              Licensing
            </a>
            
          </li>
          
          
          <li>
            <a href="/enterprise/0.33-x/getting-started/accessing-your-license" >
              Accessing Your License
            </a>
            
          </li>
          
        </ul>
      </nav>
      
      <nav>
        
          <h5>Installation</h5>
        
        <ul>
          
          
          <li>
            <a href="/enterprise/0.33-x/installation/docker" >
              Docker
            </a>
            
          </li>
          
          
          <li>
            <a href="/enterprise/0.33-x/installation/centos" >
              CentOS
            </a>
            
          </li>
          
          
          <li>
            <a href="/enterprise/0.33-x/installation/amazon-linux" >
              Amazon Linux
            </a>
            
          </li>
          
        </ul>
      </nav>
      
      <nav>
        
          <h5>APIs and Plugins</h5>
        
        <ul>
          
          
          <li>
            <a href="/enterprise/0.33-x/plugins/canary-release" >
              Canary Release Plugin
            </a>
            
          </li>
          
          
          <li>
            <a href="/enterprise/0.33-x/plugins/rate-limiting-advanced" >
              Rate Limiting Plugin
            </a>
            
          </li>
          
          
          <li>
            <a href="/enterprise/0.33-x/plugins/request-transformer" >
              Request Transformer Plugin
            </a>
            
          </li>
          
          
          <li>
            <a href="/enterprise/0.33-x/plugins/oauth2-introspection" >
              OAuth2 Introspection Plugin
            </a>
            
          </li>
          
          
          <li>
            <a href="/enterprise/0.33-x/plugins/openid-connect" >
              OpenID Connect Plugin
            </a>
            
          </li>
          
          
          <li>
            <a href="/enterprise/0.33-x/plugins/http-proxy-caching" >
              HTTP Proxy Caching
            </a>
            
          </li>
          
          
          <li>
            <a href="/enterprise/0.33-x/plugins/forward-proxy" >
              Forward Proxy
            </a>
            
          </li>
          
          
          <li>
            <a href="/enterprise/0.33-x/plugins/statsd-advanced" >
              StatsD Advanced Plugin
            </a>
            
          </li>
          
          
          <li>
            <a href="/enterprise/0.33-x/plugins/ldap-authentication-advanced" >
              LDAP Auth Advanced Plugin
            </a>
            
          </li>
          
        </ul>
      </nav>
      
      <nav>
        
          <h5>Workspaces</h5>
        
        <ul>
          
          
          <li>
            <a href="/enterprise/0.33-x/workspaces/overview" >
              Overview
            </a>
            
          </li>
          
          
          <li>
            <a href="/enterprise/0.33-x/workspaces/admin-api" >
              Admin API
            </a>
            
          </li>
          
          
          <li>
            <a href="/enterprise/0.33-x/workspaces/examples" >
              Examples
            </a>
            
          </li>
          
        </ul>
      </nav>
      
      <nav>
        
          <h5>RBAC</h5>
        
        <ul>
          
          
          <li>
            <a href="/enterprise/0.33-x/rbac/overview" >
              Overview
            </a>
            
          </li>
          
          
          <li>
            <a href="/enterprise/0.33-x/rbac/admin-api" >
              Admin API
            </a>
            
          </li>
          
          
          <li>
            <a href="/enterprise/0.33-x/rbac/examples" class="active">
              Examples
            </a>
            
          </li>
          
        </ul>
      </nav>
      
      <nav>
        
          <h5>Kong Admin GUI</h5>
        
        <ul>
          
          
          <li>
            <a href="/enterprise/0.33-x/admin-gui/overview" >
              Overview
            </a>
            
          </li>
          
          
          <li>
            <a href="/enterprise/0.33-x/admin-gui/configuration/getting-started" >
              Configuration
            </a>
            
            <ul>
              
              
              <li>
                <a href="/enterprise/0.33-x/admin-gui/configuration/getting-started" >Getting Started</a>
              </li>
              
              
              <li>
                <a href="/enterprise/0.33-x/admin-gui/configuration/authentication" >Authentication</a>
              </li>
              
              
              <li>
                <a href="/enterprise/0.33-x/admin-gui/configuration/managing-admins" >Managing Admins</a>
              </li>
              
              
              <li>
                <a href="/enterprise/0.33-x/admin-gui/configuration/networking" >Networking</a>
              </li>
              
              
              <li>
                <a href="/enterprise/0.33-x/admin-gui/configuration/property-reference" >Property Reference</a>
              </li>
              
            </ul>
            
          </li>
          
        </ul>
      </nav>
      
      <nav>
        
          <h5>Kong Developer Portal</h5>
        
        <ul>
          
          
          <li>
            <a href="/enterprise/0.33-x/developer-portal/overview" >
              Overview
            </a>
            
          </li>
          
          
          <li>
            <a href="/enterprise/0.33-x/developer-portal/glossary" >
              Glossary
            </a>
            
          </li>
          
          
          <li>
            <a href="/enterprise/0.33-x/developer-portal/best-practices" >
              Best Practices
            </a>
            
          </li>
          
          
          <li>
            <a href="/enterprise/0.33-x/developer-portal/configuration/getting-started" >
              Configuration
            </a>
            
            <ul>
              
              
              <li>
                <a href="/enterprise/0.33-x/developer-portal/configuration/getting-started" >Getting Started</a>
              </li>
              
              
              <li>
                <a href="/enterprise/0.33-x/developer-portal/configuration/authentication" >Authentication</a>
              </li>
              
              
              <li>
                <a href="/enterprise/0.33-x/developer-portal/configuration/networking" >Networking</a>
              </li>
              
              
              <li>
                <a href="/enterprise/0.33-x/developer-portal/configuration/property-reference" >Property Reference</a>
              </li>
              
            </ul>
            
          </li>
          
          
          <li>
            <a href="/enterprise/0.33-x/developer-portal/managing-developers" >
              Managing Developers
            </a>
            
          </li>
          
          
          <li>
            <a href="/enterprise/0.33-x/developer-portal/developer-access" >
              Developer Access
            </a>
            
          </li>
          
          
          <li>
            <a href="/enterprise/0.33-x/developer-portal/file-management" >
              File Management
            </a>
            
          </li>
          
          
          <li>
            <a href="/enterprise/0.33-x/developer-portal/customization" >
              Customization
            </a>
            
          </li>
          
          
          <li>
            <a href="/enterprise/0.33-x/developer-portal/faq" >
              FAQ
            </a>
            
          </li>
          
        </ul>
      </nav>
      
      <nav>
        
          <h5>Guides &amp; References</h5>
        
        <ul>
          
          
          <li>
            <a href="/enterprise/0.33-x/deployment-guide" >
              Kong Deployment Guide
            </a>
            
          </li>
          
          
          <li>
            <a href="/enterprise/changelog" >
              Changelog
            </a>
            
          </li>
          
          
          <li>
            <a href="/enterprise/0.33-x/kong-architecture-overview" >
              Architecture Overview
            </a>
            
          </li>
          
          
          <li>
            <a href="/enterprise/0.33-x/kong-architecture-patterns" >
              Architecture Patterns
            </a>
            
          </li>
          
          
          <li>
            <a href="/enterprise/0.33-x/vitals" >
              Kong Vitals
            </a>
            
          </li>
          
          
          <li>
            <a href="/enterprise/0.33-x/rate-limiting" >
              Rate Limiting Library
            </a>
            
          </li>
          
          
          <li>
            <a href="/enterprise/0.33-x/edition-versioning" >
              Kong Enterprise Edition Versioning
            </a>
            
          </li>
          
          
          <li>
            <a href="/enterprise/0.33-x/allowing-multiple-authentication-methods" >
              Multiple Authentication Methods
            </a>
            
          </li>
          
          
          <li>
            <a href="/enterprise/0.33-x/postgresql-redhat" >
              PostgreSQL on RedHat
            </a>
            
          </li>
          
          
          <li>
            <a href="/enterprise/0.33-x/oidc-google" >
              OpenID Connect with Google
            </a>
            
          </li>
          
          
          <li>
            <a href="/enterprise/0.33-x/oidc-auth0" >
              OpenID Connect with Auth0
            </a>
            
          </li>
          
          
          <li>
            <a href="/enterprise/0.33-x/upgrades-migrations" >
              Upgrades and Migrations
            </a>
            
          </li>
          
        </ul>
      </nav>
      
    </aside>

    <div class="page-content-container" id="documentation">
      <div class="page-content">
        <div class="content">
          
          

          <h1 id="rbac-examples">RBAC Examples</h1>

<p>This chapter aims to provide a step-by-step tutorial on how to set up
RBAC and see it in action, with an end-to-end use case. The chosen
use case demonstrates how <strong>RBAC with workspaces</strong> can be coupled
to achieve a flexible organization of teams and users in complex
hierarchies. Make sure to read the <a href="/enterprise/0.33-x/rbac/overview">RBAC Overview</a> page
and to glance over the <a href="/enterprise/0.33-x/rbac/admin-api">RBAC Admin API</a> chapter, keeping it
open as a reference.</p>

<h2 id="use-case">Use Case</h2>

<p>For the sake of example, let&#39;s say a given company has a Kong Enterprise
cluster to be shared with 3 teams: teamA, teamB, and teamC. While the Kong
cluster are shared among these teams, they want to be able to segment
their entities in such a way that management of entities in one team doesn&#39;t
disrupt operation in some other team. As shown in the
<a href="/enterprise/0.33-x/rbac/examples">Workspaces Examples Page</a>, such a use case is possible
with workspaces. On top of workspaces, though, each team wants to enforce
access control over their Workspace, which is possible with RBAC. <strong>To sum up,
Workspaces and RBAC are complementary: Workspaces provide segmentation of
Admin API entities, while RBAC provides access control</strong>.</p>

<h2 id="bootstrapping-the-first-rbac-user-the-super-admin">Bootstrapping the first RBAC user - the Super Admin</h2>

<p>Before anything, we will assume the Kong Admin - or, more interestingly,
the KongOps Engineer - in charge of operating Kong, will create a Super Admin
user, before actually enforcing RBAC and restarting Kong with RBAC enabled.</p>

<p>As Kong ships with a handy set of default RBAC Roles - the <code>super-admin</code>,
the <code>admin</code>, and <code>read-only</code> - the task of creating a Super Admin user is
quite easy:</p>

<p>Create the RBAC user, named <code>super-admin</code>:</p>
<div class="highlight"><pre><code class="language-" data-lang="">http :8001/rbac/users name=super-admin
{
  "user_token": "M8J5A88xKXa7FNKsMbgLMjkm6zI2anOY",
  "id": "da80838d-49f8-40f6-b673-6fff3e2c305b",
  "enabled": true,
  "created_at": 1531009435000,
  "name": "super-admin"
}
</code></pre></div>
<p>As the <code>super-admin</code> user name coincides with an existing <code>super-admin</code>
role, it gets automatically added to the <code>super-admin</code> role - which can be
confirmed with the following command:</p>
<div class="highlight"><pre><code class="language-" data-lang="">http :8001/rbac/users/super-admin/roles
{
  "roles": [
    {
      "comment": "Full access to all endpoints, across all workspaces",
      "created_at": 1531009724000,
      "name": "super-admin",
      "id": "b924ac91-e83f-4136-a5a4-4a7ff92594a8"
    }
  ],
  "user": {
    "created_at": 1531009858000,
    "id": "e6897cc0-0c34-4a9c-9f0b-cc65b4f04d68",
    "name": "super-admin",
    "enabled": true,
    "user_token": "vajeOlkybsn0q0VD9qw9B3nHYOErgY7b8"
  }
}

</code></pre></div>
<p>As the <code>super-admin</code> user has just been created, the Kong Admin may now
restart Kong with RBAC enforced, with, e.g.:</p>
<div class="highlight"><pre><code class="language-" data-lang="">KONG_ENFORCE_RBAC=on kong restart
</code></pre></div>
<p><strong>NOTE</strong>: This is one of the possible ways of enforcing RBAC and restarting
Kong; another possibility is editing the Kong configuration file and
restarting.</p>

<p>Before we move on, note that we will be using the Super Admin user, but we
could, in fact, be moving without RBAC enabled, and having our Kong Admin do
all the job of setting up the RBAC hierarchy. We want, however, to stress the
fact that RBAC is powerful enough to allow a flexible separation of tasks. To
summarize:</p>

<ul>
<li><strong>Kong Admin</strong>: this user has physical access to Kong infrastructure; her
task is to bootstrap the Kong cluster as well as its configuration, including
initial RBAC users;</li>
<li><strong>RBAC Super Admin</strong>: created by the Kong Admin, has the role of managing
RBAC users, roles, etc; this could all be done by the <strong>Kong Admin</strong>, but let&#39;s
give him a break.</li>
</ul>

<h2 id="super-admin-creates-the-teams-workspaces">Super Admin creates the teams Workspaces</h2>

<p>The Super Admin will now set up our 3 teams: teamA, teamB, and teamC, creating
one workspace for each, one admin for each. Enough talking.</p>

<p>Creating workspaces for each team - this overlaps a bit with
<a href="/enterprise/0.33-x/rbac/examples">Workspaces Examples</a>, yes, but it will make our
exploration of RBAC + Workspaces easier:</p>

<p><strong>Team A</strong>:</p>
<div class="highlight"><pre><code class="language-" data-lang="">http :8001/workspaces name=teamA Kong-Admin-Token:vajeOlkbsn0q0VD9qw9B3nHYOErgY7b8
{
  "name": "teamA",
  "created_at": 1531014100000,
  "id": "1412f3a6-4d9b-4b9d-964e-60d8d63a9d46"
}

</code></pre></div>
<p><strong>Team B</strong>:</p>
<div class="highlight"><pre><code class="language-" data-lang="">http :8001/workspaces name=teamB Kong-Admin-Token:vajeOlkbsn0q0VD9qw9B3nHYOErgY7b8
{
  "name": "teamB",
  "created_at": 1531014143000,
  "id": "7dee8c56-c6db-4125-b87a-b508baa33c66"
}
</code></pre></div>
<p><strong>Team C</strong>:</p>
<div class="highlight"><pre><code class="language-" data-lang="">http :8001/workspaces name=teamC Kong-Admin-Token:vajeOlkbsn0q0VD9qw9B3nHYOErgY7b8
{
  "name": "teamC",
  "created_at": 1531014171000,
  "id": "542c8662-17cc-49eb-af50-6eb14f3b2e8a"
}
</code></pre></div>
<p><strong>NOTE</strong>: this is the RBAC Super Admin creating workspaces - note his
token being passed in through the <code>Kong-Admin-Token</code> HTTP header.</p>

<h2 id="super-admin-creates-one-admin-for-each-team">Super Admin Creates one Admin for each Team:</h2>

<p><strong>Team A</strong>:</p>
<div class="highlight"><pre><code class="language-" data-lang="">http :8001/teamA/rbac/users name=adminA Kong-Admin-Token:vajeOlkbsn0q0VD9qw9B3nHYOErgY7b8
{
  "user_token": "qv1VLIpl8kHj7lC1QOKwRdCMXanqEDii",
  "id": "4d315ff9-8c1a-4844-9ea2-21b16204a154",
  "enabled": true,
  "created_at": 1531015165000,
  "name": "adminA"
}
</code></pre></div>
<p><strong>Team B</strong>:</p>
<div class="highlight"><pre><code class="language-" data-lang="">http :8001/teamB/rbac/users name=adminB Kong-Admin-Token:vajeOlkbsn0q0VD9qw9B3nHYOErgY7b8
{
  "user_token": "IX5vHVgYqM40tLcctdmzRtHyfxB4ToYv",
  "id": "49641fc0-8c9d-4507-bc7a-2acac8f2903a",
  "enabled": true,
  "created_at": 1531015221000,
  "name": "adminB"
}
</code></pre></div>
<p><strong>Team C</strong>:</p>
<div class="highlight"><pre><code class="language-" data-lang="">http :8001/teamC/rbac/users name=adminC Kong-Admin-Token:vajeOlkbsn0q0VD9qw9B3nHYOErgY7b8
{
  "user_token": "w2f7tsuUW4BerXocZIMRQHE84nK2ZAo7",
  "id": "74643f69-8852-49f9-b363-21971bac4f52",
  "enabled": true,
  "created_at": 1531015304000,
  "name": "teamC"
}
</code></pre></div>
<p>With this, all of the teams have one admin and each admin can only be seen
in his corresponding workspace. To verify:</p>
<div class="highlight"><pre><code class="language-" data-lang="">http :8001/teamA/rbac/users Kong-Admin-Token:vajeOlkbsn0q0VD9qw9B3nHYOErgY7b8
{
  "total": 1,
  "data": [
    {
      "created_at": 1531014784000,
      "id": "1faaacd1-709f-4762-8c3e-79f268ec8faf",
      "name": "adminA",
      "enabled": true,
      "user_token": "n5bhjgv0speXp4N7rSUzUj8PGnl3F5eG"
    }
  ]
}
</code></pre></div>
<p>Similarly, workspaces teamB and teamC only show their respective admins:</p>
<div class="highlight"><pre><code class="language-" data-lang="">http :8001/teamB/rbac/users Kong-Admin-Token:vajeOlkbsn0q0VD9qw9B3nHYOErgY7b8
{
  "total": 1,
  "data": [
    {
      "created_at": 1531014805000,
      "id": "3a829408-c1ee-4764-8222-2d280a5de441",
      "name": "adminB",
      "enabled": true,
      "user_token": "C8b6kTTN10JFyU63ORjmCQwVbvK4maeq"
    }
  ]
}
</code></pre></div><div class="highlight"><pre><code class="language-" data-lang="">http :8001/teamC/rbac/users Kong-Admin-Token:vajeOlkbsn0q0VD9qw9B3nHYOErgY7b8
{
  "total": 1,
  "data": [
    {
      "created_at": 1531014813000,
      "id": "84d43cdb-5274-4b74-ad22-615e50f005e3",
      "name": "adminC",
      "enabled": true,
      "user_token": "zN5Nj8U1MiGR7vVQKvl8odaGBDI6mjgY"
    }
  ]
}
</code></pre></div>
<h2 id="super-admin-creates-admin-roles-for-teams">Super Admin Creates Admin Roles for Teams</h2>

<p>Super Admin is now done creating RBAC Admin users for each team; his next
task is to create admin roles that will effectively grant permissions to admin
users.</p>

<p>The admin role must have access to all of the Admin API, restricted to his
workspace.</p>

<p>Setting up the Admin role - pay close attention to the request parameters:</p>
<div class="highlight"><pre><code class="language-" data-lang="">http :8001/teamA/rbac/roles/ name=admin Kong-Admin-Token:vajeOlkbsn0q0VD9qw9B3nHYOErgY7b8
{
  "created_at": 1531016728000,
  "id": "d40e61ab-8dad-4ef2-a48b-d11379f7b8d1",
  "name": "admin"
}
</code></pre></div>
<p>Creating role endpoint permissions:</p>
<div class="highlight"><pre><code class="language-" data-lang="">http :8001/teamA/rbac/roles/admin/endpoints/ endpoint=* workspace=teamA actions=* Kong-Admin-Token:vajeOlkbsn0q0VD9qw9B3nHYOErgY7b8
{
  "total": 1,
  "data": [
    {
      "endpoint": "*",
      "created_at": 1531017322000,
      "role_id": "d40e61ab-8dad-4ef2-a48b-d11379f7b8d1",
      "actions": [
        "delete",
        "create",
        "update",
        "read"
      ],
      "negative": false,
      "workspace": "teamA"
    }
  ]
}
</code></pre></div>
<p>Next logical step is to add the adminA user - admin of Team A - to the Admin
role in his workspace:</p>
<div class="highlight"><pre><code class="language-" data-lang="">http :8001/teamA/rbac/users/adminA/roles/ roles=admin Kong-Admin-Token:vajeOlkbsn0q0VD9qw9B3nHYOErgY7b8
{
  "roles": [
    {
      "comment": "Default user role generated for adminA",
      "created_at": 1531014784000,
      "id": "e2941b41-92a4-4f49-be89-f1a452bdecd0",
      "name": "adminA"
    },
    {
      "created_at": 1531016728000,
      "id": "d40e61ab-8dad-4ef2-a48b-d11379f7b8d1",
      "name": "admin"
    }
  ],
  "user": {
    "created_at": 1531014784000,
    "id": "1faaacd1-709f-4762-8c3e-79f268ec8faf",
    "name": "adminA",
    "enabled": true,
    "user_token": "n5bhjgv0speXp4N7rSUzUj8PGnl3F5eG"
  }
}
</code></pre></div>
<p>Note the admin role in the list above.</p>

<p>With these steps, Team A&#39;s admin user is now able to manage his team. To
validate that, let&#39;s try to list RBAC users in Team B using Team A&#39;s admin
user token - and see that we are not allowed to do so:</p>
<div class="highlight"><pre><code class="language-" data-lang="">http :8001/teamB/rbac/users Kong-Admin-Token:n5bhjgv0speXp4N7rSUzUj8PGnl3F5eG
{
  "message": "Invalid RBAC credentials"
}
</code></pre></div>
<p>Said admin is, however, allowed to list RBAC users in Team A&#39;s workspace:</p>
<div class="highlight"><pre><code class="language-" data-lang="">http :8001/teamA/rbac/users Kong-Admin-Token:n5bhjgv0speXp4N7rSUzUj8PGnl3F5eG
{
  "total": 1,
  "data": [
    {
      "created_at": 1531014784000,
      "id": "1faaacd1-709f-4762-8c3e-79f268ec8faf",
      "name": "adminA",
      "enabled": true,
      "user_token": "n5bhjgv0speXp4N7rSUzUj8PGnl3F5eG"
    }
  ]
}
</code></pre></div>
<p>If the same procedure is repeated for Team B and Team C, they will end up with
a similar set up, with an admin role and an admin user, both restricted to the
team&#39;s workspace.</p>

<p>And so Super Admin ends his participation; individual team admins are now able
to set up his teams users and entities!</p>

<h2 id="team-admins-create-team-regular-users">Team Admins Create Team Regular Users</h2>

<p>From this point on, team admins are able to drive the process; the next logical
step is for Team users to be created; such team users could be, for example,
engineers that are part of Team A (or B or C). Let&#39;s go ahead and do that,
using Admin A&#39;s user token.</p>

<p>Before regular users can be created, a role needs to be available for them.
Such a role needs to have permissions to all of Admin API endpoints, except
RBAC and Workspaces - regular users will not need access to these in general
and, if they do, the Admin can grant them.</p>

<p><strong>Creating the regular users role</strong>:</p>
<div class="highlight"><pre><code class="language-" data-lang="">http :8001/teamA/rbac/roles/ name=users Kong-Admin-Token:n5bhjgv0speXp4N7rSUzUj8PGnl3F5eG
{
  "created_at": 1531020346000,
  "id": "9846b92c-6820-4741-ac31-425b3d6abc5b",
  "name": "users"
}
</code></pre></div>
<p><strong>Creating permissions in the regular users role</strong>:</p>

<p>First, permission to all of Admin API - positive permission on *:</p>
<div class="highlight"><pre><code class="language-" data-lang="">http :8001/teamA/rbac/roles/users/endpoints/ endpoint=* workspace=teamA actions=* Kong-Admin-Token:n5bhjgv0speXp4N7rSUzUj8PGnl3F5eG
{
  "endpoint": "*",
  "created_at": 1531020573000,
  "role_id": "9846b92c-6820-4741-ac31-425b3d6abc5b",
  "actions": [
    "delete",
    "create",
    "update",
    "read"
  ],
  "negative": false,
  "workspace": "teamA"
}
</code></pre></div>
<p>Then, filter out RBAC and workspaces with negative permissions:</p>
<div class="highlight"><pre><code class="language-" data-lang="">http :8001/teamA/rbac/roles/users/endpoints/ endpoint=/rbac/* workspace=teamA actions=* Kong-Admin-Token:n5bhjgv0speXp4N7rSUzUj8PGnl3F5eG
{
  "endpoint": "/rbac/*",
  "created_at": 1531020744000,
  "role_id": "9846b92c-6820-4741-ac31-425b3d6abc5b",
  "actions": [
    "delete",
    "create",
    "update",
    "read"
  ],
  "negative": true,
  "workspace": "teamA"
}
</code></pre></div><div class="highlight"><pre><code class="language-" data-lang="">http :8001/teamA/rbac/roles/users/endpoints/ endpoint=/workspaces/* workspace=teamA actions=* Kong-Admin-Token:n5bhjgv0speXp4N7rSUzUj8PGnl3F5eG
{
  "endpoint": "/workspaces/*",
  "created_at": 1531020778000,
  "role_id": "9846b92c-6820-4741-ac31-425b3d6abc5b",
  "actions": [
    "delete",
    "create",
    "update",
    "read"
  ],
  "negative": true,
  "workspace": "teamA"
}
</code></pre></div>
<p><strong>IMPORTANT</strong>: as explained in the [Wildcards in Permissions][rbac-wildcards]
section, the meaning of <code>*</code> is not the expected generic globbing one might
be used to. As such, <code>/rbac/*</code> or <code>/workspaces/*</code> do not match all of the
RBAC and Workspaces endpoints. For example, to cover all of the RBAC API,
one would have to define permissions for the following endpoints:</p>

<ul>
<li><code>/rbac/*</code></li>
<li><code>/rbac/*/*</code></li>
<li><code>/rbac/*/*/*</code></li>
<li><code>/rbac/*/*/*/*</code></li>
<li><code>/rbac/*/*/*/*/*</code></li>
</ul>

<p>Team A just got 3 new members: foogineer, bargineer, and bazgineer. Admin A
will welcome them to the team by creating RBAC users for them and giving them
access to Kong!</p>

<p>Create foogineer:</p>
<div class="highlight"><pre><code class="language-" data-lang="">http :8001/teamA/rbac/users name=foogineer Kong-Admin-Token:n5bhjgv0speXp4N7rSUzUj8PGnl3F5eG
{
  "created_at": 1531019797000,
  "id": "0b4111da-2827-4767-8651-a327f7a559e9",
  "name": "foogineer",
  "enabled": true,
  "user_token": "dNeYvYAwvjOJdoReVJZXF8vLBXQioKkI"
}
</code></pre></div>
<p>Add foogineer to the <code>users</code> role:</p>
<div class="highlight"><pre><code class="language-" data-lang="">http :8001/teamA/rbac/users/foogineer/roles roles=users Kong-Admin-Token:n5bhjgv0speXp4N7rSUzUj8PGnl3F5eG
{
  "roles": [
    {
      "comment": "Default user role generated for foogineer",
      "created_at": 1531019797000,
      "id": "125c4212-b882-432d-a323-9cbe38b1d0df",
      "name": "foogineer"
    },
    {
      "created_at": 1531020346000,
      "id": "9846b92c-6820-4741-ac31-425b3d6abc5b",
      "name": "users"
    }
  ],
  "user": {
    "created_at": 1531019797000,
    "id": "0b4111da-2827-4767-8651-a327f7a559e9",
    "name": "foogineer",
    "enabled": true,
    "user_token": "dNeYvYAwvjOJdoReVJZXF8vLBXQioKkI"
  }
}
</code></pre></div>
<p>Create bargineer:</p>
<div class="highlight"><pre><code class="language-" data-lang="">http :8001/teamA/rbac/users name=bargineer Kong-Admin-Token:n5bhjgv0speXp4N7rSUzUj8PGnl3F5eG
{
  "created_at": 1531019837000,
  "id": "25dfa68e-32e8-48d8-815f-6fedfd2fb4a6",
  "name": "bargineer",
  "enabled": true,
  "user_token": "eZj3WUc46wO3zEJbLP3Y4VGvNaUgGlyv"
}
</code></pre></div>
<p>Add bargineer to the <code>users</code> role:</p>
<div class="highlight"><pre><code class="language-" data-lang="">http :8001/teamA/rbac/users/bargineer/roles roles=users Kong-Admin-Token:n5bhjgv0speXp4N7rSUzUj8PGnl3F5eG
{
  "roles": [
    {
      "comment": "Default user role generated for bargineer",
      "created_at": 1531019837000,
      "id": "3edb00c2-9ae1-423d-ac81-bec702c29e37",
      "name": "bargineer"
    },
    {
      "created_at": 1531020346000,
      "id": "9846b92c-6820-4741-ac31-425b3d6abc5b",
      "name": "users"
    }
  ],
  "user": {
    "created_at": 1531019837000,
    "id": "25dfa68e-32e8-48d8-815f-6fedfd2fb4a6",
    "name": "bargineer",
    "enabled": true,
    "user_token": "eZj3WUc46wO3zEJbLP3Y4VGvNaUgGlyv"
  }
}
</code></pre></div>
<p>Create bazgineer:</p>
<div class="highlight"><pre><code class="language-" data-lang="">http :8001/teamA/rbac/users name=bazgineer Kong-Admin-Token:n5bhjgv0speXp4N7rSUzUj8PGnl3F5eG
{
  "created_at": 1531019937000,
  "id": "ea7207d7-0d69-427b-b288-ce696b7f4690",
  "name": "bazgineer",
  "enabled": true,
  "user_token": "r8NhaT213Zm8o1woQF4ZyQyCVjFRgGp3"
}
</code></pre></div>
<p>Add bazgineer to the <code>users</code> role:</p>
<div class="highlight"><pre><code class="language-" data-lang="">http :8001/teamA/rbac/users/bazgineer/roles roles=users Kong-Admin-Token:n5bhjgv0speXp4N7rSUzUj8PGnl3F5eG
{
  "roles": [
    {
      "comment": "Default user role generated for bazgineer",
      "created_at": 1531019937000,
      "id": "fa409bb6-c86c-45d2-8a6b-ac8e71de2cc9",
      "name": "bazgineer"
    },
    {
      "created_at": 1531020346000,
      "name": "users",
      "id": "9846b92c-6820-4741-ac31-425b3d6abc5b"
    }
  ],
  "user": {
    "created_at": 1531019937000,
    "id": "ea7207d7-0d69-427b-b288-ce696b7f4690",
    "name": "bazgineer",
    "enabled": true,
    "user_token": "r8NhaT213Zm8o1woQF4ZyQyCVjFRgGp3"
  }
}
</code></pre></div>
<h2 id="regular-team-users-use-their-tokens">Regular Team Users use their tokens!</h2>

<p>foogineer, bargineer, and bazgineer all have gotten their RBAC user tokens
from their Team A admin, and are now allowed to explore Kong - within the
confines of their Team A workspace. Let&#39;s validate they can in fact do anything
they wish, except over RBAC and Workspaces.</p>

<p>Try listing Workspaces:</p>
<div class="highlight"><pre><code class="language-" data-lang="">http :8001/teamA/workspaces/ Kong-Admin-Token:dNeYvYAwvjOJdoReVJZXF8vLBXQioKkI
{
  "message": "foogineer, you do not have permissions to read this resource"
}
</code></pre></div>
<p>Enable some plugin - e.g., key-auth:</p>
<div class="highlight"><pre><code class="language-" data-lang="">http :8001/teamA/plugins name=key-auth Kong-Admin-Token:dNeYvYAwvjOJdoReVJZXF8vLBXQioKkI
{
  "created_at": 1531021732000,
  "config": {
    "key_in_body": false,
    "run_on_preflight": true,
    "anonymous": "",
    "hide_credentials": false,
    "key_names": [
      "apikey"
    ]
  },
  "id": "cdc85ef0-804b-4f92-aafd-3ff58512e445",
  "enabled": true,
  "name": "key-auth"
}
</code></pre></div>
<p>List currently enabled plugins:</p>
<div class="highlight"><pre><code class="language-" data-lang="">http :8001/teamA/plugins Kong-Admin-Token:dNeYvYAwvjOJdoReVJZXF8vLBXQioKkI
{
  "total": 1,
  "data": [
    {
      "created_at": 1531021732000,
      "config": {
        "key_in_body": false,
        "run_on_preflight": true,
        "anonymous": "",
        "hide_credentials": false,
        "key_names": [
          "apikey"
        ]
      },
      "id": "cdc85ef0-804b-4f92-aafd-3ff58512e445",
      "name": "key-auth",
      "enabled": true
    }
  ]
}
</code></pre></div>
<p>This ends our use case tutorial; it demonstrates the power of RBAC and
workspaces with a real-world scenario. Following, we will approach <strong>Entity-Level
RBAC</strong>, an extension of our powerful access control to entity-level granularity.</p>

<h1 id="entity-level-rbac-a-primer">Entity-Level RBAC: a Primer</h1>

<p>Kong Enterprise&#39;s new RBAC implementation goes one step further in permissions
granularity: in addition to &quot;endpoint&quot; permissions, it supports entity-level
permissions, meaning that particular entities, identified by their unique ID,
can be allowed or disallowed access in a role.</p>

<p>Refreshing our minds, RBAC is <a href="/enterprise/0.33-x/rbac/overview#enforcing-rbac">enforced</a> with the <code>enforce_rbac</code>
configuration directive - or with its <code>KONG_ENFORCE_RBAC</code> environment variable
counterpart. Such directive is an enum, with 4 possible values:</p>

<ul>
<li><code>on</code>: similarly to the previous RBAC implementation, applies Endpoint-level
access control</li>
<li><code>entity</code>: applies <strong>only</strong> Entity-level access control</li>
<li><code>both</code>: applies <strong>both Endpoint and Entity level access control</strong></li>
<li><code>off</code>: disables RBAC enforcement</li>
</ul>

<p>If one sets it to either <code>entity</code> or <code>both</code>, Kong will enforce entity-level
access control. However, as with endpoint-level access control, permissions
must be bootstrapped before enforcement is enabled.</p>

<h2 id="creating-entity-level-permissions">Creating Entity-Level Permissions</h2>

<p>Team A just got one new, temporary, team member: qux. Admin A, the admin of
Team A, has already created his qux RBAC user; he needs, however, to limit
access that qux has over entities in Team A workspace, giving him read access
to only a couple of entities - say, a Service and a Route. For that, he will
use Entity-Level RBAC.</p>

<p><strong>Admin A creates a role for the temporary user qux</strong>:</p>
<div class="highlight"><pre><code class="language-" data-lang="">http :8001/teamA/rbac/roles name=qux-role Kong-Admin-Token:n5bhjgv0speXp4N7rSUzUj8PGnl3F5eG
{
  "name": "qux-role",
  "created_at": 1531065975000,
  "id": "ffe93269-7993-4308-965e-0286d0bc87b9"
}
</code></pre></div>
<p>We will assume the following entities exist:</p>

<p>A service:</p>
<div class="highlight"><pre><code class="language-" data-lang="">http :8001/teamA/services Kong-Admin-Token:n5bhjgv0speXp4N7rSUzUj8PGnl3F5eG
{
  "next": null,
  "data": [
    {
      "host": "httpbin.org",
      "created_at": 1531066074,
      "connect_timeout": 60000,
      "id": "3ed24101-19a7-4a0b-a10f-2f47bcd4ff43",
      "protocol": "http",
      "name": "service1",
      "read_timeout": 60000,
      "port": 80,
      "path": null,
      "updated_at": 1531066074,
      "retries": 5,
      "write_timeout": 60000
    }
  ]
}
</code></pre></div>
<p>and a Route to that Service:</p>
<div class="highlight"><pre><code class="language-" data-lang="">http :8001/teamA/routes Kong-Admin-Token:n5bhjgv0speXp4N7rSUzUj8PGnl3F5eG
{
  "next": null,
  "data": [
    {
      "created_at": 1531066253,
      "id": "d25afc46-dc59-48b2-b04f-d3ebe19f6d4b",
      "hosts": null,
      "updated_at": 1531066253,
      "preserve_host": false,
      "regex_priority": 0,
      "service": {
        "id": "3ed24101-19a7-4a0b-a10f-2f47bcd4ff43"
      },
      "paths": [
        "/anything"
      ],
      "methods": null,
      "strip_path": false,
      "protocols": [
        "http",
        "https"
      ]
    }
  ]
}
</code></pre></div>
<p><strong>Admin A creates entity permissions in qux-role</strong>:</p>

<p>Add service1 - whose ID is 3ed24101-19a7-4a0b-a10f-2f47bcd4ff43:</p>
<div class="highlight"><pre><code class="language-" data-lang="">http :8001/teamA/rbac/roles/qux-role/entities entity_id=3ed24101-19a7-4a0b-a10f-2f47bcd4ff43 actions=read Kong-Admin-Token:n5bhjgv0speXp4N7rSUzUj8PGnl3F5eG
{
  "created_at": 1531066684000,
  "role_id": "ffe93269-7993-4308-965e-0286d0bc87b9",
  "entity_id": "3ed24101-19a7-4a0b-a10f-2f47bcd4ff43",
  "negative": false,
  "entity_type": "services",
  "actions": [
    "read"
  ]
}
</code></pre></div>
<p>Add the route - whose ID is d25afc46-dc59-48b2-b04f-d3ebe19f6d4b:</p>
<div class="highlight"><pre><code class="language-" data-lang="">http :8001/teamA/rbac/roles/qux-role/entities entity_id=d25afc46-dc59-48b2-b04f-d3ebe19f6d4b actions=read Kong-Admin-Token:n5bhjgv0speXp4N7rSUzUj8PGnl3F5eG
{
  "created_at": 1531066728000,
  "role_id": "ffe93269-7993-4308-965e-0286d0bc87b9",
  "entity_id": "d25afc46-dc59-48b2-b04f-d3ebe19f6d4b",
  "negative": false,
  "entity_type": "routes",
  "actions": [
    "read"
  ]
}
</code></pre></div>
<p><strong>Admin A adds qux to his role</strong>:</p>
<div class="highlight"><pre><code class="language-" data-lang="">http :8001/teamA/rbac/users/qux/roles roles=qux-role Kong-Admin-Token:n5bhjgv0speXp4N7rSUzUj8PGnl3F5eG
{
  "roles": [
    {
      "comment": "Default user role generated for qux",
      "created_at": 1531065373000,
      "name": "qux",
      "id": "31614171-4174-42b4-9fae-43c9ce14830f"
    },
    {
      "created_at": 1531065975000,
      "name": "qux-role",
      "id": "ffe93269-7993-4308-965e-0286d0bc87b9"
    }
  ],
  "user": {
    "created_at": 1531065373000,
    "id": "4d87bf78-5824-4756-b0d0-ceaa9bd9b2d5",
    "name": "qux",
    "enabled": true,
    "user_token": "sUnv6uBehM91amYRNWESsgX3HzqoBnR5"
  }
}
</code></pre></div>
<p>Checking permissions appear listed:</p>
<div class="highlight"><pre><code class="language-" data-lang="">http :8001/teamA/rbac/users/qux/permissions Kong-Admin-Token:n5bhjgv0speXp4N7rSUzUj8PGnl3F5eG
{
  "entities": {
    "d25afc46-dc59-48b2-b04f-d3ebe19f6d4b": {
      "actions": [
        "read"
      ],
      "negative": false
    },
    "3ed24101-19a7-4a0b-a10f-2f47bcd4ff43": {
      "actions": [
        "read"
      ],
      "negative": false
    }
  },
  "endpoints": {}
}
</code></pre></div>
<p>That is, 2 entities permissions and no endpoint permissions.</p>

<p>Admin A is done setting up qux, and qux can now use his user token to read
his two entities over Kong&#39;s admin API.</p>

<p>We will assume that Admin A <a href="/enterprise/0.33-x/rbac/overview#enforcing-rbac">enabled entity-level enforcement</a>.
Note that as qux has <strong>no endpoint-level permissions</strong>, if both endpoint and
entity-level enforcement is enabled, he will not be able to read his entities -
endpoint-level validation comes before entity-level.</p>

<p><strong>qux tries listing all RBAC users</strong></p>
<div class="highlight"><pre><code class="language-" data-lang="">http :8001/teamA/rbac/users/ Kong-Admin-Token:sUnv6uBehM91amYRNWESsgX3HzqoBnR5
{
  "message": "qux, you do not have permissions to read this resource"
}
</code></pre></div>
<p><strong>qux tries listing all Workspaces</strong></p>
<div class="highlight"><pre><code class="language-" data-lang="">http :8001/teamA/rbac/workspaces/ Kong-Admin-Token:sUnv6uBehM91amYRNWESsgX3HzqoBnR5
{
  "message": "qux, you do not have permissions to read this resource"
}
</code></pre></div>
<p><strong>qux tries to access service1</strong></p>
<div class="highlight"><pre><code class="language-" data-lang="">http :8001/teamA/services/service1 Kong-Admin-Token:sUnv6uBehM91amYRNWESsgX3HzqoBnR5
{
  "host": "httpbin.org",
  "created_at": 1531066074,
  "connect_timeout": 60000,
  "id": "3ed24101-19a7-4a0b-a10f-2f47bcd4ff43",
  "protocol": "http",
  "name": "service1",
  "read_timeout": 60000,
  "port": 80,
  "path": null,
  "updated_at": 1531066074,
  "retries": 5,
  "write_timeout": 60000
}
</code></pre></div>
<p>Similarly, he can access his Route:</p>
<div class="highlight"><pre><code class="language-" data-lang="">http :8001/teamA/routes/3ed24101-19a7-4a0b-a10f-2f47bcd4ff43 Kong-Admin-Token:sUnv6uBehM91amYRNWESsgX3HzqoBnR5
{
  "created_at": 1531066253,
  "strip_path": false,
  "hosts": null,
  "preserve_host": false,
  "regex_priority": 0,
  "updated_at": 1531066253,
  "paths": [
    "/anything"
  ],
  "service": {
    "id": "3ed24101-19a7-4a0b-a10f-2f47bcd4ff43"
  },
  "methods": null,
  "protocols": [
    "http",
    "https"
  ],
  "id": "d25afc46-dc59-48b2-b04f-d3ebe19f6d4b"
}
</code></pre></div>
<h2 id="closing-remarks">Closing Remarks</h2>

<p>We will end this chapter with a few closing remarks.</p>

<h2 id="wildcards-in-permissions">Wildcards in Permissions</h2>

<p>RBAC supports the use of wildcards - represented by the <code>*</code> character - in many
aspects of permissions:</p>

<p><strong>Creating endpoint permissions - <code>/rbac/roles/:role/endpoints</code></strong></p>

<p>To create an endpoint permission, one must pass the parameters below, all of
which can be replaced by a * character:</p>

<ul>
<li><code>endpoint</code>: <code>*</code> matches <strong>any endpoint</strong></li>
<li><code>workspace</code>: <code>*</code> matches <strong>any workspace</strong></li>
<li><code>actions</code>: <code>*</code> evaluates to <strong>all actions - read, update, create, delete</strong></li>
</ul>

<p><strong>Special case</strong>: <code>endpoint</code>, in addition to a single <code>*</code>, also accepts <code>*</code>
within the endpoint itself, replacing a URL segment between <code>/</code>; for example,
all of the following are valid endpoints:</p>

<ul>
<li><code>/rbac/*</code>: where <code>*</code> replaces any possible segment - e.g., <code>/rbac/users</code>,
<code>/rbac/roles</code>, etc</li>
<li><code>/services/*/plugins</code>: <code>*</code> matches any Service name or ID</li>
</ul>

<p>Note, however, that <code>*</code> <strong>is not</strong> a generic, shell-like, glob pattern.</p>

<p><strong>Creating entity permissions - <code>/rbac/roles/:role/entities</code></strong></p>

<p>Similarly, for entity permissions, the following parameters accept a <code>*</code>
character:</p>

<ul>
<li><code>entity_id</code>: <code>*</code> matches <strong>any entity ID</strong></li>
</ul>

<h2 id="entities-concealing-in-entity-level-rbac">Entities Concealing in Entity-Level RBAC</h2>

<p>With Entity-Level RBAC enabled, endpoints that list all entities of a
particular collection will only list entities that the user has access to;
in the example above, if user qux listed all Routes, he would only get as
response the entities he has access to - even though there could be more:</p>
<div class="highlight"><pre><code class="language-" data-lang="">http :8001/teamA/routes Kong-Admin-Token:sUnv6uBehM91amYRNWESsgX3HzqoBnR5
{
  "next": null,
  "data": [
    {
      "created_at": 1531066253,
      "id": "d25afc46-dc59-48b2-b04f-d3ebe19f6d4b",
      "hosts": null,
      "updated_at": 1531066253,
      "preserve_host": false,
      "regex_priority": 0,
      "service": {
        "id": "3ed24101-19a7-4a0b-a10f-2f47bcd4ff43"
      },
      "paths": [
        "/anything"
      ],
      "methods": null,
      "strip_path": false,
      "protocols": [
        "http",
        "https"
      ]
    }
  ]
}
</code></pre></div>
<p>Some Kong endpoints carry a <code>total</code> field in responses; with Entity-Level RBAC
enabled, the global count of entities is displayed, but only entities the user
has access to are themselves shown; for example, if Team A has a number of
plugins configured, but qux only has access to one of them, the following
would be the expected output for a GET request to <code>/teamA/plugins</code>:</p>
<div class="highlight"><pre><code class="language-" data-lang="">http :8001/teamA/plugins Kong-Admin-Token:sUnv6uBehM91amYRNWESsgX3HzqoBnR5
{
  "total": 2,
  "data": [
    {
      "created_at": 1531070344000,
      "config": {
        "key_in_body": false,
        "run_on_preflight": true,
        "anonymous": "",
        "hide_credentials": false,
        "key_names": [
          "apikey"
        ]
      },
      "id": "8813dd0b-3e9d-4bcf-8a10-3112654f86e7",
      "name": "key-auth",
      "enabled": true
    }
  ]
}
</code></pre></div>
<p>Notice the <code>total</code> field is 2, but qux only got one entity in the response.</p>

<h2 id="creating-entities-in-entity-level-rbac">Creating Entities in Entity-Level RBAC</h2>

<p>As entity-level RBAC provides access control to individual existing entities,
it does not apply to creation of new entities; for that, endpoint-level
permissions must be configured and enforced. For example, if endpoint-level
permissions are not enforced, qux will be able to create new entities:</p>
<div class="highlight"><pre><code class="language-" data-lang="">http :8001/teamA/routes paths[]=/anything service.id=3ed24101-19a7-4a0b-a10f-2f47bcd4ff43 strip_path=false Kong-Admin-Token:sUnv6uBehM91amYRNWESsgX3HzqoBnR5
{
  "created_at": 1531070828,
  "strip_path": false,
  "hosts": null,
  "preserve_host": false,
  "regex_priority": 0,
  "updated_at": 1531070828,
  "paths": [
    "/anything"
  ],
  "service": {
    "id": "3ed24101-19a7-4a0b-a10f-2f47bcd4ff43"
  },
  "methods": null,
  "protocols": [
    "http",
    "https"
  ],
  "id": "6ee76f74-3c96-46a9-ae48-72df0717d244"
}
</code></pre></div>
<p>and qux will automatically have permissions to perform any actions to entities
he created.</p>

<hr>


        </div>
      </div>
    </div>
  </div>
</div>
<style>
  @media (max-width: 768px) {
    .algolia-docsearch-suggestion--subcategory-column{
      display: none !important;
    }
  }
</style>



    
  <section class="section subscribe-section" id="newsletter">
  <div class="container">
    <div class="row">
      <div class="one-half column">
        <div class="newsletter-icon col-md-2 mx-auto mx-md-0 mb-1x mb-md-0x">
          <i class="fa fa-envelope" aria-hidden="true"></i>
        </div>
        <div class="newsletter-headline col-auto text-center text-md-left">
          Keep up-to-date with Kong <span class="hidden-sm-down">product releases and</span> news.
        </div>
      </div>
      <div class="one-half column">
        <form accept-charset="UTF-8" method="post" action="https://go.pardot.com/l/392112/2018-10-02/bh8cfd" class="form" id = "subscription_form">
          <input type="text" name="email" id="email" class="text" size="30" placeholder="Email" maxlength="255">
          <div class="error-message message"></div>
          <div class="success-message message"></div>
          <input type="hidden" name="utm_source">
          <input type="hidden" name="utm_campaign">
          <input type="hidden" name="utm_medium">
          <input type="hidden" name="utm_content">
          <input type="hidden" name="utm_term">
          <input type="submit" class="button" accesskey="s" value="Subscribe">
      </div>
    </div>
  </div>
</section>



<footer class="marketing-footer--light-gray">
  <section>
    <ul>
      <li class="logo-wrapper">
        <div class="logo">
          <img src="/assets/images/kong-blue.png" alt="Kong Inc">
        </div>
      </li>
      <li>
        <nav>
          <h4>Company</h4>
          <ul>
            <li><a href="https://konghq.com/about-kong-inc/">About</a></li>
            <li><a href="https://konghq.com/investors/">Investors</a></li>
            <li><a href="http://konghq.com/blog/">Blog</a></li>
            <li><a href="https://konghq.com/jobs/">Jobs</a></li>
            <li><a href="https://konghq.com/contact/">Contact</a></li>
            <li><a href="https://support.konghq.com">Support</a></li>
          </ul>
        </nav>
      </li>
      <li>
        <nav>
          <h4>Products</h4>
          <ul>
            <li><a href="https://docs.konghq.com/">Kong</a></li>
            <li><a href="https://konghq.com/api-dev-portal/">Dev Portal</a></li>
            <li><a href="https://konghq.com/api-analytics/">API Analytics</a></li>
            <li><a href="https://konghq.com/kong-enterprise-edition/">Enterprise</a></li>
          </ul>
        </nav>
      </li>
      <li>
        <nav>
          <h4>Open Source</h4>
          <ul>
            <li><a href="http://mockbin.org/">Mockbin</a></li>
            <li><a href="http://apiembed.com/">API Embed</a></li>
            <li><a href="http://unirest.io/">Unirest</a></li>
            <li><a href="http://guardianjs.com/">Guardian JS</a></li>
            <li><a href="http://oauthbible.com/">OAuth Bible</a></li>
          </ul>
        </nav>
      </li>
      <li>
        <nav>
          <h4>Legal</h4>
          <ul>
            <li><a href="https://konghq.com/terms/">Terms of Service</a></li>
            <li><a href="https://konghq.com/privacy/">Privacy Policy</a></li>
          </ul>
        </nav>
      </li>
    </ul>
  </section>

  <section class="legal">
    <ul>
      <li>
        <span class="mashape-footer-content">&copy; Kong Inc. 2018</span>
      </li>
      <li>
        <div class="social-link">
          <a href="https://github.com/Kong" title="Github"><i aria-label="Github" class="fa fa-github" aria-hidden="true"></i></a></div>
        <div class="social-link">
          <a href="https://www.facebook.com/konghq/" title="Facebook"><i aria-label="Facebook" class="fa fa-facebook-official" aria-hidden="true"></i></a></div>
        <div class="social-link">
          <a href="https://www.meetup.com/topics/kong/all/" title="Meetup"><img aria-label="Meetup" alt="Meetup" src="/assets/images/footer/icn-meetup-black.svg"></a>
        </div>
        <div class="social-link">
          <a href="https://twitter.com/thekonginc" title="Twitter"><i aria-label="Twitter" class="fa fa-twitter" aria-hidden="true"></i></a>
        </div>
      </li>
    </ul>
  </section>
</footer>

    <script>
  var anchorForId = function (id) {
    var anchor = document.createElement("a");
    anchor.className = "header-link";
    anchor.href      = "#" + id;
    anchor.innerHTML = "<span class=\"sr-only\">Permalink</span><i class=\"fa fa-link\"></i>";
    anchor.title = "Permalink";
    return anchor;
  };
  var linkifyAnchors = function (level, containingElement) {
    var headers = containingElement.getElementsByTagName("h" + level);
    for (var h = 0; h < headers.length; h++) {
      var header = headers[h];
      if (typeof header.id !== "undefined" && header.id !== "") {
        header.prepend(anchorForId(header.id));
      }
    }
  };
  document.onreadystatechange = function () {
    if (this.readyState === "complete") {
      var contentBlock = document.getElementById("documentation");
      if (!contentBlock) {
        return;
      }
      for (var level = 1; level <= 6; level++) {
        linkifyAnchors(level, contentBlock);
      }
    }
  };
</script>


    <script src="/assets/app.js?v=1539384294"></script>

    <div id="fb-root"></div>

    <script src="https://2tjosk2rxzc21medji3nfn1g-wpengine.netdna-ssl.com/wp-content/themes/konghq/assets/js/vendor/bootstrap.min.js" async defer></script>

    <script id="github-bjs" src="https://buttons.github.io/buttons.js" async defer></script>
    <script id="twitter-wjs" type="text/javascript" src="https://platform.twitter.com/widgets.js" async defer></script>
    <script id="facebook-jssdk" type="text/javascript" src="https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.3&appId=842731852424506" async defer></script>

    <script type="text/javascript">
      piAId = '393112';
      piCId = '48375';

      (function() {
        function async_load(){
          var s = document.createElement('script'); s.type = 'text/javascript';
          s.src = ('https:' == document.location.protocol ? 'https://pi' : 'http://cdn') + '.pardot.com/pd.js';
          var c = document.getElementsByTagName('script')[0]; c.parentNode.insertBefore(s, c);
        }
        if(window.attachEvent) { window.attachEvent('onload', async_load); }
        else { window.addEventListener('load', async_load, false); }
      })();
    </script>

    <script type='text/javascript'>
      var _vwo_code=(function(){
      var account_id=125292,
      settings_tolerance=2000,
      library_tolerance=2500,
      use_existing_jquery=true,
      // DO NOT EDIT BELOW THIS LINE
      f=false,d=document;return{use_existing_jquery:function(){return use_existing_jquery;},library_tolerance:function(){return library_tolerance;},finish:function(){if(!f){f=true;var a=d.getElementById('_vis_opt_path_hides');if(a)a.parentNode.removeChild(a);}},finished:function(){return f;},load:function(a){var b=d.createElement('script');b.src=a;b.type='text/javascript';b.innerText;b.onerror=function(){_vwo_code.finish();};d.getElementsByTagName('head')[0].appendChild(b);},init:function(){settings_timer=setTimeout('_vwo_code.finish()',settings_tolerance);this.load('//dev.visualwebsiteoptimizer.com/j.php?a='+account_id+'&u='+encodeURIComponent(d.URL)+'&r='+Math.random());var a=d.createElement('style'),b='',h=d.getElementsByTagName('head')[0];a.setAttribute('id','_vis_opt_path_hides');a.setAttribute('type','text/css');if(a.styleSheet)a.styleSheet.cssText=b;else a.appendChild(d.createTextNode(b));h.appendChild(a);return settings_timer;}};}());_vwo_settings_timer=_vwo_code.init();
    </script>

    <script type="text/javascript">
      !function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","group","track","ready","alias","page","once","off","on"];analytics.factory=function(t){return function(){var e=Array.prototype.slice.call(arguments);e.unshift(t);analytics.push(e);return analytics}};for(var t=0;t<analytics.methods.length;t++){var e=analytics.methods[t];analytics[e]=analytics.factory(e)}analytics.load=function(t){var e=document.createElement("script");e.type="text/javascript";e.async=!0;e.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)};analytics.SNIPPET_VERSION="3.0.1";
        analytics.load("WDj0nSS7hpyxwL3evgbOzK755s0NUye6");
        analytics.page()
      }}();
    </script>

  </body>


</html>
