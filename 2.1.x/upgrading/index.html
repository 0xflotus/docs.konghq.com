<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/Article">
  

<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Upgrade guide - v2.1.x | Kong - Open-Source API Management and Microservice Management</title>
  <meta name="description" content="Secure, Manage &amp; Extend your APIs or Microservices with plugins for authentication, logging, rate-limiting, transformations and more." />
  <meta name="author" content="KongHQ" />
  <meta property="og:title" content="Open-Source API Management and Microservice Management" />
  <meta property="og:site_name" content="Kong" />
  <!-- use share link for facebook -->
  <meta property="og:url" content="https://docs.konghq.com" />
  <meta property="og:description" content="Secure, Manage &amp; Extend your APIs or Microservices with plugins for authentication, logging, rate-limiting, transformations and more." />
  <meta property="og:type" content="website" />
  <meta property="og:locale" content="en_US" />
  <meta
    property="og:image"
    content="https://docs.konghq.com/assets/images/share.png"
  />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:site" content="@thekonginc" />
  <meta name="twitter:creator" content="@thekonginc" />
  <meta name="twitter:url" content="https://docs.konghq.com" />
  <meta name="twitter:description" content="Secure, Manage &amp; Extend your APIs or Microservices with plugins for authentication, logging, rate-limiting, transformations and more." />
  <meta
    name="twitter:image"
    content="https://docs.konghq.com/assets/images/share.png"
  />
  <meta property="fb:admins" content="227304446" />
  <meta property="fb:admins" content="576641408" />
  <meta
    name="google-site-verification"
    content="CrU3zp02dNKTe8NSAipL4NCPkrIjDXG8fViTZ-MIzP4"
  />
  <link
    rel="stylesheet"
    href="https://use.fontawesome.com/releases/v5.4.1/css/all.css"
    integrity="sha384-5sAR7xN1Nv6T6+dT2mhtzEpVJvfS3NScPQTrOxhwjIuvcA67KV2R5Jz6kr4abQsz"
    crossorigin="anonymous"
  />

  <!-- New Relic -->
  <script type="text/javascript">
/* eslint-disable */
window.NREUM||(NREUM={}),__nr_require=function(t,e,n){function r(n){if(!e[n]){var o=e[n]={exports:{}};t[n][0].call(o.exports,function(e){var o=t[n][1][e];return r(o||e)},o,o.exports)}return e[n].exports}if("function"==typeof __nr_require)return __nr_require;for(var o=0;o<n.length;o++)r(n[o]);return r}({1:[function(t,e,n){function r(t){try{c.console&&console.log(t)}catch(e){}}var o,i=t("ee"),a=t(20),c={};try{o=localStorage.getItem("__nr_flags").split(","),console&&"function"==typeof console.log&&(c.console=!0,o.indexOf("dev")!==-1&&(c.dev=!0),o.indexOf("nr_dev")!==-1&&(c.nrDev=!0))}catch(s){}c.nrDev&&i.on("internal-error",function(t){r(t.stack)}),c.dev&&i.on("fn-err",function(t,e,n){r(n.stack)}),c.dev&&(r("NR AGENT IN DEVELOPMENT MODE"),r("flags: "+a(c,function(t,e){return t}).join(", ")))},{}],2:[function(t,e,n){function r(t,e,n,r,c){try{h?h-=1:o(c||new UncaughtException(t,e,n),!0)}catch(f){try{i("ierr",[f,s.now(),!0])}catch(d){}}return"function"==typeof u&&u.apply(this,a(arguments))}function UncaughtException(t,e,n){this.message=t||"Uncaught error with no additional information",this.sourceURL=e,this.line=n}function o(t,e){var n=e?null:s.now();i("err",[t,n])}var i=t("handle"),a=t(21),c=t("ee"),s=t("loader"),f=t("gos"),u=window.onerror,d=!1,p="nr@seenError",h=0;s.features.err=!0,t(1),window.onerror=r;try{throw new Error}catch(l){"stack"in l&&(t(13),t(12),"addEventListener"in window&&t(6),s.xhrWrappable&&t(14),d=!0)}c.on("fn-start",function(t,e,n){d&&(h+=1)}),c.on("fn-err",function(t,e,n){d&&!n[p]&&(f(n,p,function(){return!0}),this.thrown=!0,o(n))}),c.on("fn-end",function(){d&&!this.thrown&&h>0&&(h-=1)}),c.on("internal-error",function(t){i("ierr",[t,s.now(),!0])})},{}],3:[function(t,e,n){t("loader").features.ins=!0},{}],4:[function(t,e,n){function r(){M++,S=y.hash,this[u]=b.now()}function o(){M--,y.hash!==S&&i(0,!0);var t=b.now();this[l]=~~this[l]+t-this[u],this[d]=t}function i(t,e){E.emit("newURL",[""+y,e])}function a(t,e){t.on(e,function(){this[e]=b.now()})}var c="-start",s="-end",f="-body",u="fn"+c,d="fn"+s,p="cb"+c,h="cb"+s,l="jsTime",m="fetch",v="addEventListener",w=window,y=w.location,b=t("loader");if(w[v]&&b.xhrWrappable){var g=t(10),x=t(11),E=t(8),P=t(6),O=t(13),R=t(7),T=t(14),L=t(9),j=t("ee"),N=j.get("tracer");t(15),b.features.spa=!0;var S,M=0;j.on(u,r),j.on(p,r),j.on(d,o),j.on(h,o),j.buffer([u,d,"xhr-done","xhr-resolved"]),P.buffer([u]),O.buffer(["setTimeout"+s,"clearTimeout"+c,u]),T.buffer([u,"new-xhr","send-xhr"+c]),R.buffer([m+c,m+"-done",m+f+c,m+f+s]),E.buffer(["newURL"]),g.buffer([u]),x.buffer(["propagate",p,h,"executor-err","resolve"+c]),N.buffer([u,"no-"+u]),L.buffer(["new-jsonp","cb-start","jsonp-error","jsonp-end"]),a(T,"send-xhr"+c),a(j,"xhr-resolved"),a(j,"xhr-done"),a(R,m+c),a(R,m+"-done"),a(L,"new-jsonp"),a(L,"jsonp-end"),a(L,"cb-start"),E.on("pushState-end",i),E.on("replaceState-end",i),w[v]("hashchange",i,!0),w[v]("load",i,!0),w[v]("popstate",function(){i(0,M>1)},!0)}},{}],5:[function(t,e,n){function r(t){}if(window.performance&&window.performance.timing&&window.performance.getEntriesByType){var o=t("ee"),i=t("handle"),a=t(13),c=t(12),s="learResourceTimings",f="addEventListener",u="resourcetimingbufferfull",d="bstResource",p="resource",h="-start",l="-end",m="fn"+h,v="fn"+l,w="bstTimer",y="pushState",b=t("loader");b.features.stn=!0,t(8);var g=NREUM.o.EV;o.on(m,function(t,e){var n=t[0];n instanceof g&&(this.bstStart=b.now())}),o.on(v,function(t,e){var n=t[0];n instanceof g&&i("bst",[n,e,this.bstStart,b.now()])}),a.on(m,function(t,e,n){this.bstStart=b.now(),this.bstType=n}),a.on(v,function(t,e){i(w,[e,this.bstStart,b.now(),this.bstType])}),c.on(m,function(){this.bstStart=b.now()}),c.on(v,function(t,e){i(w,[e,this.bstStart,b.now(),"requestAnimationFrame"])}),o.on(y+h,function(t){this.time=b.now(),this.startPath=location.pathname+location.hash}),o.on(y+l,function(t){i("bstHist",[location.pathname+location.hash,this.startPath,this.time])}),f in window.performance&&(window.performance["c"+s]?window.performance[f](u,function(t){i(d,[window.performance.getEntriesByType(p)]),window.performance["c"+s]()},!1):window.performance[f]("webkit"+u,function(t){i(d,[window.performance.getEntriesByType(p)]),window.performance["webkitC"+s]()},!1)),document[f]("scroll",r,{passive:!0}),document[f]("keypress",r,!1),document[f]("click",r,!1)}},{}],6:[function(t,e,n){function r(t){for(var e=t;e&&!e.hasOwnProperty(u);)e=Object.getPrototypeOf(e);e&&o(e)}function o(t){c.inPlace(t,[u,d],"-",i)}function i(t,e){return t[1]}var a=t("ee").get("events"),c=t(23)(a,!0),s=t("gos"),f=XMLHttpRequest,u="addEventListener",d="removeEventListener";e.exports=a,"getPrototypeOf"in Object?(r(document),r(window),r(f.prototype)):f.prototype.hasOwnProperty(u)&&(o(window),o(f.prototype)),a.on(u+"-start",function(t,e){var n=t[1],r=s(n,"nr@wrapped",function(){function t(){if("function"==typeof n.handleEvent)return n.handleEvent.apply(n,arguments)}var e={object:t,"function":n}[typeof n];return e?c(e,"fn-",null,e.name||"anonymous"):n});this.wrapped=t[1]=r}),a.on(d+"-start",function(t){t[1]=this.wrapped||t[1]})},{}],7:[function(t,e,n){function r(t,e,n){var r=t[e];"function"==typeof r&&(t[e]=function(){var t=r.apply(this,arguments);return o.emit(n+"start",arguments,t),t.then(function(e){return o.emit(n+"end",[null,e],t),e},function(e){throw o.emit(n+"end",[e],t),e})})}var o=t("ee").get("fetch"),i=t(20);e.exports=o;var a=window,c="fetch-",s=c+"body-",f=["arrayBuffer","blob","json","text","formData"],u=a.Request,d=a.Response,p=a.fetch,h="prototype";u&&d&&p&&(i(f,function(t,e){r(u[h],e,s),r(d[h],e,s)}),r(a,"fetch",c),o.on(c+"end",function(t,e){var n=this;e?e.clone().arrayBuffer().then(function(t){n.rxSize=t.byteLength,o.emit(c+"done",[null,e],n)}):o.emit(c+"done",[t],n)}))},{}],8:[function(t,e,n){var r=t("ee").get("history"),o=t(23)(r);e.exports=r,o.inPlace(window.history,["pushState","replaceState"],"-")},{}],9:[function(t,e,n){function r(t){function e(){s.emit("jsonp-end",[],p),t.removeEventListener("load",e,!1),t.removeEventListener("error",n,!1)}function n(){s.emit("jsonp-error",[],p),s.emit("jsonp-end",[],p),t.removeEventListener("load",e,!1),t.removeEventListener("error",n,!1)}var r=t&&"string"==typeof t.nodeName&&"script"===t.nodeName.toLowerCase();if(r){var o="function"==typeof t.addEventListener;if(o){var a=i(t.src);if(a){var u=c(a),d="function"==typeof u.parent[u.key];if(d){var p={};f.inPlace(u.parent,[u.key],"cb-",p),t.addEventListener("load",e,!1),t.addEventListener("error",n,!1),s.emit("new-jsonp",[t.src],p)}}}}}function o(){return"addEventListener"in window}function i(t){var e=t.match(u);return e?e[1]:null}function a(t,e){var n=t.match(p),r=n[1],o=n[3];return o?a(o,e[r]):e[r]}function c(t){var e=t.match(d);return e&&e.length>=3?{key:e[2],parent:a(e[1],window)}:{key:t,parent:window}}var s=t("ee").get("jsonp"),f=t(23)(s);if(e.exports=s,o()){var u=/[?&](?:callback|cb)=([^&#]+)/,d=/(.*)\.([^.]+)/,p=/^(\w+)(\.|$)(.*)$/,h=["appendChild","insertBefore","replaceChild"];f.inPlace(HTMLElement.prototype,h,"dom-"),f.inPlace(HTMLHeadElement.prototype,h,"dom-"),f.inPlace(HTMLBodyElement.prototype,h,"dom-"),s.on("dom-start",function(t){r(t[0])})}},{}],10:[function(t,e,n){var r=t("ee").get("mutation"),o=t(23)(r),i=NREUM.o.MO;e.exports=r,i&&(window.MutationObserver=function(t){return this instanceof i?new i(o(t,"fn-")):i.apply(this,arguments)},MutationObserver.prototype=i.prototype)},{}],11:[function(t,e,n){function r(t){var e=a.context(),n=c(t,"executor-",e),r=new f(n);return a.context(r).getCtx=function(){return e},a.emit("new-promise",[r,e],e),r}function o(t,e){return e}var i=t(23),a=t("ee").get("promise"),c=i(a),s=t(20),f=NREUM.o.PR;e.exports=a,f&&(window.Promise=r,["all","race"].forEach(function(t){var e=f[t];f[t]=function(n){function r(t){return function(){a.emit("propagate",[null,!o],i),o=o||!t}}var o=!1;s(n,function(e,n){Promise.resolve(n).then(r("all"===t),r(!1))});var i=e.apply(f,arguments),c=f.resolve(i);return c}}),["resolve","reject"].forEach(function(t){var e=f[t];f[t]=function(t){var n=e.apply(f,arguments);return t!==n&&a.emit("propagate",[t,!0],n),n}}),f.prototype["catch"]=function(t){return this.then(null,t)},f.prototype=Object.create(f.prototype,{constructor:{value:r}}),s(Object.getOwnPropertyNames(f),function(t,e){try{r[e]=f[e]}catch(n){}}),a.on("executor-start",function(t){t[0]=c(t[0],"resolve-",this),t[1]=c(t[1],"resolve-",this)}),a.on("executor-err",function(t,e,n){t[1](n)}),c.inPlace(f.prototype,["then"],"then-",o),a.on("then-start",function(t,e){this.promise=e,t[0]=c(t[0],"cb-",this),t[1]=c(t[1],"cb-",this)}),a.on("then-end",function(t,e,n){this.nextPromise=n;var r=this.promise;a.emit("propagate",[r,!0],n)}),a.on("cb-end",function(t,e,n){a.emit("propagate",[n,!0],this.nextPromise)}),a.on("propagate",function(t,e,n){this.getCtx&&!e||(this.getCtx=function(){if(t instanceof Promise)var e=a.context(t);return e&&e.getCtx?e.getCtx():this})}),r.toString=function(){return""+f})},{}],12:[function(t,e,n){var r=t("ee").get("raf"),o=t(23)(r),i="equestAnimationFrame";e.exports=r,o.inPlace(window,["r"+i,"mozR"+i,"webkitR"+i,"msR"+i],"raf-"),r.on("raf-start",function(t){t[0]=o(t[0],"fn-")})},{}],13:[function(t,e,n){function r(t,e,n){t[0]=a(t[0],"fn-",null,n)}function o(t,e,n){this.method=n,this.timerDuration=isNaN(t[1])?0:+t[1],t[0]=a(t[0],"fn-",this,n)}var i=t("ee").get("timer"),a=t(23)(i),c="setTimeout",s="setInterval",f="clearTimeout",u="-start",d="-";e.exports=i,a.inPlace(window,[c,"setImmediate"],c+d),a.inPlace(window,[s],s+d),a.inPlace(window,[f,"clearImmediate"],f+d),i.on(s+u,r),i.on(c+u,o)},{}],14:[function(t,e,n){function r(t,e){d.inPlace(e,["onreadystatechange"],"fn-",c)}function o(){var t=this,e=u.context(t);t.readyState>3&&!e.resolved&&(e.resolved=!0,u.emit("xhr-resolved",[],t)),d.inPlace(t,y,"fn-",c)}function i(t){b.push(t),l&&(x?x.then(a):v?v(a):(E=-E,P.data=E))}function a(){for(var t=0;t<b.length;t++)r([],b[t]);b.length&&(b=[])}function c(t,e){return e}function s(t,e){for(var n in t)e[n]=t[n];return e}t(6);var f=t("ee"),u=f.get("xhr"),d=t(23)(u),p=NREUM.o,h=p.XHR,l=p.MO,m=p.PR,v=p.SI,w="readystatechange",y=["onload","onerror","onabort","onloadstart","onloadend","onprogress","ontimeout"],b=[];e.exports=u;var g=window.XMLHttpRequest=function(t){var e=new h(t);try{u.emit("new-xhr",[e],e),e.addEventListener(w,o,!1)}catch(n){try{u.emit("internal-error",[n])}catch(r){}}return e};if(s(h,g),g.prototype=h.prototype,d.inPlace(g.prototype,["open","send"],"-xhr-",c),u.on("send-xhr-start",function(t,e){r(t,e),i(e)}),u.on("open-xhr-start",r),l){var x=m&&m.resolve();if(!v&&!m){var E=1,P=document.createTextNode(E);new l(a).observe(P,{characterData:!0})}}else f.on("fn-end",function(t){t[0]&&t[0].type===w||a()})},{}],15:[function(t,e,n){function r(t){var e=this.params,n=this.metrics;if(!this.ended){this.ended=!0;for(var r=0;r<d;r++)t.removeEventListener(u[r],this.listener,!1);if(!e.aborted){if(n.duration=a.now()-this.startTime,4===t.readyState){e.status=t.status;var i=o(t,this.lastSize);if(i&&(n.rxSize=i),this.sameOrigin){var s=t.getResponseHeader("X-NewRelic-App-Data");s&&(e.cat=s.split(", ").pop())}}else e.status=0;n.cbTime=this.cbTime,f.emit("xhr-done",[t],t),c("xhr",[e,n,this.startTime])}}}function o(t,e){var n=t.responseType;if("json"===n&&null!==e)return e;var r="arraybuffer"===n||"blob"===n||"json"===n?t.response:t.responseText;return l(r)}function i(t,e){var n=s(e),r=t.params;r.host=n.hostname+":"+n.port,r.pathname=n.pathname,t.sameOrigin=n.sameOrigin}var a=t("loader");if(a.xhrWrappable){var c=t("handle"),s=t(16),f=t("ee"),u=["load","error","abort","timeout"],d=u.length,p=t("id"),h=t(19),l=t(18),m=window.XMLHttpRequest;a.features.xhr=!0,t(14),f.on("new-xhr",function(t){var e=this;e.totalCbs=0,e.called=0,e.cbTime=0,e.end=r,e.ended=!1,e.xhrGuids={},e.lastSize=null,h&&(h>34||h<10)||window.opera||t.addEventListener("progress",function(t){e.lastSize=t.loaded},!1)}),f.on("open-xhr-start",function(t){this.params={method:t[0]},i(this,t[1]),this.metrics={}}),f.on("open-xhr-end",function(t,e){"loader_config"in NREUM&&"xpid"in NREUM.loader_config&&this.sameOrigin&&e.setRequestHeader("X-NewRelic-ID",NREUM.loader_config.xpid)}),f.on("send-xhr-start",function(t,e){var n=this.metrics,r=t[0],o=this;if(n&&r){var i=l(r);i&&(n.txSize=i)}this.startTime=a.now(),this.listener=function(t){try{"abort"===t.type&&(o.params.aborted=!0),("load"!==t.type||o.called===o.totalCbs&&(o.onloadCalled||"function"!=typeof e.onload))&&o.end(e)}catch(n){try{f.emit("internal-error",[n])}catch(r){}}};for(var c=0;c<d;c++)e.addEventListener(u[c],this.listener,!1)}),f.on("xhr-cb-time",function(t,e,n){this.cbTime+=t,e?this.onloadCalled=!0:this.called+=1,this.called!==this.totalCbs||!this.onloadCalled&&"function"==typeof n.onload||this.end(n)}),f.on("xhr-load-added",function(t,e){var n=""+p(t)+!!e;this.xhrGuids&&!this.xhrGuids[n]&&(this.xhrGuids[n]=!0,this.totalCbs+=1)}),f.on("xhr-load-removed",function(t,e){var n=""+p(t)+!!e;this.xhrGuids&&this.xhrGuids[n]&&(delete this.xhrGuids[n],this.totalCbs-=1)}),f.on("addEventListener-end",function(t,e){e instanceof m&&"load"===t[0]&&f.emit("xhr-load-added",[t[1],t[2]],e)}),f.on("removeEventListener-end",function(t,e){e instanceof m&&"load"===t[0]&&f.emit("xhr-load-removed",[t[1],t[2]],e)}),f.on("fn-start",function(t,e,n){e instanceof m&&("onload"===n&&(this.onload=!0),("load"===(t[0]&&t[0].type)||this.onload)&&(this.xhrCbStart=a.now()))}),f.on("fn-end",function(t,e){this.xhrCbStart&&f.emit("xhr-cb-time",[a.now()-this.xhrCbStart,this.onload,e],e)})}},{}],16:[function(t,e,n){e.exports=function(t){var e=document.createElement("a"),n=window.location,r={};e.href=t,r.port=e.port;var o=e.href.split("://");!r.port&&o[1]&&(r.port=o[1].split("/")[0].split("@").pop().split(":")[1]),r.port&&"0"!==r.port||(r.port="https"===o[0]?"443":"80"),r.hostname=e.hostname||n.hostname,r.pathname=e.pathname,r.protocol=o[0],"/"!==r.pathname.charAt(0)&&(r.pathname="/"+r.pathname);var i=!e.protocol||":"===e.protocol||e.protocol===n.protocol,a=e.hostname===document.domain&&e.port===n.port;return r.sameOrigin=i&&(!e.hostname||a),r}},{}],17:[function(t,e,n){function r(){}function o(t,e,n){return function(){return i(t,[f.now()].concat(c(arguments)),e?null:this,n),e?void 0:this}}var i=t("handle"),a=t(20),c=t(21),s=t("ee").get("tracer"),f=t("loader"),u=NREUM;"undefined"==typeof window.newrelic&&(newrelic=u);var d=["setPageViewName","setCustomAttribute","setErrorHandler","finished","addToTrace","inlineHit","addRelease"],p="api-",h=p+"ixn-";a(d,function(t,e){u[e]=o(p+e,!0,"api")}),u.addPageAction=o(p+"addPageAction",!0),u.setCurrentRouteName=o(p+"routeName",!0),e.exports=newrelic,u.interaction=function(){return(new r).get()};var l=r.prototype={createTracer:function(t,e){var n={},r=this,o="function"==typeof e;return i(h+"tracer",[f.now(),t,n],r),function(){if(s.emit((o?"":"no-")+"fn-start",[f.now(),r,o],n),o)try{return e.apply(this,arguments)}catch(t){throw s.emit("fn-err",[arguments,this,t],n),t}finally{s.emit("fn-end",[f.now()],n)}}}};a("setName,setAttribute,save,ignore,onEnd,getContext,end,get".split(","),function(t,e){l[e]=o(h+e)}),newrelic.noticeError=function(t){"string"==typeof t&&(t=new Error(t)),i("err",[t,f.now()])}},{}],18:[function(t,e,n){e.exports=function(t){if("string"==typeof t&&t.length)return t.length;if("object"==typeof t){if("undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer&&t.byteLength)return t.byteLength;if("undefined"!=typeof Blob&&t instanceof Blob&&t.size)return t.size;if(!("undefined"!=typeof FormData&&t instanceof FormData))try{return JSON.stringify(t).length}catch(e){return}}}},{}],19:[function(t,e,n){var r=0,o=navigator.userAgent.match(/Firefox[\/\s](\d+\.\d+)/);o&&(r=+o[1]),e.exports=r},{}],20:[function(t,e,n){function r(t,e){var n=[],r="",i=0;for(r in t)o.call(t,r)&&(n[i]=e(r,t[r]),i+=1);return n}var o=Object.prototype.hasOwnProperty;e.exports=r},{}],21:[function(t,e,n){function r(t,e,n){e||(e=0),"undefined"==typeof n&&(n=t?t.length:0);for(var r=-1,o=n-e||0,i=Array(o<0?0:o);++r<o;)i[r]=t[e+r];return i}e.exports=r},{}],22:[function(t,e,n){e.exports={exists:"undefined"!=typeof window.performance&&window.performance.timing&&"undefined"!=typeof window.performance.timing.navigationStart}},{}],23:[function(t,e,n){function r(t){return!(t&&t instanceof Function&&t.apply&&!t[a])}var o=t("ee"),i=t(21),a="nr@original",c=Object.prototype.hasOwnProperty,s=!1;e.exports=function(t,e){function n(t,e,n,o){function nrWrapper(){var r,a,c,s;try{a=this,r=i(arguments),c="function"==typeof n?n(r,a):n||{}}catch(f){p([f,"",[r,a,o],c])}u(e+"start",[r,a,o],c);try{return s=t.apply(a,r)}catch(d){throw u(e+"err",[r,a,d],c),d}finally{u(e+"end",[r,a,s],c)}}return r(t)?t:(e||(e=""),nrWrapper[a]=t,d(t,nrWrapper),nrWrapper)}function f(t,e,o,i){o||(o="");var a,c,s,f="-"===o.charAt(0);for(s=0;s<e.length;s++)c=e[s],a=t[c],r(a)||(t[c]=n(a,f?c+o:o,i,c))}function u(n,r,o){if(!s||e){var i=s;s=!0;try{t.emit(n,r,o,e)}catch(a){p([a,n,r,o])}s=i}}function d(t,e){if(Object.defineProperty&&Object.keys)try{var n=Object.keys(t);return n.forEach(function(n){Object.defineProperty(e,n,{get:function(){return t[n]},set:function(e){return t[n]=e,e}})}),e}catch(r){p([r])}for(var o in t)c.call(t,o)&&(e[o]=t[o]);return e}function p(e){try{t.emit("internal-error",e)}catch(n){}}return t||(t=o),n.inPlace=f,n.flag=a,n}},{}],ee:[function(t,e,n){function r(){}function o(t){function e(t){return t&&t instanceof r?t:t?s(t,c,i):i()}function n(n,r,o,i){if(!p.aborted||i){t&&t(n,r,o);for(var a=e(o),c=l(n),s=c.length,f=0;f<s;f++)c[f].apply(a,r);var d=u[y[n]];return d&&d.push([b,n,r,a]),a}}function h(t,e){w[t]=l(t).concat(e)}function l(t){return w[t]||[]}function m(t){return d[t]=d[t]||o(n)}function v(t,e){f(t,function(t,n){e=e||"feature",y[n]=e,e in u||(u[e]=[])})}var w={},y={},b={on:h,emit:n,get:m,listeners:l,context:e,buffer:v,abort:a,aborted:!1};return b}function i(){return new r}function a(){(u.api||u.feature)&&(p.aborted=!0,u=p.backlog={})}var c="nr@context",s=t("gos"),f=t(20),u={},d={},p=e.exports=o();p.backlog=u},{}],gos:[function(t,e,n){function r(t,e,n){if(o.call(t,e))return t[e];var r=n();if(Object.defineProperty&&Object.keys)try{return Object.defineProperty(t,e,{value:r,writable:!0,enumerable:!1}),r}catch(i){}return t[e]=r,r}var o=Object.prototype.hasOwnProperty;e.exports=r},{}],handle:[function(t,e,n){function r(t,e,n,r){o.buffer([t],r),o.emit(t,e,n)}var o=t("ee").get("handle");e.exports=r,r.ee=o},{}],id:[function(t,e,n){function r(t){var e=typeof t;return!t||"object"!==e&&"function"!==e?-1:t===window?0:a(t,i,function(){return o++})}var o=1,i="nr@id",a=t("gos");e.exports=r},{}],loader:[function(t,e,n){function r(){if(!x++){var t=g.info=NREUM.info,e=p.getElementsByTagName("script")[0];if(setTimeout(u.abort,3e4),!(t&&t.licenseKey&&t.applicationID&&e))return u.abort();f(y,function(e,n){t[e]||(t[e]=n)}),s("mark",["onload",a()+g.offset],null,"api");var n=p.createElement("script");n.src="https://"+t.agent,e.parentNode.insertBefore(n,e)}}function o(){"complete"===p.readyState&&i()}function i(){s("mark",["domContent",a()+g.offset],null,"api")}function a(){return E.exists&&performance.now?Math.round(performance.now()):(c=Math.max((new Date).getTime(),c))-g.offset}var c=(new Date).getTime(),s=t("handle"),f=t(20),u=t("ee"),d=window,p=d.document,h="addEventListener",l="attachEvent",m=d.XMLHttpRequest,v=m&&m.prototype;NREUM.o={ST:setTimeout,SI:d.setImmediate,CT:clearTimeout,XHR:m,REQ:d.Request,EV:d.Event,PR:d.Promise,MO:d.MutationObserver};var w=""+location,y={beacon:"bam.nr-data.net",errorBeacon:"bam.nr-data.net",agent:"js-agent.newrelic.com/nr-spa-1071.min.js"},b=m&&v&&v[h]&&!/CriOS/.test(navigator.userAgent),g=e.exports={offset:c,now:a,origin:w,features:{},xhrWrappable:b};t(17),p[h]?(p[h]("DOMContentLoaded",i,!1),d[h]("load",r,!1)):(p[l]("onreadystatechange",o),d[l]("onload",r)),s("mark",["firstbyte",c],null,"api");var x=0,E=t(22)},{}]},{},["loader",2,15,5,3,4]);
;NREUM.info={beacon:"bam.nr-data.net",errorBeacon:"bam.nr-data.net",licenseKey:"13e44ec848",applicationID:"187820761",sa:1}
</script>


  <!-- FullStory -->
  <!-- <script>
/* eslint-disable */
window['_fs_debug'] = false;
window['_fs_host'] = 'fullstory.com';
window['_fs_org'] = '7JS2S';
window['_fs_namespace'] = 'FS';
(function(m,n,e,t,l,o,g,y){
    if (e in m) {if(m.console && m.console.log) { m.console.log('FullStory namespace conflict. Please set window["_fs_namespace"].');} return;}
    g=m[e]=function(a,b){g.q?g.q.push([a,b]):g._api(a,b);};g.q=[];
    o=n.createElement(t);o.async=1;o.src='https://'+_fs_host+'/s/fs.js';
    y=n.getElementsByTagName(t)[0];y.parentNode.insertBefore(o,y);
    g.identify=function(i,v){g(l,{uid:i});if(v)g(l,v)};g.setUserVars=function(v){g(l,v)};g.event=function(i,v){g('event',{n:i,p:v})};
    g.shutdown=function(){g("rec",!1)};g.restart=function(){g("rec",!0)};
    g.consent=function(a){g("consent",!arguments.length||a)};
    g.identifyAccount=function(i,v){o='account';v=v||{};v.acctId=i;g(o,v)};
    g.clearUserCookie=function(){};
})(window,document,window['_fs_namespace'],'script','user');
</script>
 -->

  <!-- Delighted -->
  <script type="text/javascript">
/* eslint-disable */
  !function(e,t,r,n,a){if(!e[a]){for(var i=e[a]=[],s=0;s<r.length;s++){var c=r[s];i[c]=i[c]||function(e){return function(){var t=Array.prototype.slice.call(arguments);i.push([e,t])}}(c)}i.SNIPPET_VERSION="1.0.1";var o=t.createElement("script");o.type="text/javascript",o.async=!0,o.src="https://d2yyd1h5u9mauk.cloudfront.net/integrations/web/v1/library/"+n+"/"+a+".js";var u=t.getElementsByTagName("script")[0];u.parentNode.insertBefore(o,u)}}(window,document,["survey","reset","config","init","set","get","event","identify","track","page","screen","group","alias"],"Mvwmq6n6DhInaFYu","delighted");

  delighted.survey();
</script>


  <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "Organization",
      "name": "KongHQ",
      "url": "https://docs.konghq.com",
      "logo": "https://docs.konghq.com/assets/images/logo.png",
      "sameAs": [
        "https://www.facebook.com/konginc",
        "https://twitter.com/thekonginc",
        "https://plus.google.com/+mashape"
      ]
    }
  </script>

  <!-- Preload assets -->
  <link rel="dns-prefetch" href="//cloud.typography.com" />
  <link
    href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700"
    rel="stylesheet"
  />
  <link rel="dns-prefetch" href="//dev.visualwebsiteoptimizer.com" />
  <link rel="dns-prefetch" href="//cdn.segment.com" />

  <!-- Recaptcha -->
  <script src="https://www.google.com/recaptcha/api.js" async defer></script>

  <!-- ##gulp-resource-hints## -->

  <link rel="icon" type="image/x-icon" href="/assets/images/favicon.ico" />
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css"
  />
  <link
    rel="stylesheet"
    href="/assets/styles.css?v=1601569374"
  />

  <script>
    !(function(w) {
      var clearbit = (w.clearbit = w.clearbit || []);
      if (!clearbit.initialize)
        if (clearbit.invoked)
          w.console &&
            console.error &&
            console.error("Clearbit snippet included twice.");
        else {
          clearbit.invoked = !0;
          clearbit.methods = [
            "trackSubmit",
            "trackClick",
            "trackLink",
            "trackForm",
            "pageview",
            "identify",
            "reset",
            "group",
            "track",
            "ready",
            "alias",
            "page",
            "once",
            "off",
            "on"
          ];
          clearbit.factory = function(t) {
            return function() {
              var e = Array.prototype.slice.call(arguments);
              e.unshift(t);
              clearbit.push(e);
              return clearbit;
            };
          };
          for (var t = 0; t < clearbit.methods.length; t++) {
            var e = clearbit.methods[t];
            clearbit[e] = clearbit.factory(e);
          }
          clearbit.load = function(t) {
            var e = document.createElement("script");
            e.async = !0;
            e.src =
              ("https:" === document.location.protocol
                ? "https://"
                : "http://") +
              "x.clearbitjs.com/v1/" +
              t +
              "/clearbit.js";
            var n = document.getElementsByTagName("script")[0];
            n.parentNode.insertBefore(e, n);
          };
          clearbit.SNIPPET_VERSION = "3.1.0";
          clearbit.load("pk_1bdbdbad26342e32516473510e95c3ff");
          clearbit.page();
        }
    })(window);
  </script>

  
</head>

<!-- Kong Cookie Policy -->
<div class="cookie-policy-container">
  <p>In order to give you better service we use cookies. By continuing to use our website, you agree to the use of cookies as described in our <a href=" https://konghq.com/cookie-policy/">Cookie Policy</a>
  <button class="cookie-policy-accept btn button" type="submit">I Agree</button>
</div>



  <body
    id=""
    
    data-spy="scroll"
    data-target="#scroll-sidebar"
    data-offset="350"
  >
    <header
  class="navbar navbar-inverse navbar-toggleable-lg kong-navbar flex-row align-items-center fixed-top lower_nav expand"
>
  <div
    id="promo-banner"
    class="summit-header"
    style="
      background-image: url(https://2tjosk2rxzc21medji3nfn1g-wpengine.netdna-ssl.com/wp-content/uploads/2020/07/summit2020-scaled.jpg);
    "
  >
    <div class="container">
      <div class="closebanner"></div>
      <h4 class="countdown">
        <span><b class="days"></b> Days Until Kong Summit 2020: The Biggest Event
          for API Practitioners.<a
            href="https://konghq.com/kong-summit/?itm_source=website&amp;itm_medium=top-global-promo"
            style="font-size: 14px; font-weight: 345" target="_blank" rel="noopener"
            ><b style="font-weight: 900; letter-spacing: 0px"
              >Free tickets available now!</b
            ></a
          ></span
        >
      </h4>
      <h4 class="flip"">
        <span>Kong Summit 2020: The Biggest Event
          for API Practitioners.<a
            href="https://konghq.com/kong-summit/?itm_source=website&amp;itm_medium=top-global-promo"
            style="font-size: 14px; font-weight: 345" target="_blank" rel="noopener"
            ><b style="font-weight: 900; letter-spacing: 0px"
              >Join Live!</b
            ></a
          ></span
        >
      </h4>
    </div>
  </div>
  <div class="container d-flex">
    <a href="https://konghq.com/" class="navbar-brand col col-xl-auto">
      <img
        src="https://2tjosk2rxzc21medji3nfn1g-wpengine.netdna-ssl.com/wp-content/themes/konghq/assets/img/gradient-logo.svg"
        alt="Kong Logo"
      />
    </a>
    <button
      class="navbar-toggler align-self-center"
      type="button"
      data-toggle="kong-expand"
      data-target="#pagesNav"
      aria-controls="pagesNav"
      aria-expanded="false"
      aria-label="Toggle navigation"
    >
      <div></div>
      <div></div>
      <div></div>
    </button>
    <nav class="navbar full-width">
      <div
        class="collapse navbar-collapse col justify-content-md-end kong-navbar_nav"
      >
        <ul id="menu-primary-nav" class="menu">
          <li
            class="btn menu-item menu-item-type-custom menu-item-object-custom menu-item-12447 navbar-item"
          >
            <a
              href="https://konghq.com/get-started?itm_source=website&itm_medium=nav"
              class="nav-link"
              >Get Started</a
            >
          </li>
          <li
            id="menu-item-18416"
            class="multicol wide nav1 toplabel centered menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-18416 navbar-item"
          >
            <a href="#" class="nav-link">Products</a>
            <ul class="sub-menu">
              <li
                id="menu-item-18417"
                class="nav2 icon click menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-18417 navbar-item"
              >
                <a
                  href="https://konghq.com/products/kong-enterprise?itm_source=website&amp;itm_medium=nav"
                  class="nav-link"
                  ><img
                    alt="kong-enterprise"
                    src="/assets/images/nav/kong-logo.png"
                  />
                  Kong Enterprise</a
                >
                <ul class="sub-menu">
                  <li
                    id="menu-item-18418"
                    class="menu-item menu-item-type-custom menu-item-object-custom menu-item-18418 navbar-item"
                  >
                    <a
                      href="https://konghq.com/products/kong-enterprise?itm_source=website&itm_medium=nav"
                      class="nav-link"
                      >Kong Enterprise
                      <p class="description">
                        End-to-end connectivity platform
                      </p></a
                    >
                  </li>
                  <li
                    id="menu-item-18419"
                    class="nav3 pb-0x menu-item menu-item-type-custom menu-item-object-custom menu-item-18419 navbar-item"
                  >
                    <a
                      href="https://konghq.com/products/kong-enterprise/kong-mesh/?itm_source=website&itm_medium=nav"
                      class="nav-link"
                      >Kong Mesh
                      <p class="description">Universal service mesh</p></a
                    >
                  </li>
                  <li
                    id="menu-item-18420"
                    class="menu-item menu-item-type-custom menu-item-object-custom menu-item-18420 navbar-item"
                  >
                    <a
                      href="https://konghq.com/products/kong-enterprise/kong-studio?itm_source=website&amp;itm_medium=nav"
                      class="nav-link"
                      >Kong Studio
                      <p class="description">Empower your developers</p></a
                    >
                  </li>
                  <li
                    id="menu-item-18421"
                    class="menu-item menu-item-type-custom menu-item-object-custom menu-item-18421 navbar-item"
                  >
                    <a
                      href="https://konghq.com/products/kong-enterprise/dev-portal?itm_source=website&amp;itm_medium=nav"
                      class="nav-link"
                      >Dev Portal
                      <p class="description">Accelerate innovation</p></a
                    >
                  </li>
                  <li
                    id="menu-item-18418"
                    class="menu-item menu-item-type-custom menu-item-object-custom menu-item-18418 navbar-item"
                  >
                    <a
                      href="https://konghq.com/products/kong-enterprise/kong-manager?itm_source=website&amp;itm_medium=nav"
                      class="nav-link"
                      >Kong Manager
                      <p class="description">Manage all your services</p></a
                    >
                  </li>
                  <li
                    id="menu-item-18423"
                    class="menu-item menu-item-type-custom menu-item-object-custom menu-item-18423 navbar-item"
                  >
                    <a
                      href="https://konghq.com/products/kong-enterprise/kong-immunity?itm_source=website&amp;itm_medium=nav"
                      class="nav-link"
                      >Kong Immunity
                      <p class="description">Autonomously identify issues</p></a
                    >
                  </li>
                  <li
                    id="menu-item-18424"
                    class="menu-item menu-item-type-custom menu-item-object-custom menu-item-18424 navbar-item"
                  >
                    <a
                      href="https://konghq.com/products/kong-enterprise/kong-kubernetes?itm_source=website&amp;itm_medium=nav"
                      class="nav-link"
                      >Kong for Kubernetes
                      <p class="description">
                        Native Kubernetes Ingress Controller
                      </p></a
                    >
                  </li>
                  <li
                    id="menu-item-18425"
                    class="menu-item menu-item-type-custom menu-item-object-custom menu-item-18425 navbar-item"
                  >
                    <a
                      href="https://konghq.com/products/kong-enterprise/enterprise-plugins/?itm_source=website&amp;itm_medium=nav"
                      class="nav-link"
                      >Enterprise Plugins
                      <p class="description">Instantly implement policies</p></a
                    >
                  </li>
                  <li
                    id="menu-item-18426"
                    class="menu-item menu-item-type-custom menu-item-object-custom menu-item-18426 navbar-item"
                  >
                    <a
                      href="https://konghq.com/products/kong-enterprise/vitals/?itm_source=website&amp;itm_medium=nav"
                      class="nav-link"
                      >Kong Vitals
                      <p class="description">Monitor your Kong Enterprise</p></a
                    >
                  </li>
                  <li
                    id="menu-item-18427"
                    class="nav-button reverse menu-item menu-item-type-custom menu-item-object-custom menu-item-18427 navbar-item"
                  >
                    <a
                      href="https://konghq.com/get-started/?itm_source=website&amp;itm_medium=nav"
                      class="nav-link"
                      >Get Started</a
                    >
                  </li>
                </ul>
              </li>
              <li
                id="menu-item-18428"
                class="nav2 menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-18428 navbar-item"
              >
                <a href="#" class="nav-link"
                  >Built on an Open-source Foundation</a
                >
                <ul class="sub-menu">
                  <li
                    id="menu-item-18429"
                    class="icon menu-item menu-item-type-custom menu-item-object-custom menu-item-18429 navbar-item"
                  >
                    <a
                      href="https://konghq.com/kong/?itm_source=website&amp;itm_medium=nav"
                      class="nav-link"
                      ><img
                        alt="kong-gateway"
                        src="/assets/images/nav/kong-logo.png"
                      />
                      Kong Gateway
                      <p class="description">API Gateway</p></a
                    >
                  </li>
                  <li
                    id="menu-item-18430"
                    class="icon menu-item menu-item-type-custom menu-item-object-custom menu-item-18430 navbar-item"
                  >
                    <a
                      target="_blank"
                      rel="noopener noreferrer"
                      href="https://kuma.io/?itm_source=website&amp;itm_medium=nav"
                      class="nav-link"
                      ><img alt="kuma" src="/assets/images/nav/kuma-logo.svg" />
                      Kuma
                      <p class="description">Service Mesh</p></a
                    >
                  </li>
                  <li
                    id="menu-item-18431"
                    class="icon menu-item menu-item-type-custom menu-item-object-custom menu-item-18431 navbar-item"
                  >
                    <a
                      target="_blank"
                      rel="noopener noreferrer"
                      href="https://insomnia.rest/?itm_source=website&amp;itm_medium=nav"
                      class="nav-link"
                      ><img
                        alt="insomnia"
                        src="/assets/images/nav/insomnia-logo.svg"
                      />
                      Insomnia
                      <p class="description">API Design and Testing</p></a
                    >
                  </li>
                  <li
                    id="menu-item-18432"
                    class="nav-button menu-item menu-item-type-custom menu-item-object-custom menu-item-18432 navbar-item"
                  >
                    <a
                      href="https://konghq.com/get-started#install?itm_source=website&itm_medium=nav"
                      class="nav-link"
                      >Install</a
                    >
                  </li>
                </ul>
              </li>
              <li
                id="menu-item-18433"
                class="nav2 hidden menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-18433 navbar-item"
              >
                <a href="#" class="nav-link">Kubernetes &amp; Subscriptions</a>
                <ul class="sub-menu">
                  <li
                    id="menu-item-18434"
                    class="menu-item menu-item-type-custom menu-item-object-custom menu-item-18434 navbar-item"
                  >
                    <a
                      href="https://konghq.com/solutions/kubernetes-ingress/?itm_source=website&amp;itm_medium=nav"
                      class="nav-link"
                      >Kubernetes Ingress Controller
                      <p class="description">Ingress and CRDs</p></a
                    >
                  </li>
                  <li
                    id="menu-item-18435"
                    class="menu-item menu-item-type-custom menu-item-object-custom menu-item-18435 navbar-item"
                  >
                    <a
                      href="https://konghq.com/subscriptions/?itm_source=website&amp;itm_medium=nav"
                      class="nav-link"
                      >Subscriptions
                      <p class="description">
                        Kong Gateway and Enterprise features
                      </p></a
                    >
                  </li>
                </ul>
              </li>
            </ul>
          </li>
          <li
            id="menu-item-12471"
            class="multicol wide nav1 toplabel menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-12471 navbar-item"
          >
            <a href="#" class="nav-link solutions">Solutions</a>
            <ul class="sub-menu">
              <li
                id="menu-item-12472"
                class="nav2 menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-12472 navbar-item"
              >
                <a href="#" class="nav-link use-cases">Use Cases</a>
                <ul class="sub-menu">
                  <li
                    id="menu-item-12473"
                    class="menu-item menu-item-type-custom menu-item-object-custom menu-item-12473 navbar-item"
                  >
                    <a
                      href="https://konghq.com/solutions/use-cases/decentralize-applications-and-services?itm_source=website&amp;itm_medium=nav"
                      class="nav-link decentralize-apps-and-services<p-class=&quot;description&quot;>accelerate-your-journey-into-microservices</p>"
                      >Decentralize Apps and Services
                      <p class="description">
                        Accelerate your journey into microservices
                      </p></a
                    >
                  </li>
                  <li
                    id="menu-item-14131"
                    class="menu-item menu-item-type-custom menu-item-object-custom menu-item-14131 navbar-item"
                  >
                    <a
                      href="https://konghq.com/solutions/use-cases/secure-and-govern-apis-and-services/?itm_source=website&amp;itm_medium=nav"
                      class="nav-link secure-and-govern-apis<p-class=&quot;description&quot;>empower-teams-to-provide-security,-governance-and-compliance</p>"
                      >Secure and Govern APIs
                      <p class="description">
                        Empower teams to provide security, governance and
                        compliance
                      </p></a
                    >
                  </li>
                  <li
                    id="menu-item-17469"
                    class="menu-item menu-item-type-custom menu-item-object-custom menu-item-17469 navbar-item"
                  >
                    <a
                      href="https://konghq.com/solutions/use-cases/create-a-developer-platform/?itm_source=website&amp;itm_medium=nav"
                      class="nav-link create-a-developer-platform<p-class=&quot;description&quot;>rapidly-design,-publish-and-consume-apis-and-services</p>"
                      >Create a Developer Platform
                      <p class="description">
                        Rapidly design, publish and consume APIs and services
                      </p></a
                    >
                  </li>
                </ul>
              </li>
              <li
                id="menu-item-17470"
                class="nav2 menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-17470 navbar-item"
              >
                <a href="#" class="nav-link deployment-patterns"
                  >Deployment Patterns</a
                >
                <ul class="sub-menu">
                  <li
                    id="menu-item-17471"
                    class="menu-item menu-item-type-custom menu-item-object-custom menu-item-17471 navbar-item"
                  >
                    <a
                      href="https://konghq.com/solutions/gateway/?itm_source=website&amp;itm_medium=nav"
                      class="nav-link api-gateway<p-class=&quot;description&quot;>take-control-of-your-microservices-with-the-world's-most-popular-api-gateway</p>"
                      >API Gateway
                      <p class="description">
                        Take control of your microservices with the world’s most
                        popular API gateway
                      </p></a
                    >
                  </li>
                  <li
                    id="menu-item-17472"
                    class="menu-item menu-item-type-custom menu-item-object-custom menu-item-17472 navbar-item"
                  >
                    <a
                      href="https://konghq.com/solutions/kubernetes-ingress/?itm_source=website&amp;itm_medium=nav"
                      class="nav-link kubernetes<p-class=&quot;description&quot;>own-your-kubernetes-cluster-by-using-kong-as-an-ingress-controller</p>"
                      >Kubernetes
                      <p class="description">
                        Own your Kubernetes cluster by using Kong as an Ingress
                        Controller
                      </p></a
                    >
                  </li>
                  <li
                    id="menu-item-17473"
                    class="menu-item menu-item-type-custom menu-item-object-custom menu-item-17473 navbar-item"
                  >
                    <a
                      target="_blank"
                      rel="noopener noreferrer"
                      href="https://kuma.io/?itm_source=website&amp;itm_medium=nav"
                      class="nav-link service-mesh<p-class=&quot;description&quot;>build,-secure-and-observe-your-modern-service-mesh</p>"
                      >Service Mesh
                      <p class="description">
                        Build, secure and observe your modern Service Mesh
                      </p></a
                    >
                  </li>
                </ul>
              </li>
            </ul>
          </li>
          <li
            class="menu-item menu-item-type-custom menu-item-object-custom menu-item-12471 navbar-item"
          >
            <a href="/hub" class="nav-link">Plugins</a>
          </li>
          <li
            class="one-col nav1 menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-12475 navbar-item"
          >
            <a href="#" class="nav-link">Open Source</a>
            <ul class="sub-menu">
              <li
                class="nav2 menu-item menu-item-type-custom menu-item-object-custom menu-item-12476 navbar-item"
              >
                <a
                  href="https://konghq.com/get-started#install?itm_source=website&itm_medium=nav"
                  class="nav-link"
                  ><img src="/assets/images/nav/install.svg" /> Install Kong
                  Gateway</a
                >
              </li>
              <li
                class="nav2 menu-item menu-item-type-custom menu-item-object-custom menu-item-12477 navbar-item"
              >
                <a
                  href="https://konghq.com/community?itm_source=website&itm_medium=nav"
                  class="nav-link"
                  ><img src="/assets/images/nav/community.svg" /> Kong
                  Community</a
                >
              </li>
              <li
                class="nav2 menu-item menu-item-type-custom menu-item-object-custom menu-item-12478 navbar-item"
              >
                <a
                  target="_blank"
                  href="https://github.com/Kong/kubernetes-ingress-controller"
                  class="nav-link"
                  ><img src="/assets/images/nav/kubernetes.svg" /> Kubernetes
                  Ingress</a
                >
              </li>
              <li
                class="nav2 menu-item menu-item-type-custom menu-item-object-custom menu-item-12479 navbar-item"
              >
                <a target="_blank" href="https://kuma.io" class="nav-link"
                  ><img src="/assets/images/nav/logo-kuma-line.svg" /> Kuma</a
                >
              </li>
              <li
                class="nav2 hidden menu-item menu-item-type-custom menu-item-object-custom menu-item-12480 navbar-item"
              >
                <a
                  target="_blank"
                  href="https://insomnia.rest/"
                  class="nav-link"
                  ><img src="/assets/images/nav/insomnia.svg" /> Insomnia</a
                >
              </li>
            </ul>
          </li>
          <li
            class="multicol wide nav1 menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-12481 navbar-item docs"
          >
            <a
              target="_blank"
              href="https://docs.konghq.com/?itm_source=website&itm_medium=nav"
              class="nav-link"
              >Docs</a
            >
            <ul class="sub-menu">
              <li
                id="menu-item-12483"
                class="nav2 menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-12483 navbar-item"
              >
                <a class="nav-link">Documentation</a>
                <ul class="sub-menu">
                  <li
                    class="menu-item menu-item-type-custom menu-item-object-custom menu-item-12486 navbar-item"
                  >
                    <a
                      target="_blank"
                      href="https://docs.konghq.com/?itm_source=website&itm_medium=nav"
                      class="nav-link"
                      ><img
                        src="/assets/images/nav/deploy-plugins-master-launch.svg"
                      />
                      Kong Gateway</a
                    >
                  </li>
                  <li
                    class="menu-item menu-item-type-custom menu-item-object-custom menu-item-12487 navbar-item"
                  >
                    <a
                      target="_blank"
                      href="https://docs.konghq.com/enterprise/?itm_source=website&itm_medium=nav"
                      class="nav-link"
                      ><img
                        src="/assets/images/nav/deploy-plugins-master-launch.svg"
                      />
                      Kong Enterprise</a
                    >
                  </li>
                  <li
                    class="menu-item menu-item-type-custom menu-item-object-custom menu-item-12489 navbar-item"
                  >
                    <a
                      target="_blank"
                      href="https://docs.konghq.com/mesh/?itm_source=website&itm_medium=nav"
                      class="nav-link"
                      ><img
                        src="/assets/images/nav/deploy-plugins-master-launch.svg"
                      />
                      Kong Mesh</a
                    >
                  </li>
                  <li
                    class="menu-item menu-item-type-custom menu-item-object-custom menu-item-12488 navbar-item"
                  >
                    <a
                      target="_blank"
                      href="https://docs.konghq.com/studio/?itm_source=website&itm_medium=nav"
                      class="nav-link"
                      ><img
                        src="/assets/images/nav/deploy-plugins-master-launch.svg"
                      />
                      Kong Studio</a
                    >
                  </li>
                  <li
                    class="menu-item menu-item-type-custom menu-item-object-custom menu-item-12489 navbar-item"
                  >
                    <a
                      target="_blank"
                      href="https://docs.konghq.com/hub/?itm_source=website&itm_medium=nav"
                      class="nav-link"
                      ><img
                        src="/assets/images/nav/deploy-plugins-master-launch.svg"
                      />
                      Plugins Hub</a
                    >
                  </li>
                </ul>
              </li>
            </ul>
          </li>
          <li
            class="multicol nav1 menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-12490 navbar-item"
          >
            <a href="#" class="nav-link">Resources</a>
            <ul class="sub-menu">
              <li
                class="nav2 menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-12491 navbar-item"
              >
                <a class="nav-link">Learning</a>
                <ul class="sub-menu">
                  <li
                    class="menu-item menu-item-type-custom menu-item-object-custom menu-item-12495 navbar-item"
                  >
                    <a
                      href="https://konghq.com/resources/?content=ebooks&itm_source=website&itm_medium=nav"
                      class="nav-link"
                      ><img src="/assets/images/nav/ebooks.svg" /> eBooks</a
                    >
                  </li>
                  <li
                    class="menu-item menu-item-type-custom menu-item-object-custom menu-item-12496 navbar-item"
                  >
                    <a
                      href="https://konghq.com/resources/?content=webinars&itm_source=website&itm_medium=nav"
                      class="nav-link"
                      ><img src="/assets/images/nav/webinars.svg" /> Webinars</a
                    >
                  </li>
                  <li
                    class="menu-item menu-item-type-custom menu-item-object-custom menu-item-12497 navbar-item"
                  >
                    <a
                      href="https://konghq.com/resources/?content=whitepaper&itm_source=website&itm_medium=nav"
                      class="nav-link"
                      ><img src="/assets/images/nav/briefs.svg" /> Briefs</a
                    >
                  </li>
                  <li
                    class="menu-item menu-item-type-custom menu-item-object-custom menu-item-12494 navbar-item"
                  >
                    <a
                      href="https://konghq.com/blog?itm_source=website&itm_medium=nav"
                      class="nav-link"
                      ><img src="/assets/images/nav/blog.svg" /> Blog</a
                    >
                  </li>
                </ul>
              </li>
              <li
                class="nav2 menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-12492 navbar-item"
              >
                <a class="nav-link">Community</a>
                <ul class="sub-menu">
                  <li
                    class="menu-item menu-item-type-custom menu-item-object-custom menu-item-12500 navbar-item"
                  >
                    <a
                      href="https://konghq.com/community?itm_source=website&itm_medium=nav"
                      class="nav-link"
                      ><img src="/assets/images/nav/meetups.svg" /> Community</a
                    >
                  </li>
                  <li
                    class="menu-item menu-item-type-custom menu-item-object-custom menu-item-12498 navbar-item"
                  >
                    <a
                      target="_blank"
                      href="https://discuss.konghq.com/?_ga=2.147363831.1919773651.1569859116-132287075.1554308608"
                      class="nav-link"
                      ><img src="/assets/images/nav/kong-nation.svg" /> Kong
                      Nation</a
                    >
                  </li>
                  <li
                    class="menu-item menu-item-type-custom menu-item-object-custom menu-item-12501 navbar-item"
                  >
                    <a
                      href="https://konghq.com/kong-summit?itm_source=website&itm_medium=nav"
                      class="nav-link"
                      ><img src="/assets/images/nav/summit.svg" /> Kong
                      Summit</a
                    >
                  </li>
                  <li
                    class="menu-item menu-item-type-custom menu-item-object-custom menu-item-12499 navbar-item"
                  >
                    <a
                      target="_blank"
                      href="https://github.com/Kong/"
                      class="nav-link"
                      ><img src="/assets/images/nav/github.svg" /> GitHub</a
                    >
                  </li>
                </ul>
              </li>
              <li
                class="nav2 menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-12493 navbar-item"
              >
                <a class="nav-link">Support</a>
                <ul class="sub-menu">
                  <li
                    class="menu-item menu-item-type-custom menu-item-object-custom menu-item-12502 navbar-item"
                  >
                    <a
                      target="_blank"
                      href="https://support.konghq.com/s/?itm_source=website&itm_medium=nav"
                      class="nav-link"
                      ><img src="/assets/images/nav/support-faqs.svg" />
                      Enterprise Support Portal</a
                    >
                  </li>
                  <li
                    class="menu-item menu-item-type-custom menu-item-object-custom menu-item-12503 navbar-item"
                  >
                    <a
                      href="https://konghq.com/faqs?itm_source=website&itm_medium=nav"
                      class="nav-link"
                      ><img src="/assets/images/nav/support-faqs.svg" /> FAQS</a
                    >
                  </li>
                  <li
                    class="menu-item menu-item-type-custom menu-item-object-custom menu-item-12502 navbar-item"
                  >
                    <a
                      href="https://konghq.com/support/kong-professional-services?itm_source=website&itm_medium=nav"
                      class="nav-link"
                      ><img src="/assets/images/nav/support-faqs.svg" /> Kong
                      Professional Services</a
                    >
                  </li>
                  <li
                    class="menu-item menu-item-type-custom menu-item-object-custom menu-item-12503 navbar-item"
                  >
                    <a
                      href="https://konghq.com/support/kong-university/?itm_source=website&itm_medium=nav"
                      class="nav-link"
                      ><img src="/assets/images/nav/support-faqs.svg" /> Kong
                      University</a
                    >
                  </li>
                </ul>
              </li>
            </ul>
          </li>
          <li
            id="menu-item-12504"
            class="one-col icn-sm nav1 menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-12504 navbar-item"
          >
            <a href="#" class="nav-link">Company</a>
            <ul class="sub-menu">
              <li
                class="nav2 menu-item menu-item-type-custom menu-item-object-custom menu-item-12505 navbar-item"
              >
                <a
                  href="https://konghq.com/about-kong-inc?itm_source=website&itm_medium=nav"
                  class="nav-link"
                  ><img src="/assets/images/nav/about.svg" /> About</a
                >
              </li>
              <li
                class="nav2 menu-item menu-item-type-custom menu-item-object-custom menu-item-12505 navbar-item"
              >
                <a
                  href="https://konghq.com/customers?itm_source=website&itm_medium=nav"
                  class="nav-link"
                  ><img src="/assets/images/nav/meetups.svg" /> Customers</a
                >
              </li>
              <li
                class="nav2 menu-item menu-item-type-custom menu-item-object-custom menu-item-12506 navbar-item"
              >
                <a
                  href="https://konghq.com/investors?itm_source=website&itm_medium=nav"
                  class="nav-link"
                  ><img src="/assets/images/nav/investors.svg" /> Investors</a
                >
              </li>
              <li
                class="nav2 menu-item menu-item-type-custom menu-item-object-custom menu-item-12507 navbar-item"
              >
                <a
                  href="https://konghq.com/careers?itm_source=website&itm_medium=nav"
                  class="nav-link"
                  ><img src="/assets/images/nav/careers.svg" /> Careers</a
                >
              </li>
              <li
                class="nav2 menu-item menu-item-type-custom menu-item-object-custom menu-item-12508 navbar-item"
              >
                <a
                  href="https://konghq.com/partners?itm_source=website&itm_medium=nav"
                  class="nav-link"
                  ><img src="/assets/images/nav/partners.svg" /> Partners</a
                >
              </li>
              <li
                class="nav2 menu-item menu-item-type-custom menu-item-object-custom menu-item-12509 navbar-item"
              >
                <a
                  href="https://konghq.com/press-room?itm_source=website&itm_medium=nav"
                  class="nav-link"
                  ><img src="/assets/images/nav/press.svg" /> Press</a
                >
              </li>
              <li
                class="nav2 menu-item menu-item-type-custom menu-item-object-custom menu-item-12510 navbar-item"
              >
                <a
                  href="https://konghq.com/contact?itm_source=website&itm_medium=nav"
                  class="nav-link"
                  ><img src="/assets/images/nav/contact.svg" /> Contact</a
                >
              </li>
            </ul>
          </li>
          <li
            class="demo-btn menu-item menu-item-type-custom menu-item-object-custom menu-item-12511 navbar-item"
          >
            <a
              href="https://konghq.com/get-started?itm_source=website&itm_medium=nav"
              class="nav-link"
              >Get Started</a
            >
          </li>
        </ul>
      </div>
    </nav>
  </div>
</header>


    <div class="page v2 ">
  <header class="page-header">
    <div class="page-header-bg"></div>
    <div class="container">
      <nav class="docs-navigation v2">
        <a href="/"  class="active" >Kong Gateway</a>
        <a href="/enterprise" >Kong Enterprise</a>
        <a href="/mesh" >Kong Mesh</a>
        <a href="/getting-started-guide/latest/overview" >Getting Started</a>

        <div class="header-actions">
          <div class="search-version-row">
            
            <div class="versions-dropdown dropdown no-right-border">
              <button class="page-header-btn" id="version-dropdown" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Version 2.1.x
                 <em>(latest)</em>
                <span class="caret"></span>
              </button>
              <ul class="dropdown-menu dropdown-menu-right" role="menu" aria-labelledby="version-dropdown">
                
                
                <li  class="active" >
                <li  class="active" >
                  <a href="/2.1.x/upgrading/"
                     class="active" 
                    data-version-id="2.1.x"
                  >
                  2.1.x
                   <em>(latest)</em>
                  </a>
                </li>
                
                
                <li >
                <li >
                  <a href="/2.0.x/upgrading/"
                    
                    data-version-id="2.0.x"
                  >
                  2.0.x
                  
                  </a>
                </li>
                
                
                <li >
                <li >
                  <a href="/1.5.x/upgrading/"
                    
                    data-version-id="1.5.x"
                  >
                  1.5.x
                  
                  </a>
                </li>
                
                
                <li >
                <li >
                  <a href="/1.4.x/upgrading/"
                    
                    data-version-id="1.4.x"
                  >
                  1.4.x
                  
                  </a>
                </li>
                
                
                <li >
                <li >
                  <a href="/1.3.x/upgrading/"
                    
                    data-version-id="1.3.x"
                  >
                  1.3.x
                  
                  </a>
                </li>
                
                
                <li >
                <li >
                  <a href="/1.2.x/upgrading/"
                    
                    data-version-id="1.2.x"
                  >
                  1.2.x
                  
                  </a>
                </li>
                
                
                <li >
                <li >
                  <a href="/1.1.x/upgrading/"
                    
                    data-version-id="1.1.x"
                  >
                  1.1.x
                  
                  </a>
                </li>
                
                
                <li >
                <li >
                  <a href="/1.0.x/upgrading/"
                    
                    data-version-id="1.0.x"
                  >
                  1.0.x
                  
                  </a>
                </li>
                
                
                <li >
                <li >
                  <a href="/0.14.x"
                    
                    data-version-id="0.14.x"
                  >
                  0.14.x
                  
                  </a>
                </li>
                
                
                <li >
                <li >
                  <a href="/0.13.x"
                    
                    data-version-id="0.13.x"
                  >
                  0.13.x
                  
                  </a>
                </li>
                
                
                <li >
                <li >
                  <a href="/0.12.x"
                    
                    data-version-id="0.12.x"
                  >
                  0.12.x
                  
                  </a>
                </li>
                
                
                <li >
                <li >
                  <a href="/0.11.x"
                    
                    data-version-id="0.11.x"
                  >
                  0.11.x
                  
                  </a>
                </li>
                
                
                <li >
                <li >
                  <a href="/0.10.x"
                    
                    data-version-id="0.10.x"
                  >
                  0.10.x
                  
                  </a>
                </li>
                
                
                <li >
                <li >
                  <a href="/0.9.x"
                    
                    data-version-id="0.9.x"
                  >
                  0.9.x
                  
                  </a>
                </li>
                
                
                <li >
                <li >
                  <a href="/0.8.x"
                    
                    data-version-id="0.8.x"
                  >
                  0.8.x
                  
                  </a>
                </li>
                
                
                <li >
                <li >
                  <a href="/0.7.x"
                    
                    data-version-id="0.7.x"
                  >
                  0.7.x
                  
                  </a>
                </li>
                
                
                <li >
                <li >
                  <a href="/0.6.x"
                    
                    data-version-id="0.6.x"
                  >
                  0.6.x
                  
                  </a>
                </li>
                
                
                <li >
                <li >
                  <a href="/0.5.x"
                    
                    data-version-id="0.5.x"
                  >
                  0.5.x
                  
                  </a>
                </li>
                
                
                <li >
                <li >
                  <a href="/0.4.x"
                    
                    data-version-id="0.4.x"
                  >
                  0.4.x
                  
                  </a>
                </li>
                
                
                <li >
                <li >
                  <a href="/0.3.x"
                    
                    data-version-id="0.3.x"
                  >
                  0.3.x
                  
                  </a>
                </li>
                
                
                <li >
                <li >
                  <a href="/0.2.x"
                    
                    data-version-id="0.2.x"
                  >
                  0.2.x
                  
                  </a>
                </li>
                
              </ul>
            </div>
            
            
            <div class="dropdown" id="searchBar">
              <div id="getkong-algolia-search" class="search-input v2">
                <img class="icon" src="/assets/images/icons/icn-magnifying-glass.svg" alt="search">
                <input type="text" placeholder="Type to search" id="getkong-algolia-search-input" />
              </div>
            </div>
          </div>
          <img id="search-version-icon" src="/assets/images/icons/icn-magnifying-glass.svg" alt="search">
          
          <div class="edit-this-page v2">
            <a target="_blank" href="https://github.com/Kong/docs.konghq.com/tree/master/app/2.1.x/upgrading.md">
              <img src="/assets/images/logos/logo-github.svg" alt="github"/>
            </a>
          </div>
        </div>
      </nav>

      <div class="title-version-search-container">
        <div class="page-header-title">
          <h1>Upgrade guide</h1>
          <h2></h2>
        </div>
      </div>
    </div>
  </header>

  <div class="container">
    <aside class="docs-sidebar">
  <i class="fa fa-times close-sidebar"></i>
  

  <ul class="accordion-container">
    
    





<li class="accordion-item">
  
  <input id="accordion-1" type="checkbox" />
  
  
  <label for="accordion-1">
    
    <img src="/assets/images/icons/documentation/icn-quickstart-color.svg" alt="icon">
    
    
    Getting Started
    
    
    <i class="fa fa-chevron-down"></i>
    
  </label>
  
  <div>
    
<ul class="items">
  
  
  
  
  
  <li>
    <a href="/2.1.x/../../getting-started-guide/latest/overview"  >
      Overview
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/../../getting-started-guide/latest/prepare"  >
      Prepare to Administer
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/../../getting-started-guide/latest/expose-services"  >
      Expose your Services
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/../../getting-started-guide/latest/protect-services"  >
      Protect your Services
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/../../getting-started-guide/latest/improve-performance"  >
      Improve Performance
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/../../getting-started-guide/latest/secure-services"  >
      Secure Services
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/../../getting-started-guide/latest/load-balancing"  >
      Set Up Intelligent Load Balancing
    </a>
  </li>
  
  
</ul>

  </div>
</li>


    
    





<li class="accordion-item">
  
  <input id="accordion-2" type="checkbox" />
  
  
  <label for="accordion-2">
    
    <img src="/assets/images/icons/documentation/icn-references-color.svg" alt="icon">
    
    
    Guides &amp; References
    
    
    <i class="fa fa-chevron-down"></i>
    
  </label>
  
  <div>
    
<ul class="items">
  
  
  
  
  
  <li>
    <a href="/2.1.x/getting-started/introduction"  >
      Quickstart Guide
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/getting-started/quickstart"  >
      Five-minute quickstart
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/getting-started/configuring-a-service"  >
      Configuring a Service
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/getting-started/configuring-a-grpc-service"  >
      Configuring a gRPC Service
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/getting-started/enabling-plugins"  >
      Enabling Plugins
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/getting-started/adding-consumers"  >
      Adding Consumers
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/configuration"  >
      Configuration reference
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/cli"  >
      CLI reference
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/proxy"  >
      Proxy reference
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/auth"  >
      Authentication reference
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/loadbalancing"  >
      Load balancing reference
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/health-checks-circuit-breakers"  >
      Health checks and circuit breakers reference
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/hybrid-mode"  >
      Hybrid Mode
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/go"  >
      Go Plugins
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/clustering"  >
      Clustering reference
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/db-less-and-declarative-config"  >
      DB-less &amp; Declarative Configuration Format
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/sizing-guidelines"  >
      Resource Sizing Guidelines
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/logging"  >
      Logging reference
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/network"  >
      Network &amp; Firewall
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/secure-admin-api"  >
      Securing the Admin API
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/systemd"  >
      Control Kong Community Gateway through systemd
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/upgrading"  class="active">
      Upgrade Guide
    </a>
  </li>
  
  
  
  
  





<li class="accordion-item">
  
  <input id="accordion-2-23" type="checkbox" />
  
  
  <label for="accordion-2-23">
    
    
    <a href="/2.1.x/plugin-development/">Plugin Development Guide</a>
    
    
    <i class="fa fa-chevron-down"></i>
    
  </label>
  
  <div>
    
<ul class="items">
  
  
  
  
  
  <li>
    <a href="/2.1.x/plugin-development"  >
      Introduction
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/plugin-development/file-structure"  >
      File structure
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/plugin-development/custom-logic"  >
      Implementing custom logic
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/plugin-development/plugin-configuration"  >
      Plugin configuration
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/plugin-development/access-the-datastore"  >
      Accessing the datastore
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/plugin-development/custom-entities"  >
      Storing custom entities
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/plugin-development/entities-cache"  >
      Caching custom entities
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/plugin-development/admin-api"  >
      Extending the Admin API
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/plugin-development/tests"  >
      Writing tests
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/plugin-development/distribution"  >
      (un)Installing your plugin
    </a>
  </li>
  
  
</ul>

  </div>
</li>


  
  
  
  
  





<li class="accordion-item">
  
  <input id="accordion-2-24" type="checkbox" />
  
  
  <label for="accordion-2-24">
    
    
    <a href="/2.1.x/pdk/">Plugin Development Kit</a>
    
    
    <i class="fa fa-chevron-down"></i>
    
  </label>
  
  <div>
    
<ul class="items">
  
  
  
  
  
  <li>
    <a href="/2.1.x/pdk/kong.client"  >
      kong.client
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/pdk/kong.client.tls"  >
      kong.client.tls
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/pdk/kong.ctx"  >
      kong.ctx
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/pdk/kong.ip"  >
      kong.ip
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/pdk/kong.log"  >
      kong.log
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/pdk/kong.nginx"  >
      kong.nginx
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/pdk/kong.node"  >
      kong.node
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/pdk/kong.request"  >
      kong.request
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/pdk/kong.response"  >
      kong.response
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/pdk/kong.router"  >
      kong.router
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/pdk/kong.service"  >
      kong.service
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/pdk/kong.service.request"  >
      kong.service.request
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/pdk/kong.service.response"  >
      kong.service.response
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/pdk/kong.table"  >
      kong.table
    </a>
  </li>
  
  
</ul>

  </div>
</li>


  
  
</ul>

  </div>
</li>


    
    





<li class="accordion-item">
  
  <input id="accordion-3" type="checkbox" />
  
  
  <label for="accordion-3">
    
    <img src="/assets/images/icons/documentation/icn-admin-api-color.svg" alt="icon">
    
    
    <a href="/2.1.x/admin-api/">Admin API</a>
    
    
    <i class="fa fa-chevron-down"></i>
    
  </label>
  
  <div>
    
<ul class="items">
  
  
  
  
  
  <li>
    <a href="/2.1.x/db-less-admin-api"  >
      DB-less
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/db-less-admin-api/#declarative-configuration"  >
      Declarative Configuration
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/admin-api/#supported-content-types"  >
      Supported Content Types
    </a>
  </li>
  
  
  
  
  





<li class="accordion-item">
  
  <input id="accordion-3-4" type="checkbox" />
  
  
  <label for="accordion-3-4">
    
    
    <a href="/2.1.x/admin-api/#information-routes">Information Routes</a>
    
    
    <i class="fa fa-chevron-down"></i>
    
  </label>
  
  <div>
    
<ul class="items">
  
  
  
  
  
  <li>
    <a href="/2.1.x/admin-api/#retrieve-node-information"  >
      Retrieve Node Information
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/admin-api/#list-available-endpoints"  >
      List Available Endpoints
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/admin-api/#validate-a-configuration-against-a-schema"  >
      Validate A Configuration against A Schema
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/admin-api/#retrieve-entity-schema"  >
      Retrieve Entity Schema
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/admin-api/#retrieve-plugin-schema"  >
      Retrieve Plugin Schema
    </a>
  </li>
  
  
</ul>

  </div>
</li>


  
  
  
  
  





<li class="accordion-item">
  
  <input id="accordion-3-5" type="checkbox" />
  
  
  <label for="accordion-3-5">
    
    
    <a href="/2.1.x/admin-api/#health-routes">Health Routes</a>
    
    
    <i class="fa fa-chevron-down"></i>
    
  </label>
  
  <div>
    
<ul class="items">
  
  
  
  
  
  <li>
    <a href="/2.1.x/admin-api/#retrieve-node-status"  >
      Retrieve Node Status
    </a>
  </li>
  
  
</ul>

  </div>
</li>


  
  
  
  
  





<li class="accordion-item">
  
  <input id="accordion-3-6" type="checkbox" />
  
  
  <label for="accordion-3-6">
    
    
    <a href="/2.1.x/admin-api/#tags">Tags</a>
    
    
    <i class="fa fa-chevron-down"></i>
    
  </label>
  
  <div>
    
<ul class="items">
  
  
  
  
  
  <li>
    <a href="/2.1.x/admin-api/#list-all-tags"  >
      List All Tags
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/admin-api/#list-entity-ids-by-tag"  >
      List Entity Ids by Tag
    </a>
  </li>
  
  
</ul>

  </div>
</li>


  
  
  
  
  





<li class="accordion-item">
  
  <input id="accordion-3-7" type="checkbox" />
  
  
  <label for="accordion-3-7">
    
    
    <a href="/2.1.x/admin-api/#service-object">Service Object</a>
    
    
    <i class="fa fa-chevron-down"></i>
    
  </label>
  
  <div>
    
<ul class="items">
  
  
  
  
  
  <li>
    <a href="/2.1.x/admin-api/#add-service"  >
      Add Service
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/admin-api/#list-services"  >
      List Services
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/admin-api/#retrieve-service"  >
      Retrieve Service
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/admin-api/#update-service"  >
      Update Service
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/admin-api/#update-or-create-service"  >
      Update Or Create Service
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/admin-api/#delete-service"  >
      Delete Service
    </a>
  </li>
  
  
</ul>

  </div>
</li>


  
  
  
  
  





<li class="accordion-item">
  
  <input id="accordion-3-8" type="checkbox" />
  
  
  <label for="accordion-3-8">
    
    
    <a href="/2.1.x/admin-api/#route-object">Route Object</a>
    
    
    <i class="fa fa-chevron-down"></i>
    
  </label>
  
  <div>
    
<ul class="items">
  
  
  
  
  
  <li>
    <a href="/2.1.x/admin-api/#add-route"  >
      Add Route
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/admin-api/#list-routes"  >
      List Routes
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/admin-api/#retrieve-route"  >
      Retrieve Route
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/admin-api/#update-route"  >
      Update Route
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/admin-api/#update-or-create-route"  >
      Update Or Create Route
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/admin-api/#delete-route"  >
      Delete Route
    </a>
  </li>
  
  
</ul>

  </div>
</li>


  
  
  
  
  





<li class="accordion-item">
  
  <input id="accordion-3-9" type="checkbox" />
  
  
  <label for="accordion-3-9">
    
    
    <a href="/2.1.x/admin-api/#consumer-object">Consumer Object</a>
    
    
    <i class="fa fa-chevron-down"></i>
    
  </label>
  
  <div>
    
<ul class="items">
  
  
  
  
  
  <li>
    <a href="/2.1.x/admin-api/#add-consumer"  >
      Add Consumer
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/admin-api/#list-consumers"  >
      List Consumers
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/admin-api/#retrieve-consumer"  >
      Retrieve Consumer
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/admin-api/#update-consumer"  >
      Update Consumer
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/admin-api/#update-or-create-consumer"  >
      Update Or Create Consumer
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/admin-api/#delete-consumer"  >
      Delete Consumer
    </a>
  </li>
  
  
</ul>

  </div>
</li>


  
  
  
  
  





<li class="accordion-item">
  
  <input id="accordion-3-10" type="checkbox" />
  
  
  <label for="accordion-3-10">
    
    
    <a href="/2.1.x/admin-api/#plugin-object">Plugin Object</a>
    
    
    <i class="fa fa-chevron-down"></i>
    
  </label>
  
  <div>
    
<ul class="items">
  
  
  
  
  
  <li>
    <a href="/2.1.x/admin-api/#add-plugin"  >
      Add Plugin
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/admin-api/#list-plugins"  >
      List Plugins
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/admin-api/#retrieve-plugin"  >
      Retrieve Plugin
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/admin-api/#update-plugin"  >
      Update Plugin
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/admin-api/#update-or-create-plugin"  >
      Update Or Create Plugin
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/admin-api/#delete-plugin"  >
      Delete Plugin
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/admin-api/#retrieve-enabled-plugins"  >
      Retrieve Enabled Plugins
    </a>
  </li>
  
  
</ul>

  </div>
</li>


  
  
  
  
  





<li class="accordion-item">
  
  <input id="accordion-3-11" type="checkbox" />
  
  
  <label for="accordion-3-11">
    
    
    <a href="/2.1.x/admin-api/#certificate-object">Certificate Object</a>
    
    
    <i class="fa fa-chevron-down"></i>
    
  </label>
  
  <div>
    
<ul class="items">
  
  
  
  
  
  <li>
    <a href="/2.1.x/admin-api/#add-certificate"  >
      Add Certificate
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/admin-api/#list-certificates"  >
      List Certificates
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/admin-api/#retrieve-certificate"  >
      Retrieve Certificate
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/admin-api/#update-certificate"  >
      Update Certificate
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/admin-api/#update-or-create-certificate"  >
      Update Or Create Certificate
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/admin-api/#delete-certificate"  >
      Delete Certificate
    </a>
  </li>
  
  
</ul>

  </div>
</li>


  
  
  
  
  





<li class="accordion-item">
  
  <input id="accordion-3-12" type="checkbox" />
  
  
  <label for="accordion-3-12">
    
    
    <a href="/2.1.x/admin-api/#ca-certificate-object">CA Certificate Object</a>
    
    
    <i class="fa fa-chevron-down"></i>
    
  </label>
  
  <div>
    
<ul class="items">
  
  
  
  
  
  <li>
    <a href="/2.1.x/admin-api/#add-ca-certificate"  >
      Add CA Certificate
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/admin-api/#list-ca-certificates"  >
      List CA Certificates
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/admin-api/#retrieve-ca-certificate"  >
      Retrieve CA Certificate
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/admin-api/#update-ca-certificate"  >
      Update CA Certificate
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/admin-api/#update-or-create-ca-certificate"  >
      Update Or Create CA Certificate
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/admin-api/#delete-ca-certificate"  >
      Delete CA Certificate
    </a>
  </li>
  
  
</ul>

  </div>
</li>


  
  
  
  
  





<li class="accordion-item">
  
  <input id="accordion-3-13" type="checkbox" />
  
  
  <label for="accordion-3-13">
    
    
    <a href="/2.1.x/admin-api/#sni-object">SNI Object</a>
    
    
    <i class="fa fa-chevron-down"></i>
    
  </label>
  
  <div>
    
<ul class="items">
  
  
  
  
  
  <li>
    <a href="/2.1.x/admin-api/#add-sni"  >
      Add SNI
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/admin-api/#list-snis"  >
      List SNIs
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/admin-api/#retrieve-sni"  >
      Retrieve SNI
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/admin-api/#update-sni"  >
      Update SNI
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/admin-api/#update-or-create-sni"  >
      Update Or Create SNI
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/admin-api/#delete-sni"  >
      Delete SNI
    </a>
  </li>
  
  
</ul>

  </div>
</li>


  
  
  
  
  





<li class="accordion-item">
  
  <input id="accordion-3-14" type="checkbox" />
  
  
  <label for="accordion-3-14">
    
    
    <a href="/2.1.x/admin-api/#upstream-object">Upstream Object</a>
    
    
    <i class="fa fa-chevron-down"></i>
    
  </label>
  
  <div>
    
<ul class="items">
  
  
  
  
  
  <li>
    <a href="/2.1.x/admin-api/#add-upstream"  >
      Add Upstream
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/admin-api/#list-upstreams"  >
      List Upstreams
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/admin-api/#retrieve-upstream"  >
      Retrieve Upstream
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/admin-api/#update-upstream"  >
      Update Upstream
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/admin-api/#update-or-create-upstream"  >
      Update Or Create Upstream
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/admin-api/#delete-upstream"  >
      Delete Upstream
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/admin-api/#show-upstream-health-for-node"  >
      Show Upstream Health for Node
    </a>
  </li>
  
  
</ul>

  </div>
</li>


  
  
  
  
  





<li class="accordion-item">
  
  <input id="accordion-3-15" type="checkbox" />
  
  
  <label for="accordion-3-15">
    
    
    <a href="/2.1.x/admin-api/#target-object">Target Object</a>
    
    
    <i class="fa fa-chevron-down"></i>
    
  </label>
  
  <div>
    
<ul class="items">
  
  
  
  
  
  <li>
    <a href="/2.1.x/admin-api/#add-target"  >
      Add Target
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/admin-api/#list-targets"  >
      List Targets
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/admin-api/#delete-target"  >
      Delete Target
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/admin-api/#set-target-address-as-healthy"  >
      Set Target Address As Healthy
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/admin-api/#set-target-address-as-unhealthy"  >
      Set Target Address As Unhealthy
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/admin-api/#set-target-as-healthy"  >
      Set Target As Healthy
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/admin-api/#set-target-as-unhealthy"  >
      Set Target As Unhealthy
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/admin-api/#list-all-targets"  >
      List All Targets
    </a>
  </li>
  
  
</ul>

  </div>
</li>


  
  
</ul>

  </div>
</li>


    
    





<li class="accordion-item">
  
  <input id="accordion-4" type="checkbox" />
  
  
  <label for="accordion-4">
    
    <img src="/assets/images/icons/documentation/icn-kubernetes-color.svg" alt="icon">
    
    
    <a href="/2.1.x/kong-for-kubernetes/">Kong for Kubernetes</a>
    
    
    <i class="fa fa-chevron-down"></i>
    
  </label>
  
  <div>
    
<ul class="items">
  
  
  
  
  
  <li>
    <a href="/2.1.x/kong-for-kubernetes/install"  >
      Install Kong for Kubernetes
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/kong-for-kubernetes/using-kong-for-kubernetes"  >
      Using Kong for Kubernetes
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/kong-for-kubernetes/changelog"  >
      Changelog
    </a>
  </li>
  
  
</ul>

  </div>
</li>


    
    





<li class="accordion-item">
  
  <input id="accordion-5" type="checkbox" />
  
  
  <label for="accordion-5">
    
    <img src="/assets/images/icons/documentation/icn-dev-portal-color.svg" alt="icon">
    
    
    decK
    
    
    <i class="fa fa-chevron-down"></i>
    
  </label>
  
  <div>
    
<ul class="items">
  
  
  
  





<li class="accordion-item">
  
  <input id="accordion-5-1" type="checkbox" />
  
  
  <label for="accordion-5-1">
    
    
    Introduction
    
    
    <i class="fa fa-chevron-down"></i>
    
  </label>
  
  <div>
    
<ul class="items">
  
  
  
  
  
  <li>
    <a href="/2.1.x/../../deck/overview"  >
      Overview
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/../../deck/terminology"  >
      Terminology
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/../../deck/design-architecture"  >
      Architecture
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/../../deck/compatibility-promise"  >
      Compatibility Promise
    </a>
  </li>
  
  
</ul>

  </div>
</li>


  
  
  
  
  
  
  <li>
    <a href="/2.1.x/../../deck/installation"  >
      Installation
    </a>
  </li>
  
  
  
  
  





<li class="accordion-item">
  
  <input id="accordion-5-3" type="checkbox" />
  
  
  <label for="accordion-5-3">
    
    
    Guides
    
    
    <i class="fa fa-chevron-down"></i>
    
  </label>
  
  <div>
    
<ul class="items">
  
  
  
  
  
  <li>
    <a href="/2.1.x/../../deck/guides/getting-started"  >
      Getting Started with decK
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/../../deck/guides/backup-restore"  >
      Backup and Restore
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/../../deck/guides/ci-driven-configuration"  >
      Configuration as Code and GitOps
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/../../deck/guides/distributed-configuration"  >
      Distributed Configuration
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/../../deck/guides/best-practices"  >
      Best Practices
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/../../deck/guides/kong-enterprise"  >
      Using decK with Kong Enterprise
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/../../deck/guides/multi-file-state"  >
      Using Multiple Files to Store Configuration
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/../../deck/guides/deduplicate-plugin-configuration"  >
      De-duplicate Plugin Configuration
    </a>
  </li>
  
  
</ul>

  </div>
</li>


  
  
  
  
  
  
  <li>
    <a href="/2.1.x/../../deck/commands"  >
      decK CLI Reference
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="/2.1.x/../../deck/faqs"  >
      FAQ
    </a>
  </li>
  
  
  
  
  
  
  <li>
    <a href="https://github.com/kong/deck/blob/main/CHANGELOG.md"  >
      Changelog
    </a>
  </li>
  
  
</ul>

  </div>
</li>


    
  </ul>
</aside>


    
    <aside class="docs-toc">
      <i class="fa fa-times close-sidebar"></i>
      <i class="fa fa-chevron-right collapse-toc"></i>
      <i class="far fa-list-alt expand-toc"></i>
      <div class="docs-toc-title">On this page</div>
      <ul>
  <li><a href="#suggested-upgrade-path" class="active scroll-to">Suggested upgrade path</a></li>
  <li><a href="#upgrade-to-210" class="scroll-to">Upgrade to <code class="language-plaintext highlighter-rouge">2.1.0</code></a></li>
  <li><a href="#upgrade-to-200" class="scroll-to">Upgrade to <code class="language-plaintext highlighter-rouge">2.0.0</code></a></li>
  <li><a href="#upgrade-to-150" class="scroll-to">Upgrade to <code class="language-plaintext highlighter-rouge">1.5.0</code></a></li>
  <li><a href="#upgrade-to-140" class="scroll-to">Upgrade to <code class="language-plaintext highlighter-rouge">1.4.0</code></a></li>
  <li><a href="#upgrade-to-13" class="scroll-to">Upgrade to <code class="language-plaintext highlighter-rouge">1.3</code></a></li>
  <li><a href="#upgrade-to-12" class="scroll-to">Upgrade to <code class="language-plaintext highlighter-rouge">1.2</code></a></li>
  <li><a href="#upgrade-to-11" class="scroll-to">Upgrade to <code class="language-plaintext highlighter-rouge">1.1</code></a></li>
  <li><a href="#upgrading-10x-patch-releases" class="scroll-to">Upgrading <code class="language-plaintext highlighter-rouge">1.0.x</code> patch releases</a></li>
  <li><a href="#upgrade-from-0x-to-10x" class="scroll-to">Upgrade from <code class="language-plaintext highlighter-rouge">0.x</code> to <code class="language-plaintext highlighter-rouge">1.0.x</code></a></li>
  <li><a href="#upgrade-to-015" class="scroll-to">Upgrade to <code class="language-plaintext highlighter-rouge">0.15</code></a></li>
  <li><a href="#upgrade-to-014x" class="scroll-to">Upgrade to <code class="language-plaintext highlighter-rouge">0.14.x</code></a></li>
  <li><a href="#upgrade-to-013x" class="scroll-to">Upgrade to <code class="language-plaintext highlighter-rouge">0.13.x</code></a></li>
  <li><a href="#upgrade-to-012x" class="scroll-to">Upgrade to <code class="language-plaintext highlighter-rouge">0.12.x</code></a></li>
  <li><a href="#upgrade-to-011x" class="scroll-to">Upgrade to <code class="language-plaintext highlighter-rouge">0.11.x</code></a></li>
  <li><a href="#upgrade-to-010x" class="scroll-to">Upgrade to <code class="language-plaintext highlighter-rouge">0.10.x</code></a></li>
  <li><a href="#upgrade-to-09x" class="scroll-to">Upgrade to <code class="language-plaintext highlighter-rouge">0.9.x</code></a></li>
  <li><a href="#upgrade-to-08x" class="scroll-to">Upgrade to <code class="language-plaintext highlighter-rouge">0.8.x</code></a></li>
  <li><a href="#upgrade-to-07x" class="scroll-to">Upgrade to <code class="language-plaintext highlighter-rouge">0.7.x</code></a></li>
  <li><a href="#upgrade-to-06x" class="scroll-to">Upgrade to <code class="language-plaintext highlighter-rouge">0.6.x</code></a></li>
  <li><a href="#upgrade-to-05x" class="scroll-to">Upgrade to <code class="language-plaintext highlighter-rouge">0.5.x</code></a></li>
  <li><a href="#upgrade-to-kong-042" class="scroll-to">Upgrade to Kong <code class="language-plaintext highlighter-rouge">0.4.2</code></a></li>
  <li><a href="#upgrade-to-03x" class="scroll-to">Upgrade to <code class="language-plaintext highlighter-rouge">0.3.x</code></a></li>
</ul>

    </aside>
    

    <div class="page-content-container v2" id="documentation">
      <div class="toggles">
        <i class="fas fa-stream sidebar-toggle"></i>
        
        <i class="far fa-list-alt toc-sidebar-toggle"></i>
        
      </div>

      <div class="page-content">
        <div class="content show-anchor-links">
          
          <div class="alert alert-ee">
            Maybe you were looking for the <a href="/enterprise"><strong>Enterprise Documentation</strong></a>
            instead?
          </div>
          
          

          

          <p>This document guides you through the process of upgrading Kong. First, check if
a section named “Upgrade to <code class="language-plaintext highlighter-rouge">x.x.x</code>” exists, with <code class="language-plaintext highlighter-rouge">x.x.x</code> being the version
you are planning to upgrade to. If such a section does not exist, the upgrade
you want to perform does not have any particular instructions, and you can
simply consult the <a href="#suggested-upgrade-path">Suggested upgrade path</a>.</p>

<h2 id="suggested-upgrade-path">Suggested upgrade path</h2>

<p>Unless indicated otherwise in one of the upgrade paths of this document, it is
possible to upgrade Kong <strong>without downtime</strong>:</p>

<p>Assuming that Kong is already running on your system, acquire the latest
version from any of the available <a href="https://getkong.org/install/">installation
methods</a> and proceed to install it, overriding
your previous installation.</p>

<p>If you are planning to make modifications to your configuration, this is a
good time to do so.</p>

<p>Then, run migration to upgrade your database schema:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kong migrations up <span class="o">[</span><span class="nt">-c</span> configuration_file]
</code></pre></div></div>

<p>If the command is successful, and no migration ran
(no output), then you only have to
<a href="https://docs.konghq.com/1.0.x/cli/#kong-reload">reload</a> Kong:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kong reload <span class="o">[</span><span class="nt">-c</span> configuration_file]
</code></pre></div></div>

<p><strong>Reminder</strong>: <code class="language-plaintext highlighter-rouge">kong reload</code> leverages the Nginx <code class="language-plaintext highlighter-rouge">reload</code> signal that seamlessly
starts new workers, which take over from old workers before those old workers
are terminated. In this way, Kong will serve new requests via the new
configuration, without dropping existing in-flight connections.</p>

<h2 id="upgrade-to-210">Upgrade to <code class="language-plaintext highlighter-rouge">2.1.0</code></h2>

<p>Kong adheres to <a href="https://semver.org/">semantic versioning</a>, which makes a
distinction between “major”, “minor”, and “patch” versions. The upgrade path
will be different depending on which previous version from which you are migrating.</p>

<p>If you are migrating from 2.0.0, upgrading into 2.1.x is a minor upgrade,
but read below for important instructions on database migration, especially
for Cassandra users.</p>

<p>If you are migrating from 1.x, upgrading into 2.1.x is a major upgrade,
so, in addition, be aware of any <a href="#breaking-changes-2.0.0">breaking changes</a>
between the 1.x and 2.x series below, further detailed in the
<a href="https://github.com/Kong/kong/blob/2.0.0/CHANGELOG.md">CHANGELOG.md</a> document.</p>

<h4 id="1-dependencies">1. Dependencies</h4>

<p>If you are using the provided binary packages, all necessary dependencies
for the gateway are bundled and you can skip this section.</p>

<p>If you are building your dependencies by hand, there are changes since the
previous release, so you will need to rebuild them with the latest patches.</p>

<p>In order to use all Kong features, including the new
dynamic upstream keepalive behavior, the required OpenResty version is
<a href="http://openresty.org/en/changelog-1015008.html">1.15.8.3</a> and the
the set of <a href="https://github.com/Kong/kong-build-tools/tree/master/openresty-build-tools/openresty-patches">OpenResty
patches</a>
included has changed, including the latest release of
<a href="https://github.com/Kong/lua-kong-nginx-module">lua-kong-nginx-module</a>.
The <a href="https://github.com/Kong/kong-build-tools">kong-build-tools</a>
repository contains <a href="https://github.com/Kong/kong-build-tools/tree/master/openresty-build-tools">openresty-build-tools</a>,
which allows you to build OpenResty with the necessary patches
and modules easily.</p>

<p>For Go support, you also need to build both your plugins and
the <a href="https://github.com/kong/go-pluginserver">Kong go-pluginserver</a>.
The documentation includes detailed <a href="https://docs.konghq.com/2.1.x/go/">instructions on how to build
the plugin server and your plugins</a>.</p>

<h4 id="2-template-changes">2. Template Changes</h4>

<p>The <strong>Nginx configuration file has changed</strong>, which means that you need to
update it if you are using a custom template.</p>

<p>To view the configuration changes between 2.0.0 and 2.1.0, clone the
<a href="https://github.com/kong/kong">Kong repository</a> and run <code class="language-plaintext highlighter-rouge">git diff</code>
on the configuration templates, using <code class="language-plaintext highlighter-rouge">-w</code> for greater readability:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/kong/kong
cd kong
git diff -w 2.0.0 2.1.0 kong/templates/nginx_kong*.lua
</code></pre></div></div>

<p>To produce a patch file, use the following command:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git diff 2.0.0 2.1.0 kong/templates/nginx_kong*.lua &gt; kong_config_changes.diff
</code></pre></div></div>

<h4 id="3-suggested-upgrade-path">3. Suggested Upgrade Path</h4>

<h5 id="upgrade-from-0x-to-210">Upgrade from <code class="language-plaintext highlighter-rouge">0.x</code> to <code class="language-plaintext highlighter-rouge">2.1.0</code></h5>

<p>The lowest version that Kong 2.1.0 supports migrating from is 1.0.0.
If you are migrating from a version lower than 0.14.1, you need to
migrate to 0.14.1 first. Then, once you are migrating from 0.14.1,
please migrate to 1.5.0 first.</p>

<p>The steps for upgrading from 0.14.1 to 1.5.0 are the same as upgrading
from 0.14.1 to Kong 1.0. Please follow the steps described in the
“Migration Steps from 0.14” in the <a href="#kong-1-0-upgrade-path">Suggested Upgrade Path for Kong
1.0</a>, with the addition of the <code class="language-plaintext highlighter-rouge">kong
migrations migrate-apis</code> command, which you can use to migrate legacy
<code class="language-plaintext highlighter-rouge">apis</code> configurations.</p>

<p>Once you migrated to 1.5.0, you can follow the instructions in the section
below to migrate to 2.1.0.</p>

<h5 id="upgrade-from-100---200-to-210">Upgrade from <code class="language-plaintext highlighter-rouge">1.0.0</code> - <code class="language-plaintext highlighter-rouge">2.0.0</code> to <code class="language-plaintext highlighter-rouge">2.1.0</code></h5>

<p><strong>Postgres</strong></p>

<p>Kong 2.1.0 supports a no-downtime migration model. This means that while the
migration is ongoing, you will have two Kong clusters running, sharing the
same database. (This is sometimes called the Blue/Green migration model.)</p>

<p>The migrations are designed so that the new version of Kong is able to use
the database as it is migrated while the old Kong cluster keeps working until
it is time to decommission it. For this reason, the migration is split into
two steps, performed via commands <code class="language-plaintext highlighter-rouge">kong migrations up</code> (which does
only non-destructive operations) and <code class="language-plaintext highlighter-rouge">kong migrations finish</code> (which puts the
database in the final expected state for Kong 2.1.0).</p>

<ol>
  <li>Download 2.1.0, and configure it to point to the same datastore
as your old (1.0 to 2.0) cluster. Run <code class="language-plaintext highlighter-rouge">kong migrations up</code>.</li>
  <li>Once that finishes running, both the old (pre-2.1) and new (2.1.0)
clusters can now run simultaneously. Start provisioning 2.1.0 nodes,
but do not use their Admin API yet. If you need to perform Admin API
requests, these should be made to the old cluster’s nodes. The reason
is to prevent the new cluster from generating data that is not understood
by the old cluster.</li>
  <li>Gradually divert traffic away from your old nodes, and into
your 2.1.0 cluster. Monitor your traffic to make sure everything
is going smoothly.</li>
  <li>When your traffic is fully migrated to the 2.1.0 cluster,
decommission your old nodes.</li>
  <li>From your 2.1.0 cluster, run: <code class="language-plaintext highlighter-rouge">kong migrations finish</code>.
From this point on, it will not be possible to start
nodes in the old cluster pointing to the same datastore anymore. Only run
this command when you are confident that your migration
was successful. From now on, you can safely make Admin API
requests to your 2.1.0 nodes.</li>
</ol>

<p><strong>Cassandra</strong></p>

<p>Due to internal changes, the table schemas used by Kong 2.1.0 on Cassandra
are incompatible with those used by Kong 2.0.0. Migrating using the usual commands
<code class="language-plaintext highlighter-rouge">kong migrations up</code> and <code class="language-plaintext highlighter-rouge">kong migrations finish</code> will require a small
window of downtime, since the old and new versions cannot use the
database at the same time. Alternatively, to keep your previous version fully
operational while the new one initializes, you will need to transfer the
data to a new keyspace via a database dump, as described below:</p>

<ol>
  <li>Download 2.1.0, and configure it to point to a new keyspace.
Run <code class="language-plaintext highlighter-rouge">kong migrations bootstrap</code>.</li>
  <li>Once that finishes running, both the old (pre-2.1) and new (2.1.0)
clusters can now run simultaneously, but the new cluster does not
have any data yet.</li>
  <li>On the old cluster, run <code class="language-plaintext highlighter-rouge">kong config db_export</code>. This will create
a file <code class="language-plaintext highlighter-rouge">kong.yml</code> with a database dump.</li>
  <li>Transfer the file to the new cluster and run
<code class="language-plaintext highlighter-rouge">kong config db_import kong.yml</code>. This will load the data into the new cluster.</li>
  <li>Gradually divert traffic away from your old nodes, and into
your 2.1.0 cluster. Monitor your traffic to make sure everything
is going smoothly.</li>
  <li>When your traffic is fully migrated to the 2.1.0 cluster,
decommission your old nodes.</li>
</ol>

<h5 id="installing-210-on-a-fresh-datastore">Installing 2.1.0 on a Fresh Datastore</h5>

<p>The following commands should be used to prepare a new 2.1.0 cluster from a
fresh datastore. By default the <code class="language-plaintext highlighter-rouge">kong</code> CLI tool will load the configuration
from <code class="language-plaintext highlighter-rouge">/etc/kong/kong.conf</code>, but you can optionally use the flag <code class="language-plaintext highlighter-rouge">-c</code> to
indicate the path to your configuration file:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ kong migrations bootstrap [-c /path/to/your/kong.conf]
$ kong start [-c /path/to/your/kong.conf]
</code></pre></div></div>

<h2 id="upgrade-to-200">Upgrade to <code class="language-plaintext highlighter-rouge">2.0.0</code></h2>

<p>Kong adheres to <a href="https://semver.org/">semantic versioning</a>, which makes a
distinction between “major”, “minor”, and “patch” versions. The upgrade path
will be different on which previous version from which you are migrating.
Upgrading into 2.0.x is a major version upgrade, so be aware of any
breaking changes listed in the <a href="https://github.com/Kong/kong/blob/2.0.0/CHANGELOG.md">CHANGELOG.md</a> document.</p>

<h4 id="1-dependencies-1">1. Dependencies</h4>

<p>If you are using the provided binary packages, all necessary dependencies
are bundled and you can skip this section.</p>

<p>If you are building your dependencies by hand, there are changes since the
previous release, so you will need to rebuild them with the latest patches.</p>

<p>The required OpenResty version is
<a href="http://openresty.org/en/changelog-1015008.html">1.15.8.2</a>, and the
the set of <a href="https://github.com/Kong/kong-build-tools/tree/master/openresty-build-tools/openresty-patches">OpenResty
patches</a>
included has changed, including the latest release of
<a href="https://github.com/Kong/lua-kong-nginx-module">lua-kong-nginx-module</a>.
Our <a href="https://github.com/Kong/kong-build-tools">kong-build-tools</a>
repository allows you to build OpenResty with the necessary patches
and modules easily.</p>

<p>For Go support, you also need the <a href="https://github.com/kong/go-pluginserver">Kong go-pluginserver</a>.
This is bundled with Kong binary packages and it is automatically started by
Kong if Go plugin support is enabled in Kong’s configuration.
Note that the Go version used to compile any Go plugins needs to match the Go
version of the <code class="language-plaintext highlighter-rouge">go-pluginserver</code>. You can check the Go version used to
build the <code class="language-plaintext highlighter-rouge">go-pluginserver</code> binary running <code class="language-plaintext highlighter-rouge">go-pluginserver -version</code>.</p>

<p><a name="breaking-changes-2.0"></a></p>
<h4 id="2-breaking-changes">2. Breaking Changes</h4>

<p>Kong 2.0.0 does include a few breaking changes over Kong 1.x, all of them
related to the removal of service mesh:</p>

<ul>
  <li><strong>Removed Service Mesh support</strong> - That has been deprecated in Kong 1.4
and made off-by-default already, and the code is now be gone in 2.0.
For Service Mesh, we now have <a href="https://kuma.io">Kuma</a>, which is something
designed for Mesh patterns from day one, so we feel at peace with removing
Kong’s native Service Mesh functionality and focus on its core capabilities
as a gateway.</li>
  <li>As part of service mesh removal, serviceless proxying was removed.
You can still set <code class="language-plaintext highlighter-rouge">service = null</code> when creating a route for use with
serverless plugins such as <code class="language-plaintext highlighter-rouge">aws-lambda</code>, or <code class="language-plaintext highlighter-rouge">request-termination</code>.</li>
  <li>Removed the <code class="language-plaintext highlighter-rouge">origins</code> property.</li>
  <li>Removed the <code class="language-plaintext highlighter-rouge">transparent</code> property.</li>
  <li>Removed the Sidecar Injector plugin which was used for service mesh.</li>
  <li>The <strong>Nginx configuration file has changed</strong>, which means that you need to update
it if you are using a custom template. Changes were made to improve
stream mode support and to make the Nginx injections system more
powerful so that custom templates are less of a necessity. The changes
are detailed in a diff included below.
    <ul>
      <li>:warning: Note that the <code class="language-plaintext highlighter-rouge">kong_cache</code> shm was split into two
shms: <code class="language-plaintext highlighter-rouge">kong_core_cache</code> and <code class="language-plaintext highlighter-rouge">kong_cache</code>. If you are using a
custom Nginx template, make sure core cache shared dictionaries
are defined, including db-less mode shadow definitions.
Both cache values rely on the already existent <code class="language-plaintext highlighter-rouge">mem_cache_size</code>
configuration option to set their size, so when upgrading from
a previous Kong version, the cache memory consumption might
double if this value is not adjusted.</li>
    </ul>
  </li>
</ul>

<details>
<summary><strong>Click here to see the Nginx configuration changes</strong></summary>
<p>

```diff
diff --git a/kong/templates/nginx_kong.lua b/kong/templates/nginx_kong.lua
index 5c6c1db03..6b4b4a818 100644
--- a/kong/templates/nginx_kong.lua
+++ b/kong/templates/nginx_kong.lua
@@ -5,52 +5,46 @@ server_tokens off;
 &gt; if anonymous_reports then
 $
 &gt; end
-
 error_log $ $;

-&gt; if nginx_optimizations then
-&gt;-- send_timeout 60s;          # default value
-&gt;-- keepalive_timeout 75s;     # default value
-&gt;-- client_body_timeout 60s;   # default value
-&gt;-- client_header_timeout 60s; # default value
-&gt;-- tcp_nopush on;             # disabled until benchmarked
-&gt;-- proxy_buffer_size 128k;    # disabled until benchmarked
-&gt;-- proxy_buffers 4 256k;      # disabled until benchmarked
-&gt;-- proxy_busy_buffers_size 256k; # disabled until benchmarked
-&gt;-- reset_timedout_connection on; # disabled until benchmarked
-&gt; end
-
-client_max_body_size $;
-proxy_ssl_server_name on;
-underscores_in_headers on;
-
 lua_package_path       '$;;';
 lua_package_cpath      '$;;';
 lua_socket_pool_size   $;
+lua_socket_log_errors  off;
 lua_max_running_timers 4096;
 lua_max_pending_timers 16384;
+lua_ssl_verify_depth   $;
+&gt; if lua_ssl_trusted_certificate then
+lua_ssl_trusted_certificate '$';
+&gt; end
+
 lua_shared_dict kong                        5m;
+lua_shared_dict kong_locks                  8m;
+lua_shared_dict kong_healthchecks           5m;
+lua_shared_dict kong_process_events         5m;
+lua_shared_dict kong_cluster_events         5m;
+lua_shared_dict kong_rate_limiting_counters 12m;
+lua_shared_dict kong_core_db_cache          $;
+lua_shared_dict kong_core_db_cache_miss     12m;
 lua_shared_dict kong_db_cache               $;
-&gt; if database == "off" then
-lua_shared_dict kong_db_cache_2     $;
-&gt; end
 lua_shared_dict kong_db_cache_miss          12m;
 &gt; if database == "off" then
+lua_shared_dict kong_core_db_cache_2        $;
+lua_shared_dict kong_core_db_cache_miss_2   12m;
+lua_shared_dict kong_db_cache_2             $;
 lua_shared_dict kong_db_cache_miss_2        12m;
 &gt; end
-lua_shared_dict kong_locks          8m;
-lua_shared_dict kong_process_events 5m;
-lua_shared_dict kong_cluster_events 5m;
-lua_shared_dict kong_healthchecks   5m;
-lua_shared_dict kong_rate_limiting_counters 12m;
 &gt; if database == "cassandra" then
 lua_shared_dict kong_cassandra              5m;
 &gt; end
-lua_socket_log_errors off;
-&gt; if lua_ssl_trusted_certificate then
-lua_ssl_trusted_certificate '$';
+&gt; if role == "control_plane" then
+lua_shared_dict kong_clustering             5m;
+&gt; end
+
+underscores_in_headers on;
+&gt; if ssl_ciphers then
+ssl_ciphers $;
 &gt; end
-lua_ssl_verify_depth $;

 # injected nginx_http_* directives
 &gt; for _, el in ipairs(nginx_http_directives) do
@@ -66,61 +60,47 @@ init_worker_by_lua_block {
     Kong.init_worker()
 }

-
-&gt; if #proxy_listeners &gt; 0 then
+&gt; if (role == "traditional" or role == "data_plane") and #proxy_listeners &gt; 0 then
 upstream kong_upstream {
     server 0.0.0.1;
     balancer_by_lua_block {
         Kong.balancer()
     }

-# injected nginx_http_upstream_* directives
-&gt; for _, el in ipairs(nginx_http_upstream_directives) do
+    # injected nginx_upstream_* directives
+&gt; for _, el in ipairs(nginx_upstream_directives) do
     $(el.name) $(el.value);
 &gt; end
 }

 server {
     server_name kong;
-&gt; for i = 1, #proxy_listeners do
-    listen $(proxy_listeners[i].listener);
+&gt; for _, entry in ipairs(proxy_listeners) do
+    listen $(entry.listener);
 &gt; end
+
     error_page 400 404 408 411 412 413 414 417 494 /kong_error_handler;
     error_page 500 502 503 504                     /kong_error_handler;

     access_log $;
     error_log  $ $;

-    client_body_buffer_size $;
-
 &gt; if proxy_ssl_enabled then
     ssl_certificate     $;
     ssl_certificate_key $;
+    ssl_session_cache   shared:SSL:10m;
     ssl_certificate_by_lua_block {
         Kong.ssl_certificate()
     }
-
-    ssl_session_cache shared:SSL:10m;
-    ssl_session_timeout 10m;
-    ssl_prefer_server_ciphers on;
-    ssl_ciphers $;
-&gt; end
-
-&gt; if client_ssl then
-    proxy_ssl_certificate $;
-    proxy_ssl_certificate_key $;
-&gt; end
-
-    real_ip_header     $;
-    real_ip_recursive  $;
-&gt; for i = 1, #trusted_ips do
-    set_real_ip_from   $(trusted_ips[i]);
 &gt; end

     # injected nginx_proxy_* directives
 &gt; for _, el in ipairs(nginx_proxy_directives) do
     $(el.name) $(el.value);
 &gt; end
+&gt; for i = 1, #trusted_ips do
+    set_real_ip_from  $(trusted_ips[i]);
+&gt; end

     rewrite_by_lua_block {
         Kong.rewrite()
@@ -171,43 +151,93 @@ server {
         proxy_pass_header     Server;
         proxy_pass_header     Date;
         proxy_ssl_name        $upstream_host;
+        proxy_ssl_server_name on;
+&gt; if client_ssl then
+        proxy_ssl_certificate $;
+        proxy_ssl_certificate_key $;
+&gt; end
         proxy_pass            $upstream_scheme://kong_upstream$upstream_uri;
     }

     location @grpc {
         internal;
+        default_type         '';
         set $kong_proxy_mode 'grpc';

+        grpc_set_header      TE                $upstream_te;
         grpc_set_header      Host              $upstream_host;
         grpc_set_header      X-Forwarded-For   $upstream_x_forwarded_for;
         grpc_set_header      X-Forwarded-Proto $upstream_x_forwarded_proto;
         grpc_set_header      X-Forwarded-Host  $upstream_x_forwarded_host;
         grpc_set_header      X-Forwarded-Port  $upstream_x_forwarded_port;
         grpc_set_header      X-Real-IP         $remote_addr;
-
+        grpc_pass_header     Server;
+        grpc_pass_header     Date;
         grpc_pass            grpc://kong_upstream;
     }

     location @grpcs {
         internal;
+        default_type         '';
         set $kong_proxy_mode 'grpc';

+        grpc_set_header      TE                $upstream_te;
         grpc_set_header      Host              $upstream_host;
         grpc_set_header      X-Forwarded-For   $upstream_x_forwarded_for;
         grpc_set_header      X-Forwarded-Proto $upstream_x_forwarded_proto;
         grpc_set_header      X-Forwarded-Host  $upstream_x_forwarded_host;
         grpc_set_header      X-Forwarded-Port  $upstream_x_forwarded_port;
         grpc_set_header      X-Real-IP         $remote_addr;
-
+        grpc_pass_header     Server;
+        grpc_pass_header     Date;
+        grpc_ssl_name        $upstream_host;
+        grpc_ssl_server_name on;
+&gt; if client_ssl then
+        grpc_ssl_certificate $;
+        grpc_ssl_certificate_key $;
+&gt; end
         grpc_pass            grpcs://kong_upstream;
     }

+    location = /kong_buffered_http {
+        internal;
+        default_type         '';
+        set $kong_proxy_mode 'http';
+
+        rewrite_by_lua_block       {;}
+        access_by_lua_block        {;}
+        header_filter_by_lua_block {;}
+        body_filter_by_lua_block   {;}
+        log_by_lua_block           {;}
+
+        proxy_http_version 1.1;
+        proxy_set_header      TE                $upstream_te;
+        proxy_set_header      Host              $upstream_host;
+        proxy_set_header      Upgrade           $upstream_upgrade;
+        proxy_set_header      Connection        $upstream_connection;
+        proxy_set_header      X-Forwarded-For   $upstream_x_forwarded_for;
+        proxy_set_header      X-Forwarded-Proto $upstream_x_forwarded_proto;
+        proxy_set_header      X-Forwarded-Host  $upstream_x_forwarded_host;
+        proxy_set_header      X-Forwarded-Port  $upstream_x_forwarded_port;
+        proxy_set_header      X-Real-IP         $remote_addr;
+        proxy_pass_header     Server;
+        proxy_pass_header     Date;
+        proxy_ssl_name        $upstream_host;
+        proxy_ssl_server_name on;
+&gt; if client_ssl then
+        proxy_ssl_certificate $;
+        proxy_ssl_certificate_key $;
+&gt; end
+        proxy_pass            $upstream_scheme://kong_upstream$upstream_uri;
+    }
+
     location = /kong_error_handler {
         internal;
+        default_type                 '';
+
         uninitialized_variable_warn  off;

         rewrite_by_lua_block {;}
-
         access_by_lua_block  {;}

         content_by_lua_block {
@@ -215,13 +245,13 @@ server {
         }
     }
 }
-&gt; end
+&gt; end -- (role == "traditional" or role == "data_plane") and #proxy_listeners &gt; 0

-&gt; if #admin_listeners &gt; 0 then
+&gt; if (role == "control_plane" or role == "traditional") and #admin_listeners &gt; 0 then
 server {
     server_name kong_admin;
-&gt; for i = 1, #admin_listeners do
-    listen $(admin_listeners[i].listener);
+&gt; for _, entry in ipairs(admin_listeners) do
+    listen $(entry.listener);
 &gt; end

     access_log $;
@@ -233,11 +263,7 @@ server {
 &gt; if admin_ssl_enabled then
     ssl_certificate     $;
     ssl_certificate_key $;
-
-    ssl_session_cache shared:SSL:10m;
-    ssl_session_timeout 10m;
-    ssl_prefer_server_ciphers on;
-    ssl_ciphers $;
+    ssl_session_cache   shared:AdminSSL:10m;
 &gt; end

     # injected nginx_admin_* directives
@@ -265,20 +291,20 @@ server {
         return 200 'User-agent: *\nDisallow: /';
     }
 }
-&gt; end
+&gt; end -- (role == "control_plane" or role == "traditional") and #admin_listeners &gt; 0

 &gt; if #status_listeners &gt; 0 then
 server {
     server_name kong_status;
-&gt; for i = 1, #status_listeners do
-    listen $(status_listeners[i].listener);
+&gt; for _, entry in ipairs(status_listeners) do
+    listen $(entry.listener);
 &gt; end

     access_log $;
     error_log  $ $;

-    # injected nginx_http_status_* directives
-&gt; for _, el in ipairs(nginx_http_status_directives) do
+    # injected nginx_status_* directives
+&gt; for _, el in ipairs(nginx_status_directives) do
     $(el.name) $(el.value);
 &gt; end

@@ -303,4 +329,26 @@ server {
     }
 }
 &gt; end
+
+&gt; if role == "control_plane" then
+server {
+    server_name kong_cluster_listener;
+&gt; for _, entry in ipairs(cluster_listeners) do
+    listen $(entry.listener) ssl;
+&gt; end
+
+    access_log off;
+
+    ssl_verify_client   optional_no_ca;
+    ssl_certificate     $;
+    ssl_certificate_key $;
+    ssl_session_cache   shared:ClusterSSL:10m;
+
+    location = /v1/outlet {
+        content_by_lua_block {
+            Kong.serve_cluster_listener()
+        }
+    }
+}
+&gt; end -- role == "control_plane"
 ]]
```

</p>
</details>

<h4 id="3-suggested-upgrade-path-1">3. Suggested Upgrade Path</h4>

<h5 id="upgrade-from-0x-to-200">Upgrade from <code class="language-plaintext highlighter-rouge">0.x</code> to <code class="language-plaintext highlighter-rouge">2.0.0</code></h5>

<p>The lowest version that Kong 2.0.0 supports migrating from is 1.0.0.
If you are migrating from a version lower than 0.14.1, you need to
migrate to 0.14.1 first. Then, once you are migrating from 0.14.1,
please migrate to 1.5.0 first.</p>

<p>The steps for upgrading from 0.14.1 to 1.5.0 are the same as upgrading
from 0.14.1 to Kong 1.0. Please follow the steps described in the
“Migration Steps from 0.14” in the <a href="#kong-1-0-upgrade-path">Suggested Upgrade Path for Kong
1.0</a>, with the addition of the <code class="language-plaintext highlighter-rouge">kong
migrations migrate-apis</code> command, which you can use to migrate legacy
<code class="language-plaintext highlighter-rouge">apis</code> configurations.</p>

<p>Once you migrated to 1.5.0, you can follow the instructions in the section
below to migrate to 2.0.0.</p>

<h5 id="upgrade-from-100---150-to-200">Upgrade from <code class="language-plaintext highlighter-rouge">1.0.0</code> - <code class="language-plaintext highlighter-rouge">1.5.0</code> to <code class="language-plaintext highlighter-rouge">2.0.0</code></h5>

<p>Kong 2.0.0 supports a no-downtime migration model. This means that while the
migration is ongoing, you will have two Kong clusters running, sharing the
same database. (This is sometimes called the Blue/Green migration model.)</p>

<p>The migrations are designed so that there is no need to fully copy
the data, but this also means that they are designed in such a way so that
the new version of Kong is able to use the data as it is migrated, and to do
it in a way so that the old Kong cluster keeps working until it is finally
time to decommission it. For this reason, the full migration is now split into
two steps, which are performed via commands <code class="language-plaintext highlighter-rouge">kong migrations up</code> (which does
only non-destructive operations) and <code class="language-plaintext highlighter-rouge">kong migrations finish</code> (which puts the
database in the final expected state for Kong 2.0.0).</p>

<ol>
  <li>Download 2.0.0, and configure it to point to the same datastore
as your old (1.0 to 1.5) cluster. Run <code class="language-plaintext highlighter-rouge">kong migrations up</code>.</li>
  <li>Once that finishes running, both the old and new (2.0.0) clusters can now
run simultaneously on the same datastore. Start provisioning
2.0.0 nodes, but do not use their Admin API yet. If you need to
perform Admin API requests, these should be made to the old cluster’s nodes.
The reason is to prevent the new cluster from generating data
that is not understood by the old cluster.</li>
  <li>Gradually divert traffic away from your old nodes, and into
your 2.0.0 cluster. Monitor your traffic to make sure everything
is going smoothly.</li>
  <li>When your traffic is fully migrated to the 2.0.0 cluster,
decommission your old nodes.</li>
  <li>From your 2.0.0 cluster, run: <code class="language-plaintext highlighter-rouge">kong migrations finish</code>.
From this point on, it will not be possible to start
nodes in the old cluster pointing to the same datastore anymore. Only run
this command when you are confident that your migration
was successful. From now on, you can safely make Admin API
requests to your 2.0.0 nodes.</li>
</ol>

<h5 id="installing-200-on-a-fresh-datastore">Installing 2.0.0 on a Fresh Datastore</h5>

<p>The following commands should be used to prepare a new 2.0.0 cluster from a
fresh datastore:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ kong migrations bootstrap [-c config]
$ kong start [-c config]
</code></pre></div></div>

<h2 id="upgrade-to-150">Upgrade to <code class="language-plaintext highlighter-rouge">1.5.0</code></h2>

<p>Kong adheres to <a href="https://semver.org/">semantic versioning</a>, which makes a
distinction between “major”, “minor”, and “patch” versions. The upgrade path
will be different on which previous version from which you are migrating.
If you are upgrading from 0.x, this is a major upgrade. If you are
upgrading from 1.0.x or 1.4.x, this is a minor upgrade. Both scenarios are
explained below.</p>

<h4 id="1-dependencies-2">1. Dependencies</h4>

<p>If you are using the provided binary packages, all necessary dependencies
are bundled. If you are building your dependencies by hand, since Kong 1.4.0 the
only dependency upgraded is
<a href="https://github.com/Kong/lua-resty-healthcheck">lua-resty-healthcheck</a> that must
be at least the 1.1.2 version from now on. For any lower version you should
check the upgrade path for the correct dependencies.</p>

<h4 id="2-breaking-changes-1">2. Breaking Changes</h4>

<p>Kong 1.5.0 does not include any breaking changes over Kong 1.4, but Kong 1.3
included breaking changes in configuration and for routing in some edge-cases
over Kong 1.2, and Kong 1.0 included a number of breaking changes over Kong 0.x.
If you are upgrading from 1.2, please read the section on
<a href="#kong-1-3-breaking-changes">Kong 1.3 Breaking Changes</a> carefully before
proceeding. If you are upgrading from 0.14,x, please read the section on
<a href="#kong-1-0-breaking-changes">Kong 1.0 Breaking Changes</a> carefully before
proceeding.</p>

<h4 id="3-suggested-upgrade-path-2">3. Suggested Upgrade Path</h4>

<h5 id="upgrade-from-0x-to-150">Upgrade from <code class="language-plaintext highlighter-rouge">0.x</code> to <code class="language-plaintext highlighter-rouge">1.5.0</code></h5>

<p>The lowest version that Kong 1.5.0 supports migrating from is 0.14.1. if you
are migrating from a previous 0.x release, please migrate to 0.14.1 first.</p>

<p>For upgrading from 0.14.1 to Kong 1.5.0, the steps for upgrading are the same
as upgrading from 0.14.1 to Kong 1.0. Please follow the steps described in the
“Migration Steps from 0.14” in the <a href="#kong-1-0-upgrade-path">Suggested Upgrade Path for Kong
1.0</a>.</p>

<h5 id="upgrade-from-10x---14x-to-150">Upgrade from <code class="language-plaintext highlighter-rouge">1.0.x</code> - <code class="language-plaintext highlighter-rouge">1.4.x</code> to <code class="language-plaintext highlighter-rouge">1.5.0</code></h5>

<p>Kong 1.5.0 supports a no-downtime migration model. This means that while the
migration is ongoing, you will have two Kong clusters running, sharing the
same database. (This is sometimes called the Blue/Green migration model.)</p>

<p>The migrations are designed so that there is no need to fully copy
the data, but this also means that they are designed in such a way so that
the new version of Kong is able to use the data as it is migrated, and to do
it in a way so that the old Kong cluster keeps working until it is finally
time to decommission it. For this reason, the full migration is now split into
two steps, which are performed via commands <code class="language-plaintext highlighter-rouge">kong migrations up</code> (which does
only non-destructive operations) and <code class="language-plaintext highlighter-rouge">kong migrations finish</code> (which puts the
database in the final expected state for Kong 1.5.0).</p>

<ol>
  <li>Download 1.5.0, and configure it to point to the same datastore
as your old (1.0 to 1.4) cluster. Run <code class="language-plaintext highlighter-rouge">kong migrations up</code>.</li>
  <li>Once that finishes running, both the old and new (1.5.0) clusters can now
run simultaneously on the same datastore. Start provisioning
1.5.0 nodes, but do not use their Admin API yet. If you need to
perform Admin API requests, these should be made to the old cluster’s nodes.
The reason is to prevent the new cluster from generating data
that is not understood by the old cluster.</li>
  <li>Gradually divert traffic away from your old nodes, and into
your 1.5.0 cluster. Monitor your traffic to make sure everything
is going smoothly.</li>
  <li>When your traffic is fully migrated to the 1.5.0 cluster,
decommission your old nodes.</li>
  <li>From your 1.5.0 cluster, run: <code class="language-plaintext highlighter-rouge">kong migrations finish</code>.
From this point on, it will not be possible to start
nodes in the old cluster pointing to the same datastore anymore. Only run
this command when you are confident that your migration
was successful. From now on, you can safely make Admin API
requests to your 1.5.0 nodes.</li>
</ol>

<h5 id="installing-150-on-a-fresh-datastore">Installing 1.5.0 on a Fresh Datastore</h5>

<p>The following commands should be used to prepare a new 1.5.0 cluster from a
fresh datastore:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ kong migrations bootstrap [-c config]
$ kong start [-c config]
</code></pre></div></div>

<h2 id="upgrade-to-140">Upgrade to <code class="language-plaintext highlighter-rouge">1.4.0</code></h2>

<p>Kong adheres to <a href="https://semver.org/">semantic versioning</a>, which makes a
distinction between “major”, “minor”, and “patch” versions. The upgrade path
will be different on which previous version from which you are migrating.
If you are upgrading from 0.x, this is a major upgrade. If you are
upgrading from 1.0.x or 1.3.x, this is a minor upgrade. Both scenarios are
explained below.</p>

<h4 id="1-dependencies-3">1. Dependencies</h4>

<p>If you are using the provided binary packages, all necessary dependencies
are bundled. If you are building your dependencies by hand, there are no changes
in dependencies from 1.3.0, for any lower version you should check the upgrade
path for the correct dependencies.</p>

<h4 id="2-breaking-changes-2">2. Breaking Changes</h4>

<p>Kong 1.4.0 does not include any breaking changes over Kong 1.3, but Kong 1.3
included breaking changes in configuration and for routing in some edge-cases
over Kong 1.2, and Kong 1.0 included a number of breaking changes over Kong 0.x.
If you are upgrading from 1.2, please read the section on
<a href="#kong-1-3-breaking-changes">Kong 1.3 Breaking Changes</a> carefully before
proceeding. If you are upgrading from 0.14,x, please read the section on
<a href="#kong-1-0-breaking-changes">Kong 1.0 Breaking Changes</a> carefully before
proceeding.</p>

<h4 id="3-suggested-upgrade-path-3">3. Suggested Upgrade Path</h4>

<h5 id="upgrade-from-0x-to-140">Upgrade from <code class="language-plaintext highlighter-rouge">0.x</code> to <code class="language-plaintext highlighter-rouge">1.4.0</code></h5>

<p>The lowest version that Kong 1.4.0 supports migrating from is 0.14.1. if you
are migrating from a previous 0.x release, please migrate to 0.14.1 first.</p>

<p>For upgrading from 0.14.1 to Kong 1.4.0, the steps for upgrading are the same
as upgrading from 0.14.1 to Kong 1.0. Please follow the steps described in the
“Migration Steps from 0.14” in the <a href="#kong-1-0-upgrade-path">Suggested Upgrade Path for Kong
1.0</a>.</p>

<h5 id="upgrade-from-10x---13x-to-140">Upgrade from <code class="language-plaintext highlighter-rouge">1.0.x</code> - <code class="language-plaintext highlighter-rouge">1.3.x</code> to <code class="language-plaintext highlighter-rouge">1.4.0</code></h5>

<p>Kong 1.4.0 supports a no-downtime migration model. This means that while the
migration is ongoing, you will have two Kong clusters running, sharing the
same database. (This is sometimes called the Blue/Green migration model.)</p>

<p>The migrations are designed so that there is no need to fully copy
the data, but this also means that they are designed in such a way so that
the new version of Kong is able to use the data as it is migrated, and to do
it in a way so that the old Kong cluster keeps working until it is finally
time to decommission it. For this reason, the full migration is now split into
two steps, which are performed via commands <code class="language-plaintext highlighter-rouge">kong migrations up</code> (which does
only non-destructive operations) and <code class="language-plaintext highlighter-rouge">kong migrations finish</code> (which puts the
database in the final expected state for Kong 1.4.0).</p>

<ol>
  <li>Download 1.4.0, and configure it to point to the same datastore
as your old (1.0 to 1.3) cluster. Run <code class="language-plaintext highlighter-rouge">kong migrations up</code>.</li>
  <li>Once that finishes running, both the old and new (1.4.0) clusters can now
run simultaneously on the same datastore. Start provisioning
1.4.0 nodes, but do not use their Admin API yet. If you need to
perform Admin API requests, these should be made to the old cluster’s nodes.
The reason is to prevent the new cluster from generating data
that is not understood by the old cluster.</li>
  <li>Gradually divert traffic away from your old nodes, and into
your 1.4.0 cluster. Monitor your traffic to make sure everything
is going smoothly.</li>
  <li>When your traffic is fully migrated to the 1.4.0 cluster,
decommission your old nodes.</li>
  <li>From your 1.4.0 cluster, run: <code class="language-plaintext highlighter-rouge">kong migrations finish</code>.
From this point on, it will not be possible to start
nodes in the old cluster pointing to the same datastore anymore. Only run
this command when you are confident that your migration
was successful. From now on, you can safely make Admin API
requests to your 1.4.0 nodes.</li>
</ol>

<h5 id="installing-140-on-a-fresh-datastore">Installing 1.4.0 on a Fresh Datastore</h5>

<p>The following commands should be used to prepare a new 1.4.0 cluster from a
fresh datastore:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ kong migrations bootstrap [-c config]
$ kong start [-c config]
</code></pre></div></div>

<h2 id="upgrade-to-13">Upgrade to <code class="language-plaintext highlighter-rouge">1.3</code></h2>

<h4 id="1-breaking-changes">1. Breaking Changes</h4>

<h5 id="dependencies">Dependencies</h5>

<p>If you are using the provided binary packages, all necessary dependencies
are bundled. If you are building your dependencies by hand, you should
be aware of the following changes:</p>

<ul>
  <li>The required OpenResty version has been bumped to
<a href="http://openresty.org/en/changelog-1015008.html">1.15.8.1</a>. If you are
installing Kong from one of our distribution packages, you are not affected
by this change.</li>
  <li>From this version on, the new
<a href="https://github.com/Kong/lua-kong-nginx-module">lua-kong-nginx-module</a> Nginx
module is <strong>required</strong> to be built into OpenResty for Kong to function
properly. If you are installing Kong from one of our distribution packages,
you are not affected by this change.
<a href="https://github.com/Kong/openresty-build-tools/pull/26">openresty-build-tools#26</a></li>
</ul>

<p><strong>Note:</strong> if you are not using one of our distribution packages and compiling
OpenResty from source, you must still apply Kong’s <a href="https://github.com/kong/openresty-patches">OpenResty
patches</a> (and, as highlighted above,
compile OpenResty with the new lua-kong-nginx-module). Our new
<a href="https://github.com/Kong/openresty-build-tools">openresty-build-tools</a>
repository will allow you to do both easily.</p>

<h5 id="core">Core</h5>

<ul>
  <li>Bugfixes in the router <em>may, in some edge-cases</em>, result in different Routes
being matched. It was reported to us that the router behaved incorrectly in
some cases when configuring wildcard Hosts and regex paths (e.g.
<a href="https://github.com/Kong/kong/issues/3094">#3094</a>). It may be so that you are
subject to these bugs without realizing it. Please ensure that wildcard Hosts
and regex paths Routes you have configured are matching as expected before
upgrading.
<a href="https://github.com/Kong/kong/commit/9ca4dc09fdb12b340531be8e0f9d1560c48664d5">9ca4dc0</a>
<a href="https://github.com/Kong/kong/commit/2683b86c2f7680238e3fe85da224d6f077e3425d">2683b86</a>
<a href="https://github.com/Kong/kong/commit/6a03e1bd95594716167ccac840ff3e892ed66215">6a03e1b</a></li>
  <li>Upstream connections are now only kept-alive for 100 requests or 60 seconds
(idle) by default. Previously, upstream connections were not actively closed
by Kong. This is a (non-breaking) change in behavior inherited from Nginx
1.15, and configurable via new configuration properties.</li>
</ul>

<h5 id="configuration">Configuration</h5>

<ul>
  <li>The <code class="language-plaintext highlighter-rouge">upstream_keepalive</code> configuration property is deprecated, and replaced
by the new <code class="language-plaintext highlighter-rouge">nginx_http_upstream_keepalive</code> property. Its behavior is almost
identical, but the notable difference is that the latter leverages the
<a href="https://konghq.com/blog/kong-ce-nginx-injected-directives/">injected Nginx
directives</a>
feature added in Kong 0.14.0.</li>
  <li>The Nginx configuration file has changed, which means that you need to update
it if you are using a custom template. Changes were made to address the
<code class="language-plaintext highlighter-rouge">upstream_keepalive</code> change, the new gRPC support, and to make <code class="language-plaintext highlighter-rouge">ssl_protocols</code>
load via injected directives. The changes are detailed in a diff
included below.</li>
</ul>

<details>
<summary><strong>Click here to see the Nginx configuration changes</strong></summary>
<p>

```diff
diff --git a/kong/templates/nginx_kong.lua b/kong/templates/nginx_kong.lua
index 761376a07..5a957a1b7 100644
--- a/kong/templates/nginx_kong.lua
+++ b/kong/templates/nginx_kong.lua
@@ -72,8 +72,10 @@ upstream kong_upstream {
     balancer_by_lua_block {
         Kong.balancer()
     }
-&gt; if upstream_keepalive &gt; 0 then
-    keepalive $;
+
+# injected nginx_http_upstream_* directives
+&gt; for _, el in ipairs(nginx_http_upstream_directives) do
+    $(el.name) $(el.value);
 &gt; end
 }

@@ -93,7 +95,6 @@ server {
 &gt; if proxy_ssl_enabled then
     ssl_certificate $;
     ssl_certificate_key $;
-    ssl_protocols TLSv1.1 TLSv1.2 TLSv1.3;
     ssl_certificate_by_lua_block {
         Kong.ssl_certificate()
     }
@@ -120,6 +121,26 @@ server {
     $(el.name) $(el.value);
 &gt; end

+    rewrite_by_lua_block {
+        Kong.rewrite()
+    }
+
+    access_by_lua_block {
+        Kong.access()
+    }
+
+    header_filter_by_lua_block {
+        Kong.header_filter()
+    }
+
+    body_filter_by_lua_block {
+        Kong.body_filter()
+    }
+
+    log_by_lua_block {
+        Kong.log()
+    }
+
     location / {
         default_type                     '';

@@ -134,14 +155,7 @@ server {
         set $upstream_x_forwarded_proto  '';
         set $upstream_x_forwarded_host   '';
         set $upstream_x_forwarded_port   '';
-
-        rewrite_by_lua_block {
-            Kong.rewrite()
-        }
-
-        access_by_lua_block {
-            Kong.access()
-        }
+        set $kong_proxy_mode             'http';

         proxy_http_version 1.1;
         proxy_set_header   TE                $upstream_te;
@@ -157,38 +171,32 @@ server {
         proxy_pass_header  Date;
         proxy_ssl_name     $upstream_host;
         proxy_pass         $upstream_scheme://kong_upstream$upstream_uri;
+    }

-        header_filter_by_lua_block {
-            Kong.header_filter()
-        }
+    location @grpc {
+        internal;

-        body_filter_by_lua_block {
-            Kong.body_filter()
-        }
+        set $kong_proxy_mode       'grpc';
+        grpc_pass grpc://kong_upstream;
+    }

-        log_by_lua_block {
-            Kong.log()
-        }
+    location @grpcs {
+        internal;
+
+        set $kong_proxy_mode       'grpcs';
+        grpc_pass grpcs://kong_upstream;
     }

     location = /kong_error_handler {
         internal;
         uninitialized_variable_warn off;

-        content_by_lua_block {
-            Kong.handle_error()
-        }
-
-        header_filter_by_lua_block {
-            Kong.header_filter()
-        }
+        rewrite_by_lua_block {;}

-        body_filter_by_lua_block {
-            Kong.body_filter()
-        }
+        access_by_lua_block {;}

-        log_by_lua_block {
-            Kong.log()
+        content_by_lua_block {
+            Kong.handle_error()
         }
     }
 }
@@ -210,7 +218,6 @@ server {
 &gt; if admin_ssl_enabled then
     ssl_certificate $;
     ssl_certificate_key $;
-    ssl_protocols TLSv1.1 TLSv1.2 TLSv1.3;

     ssl_session_cache shared:SSL:10m;
     ssl_session_timeout 10m;
```

</p>
</details>

<h4 id="2-suggested-upgrade-path">2. Suggested Upgrade Path</h4>

<h5 id="upgrade-from-0x-to-13">Upgrade from <code class="language-plaintext highlighter-rouge">0.x</code> to <code class="language-plaintext highlighter-rouge">1.3</code></h5>

<p>The lowest version that Kong 1.3 supports migrating from is 0.14.1. if you
are migrating from a previous 0.x release, please migrate to 0.14.1 first.</p>

<p>For upgrading from 0.14.1 to Kong 1.3, the steps for upgrading are the same as
upgrading from 0.14.1 to Kong 1.0. Please follow the steps described in the
“Migration Steps from 0.14” in the <a href="#kong-1-0-upgrade-path">Suggested Upgrade Path for Kong
1.0</a>.</p>

<h5 id="upgrade-from-10x---12x-to-13">Upgrade from <code class="language-plaintext highlighter-rouge">1.0.x</code> - <code class="language-plaintext highlighter-rouge">1.2.x</code> to <code class="language-plaintext highlighter-rouge">1.3</code></h5>

<p>Kong 1.3 supports the no-downtime migration model. This means that while the
migration is ongoing, you will have two Kong clusters running, sharing the
same database. (This is sometimes called the Blue/Green migration model.)</p>

<p>The migrations are designed so that there is no need to fully copy
the data, but this also means that they are designed in such a way so that
the new version of Kong is able to use the data as it is migrated, and to do
it in a way so that the old Kong cluster keeps working until it is finally
time to decommission it. For this reason, the full migration is now split into
two steps, which are performed via commands <code class="language-plaintext highlighter-rouge">kong migrations up</code> (which does
only non-destructive operations) and <code class="language-plaintext highlighter-rouge">kong migrations finish</code> (which puts the
database in the final expected state for Kong 1.2).</p>

<ol>
  <li>Download 1.3, and configure it to point to the same datastore as your old
(1.0 - 1.2) cluster. Run <code class="language-plaintext highlighter-rouge">kong migrations up</code>.</li>
  <li>Once that finishes running, both the old and new (1.3) clusters can now run
simultaneously on the same datastore. Start provisioning 1.3 nodes, but do
not use their Admin API yet. If you need to perform Admin API requests,
these should be made to the old cluster’s nodes.  The reason is to prevent
the new cluster from generating data that is not understood by the old
cluster.</li>
  <li>Gradually divert traffic away from your old nodes, and into
your 1.3 cluster. Monitor your traffic to make sure everything
is going smoothly.</li>
  <li>When your traffic is fully migrated to the 1.3 cluster, decommission your
old nodes.</li>
  <li>From your 1.3 cluster, run: <code class="language-plaintext highlighter-rouge">kong migrations finish</code>.  From this point on,
it will not be possible to start nodes in the old cluster pointing to the
same datastore anymore. Only run this command when you are confident that
your migration was successful. From now on, you can safely make Admin API
requests to your 1.3 nodes.</li>
</ol>

<h5 id="installing-13-on-a-fresh-datastore">Installing 1.3 on a Fresh Datastore</h5>

<p>The following commands should be used to prepare a new 1.3 cluster from a fresh
datastore:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ kong migrations bootstrap [-c config]
$ kong start [-c config]
</code></pre></div></div>

<h2 id="upgrade-to-12">Upgrade to <code class="language-plaintext highlighter-rouge">1.2</code></h2>

<p>Kong adheres to <a href="https://semver.org/">semantic versioning</a>, which makes a
distinction between “major”, “minor”, and “patch” versions. The upgrade path
will be different on which previous version from which you are migrating.
If you are upgrading from 0.x, this is a major upgrade. If you are
upgrading from 1.0.x or 1.1.x, this is a minor upgrade. Both scenarios are
explained below.</p>

<h4 id="1-dependencies-4">1. Dependencies</h4>

<p>If you are using the provided binary packages, all necessary dependencies
are bundled. If you are building your dependencies by hand, you should
be aware of the following changes:</p>

<ul>
  <li>The required OpenResty version is 1.13.6.2, but for a full feature set,
including stream routing and service mesh abilities with mutual TLS, you need
Kong’s <a href="https://github.com/kong/openresty-patches">openresty-patches</a>.
Note that the set of patches was updated from 1.0 to 1.2.</li>
  <li>The minimum required OpenSSL version is 1.1.1. If you are building by hand,
make sure all dependencies, including LuaRocks modules, are compiled using
the same OpenSSL version. If you are installing Kong from one of our
distribution packages, you are not affected by this change.</li>
</ul>

<h4 id="2-breaking-changes-3">2. Breaking Changes</h4>

<p>Kong 1.2 does not include any breaking changes over Kong 1.0 or 1.1, but Kong 1.0
included a number of breaking changes over Kong 0.x. If you are upgrading
from 0.14,x, please read the section on
<a href="#kong-1-0-breaking-changes">Kong 1.0 Breaking Changes</a> carefully before
proceeding.</p>

<h4 id="3-suggested-upgrade-path-4">3. Suggested Upgrade Path</h4>

<h5 id="upgrade-from-0x-to-12">Upgrade from <code class="language-plaintext highlighter-rouge">0.x</code> to <code class="language-plaintext highlighter-rouge">1.2</code></h5>

<p>The lowest version that Kong 1.2 supports migrating from is 0.14.1. if you
are migrating from a previous 0.x release, please migrate to 0.14.1 first.</p>

<p>For upgrading from 0.14.1 to Kong 1.2, the steps for upgrading are the same as
upgrading from 0.14.1 to Kong 1.0. Please follow the steps described in the
“Migration Steps from 0.14” in the <a href="#kong-1-0-upgrade-path">Suggested Upgrade Path for Kong
1.0</a>.</p>

<h5 id="upgrade-from-10x-or-11x-to-12">Upgrade from <code class="language-plaintext highlighter-rouge">1.0.x</code> or <code class="language-plaintext highlighter-rouge">1.1.x</code> to <code class="language-plaintext highlighter-rouge">1.2</code></h5>

<p>Kong 1.2 supports a no-downtime migration model. This means that while the
migration is ongoing, you will have two Kong clusters running, sharing the
same database. (This is sometimes called the Blue/Green migration model.)</p>

<p>The migrations are designed so that there is no need to fully copy
the data, but this also means that they are designed in such a way so that
the new version of Kong is able to use the data as it is migrated, and to do
it in a way so that the old Kong cluster keeps working until it is finally
time to decommission it. For this reason, the full migration is now split into
two steps, which are performed via commands <code class="language-plaintext highlighter-rouge">kong migrations up</code> (which does
only non-destructive operations) and <code class="language-plaintext highlighter-rouge">kong migrations finish</code> (which puts the
database in the final expected state for Kong 1.2).</p>

<ol>
  <li>Download 1.2, and configure it to point to the same datastore
as your old (1.0 or 1.1) cluster. Run <code class="language-plaintext highlighter-rouge">kong migrations up</code>.</li>
  <li>Once that finishes running, both the old and new (1.2) clusters can now
run simultaneously on the same datastore. Start provisioning
1.2 nodes, but do not use their Admin API yet. If you need to
perform Admin API requests, these should be made to the old cluster’s nodes.
The reason is to prevent the new cluster from generating data
that is not understood by the old cluster.</li>
  <li>Gradually divert traffic away from your old nodes, and into
your 1.2 cluster. Monitor your traffic to make sure everything
is going smoothly.</li>
  <li>When your traffic is fully migrated to the 1.2 cluster,
decommission your old nodes.</li>
  <li>From your 1.2 cluster, run: <code class="language-plaintext highlighter-rouge">kong migrations finish</code>.
From this point on, it will not be possible to start
nodes in the old cluster pointing to the same datastore anymore. Only run
this command when you are confident that your migration
was successful. From now on, you can safely make Admin API
requests to your 1.2 nodes.</li>
</ol>

<h5 id="upgrade-path-from-12-release-candidates">Upgrade Path from 1.2 Release Candidates</h5>

<p>The process is the same as for upgrading from 1.0 listed above, but on step 1
you should run <code class="language-plaintext highlighter-rouge">kong migrations up --force</code> instead.</p>

<h5 id="installing-12-on-a-fresh-datastore">Installing 1.2 on a Fresh Datastore</h5>

<p>The following commands should be used to prepare a new 1.2 cluster from a fresh datastore:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ kong migrations bootstrap [-c config]
$ kong start [-c config]
</code></pre></div></div>

<h2 id="upgrade-to-11">Upgrade to <code class="language-plaintext highlighter-rouge">1.1</code></h2>

<p>Kong adheres to <a href="https://semver.org/">semantic versioning</a>, which makes a
distinction between “major”, “minor”, and “patch” versions. The upgrade path
will be different on which previous version from which you are migrating.
If you are upgrading from 0.x, this is a major upgrade. If you are
upgrading from 1.0.x, this is a minor upgrade. Both scenarios are
explained below.</p>

<h4 id="1-dependencies-5">1. Dependencies</h4>

<p>If you are using the provided binary packages, all necessary dependencies
are bundled. If you are building your dependencies by hand, you should
be aware of the following changes:</p>

<ul>
  <li>The required OpenResty version is 1.13.6.2, but for a full feature set,
including stream routing and service mesh abilities with mutual TLS, you need
Kong’s <a href="https://github.com/kong/openresty-patches">openresty-patches</a>.
Note that the set of patches was updated from 1.0 to 1.1.</li>
  <li>The minimum required OpenSSL version is 1.1.1. If you are building by hand,
make sure all dependencies, including LuaRocks modules, are compiled using
the same OpenSSL version. If you are installing Kong from one of our
distribution packages, you are not affected by this change.</li>
</ul>

<h4 id="2-breaking-changes-4">2. Breaking Changes</h4>

<p>Kong 1.1 does not include any breaking changes over Kong 1.0, but Kong 1.0
included a number of breaking changes over Kong 0.x. If you are upgrading
from 0.14,x, please read the section on
<a href="#kong-1-0-breaking-changes">Kong 1.0 Breaking Changes</a> carefully before
proceeding.</p>

<h4 id="3-suggested-upgrade-path-5">3. Suggested Upgrade Path</h4>

<h5 id="upgrade-from-0x-to-11">Upgrade from <code class="language-plaintext highlighter-rouge">0.x</code> to <code class="language-plaintext highlighter-rouge">1.1</code></h5>

<p>The lowest version that Kong 1.1 supports migrating from is 0.14.1. if you
are migrating from a previous 0.x release, please migrate to 0.14.1 first.</p>

<p>For upgrading from 0.14.1 to Kong 1.1, the steps for upgrading are the same as
upgrading from 0.14.1 to Kong 1.0. Please follow the steps described in the
“Migration Steps from 0.14” in the <a href="#kong-1-0-upgrade-path">Suggested Upgrade Path for Kong
1.0</a>.</p>

<h5 id="upgrade-from-10x-to-11">Upgrade from <code class="language-plaintext highlighter-rouge">1.0.x</code> to <code class="language-plaintext highlighter-rouge">1.1</code></h5>

<p>Kong 1.1 supports a no-downtime migration model. This means that while the
migration is ongoing, you will have two Kong clusters running, sharing the
same database. (This is sometimes called the Blue/Green migration model.)</p>

<p>The migrations are designed so that there is no need to fully copy
the data, but this also means that they are designed in such a way so that
the new version of Kong is able to use the data as it is migrated, and to do
it in a way so that the old Kong cluster keeps working until it is finally
time to decommission it. For this reason, the full migration is now split into
two steps, which are performed via commands <code class="language-plaintext highlighter-rouge">kong migrations up</code> (which does
only non-destructive operations) and <code class="language-plaintext highlighter-rouge">kong migrations finish</code> (which puts the
database in the final expected state for Kong 1.1).</p>

<ol>
  <li>Download 1.1, and configure it to point to the same datastore
as your 1.0 cluster. Run <code class="language-plaintext highlighter-rouge">kong migrations up</code>.</li>
  <li>Once that finishes running, both 1.0 and 1.1 clusters can now
run simultaneously on the same datastore. Start provisioning
1.1 nodes, but do not use their Admin API yet. If you need to
perform Admin API requests, these should be made to your 1.0 nodes.
The reason is to prevent the new cluster from generating data
that is not understood by the old cluster.</li>
  <li>Gradually divert traffic away from your 1.0 nodes, and into
your 1.1 cluster. Monitor your traffic to make sure everything
is going smoothly.</li>
  <li>When your traffic is fully migrated to the 1.1 cluster,
decommission your 1.0 nodes.</li>
  <li>From your 1.1 cluster, run: <code class="language-plaintext highlighter-rouge">kong migrations finish</code>.
From this point on, it will not be possible to start 1.0
nodes pointing to the same datastore anymore. Only run
this command when you are confident that your migration
was successful. From now on, you can safely make Admin API
requests to your 1.1 nodes.</li>
</ol>

<h5 id="upgrade-path-from-11-release-candidates">Upgrade Path from 1.1 Release Candidates</h5>

<p>The process is the same as for upgrading from 1.0 listed above, but on step 1
you should run <code class="language-plaintext highlighter-rouge">kong migrations up --force</code> instead.</p>

<h5 id="installing-11-on-a-fresh-datastore">Installing 1.1 on a Fresh Datastore</h5>

<p>The following commands should be used to prepare a new 1.1 cluster from a fresh datastore:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ kong migrations bootstrap [-c config]
$ kong start [-c config]
</code></pre></div></div>

<h2 id="upgrading-10x-patch-releases">Upgrading <code class="language-plaintext highlighter-rouge">1.0.x</code> patch releases</h2>

<p>If you are upgrading from another release in the 1.0.x series (e.g. from 1.0.0
to 1.0.1), there are no migrations. Simply upgrade your Kong installation and
<a href="https://docs.konghq.com/1.0.x/cli/#kong-reload">reload</a> Kong:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kong reload <span class="o">[</span><span class="nt">-c</span> configuration_file]
</code></pre></div></div>

<p>If you are upgrading from 0.x, then read the following section for
detailed migration instructions.</p>

<h2 id="upgrade-from-0x-to-10x">Upgrade from <code class="language-plaintext highlighter-rouge">0.x</code> to <code class="language-plaintext highlighter-rouge">1.0.x</code></h2>

<p>Kong 1.0 is a major upgrade, and includes a number of new features
as well as breaking changes.</p>

<p>This version introduces <strong>a new schema format for plugins</strong>, <strong>changes in
Admin API endpoints</strong>, <strong>database migrations</strong>, <strong>Nginx configuration
changes</strong>, and <strong>removed configuration properties</strong>.</p>

<p>In this release, the <strong>API entity is removed</strong>, along with its related
Admin API endpoints.</p>

<p>This section will highlight breaking changes that you need to be aware of
before upgrading and will describe the recommended upgrade path. We recommend
that you consult the full <a href="https://github.com/Kong/kong/blob/master/CHANGELOG.md">1.0.0
Changelog</a> for a
complete list of changes and new features.</p>

<p><a name="kong-1-0-breaking-changes"></a></p>
<h4 id="1-breaking-changes-1">1. Breaking Changes</h4>

<h5 id="dependencies-1">Dependencies</h5>

<ul>
  <li>The required OpenResty version is 1.13.6.2, but for a full feature set,
including stream routing and service mesh abilities with mutual TLS, you need
Kong’s <a href="https://github.com/kong/openresty-patches">openresty-patches</a>.</li>
  <li>The minimum required OpenSSL version is 1.1.1. If you are building by hand,
make sure all dependencies, including LuaRocks modules, are compiled using
the same OpenSSL version. If you are installing Kong from one of our
distribution packages, you are not affected by this change.</li>
</ul>

<h5 id="configuration-1">Configuration</h5>

<ul>
  <li>The <code class="language-plaintext highlighter-rouge">custom_plugins</code> directive is removed (deprecated since 0.14.0).
Use <code class="language-plaintext highlighter-rouge">plugins</code> instead, which you can use not only to enable
custom plugins, but also to disable bundled plugins.</li>
  <li>The default value for <code class="language-plaintext highlighter-rouge">cassandra_lb_policy</code> changed from <code class="language-plaintext highlighter-rouge">RoundRobin</code>
to <code class="language-plaintext highlighter-rouge">RequestRoundRobin</code>.</li>
  <li>The Nginx configuration file has changed, which means that you need to update
it if you are using a custom template. The changes are detailed in a diff
included below.</li>
</ul>

<details>
<summary><strong>Click here to see the Nginx configuration changes</strong></summary>
<p>

```diff
diff --git a/kong/templates/nginx_kong.lua b/kong/templates/nginx_kong.lua
index d4e416bc..8f268ffd 100644
--- a/kong/templates/nginx_kong.lua
+++ b/kong/templates/nginx_kong.lua
@@ -66,7 +66,9 @@ upstream kong_upstream {
     balancer_by_lua_block {
         Kong.balancer()
     }
+&gt; if upstream_keepalive &gt; 0 then
     keepalive $;
+&gt; end
 }

 server {
@@ -85,7 +87,7 @@ server {
 &gt; if proxy_ssl_enabled then
     ssl_certificate $;
     ssl_certificate_key $;
-    ssl_protocols TLSv1.1 TLSv1.2;
+    ssl_protocols TLSv1.1 TLSv1.2 TLSv1.3;
     ssl_certificate_by_lua_block {
         Kong.ssl_certificate()
     }
@@ -200,7 +202,7 @@ server {
 &gt; if admin_ssl_enabled then
     ssl_certificate $;
     ssl_certificate_key $;
-    ssl_protocols TLSv1.1 TLSv1.2;
+    ssl_protocols TLSv1.1 TLSv1.2 TLSv1.3;

     ssl_session_cache shared:SSL:10m;
     ssl_session_timeout 10m;
```

</p>
</details>

<ul>
  <li>Kong generates a new template file for stream routing,
<code class="language-plaintext highlighter-rouge">nginx-kong-stream.conf</code>, included in the <code class="language-plaintext highlighter-rouge">stream</code> block
of its top-level Nginx configuration file. If you use
a custom Nginx configuration and wish to use stream
routing, you can generate this file using <code class="language-plaintext highlighter-rouge">kong prepare</code>.</li>
</ul>

<h5 id="core-1">Core</h5>

<ul>
  <li>The <strong>API</strong> entity and related concepts such as the
<code class="language-plaintext highlighter-rouge">/apis</code> endpoint, are removed. These were deprecated since
0.13.0. Instead, use <strong>Routes</strong> to configure your
endpoints and <strong>Services</strong> to configure your upstream
services.</li>
  <li>The old DAO implementation (<code class="language-plaintext highlighter-rouge">kong.dao</code>) is removed,
which includes the old schema validation library. This
has implications to plugin developers, listed below.
    <ul>
      <li>The last remaining entities that were converted to
the new DAO implementation were Plugins, Upstreams
and Targets. This has implications to the Admin API,
listed below.</li>
    </ul>
  </li>
</ul>

<h5 id="plugins">Plugins</h5>

<p>Kong 1.0.0 marks the introduction of version 1.0.0 of
the Plugin Development Kit (PDK). No major changes are
made to the PDK compared to release 0.14, but some older
non-PDK functionality which was possibly used by custom
plugins is now removed.</p>

<ul>
  <li>Plugins now use the new schema format introduced by the
new DAO implementation, for both plugin schemas
(in <code class="language-plaintext highlighter-rouge">schema.lua</code>) and custom DAO entities (<code class="language-plaintext highlighter-rouge">daos.lua</code>).
To ease the transition of plugins, the plugin loader
in 1.0 includes a <em>best-effort</em> schema auto-translator
for <code class="language-plaintext highlighter-rouge">schema.lua</code>, which should be sufficient for many
plugins (in 1.0.0rc1, our bundled plugins used the
auto-translator; they now use the new format).
    <ul>
      <li>If your plugin using the old format in <code class="language-plaintext highlighter-rouge">schema.lua</code>
fails to load, check the error logs for messages
produced by the auto-translator. If a field cannot
be auto-translated, you can make a gradual conversion
of the schema file by adding a <code class="language-plaintext highlighter-rouge">new_type</code> entry to
the field table translation of the format. See,
for example, the <a href="https://github.com/Kong/kong/blob/1.0.0rc1/kong/plugins/key-auth/schema.lua#L39-L54">key-auth schema in 1.0.0rc1</a>.
The <code class="language-plaintext highlighter-rouge">new_type</code> annotation is ignored by Kong 0.x.</li>
      <li>If your custom plugin uses custom DAO objects (i.e.
if it includes a <code class="language-plaintext highlighter-rouge">daos.lua</code> file), it needs to be
converted to the new format. Their code also needs
to be adjusted accordingly, replacing uses of
<code class="language-plaintext highlighter-rouge">singletons.dao</code> or <code class="language-plaintext highlighter-rouge">kong.dao</code> by <code class="language-plaintext highlighter-rouge">kong.db</code> (note
that this module exposes a different API from the
old DAO implementation).</li>
    </ul>
  </li>
  <li>Some Kong modules that had their functionality replaced
by the PDK in 0.14.0 are now removed:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">kong.tools.ip</code>: use <code class="language-plaintext highlighter-rouge">kong.ip</code> from the PDK instead.</li>
      <li><code class="language-plaintext highlighter-rouge">kong.tools.public</code>: replaced by various functionalities
of the PDK.</li>
      <li><code class="language-plaintext highlighter-rouge">kong.tools.responses</code>: use <code class="language-plaintext highlighter-rouge">kong.response.exit</code> from the PDK instead. You
might want to use <code class="language-plaintext highlighter-rouge">kong.log.err</code> to log internal server errors as well.</li>
    </ul>
  </li>
  <li>The <code class="language-plaintext highlighter-rouge">kong.api.crud_helpers</code> module was removed.
Use <code class="language-plaintext highlighter-rouge">kong.api.endpoints</code> instead if you need to customize
the auto-generated endpoints.</li>
</ul>

<h5 id="admin-api">Admin API</h5>

<ul>
  <li>With the removal of the API entity, the <code class="language-plaintext highlighter-rouge">/apis</code> endpoint
is removed; accordingly, other endpoints that accepted
<code class="language-plaintext highlighter-rouge">api_id</code> no longer do so. Use Routes and Services instead.</li>
  <li>All entity endpoints now use the new Admin API implementation.
This means their requests and responses now use the same
syntax, which was already in use in endpoints such as
<code class="language-plaintext highlighter-rouge">/routes</code> and <code class="language-plaintext highlighter-rouge">/services</code>.
    <ul>
      <li>All endpoints now use the same syntax for
referencing other entities as <code class="language-plaintext highlighter-rouge">/routes</code>
(for example, <code class="language-plaintext highlighter-rouge">"service":{"id":"..."}</code> instead of
<code class="language-plaintext highlighter-rouge">"service_id":"..."</code>), both in requests and responses.
        <ul>
          <li>This change affects <code class="language-plaintext highlighter-rouge">/plugins</code> as well as
plugin-specific endpoints.</li>
        </ul>
      </li>
      <li>Array-typed values are not specified as a
comma-separated list anymore. It must be specified as a
JSON array or using the various formats supported by
the url-formencoded array notation of the new Admin API
implementation (<code class="language-plaintext highlighter-rouge">a[1]=x&amp;a[2]=y</code>, <code class="language-plaintext highlighter-rouge">a[]=x&amp;a[]=y</code>,
<code class="language-plaintext highlighter-rouge">a=x&amp;a=y</code>).
        <ul>
          <li>This change affects attributes of the <code class="language-plaintext highlighter-rouge">/upstreams</code> endpoint.</li>
        </ul>
      </li>
      <li>Error responses for the updated endpoints use
the new standardized format.</li>
      <li>As a result of being moved to the new Admin API implementation,
all endpoints supporting <code class="language-plaintext highlighter-rouge">PUT</code> do so with proper semantics.</li>
      <li>See the <a href="https://docs.konghq.com/1.0.x/admin-api">Admin API
reference</a>
for more details.</li>
    </ul>
  </li>
</ul>

<h4 id="2-deprecation-notices">2. Deprecation Notices</h4>

<p>There are no deprecation notices in this release.</p>

<p><a name="kong-1-0-upgrade-path"></a></p>
<h4 id="3-suggested-upgrade-path-6">3. Suggested Upgrade Path</h4>

<h5 id="preliminary-checks">Preliminary Checks</h5>

<p>If your cluster is running a version lower than 0.14, you need to
upgrade to 0.14.1 first instead. Upgrading from a pre-0.14 cluster
straight to Kong 1.0 is <strong>not</strong> supported.</p>

<p>If you still use the deprecated API entity to configure your endpoints and
upstream services (via <code class="language-plaintext highlighter-rouge">/apis</code>) instead of using Routes for endpoints (via
<code class="language-plaintext highlighter-rouge">/routes</code>) and Services for upstream services (via <code class="language-plaintext highlighter-rouge">/services</code>), now is the
time to do so. Kong 1.0 will refuse to run migrations if you have any entity
configured using <code class="language-plaintext highlighter-rouge">/apis</code> in your datastore. Create equivalent Routes and
Services and delete your APIs. (Note that Kong does not do this automatically
because the naive option of creating a Route and Service pair for each API
would miss the point of the improvements brought by Routes and Services;
the ideal mapping of Routes and Services depends on your microservice
architecture.)</p>

<p>If you use additional plugins other than the ones bundled with Kong,
make sure they are compatible with Kong 1.0 prior to upgrading.
See the section above on Plugins for information on plugin compatibility.</p>

<h5 id="migration-steps-from-014">Migration Steps from 0.14</h5>

<p>Kong 1.0 introduces a new, improved migrations framework.
It supports a no-downtime, Blue/Green migration model for upgrading
from 0.14.x. This means that while the migration is ongoing, you will
have two Kong clusters running, sharing the same database. The “Blue” cluster
is your existing cluster running 0.14.x, the “Green” cluster is the new one
running Kong 1.0.</p>

<p>The migrations are designed so that there is no need to fully copy
the data, but this also means that they are designed in such a way so that
the new version of Kong is able to use the data as it is migrated, and to do
it in a way so that the old Kong cluster keeps working until it is finally
time to decommission it. For this reason, the full migration is now split into
two steps, which are performed via commands <code class="language-plaintext highlighter-rouge">kong migrations up</code> (which does
only non-destructive operations) and <code class="language-plaintext highlighter-rouge">kong migrations finish</code> (which puts the
database in the final expected state for Kong 1.0).</p>

<p>For a no-downtime migration from a 0.14 cluster to a 1.0 cluster,
we recommend the following sequence of steps:</p>

<ol>
  <li>Download 1.0, and configure it to point to the same datastore
as your 0.14 cluster. Run <code class="language-plaintext highlighter-rouge">kong migrations up</code> from a Kong 1.0
node.</li>
  <li>Once that finishes running, both 0.14 and 1.0 clusters can now
run simultaneously on the same datastore. Start provisioning
1.0 nodes, but do not use their Admin API yet. If you need to
perform Admin API requests, these should be made to your 0.14 nodes.
The reason is to prevent the new cluster from generating data
that is not understood by the old cluster.</li>
  <li>Gradually divert traffic away from your 0.14 nodes, and into
your 1.0 cluster. Monitor your traffic to make sure everything
is going smoothly.</li>
  <li>When your traffic is fully migrated to the 1.0 cluster,
decommission your 0.14 nodes.</li>
  <li>From your 1.0 cluster, run: <code class="language-plaintext highlighter-rouge">kong migrations finish</code>.
From this point on, it will not be possible to start 0.14
nodes pointing to the same datastore anymore. Only run
this command when you are confident that your migration
was successful. From now on, you can safely make Admin API
requests to your 1.0 nodes.</li>
</ol>

<h5 id="upgrade-path-from-10-release-candidates">Upgrade Path from 1.0 Release Candidates</h5>

<p>The process is the same as for upgrading for 0.14 listed above, but on step 1 you should run <code class="language-plaintext highlighter-rouge">kong migrations up --force</code> instead.</p>

<h5 id="installing-10-on-a-fresh-datastore">Installing 1.0 on a Fresh Datastore</h5>

<p>For installing on a fresh datastore, Kong 1.0 introduces the <code class="language-plaintext highlighter-rouge">kong migrations bootstrap</code> command. The following commands can be run to prepare a new 1.0 cluster from a fresh datastore:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ kong migrations bootstrap [-c config]
$ kong start [-c config]
</code></pre></div></div>

<h2 id="upgrade-to-015">Upgrade to <code class="language-plaintext highlighter-rouge">0.15</code></h2>

<p>This is the last release in the 0.x series, giving users one last chance to
upgrade while still using some of the options and concepts that were marked as
deprecated in Kong 0.x and were removed in Kong 1.0. Still, Kong 0.15 does
have a number of breaking changes related to functionality that has changed
since version 0.14.</p>

<p>This version introduces <strong>a new schema format for plugins</strong>, <strong>changes in
Admin API endpoints</strong>, <strong>database migrations</strong> and <strong>Nginx configuration
changes</strong>.</p>

<p>This section will highlight breaking changes that you need to be aware of
before upgrading and will describe the recommended upgrade path. We recommend
that you consult the full <a href="https://github.com/Kong/kong/blob/master/CHANGELOG.md">0.15
Changelog</a> for a
complete list of changes and new features.</p>

<h4 id="1-breaking-changes-2">1. Breaking Changes</h4>

<h5 id="dependencies-2">Dependencies</h5>

<ul>
  <li>The required OpenResty version is 1.13.6.2, but for a full feature set,
including stream routing and service mesh abilities with mutual TLS,
you need Kong’s <a href="https://github.com/kong/openresty-patches">openresty-patches</a>.
The minimum required OpenSSL version is 1.1.1. If you are building by
hand, make sure all dependencies, including LuaRocks modules, are
compiled using the same OpenSSL version.
If you are installing Kong from one of our distribution packages, you are not
affected by this change.</li>
</ul>

<h5 id="configuration-2">Configuration</h5>

<ul>
  <li>The default value for <code class="language-plaintext highlighter-rouge">cassandra_lb_policy</code> changed from <code class="language-plaintext highlighter-rouge">RoundRobin</code>
to <code class="language-plaintext highlighter-rouge">RequestRoundRobin</code>.</li>
  <li>The Nginx configuration file has changed, which means that you need to update
it if you are using a custom template. The changes are detailed in a diff
included below.</li>
</ul>

<details>
<summary><strong>Click here to see the Nginx configuration changes</strong></summary>
<p>

```diff
diff --git a/kong/templates/nginx_kong.lua b/kong/templates/nginx_kong.lua
index d4e416bc..8f268ffd 100644
--- a/kong/templates/nginx_kong.lua
+++ b/kong/templates/nginx_kong.lua
@@ -66,7 +66,9 @@ upstream kong_upstream {
     balancer_by_lua_block {
         Kong.balancer()
     }
+&gt; if upstream_keepalive &gt; 0 then
     keepalive $;
+&gt; end
 }

 server {
@@ -85,7 +87,7 @@ server {
 &gt; if proxy_ssl_enabled then
     ssl_certificate $;
     ssl_certificate_key $;
-    ssl_protocols TLSv1.1 TLSv1.2;
+    ssl_protocols TLSv1.1 TLSv1.2 TLSv1.3;
     ssl_certificate_by_lua_block {
         Kong.ssl_certificate()
     }
@@ -200,7 +202,7 @@ server {
 &gt; if admin_ssl_enabled then
     ssl_certificate $;
     ssl_certificate_key $;
-    ssl_protocols TLSv1.1 TLSv1.2;
+    ssl_protocols TLSv1.1 TLSv1.2 TLSv1.3;

     ssl_session_cache shared:SSL:10m;
     ssl_session_timeout 10m;
```

</p>
</details>

<ul>
  <li>Kong generates a new template file for stream routing,
<code class="language-plaintext highlighter-rouge">nginx-kong-stream.conf</code>, included in the <code class="language-plaintext highlighter-rouge">stream</code> block
of its top-level Nginx configuration file. If you use
a custom Nginx configuration and wish to use stream
routing, you can generate this file using <code class="language-plaintext highlighter-rouge">kong prepare</code>.</li>
</ul>

<h5 id="core-2">Core</h5>

<ul>
  <li>The old DAO implementation (<code class="language-plaintext highlighter-rouge">kong.dao</code>) is no longer
used by the Kong core,  which includes the old schema
validation library. This has implications to plugin
developers, listed below.
    <ul>
      <li>The last remaining entities that were converted to
the new DAO implementation were Plugins, Upstreams
and Targets. This has implications to the Admin API,
listed below.</li>
    </ul>
  </li>
</ul>

<h5 id="plugins-1">Plugins</h5>

<p>Kong 0.15 includes version 1.0.0 of the Plugin Development Kit (PDK). No major
changes are made to the PDK compared to release 0.14, but some older non-PDK
functionality which was possibly used by custom plugins is now removed.</p>

<ul>
  <li>Plugins now use the new schema format introduced by the
new DAO implementation, for both plugin schemas
(in <code class="language-plaintext highlighter-rouge">schema.lua</code>) and custom DAO entities (<code class="language-plaintext highlighter-rouge">daos.lua</code>).
To ease the transition of plugins, the plugin loader
in 0.15 includes a <em>best-effort</em> schema auto-translator
for <code class="language-plaintext highlighter-rouge">schema.lua</code>, which should be sufficient for many
plugins (in 1.0.0rc1, our bundled plugins used the
auto-translator; they now use the new format).
    <ul>
      <li>If your plugin using the old format in <code class="language-plaintext highlighter-rouge">schema.lua</code>
fails to load, check the error logs for messages
produced by the auto-translator. If a field cannot
be auto-translated, you can make a gradual conversion
of the schema file by adding a <code class="language-plaintext highlighter-rouge">new_type</code> entry to
the field table translation of the format. See,
for example, the <a href="https://github.com/Kong/kong/blob/1.0.0rc1/kong/plugins/key-auth/schema.lua#L39-L54">key-auth schema in 1.0.0rc1</a>.
The <code class="language-plaintext highlighter-rouge">new_type</code> annotation is ignored by Kong 0.x.</li>
      <li>If your custom plugin uses custom DAO objects (i.e.
if it includes a <code class="language-plaintext highlighter-rouge">daos.lua</code> file), it needs to be
converted to the new format. Their code also needs
to be adjusted accordingly, replacing uses of
<code class="language-plaintext highlighter-rouge">singletons.dao</code> or <code class="language-plaintext highlighter-rouge">kong.dao</code> by <code class="language-plaintext highlighter-rouge">kong.db</code> (note
that this module exposes a different API from the
old DAO implementation).</li>
    </ul>
  </li>
</ul>

<h5 id="admin-api-1">Admin API</h5>

<ul>
  <li>All entity endpoints now use the new Admin API implementation.
This means their requests and responses now use the same
syntax, which was already in use in endpoints such as
<code class="language-plaintext highlighter-rouge">/routes</code> and <code class="language-plaintext highlighter-rouge">/services</code>.
    <ul>
      <li>All endpoints now use the same syntax for
referencing other entities as <code class="language-plaintext highlighter-rouge">/routes</code>
(for example, <code class="language-plaintext highlighter-rouge">"service":{"id":"..."}</code> instead of
<code class="language-plaintext highlighter-rouge">"service_id":"..."</code>), both in requests and responses.
        <ul>
          <li>This change affects <code class="language-plaintext highlighter-rouge">/plugins</code> as well as
plugin-specific endpoints.</li>
        </ul>
      </li>
      <li>Array-typed values are not specified as a
comma-separated list anymore. It must be specified as a
JSON array or using the various formats supported by
the url-formencoded array notation of the new Admin API
implementation (<code class="language-plaintext highlighter-rouge">a[1]=x&amp;a[2]=y</code>, <code class="language-plaintext highlighter-rouge">a[]=x&amp;a[]=y</code>,
<code class="language-plaintext highlighter-rouge">a=x&amp;a=y</code>).
        <ul>
          <li>This change affects attributes of the <code class="language-plaintext highlighter-rouge">/upstreams</code> endpoint.</li>
        </ul>
      </li>
      <li>Error responses for the updated endpoints use
the new standardized format.</li>
      <li>As a result of being moved to the new Admin API implementation,
all endpoints supporting <code class="language-plaintext highlighter-rouge">PUT</code> do so with proper semantics.</li>
      <li>See the <a href="https://docs.konghq.com/0.15/admin-api">Admin API
reference</a>
for more details.</li>
    </ul>
  </li>
</ul>

<h4 id="2-deprecation-notices-1">2. Deprecation Notices</h4>

<p>Kong 0.15 retains the deprecation notices of previous releases; all modules
and concepts that have been marked as deprecated in previous releases are
retained in 0.15 but are removed in 1.0. See the Kong 1.0 changelog and
upgrade path for a detailed list.</p>

<h4 id="3-suggested-upgrade-path-7">3. Suggested Upgrade Path</h4>

<h5 id="preliminary-checks-1">Preliminary Checks</h5>

<p>If your cluster is running a version lower than 0.14, you need to
upgrade to 0.14.1 first instead. Upgrading from a pre-0.14 cluster
straight to Kong 0.15 is <strong>not</strong> supported.</p>

<p>If you use additional plugins other than the ones bundled with Kong,
make sure they are compatible with Kong 0.15 prior to upgrading.
See the section above on Plugins for information on plugin compatibility.</p>

<h5 id="migration-steps-from-014-1">Migration Steps from 0.14</h5>

<p>Kong 0.15 introduces a new, improved migrations framework.
It supports a no-downtime, Blue/Green migration model for upgrading
from 0.14.x. The full migration is now split into two steps,
which are performed via commands <code class="language-plaintext highlighter-rouge">kong migrations up</code> and
<code class="language-plaintext highlighter-rouge">kong migrations finish</code>.</p>

<p>For a no-downtime migration from a 0.14 cluster to a 0.15 cluster,
we recommend the following sequence of steps:</p>

<ol>
  <li>Download 0.15, and configure it to point to the same datastore
as your 0.14 cluster. Run <code class="language-plaintext highlighter-rouge">kong migrations up</code>.</li>
  <li>Both 0.14 and 0.15 nodes can now run simultaneously on the same
datastore. Start provisioning 0.15 nodes, but do not use their
Admin API yet. Prefer making Admin API requests to your 0.14 nodes
instead.</li>
  <li>Gradually divert traffic away from your 0.14 nodes, and into
your 0.15 cluster. Monitor your traffic to make sure everything
is going smoothly.</li>
  <li>When your traffic is fully migrated to the 0.15 cluster,
decommission your 0.14 nodes.</li>
  <li>From your 0.15 cluster, run: <code class="language-plaintext highlighter-rouge">kong migrations finish</code>.
From this point on, it will not be possible to start 0.14
nodes pointing to the same datastore anymore. Only run
this command when you are confident that your migration
was successful. From now on, you can safely make Admin API
requests to your 0.15 nodes.</li>
</ol>

<h5 id="installing-015-on-a-fresh-datastore">Installing 0.15 on a Fresh Datastore</h5>

<p>For installing on a fresh datastore, Kong 0.15 introduces the <code class="language-plaintext highlighter-rouge">kong migrations
bootstrap</code> command. The following commands can be run to prepare a new 0.15
cluster from a fresh datastore:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ kong migrations bootstrap [-c config]
$ kong start [-c config]
</code></pre></div></div>

<h2 id="upgrade-to-014x">Upgrade to <code class="language-plaintext highlighter-rouge">0.14.x</code></h2>

<p>This version introduces <strong>changes in Admin API endpoints</strong>, <strong>database
migrations</strong>, <strong>Nginx configuration changes</strong>, and <strong>removed configuration
properties</strong>.</p>

<p>In this release, the <strong>API entity is still supported</strong>, along with its related
Admin API endpoints.</p>

<p>This section will highlight breaking changes that you need to be aware of
before upgrading and will describe the recommended upgrade path. We recommend
that you consult the full <a href="https://github.com/Kong/kong/blob/master/CHANGELOG.md">0.14.0
Changelog</a> for a
complete list of changes and new features.</p>

<h4 id="1-breaking-changes-3">1. Breaking Changes</h4>

<h5 id="dependencies-3">Dependencies</h5>

<ul>
  <li>The required OpenResty version has been bumped to 1.13.6.2. If you
are installing Kong from one of our distribution packages, you are not
affected by this change.</li>
  <li>Support for PostreSQL 9.4 (deprecated in 0.12.0) is now dropped.</li>
  <li>Support for Cassandra 2.1 (deprecated in 0.12.0) is now dropped.</li>
</ul>

<h5 id="configuration-3">Configuration</h5>

<ul>
  <li>The <code class="language-plaintext highlighter-rouge">server_tokens</code> and <code class="language-plaintext highlighter-rouge">latency_tokens</code> configuration properties have been
removed. Instead, a new <code class="language-plaintext highlighter-rouge">headers</code> configuration properties replaces them.
See the default configuration file or the <a href="https://docs.konghq.com/0.14.x/configuration/">configuration
reference</a> for more details.</li>
  <li>The Nginx configuration file has changed, which means that you need to update
it if you are using a custom template. The changes are detailed in a diff
included below.</li>
</ul>

<h5 id="plugins-2">Plugins</h5>
<ul>
  <li>The Runscope plugin has been dropped, based on the EoL announcement made by Runscope about their Traffic Inspector product. <a href="https://github.com/Kong/kong/pull/3495">#3495</a></li>
</ul>

<h5 id="admin-api-2">Admin API</h5>
<ul>
  <li>
    <p>The SSL Certificates and SNI entities have moved to the new DAO implementation. As such, the /certificates and /snis endpoints have received notable usability improvements, but suffer from a few breaking changes. <a href="https://github.com/Kong/kong/pull/3386">#3386</a></p>
  </li>
  <li>
    <p>The Consumers entity has moved to the new DAO implementation. As such, the <code class="language-plaintext highlighter-rouge">/consumers</code> endpoint has received notable usability improvements, but suffers from a few breaking changes. <a href="https://github.com/Kong/kong/pull/3437">#3437</a></p>
  </li>
</ul>

<details>
<summary><strong>Click here to see the Nginx configuration changes</strong></summary>
<p>

```diff
diff --git a/kong/templates/nginx_kong.lua b/kong/templates/nginx_kong.lua
index a66c230f..d4e416bc 100644
--- a/kong/templates/nginx_kong.lua
+++ b/kong/templates/nginx_kong.lua
@@ -29,8 +29,9 @@ lua_socket_pool_size $;
 lua_max_running_timers 4096;
 lua_max_pending_timers 16384;
 lua_shared_dict kong                5m;
-lua_shared_dict kong_cache          $;
+lua_shared_dict kong_db_cache       $;
 lua_shared_dict kong_db_cache_miss 12m;
+lua_shared_dict kong_locks          8m;
 lua_shared_dict kong_process_events 5m;
 lua_shared_dict kong_cluster_events 5m;
 lua_shared_dict kong_healthchecks   5m;
@@ -44,13 +45,18 @@ lua_ssl_trusted_certificate '$';
 lua_ssl_verify_depth $;
 &gt; end

+# injected nginx_http_* directives
+&gt; for _, el in ipairs(nginx_http_directives)  do
+$(el.name) $(el.value);
+&gt; end
+
 init_by_lua_block {
-    kong = require 'kong'
-    kong.init()
+    Kong = require 'kong'
+    Kong.init()
 }

 init_worker_by_lua_block {
-    kong.init_worker()
+    Kong.init_worker()
 }


@@ -58,7 +64,7 @@ init_worker_by_lua_block {
 upstream kong_upstream {
     server 0.0.0.1;
     balancer_by_lua_block {
-        kong.balancer()
+        Kong.balancer()
     }
     keepalive $;
 }
@@ -81,7 +87,7 @@ server {
     ssl_certificate_key $;
     ssl_protocols TLSv1.1 TLSv1.2;
     ssl_certificate_by_lua_block {
-        kong.ssl_certificate()
+        Kong.ssl_certificate()
     }

     ssl_session_cache shared:SSL:10m;
@@ -101,7 +107,15 @@ server {
     set_real_ip_from   $(trusted_ips[i]);
 &gt; end

+    # injected nginx_proxy_* directives
+&gt; for _, el in ipairs(nginx_proxy_directives)  do
+    $(el.name) $(el.value);
+&gt; end
+
     location / {
+        default_type                     '';
+
+        set $ctx_ref                     '';
         set $upstream_host               '';
         set $upstream_upgrade            '';
         set $upstream_connection         '';
@@ -113,11 +127,11 @@ server {
         set $upstream_x_forwarded_port   '';

         rewrite_by_lua_block {
-            kong.rewrite()
+            Kong.rewrite()
         }

         access_by_lua_block {
-            kong.access()
+            Kong.access()
         }

         proxy_http_version 1.1;
@@ -135,22 +149,36 @@ server {
         proxy_pass         $upstream_scheme://kong_upstream$upstream_uri;

         header_filter_by_lua_block {
-            kong.header_filter()
+            Kong.header_filter()
         }

         body_filter_by_lua_block {
-            kong.body_filter()
+            Kong.body_filter()
         }

         log_by_lua_block {
-            kong.log()
+            Kong.log()
         }
     }

     location = /kong_error_handler {
         internal;
+        uninitialized_variable_warn off;
+
         content_by_lua_block {
-            kong.handle_error()
+            Kong.handle_error()
+        }
+
+        header_filter_by_lua_block {
+            Kong.header_filter()
+        }
+
+        body_filter_by_lua_block {
+            Kong.body_filter()
+        }
+
+        log_by_lua_block {
+            Kong.log()
         }
     }
 }
@@ -180,10 +208,15 @@ server {
     ssl_ciphers $;
 &gt; end

+    # injected nginx_admin_* directives
+&gt; for _, el in ipairs(nginx_admin_directives)  do
+    $(el.name) $(el.value);
+&gt; end
+
     location / {
         default_type application/json;
         content_by_lua_block {
-            kong.serve_admin_api()
+            Kong.serve_admin_api()
         }
     }
```

</p>
</details>

<h5 id="core-3">Core</h5>

<ul>
  <li>If you are relying on passive health-checks to detect TCP timeouts, you
should double-check your health-check configurations. Previously, timeouts
were erroneously contributing to the <code class="language-plaintext highlighter-rouge">tcp_failures</code> counter. They are now
properly contributing to the <code class="language-plaintext highlighter-rouge">timeout</code> counter. In order to short-circuit
traffic based on timeouts, you must ensure that your <code class="language-plaintext highlighter-rouge">timeout</code> settings
are properly configured. See the <a href="https://docs.konghq.com/0.14.x/health-checks-circuit-breakers/">Health Checks
reference</a>
for more details.</li>
</ul>

<h5 id="plugins-3">Plugins</h5>

<ul>
  <li>Custom plugins can now see their <code class="language-plaintext highlighter-rouge">header_filter</code>, <code class="language-plaintext highlighter-rouge">body_filter</code>, and <code class="language-plaintext highlighter-rouge">log</code>
phases executed without the <code class="language-plaintext highlighter-rouge">rewrite</code> or <code class="language-plaintext highlighter-rouge">access</code> phases running first. This
can happen when Nginx itself produces an error while parsing the client’s
request. Similarly, <code class="language-plaintext highlighter-rouge">ngx.var</code> values (e.g. <code class="language-plaintext highlighter-rouge">ngx.var.request_uri</code>) may be
<code class="language-plaintext highlighter-rouge">nil</code>. Plugins should be hardened to handle such cases and avoid using
uninitialized variables, which could throw Lua errors.</li>
  <li>The Runscope plugin has been dropped, based on the EoL announcement made by
Runscope about their Traffic Inspector product.</li>
</ul>

<h5 id="admin-api-3">Admin API</h5>

<ul>
  <li>As a result of being moved to the new Admin API implementation (and
supporting <code class="language-plaintext highlighter-rouge">PUT</code> and named endpoints), the <code class="language-plaintext highlighter-rouge">/snis</code> endpoint
<code class="language-plaintext highlighter-rouge">ssl_certificate_id</code> attribute has been renamed to <code class="language-plaintext highlighter-rouge">certificate_id</code>.
See the <a href="https://docs.konghq.com/0.14.x/admin-api/#add-sni">Admin API
reference</a> for
more details.</li>
  <li>On the <code class="language-plaintext highlighter-rouge">/certificates</code> endpoint, the <code class="language-plaintext highlighter-rouge">snis</code> attribute is not specified as a
comma-separated list anymore. It must be specified as a JSON array or using
the url-formencoded array notation of other recent Admin API endpoints. See
the <a href="https://docs.konghq.com/0.14.x/admin-api/#add-certificate">Admin API
reference</a> for
more details.</li>
  <li>Filtering by username in the <code class="language-plaintext highlighter-rouge">/consumers</code> endpoint is not supported with
<code class="language-plaintext highlighter-rouge">/consumers?username=...</code>. Instead, use <code class="language-plaintext highlighter-rouge">/consumers/{username}</code> to retrieve a
Consumer by its username. Filtering with <code class="language-plaintext highlighter-rouge">/consumers?custom_id=...</code> is still
supported.</li>
</ul>

<h4 id="2-deprecation-notices-2">2. Deprecation Notices</h4>

<ul>
  <li>The <code class="language-plaintext highlighter-rouge">custom_plugins</code> configuration property is now deprecated in favor of
<code class="language-plaintext highlighter-rouge">plugins</code>. See the default configuration file or the <a href="https://docs.konghq.com/0.14.x/configuration/">configuration
reference</a> for more details.</li>
</ul>

<h4 id="3-suggested-upgrade-path-8">3. Suggested Upgrade Path</h4>

<p>You can now start migrating your cluster from <code class="language-plaintext highlighter-rouge">0.13.x</code> to <code class="language-plaintext highlighter-rouge">0.14</code>. If you are
doing this upgrade “in-place”, against the datastore of a running 0.13 cluster,
then for a short period of time, your database schema won’t be fully compatible
with your 0.13 nodes anymore. This is why we suggest either performing this
upgrade when your 0.13 cluster is warm and most entities are cached, or against
a new database, if you can migrate your data. If you wish to temporarily make
your APIs unavailable, you can leverage the
<a href="https://getkong.org/plugins/request-termination/">request-termination</a> plugin.</p>

<p>The path to upgrade a 0.13 datastore is identical to the one of previous major
releases:</p>

<ol>
  <li>If you are planning on upgrading Kong while 0.13 nodes are running against
the same datastore, make sure those nodes are warm enough (they should have
most of your entities cached already), or temporarily disable your APIs.</li>
  <li>Provision a 0.14 node and configure it as you wish (environment variables/
configuration file). Make sure to point this new 0.14 node to your current
datastore.</li>
  <li><strong>Without starting the 0.14 node</strong>, run the 0.14 migrations against your
current datastore:</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ kong migrations up [-c kong.conf]
</code></pre></div></div>

<p>As usual, this step should be executed from a <strong>single node</strong>.</p>

<ol>
  <li>You can now provision a fresh 0.14 cluster pointing to your migrated
datastore and start your 0.14 nodes.</li>
  <li>Gradually switch your traffic from the 0.13 cluster to the new 0.14 cluster.
Remember, once your database is migrated, your 0.13 nodes will rely on
their cache and not on the underlying database. Your traffic should switch
to the new cluster as quickly as possible.</li>
  <li>Once your traffic is fully migrated to the 0.14 cluster, decommission
your 0.13 cluster.</li>
</ol>

<p>You have now successfully upgraded your cluster to run 0.14 nodes exclusively.</p>

<h2 id="upgrade-to-013x">Upgrade to <code class="language-plaintext highlighter-rouge">0.13.x</code></h2>

<p>This version comes with <strong>new model entities</strong>, <strong>database migrations</strong>, and
<strong>nginx configuration changes</strong>.</p>

<p>This section will only highlight the breaking changes that you need to be
aware of, and describe a recommended upgrade path. We recommend that you
consult the full <a href="https://github.com/Kong/kong/blob/master/CHANGELOG.md">0.13.0
Changelog</a> for a
complete list of changes and new features.</p>

<p>See below the breaking changes section for a detailed list of steps recommended
to <strong>run migrations</strong> and upgrade from a previous version of Kong.</p>

<h4 id="1-breaking-changes-4">1. Breaking Changes</h4>

<ul>
  <li><strong>Note to Docker users</strong>: The <code class="language-plaintext highlighter-rouge">latest</code> tag on Docker Hub now points to the
<strong>alpine</strong> image instead of CentOS. This also applies to the <code class="language-plaintext highlighter-rouge">0.13.0</code> tag.</li>
</ul>

<h5 id="dependencies-4">Dependencies</h5>

<ul>
  <li>Support for Cassandra 2.1 was deprecated in 0.12.0 and has been dropped
starting with 0.13.0.</li>
  <li>Various dependencies have been bumped. Once again, consult the Changelog for
a detailed list.</li>
</ul>

<h5 id="configuration-4">Configuration</h5>

<ul>
  <li>The <code class="language-plaintext highlighter-rouge">proxy_listen</code> and <code class="language-plaintext highlighter-rouge">admin_listen</code> configuration values have a new syntax.
See the configuration file or the <a href="https://getkong.org/docs/0.13.x/configuration/">0.13.x
documentation</a> for insights
on the new syntax.</li>
  <li>The nginx configuration file has changed, which means that you need to update
it if you are using a custom template. The changes are detailed in a diff
included below.</li>
</ul>

<details>
<summary><strong>Click here to see the nginx configuration changes</strong></summary>
<p>

```diff
diff --git a/kong/templates/nginx_kong.lua b/kong/templates/nginx_kong.lua
index 5639f319..62f5f1ae 100644
--- a/kong/templates/nginx_kong.lua
+++ b/kong/templates/nginx_kong.lua
@@ -51,6 +51,8 @@ init_worker_by_lua_block {
     kong.init_worker()
 }

+
+&gt; if #proxy_listeners &gt; 0 then
 upstream kong_upstream {
     server 0.0.0.1;
     balancer_by_lua_block {
@@ -61,7 +63,9 @@ upstream kong_upstream {

 server {
     server_name kong;
-    listen $$;
+&gt; for i = 1, #proxy_listeners do
+    listen $(proxy_listeners[i].listener);
+&gt; end
     error_page 400 404 408 411 412 413 414 417 /kong_error_handler;
     error_page 500 502 503 504 /kong_error_handler;

@@ -70,8 +74,7 @@ server {

     client_body_buffer_size $;

-&gt; if ssl then
-    listen $ ssl$$;
+&gt; if proxy_ssl_enabled then
     ssl_certificate $;
     ssl_certificate_key $;
     ssl_protocols TLSv1.1 TLSv1.2;
@@ -149,10 +152,14 @@ server {
         }
     }
 }
+&gt; end

+&gt; if #admin_listeners &gt; 0 then
 server {
     server_name kong_admin;
-    listen $;
+&gt; for i = 1, #admin_listeners do
+    listen $(admin_listeners[i].listener);
+&gt; end

     access_log $;
     error_log $ $;
@@ -160,8 +167,7 @@ server {
     client_max_body_size 10m;
     client_body_buffer_size 10m;

-&gt; if admin_ssl then
-    listen $ ssl$;
+&gt; if admin_ssl_enabled then
     ssl_certificate $;
     ssl_certificate_key $;
     ssl_protocols TLSv1.1 TLSv1.2;
@@ -189,4 +195,5 @@ server {
         return 200 'User-agent: *\nDisallow: /';
     }
 }
+&gt; end
```

</p>
</details>

<h5 id="plugins-4">Plugins</h5>

<ul>
  <li>The galileo plugin is considered deprecated and not enabled by default
anymore. It is still shipped with Kong 0.13.0, but you must enable it by
specifying it in the <code class="language-plaintext highlighter-rouge">custom_plugins</code> configuration property, like so:
<code class="language-plaintext highlighter-rouge">custom_plugins = galileo</code> (or via the <code class="language-plaintext highlighter-rouge">KONG_CUSTOM_PLUGINS</code> environment
variable).</li>
  <li>The migrations will remove and re-create the rate-limiting and
response-ratelimiting tables storing counters. This means that your counters
will reset.</li>
</ul>

<h4 id="2-deprecation-notices-3">2. Deprecation Notices</h4>

<p>Starting with 0.13.0, the “API” entity is considered <strong>deprecated</strong>. While
still supported, we will eventually remove the entity and its related endpoints
from the Admin API. Services and Routes are the new first-class citizen
entities that new users (or users upgrading their clusters) should configure.</p>

<p>You can read more about Services and Routes in the <a href="https://getkong.org/docs/0.13.x/proxy/">Proxy
Guide</a> and the <a href="https://getkong.org/docs/0.13.x/admin-api/">Admin API
Reference</a>.</p>

<h4 id="3-suggested-upgrade-path-9">3. Suggested Upgrade Path</h4>

<p>You can now start migrating your cluster from <code class="language-plaintext highlighter-rouge">0.12.x</code> to <code class="language-plaintext highlighter-rouge">0.13</code>. If you are
doing this upgrade “in-place”, against the datastore of a running 0.12 cluster,
then for a short period of time, your database schema won’t be fully compatible
with your 0.12 nodes anymore. This is why we suggest either performing this
upgrade when your 0.12 cluster is warm and most entities are cached, or against
a new database if you can migrate your data. If you wish to temporarily make
your APIs unavailable, you can leverage the
<a href="https://getkong.org/plugins/request-termination/">request-termination</a> plugin.</p>

<p>The path to upgrade a 0.12 datastore is identical to the one of previous major
releases:</p>

<ol>
  <li>If you are planning on upgrading Kong while 0.12 nodes are running against
the same datastore, make sure those nodes are warm enough (they should have
most of your entities cached already) or temporarily disable your APIs.</li>
  <li>Provision a 0.13 node and configure it as you wish (environment variables/
configuration file). Make sure to point this new 0.13 node to your current
datastore.</li>
  <li><strong>Without starting the 0.13 node</strong>, run the 0.13 migrations against your
current datastore:</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ kong migrations up [-c kong.conf]
</code></pre></div></div>

<p>As usual, this step should be executed from a <strong>single node</strong>.</p>

<ol>
  <li>You can now provision a fresh 0.13 cluster pointing to your migrated
datastore and start your 0.13 nodes.</li>
  <li>Gradually switch your traffic from the 0.12 cluster to the new 0.13 cluster.
Remember, once your database is migrated, your 0.12 nodes will rely on
their cache and not on the underlying database. Your traffic should switch
to the new cluster as quickly as possible.</li>
  <li>Once your traffic is fully migrated to the 0.13 cluster, decommission
your 0.12 cluster.</li>
</ol>

<p>You have now successfully upgraded your cluster to run 0.13 nodes exclusively.</p>

<h2 id="upgrade-to-012x">Upgrade to <code class="language-plaintext highlighter-rouge">0.12.x</code></h2>

<p>As it is the case most of the time, this new major version of Kong comes with
a few <strong>database migrations</strong>, some breaking changes, databases deprecation
notices, and minor updates to the NGINX configuration template.</p>

<p>This document will only highlight the breaking changes that you need to be
aware of, and describe a recommended upgrade path. We recommend that you
consult the full <a href="https://github.com/Kong/kong/blob/master/CHANGELOG.md">0.12.0
Changelog</a> for a
complete list of changes and new features.</p>

<p>See below the breaking changes section for a detailed list of steps recommended
to <strong>run migrations</strong> and upgrade from a previous version of Kong.</p>

<h4 id="deprecation-notices">Deprecation notices</h4>

<p>Starting with 0.12.0, we are announcing the deprecation of older versions
of our supported databases:</p>

<ul>
  <li>Support for PostgreSQL 9.4 is deprecated. Users are advised to upgrade to
9.5+</li>
  <li>Support for Cassandra 2.1 and below is deprecated. Users are advised to
upgrade to 2.2+</li>
</ul>

<p>Note that the above-deprecated versions are still supported in this release,
but will be dropped in subsequent ones.</p>

<h4 id="breaking-changes">Breaking changes</h4>

<h5 id="configuration-5">Configuration</h5>

<ul>
  <li>Several updates were made to the NGINX configuration template. If you are
using a custom template, you <strong>must</strong> apply those modifications. See below
for a list of changes to apply.</li>
</ul>

<h5 id="core-4">Core</h5>

<ul>
  <li>The required OpenResty version has been bumped to 1.11.2.5. If you
are installing Kong from one of our distribution packages, you are not
affected by this change.</li>
  <li>As Kong now executes subsequent plugins when a request is being
short-circuited (e.g. HTTP 401 responses from auth plugins), plugins that
run in the header or body filter phases will be run upon such responses
from the access phase. It is possible that some of these plugins (e.g. your
custom plugins) now run in scenarios where they were not previously expected
to run.</li>
</ul>

<h5 id="admin-api-4">Admin API</h5>

<ul>
  <li>
    <p>By default, the Admin API now only listens on the local interface.
We consider this change to be an improvement in the default security policy
of Kong. If you are already using Kong, and your Admin API still binds to all
interfaces, consider updating it as well. You can do so by updating the
<code class="language-plaintext highlighter-rouge">admin_listen</code> configuration value, like so: <code class="language-plaintext highlighter-rouge">admin_listen = 127.0.0.1:8001</code>.</p>

    <p>:red_circle: <strong>Note to Docker users</strong>: Beware of this change as you may have
to ensure that your Admin API is reachable via the host’s interface.
You can use the <code class="language-plaintext highlighter-rouge">-e KONG_ADMIN_LISTEN</code> argument when provisioning your
container(s) to update this value; for example,
<code class="language-plaintext highlighter-rouge">-e KONG_ADMIN_LISTEN=0.0.0.0:8001</code>.</p>
  </li>
  <li>The <code class="language-plaintext highlighter-rouge">/upstreams/:upstream_name_or_id/targets/</code> has been updated to not show
the full list of Targets anymore, but only the ones that are currently
active in the load balancer. To retrieve the full history of Targets, you can
now query <code class="language-plaintext highlighter-rouge">/upstreams/:upstream_name_or_id/targets/all</code>. The
<code class="language-plaintext highlighter-rouge">/upstreams/:upstream_name_or_id/targets/active</code> endpoint has been removed.</li>
  <li>The <code class="language-plaintext highlighter-rouge">orderlist</code> property of Upstreams has been removed.</li>
</ul>

<h5 id="cli">CLI</h5>

<ul>
  <li>The <code class="language-plaintext highlighter-rouge">$ kong compile</code> command which was deprecated in 0.11.0 has been removed.</li>
</ul>

<h5 id="plugins-5">Plugins</h5>

<ul>
  <li>In logging plugins, the <code class="language-plaintext highlighter-rouge">request.request_uri</code> field has been renamed to
<code class="language-plaintext highlighter-rouge">request.url</code>.</li>
</ul>

<hr />

<p>If you use a custom NGINX configuration template from Kong 0.11, before
attempting to run any 0.12 node, make sure to apply the following change to
your template:</p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gh">diff --git a/kong/templates/nginx_kong.lua b/kong/templates/nginx_kong.lua
index 5ab65ca3..8a6abd64 100644
</span><span class="gd">--- a/kong/templates/nginx_kong.lua
</span><span class="gi">+++ b/kong/templates/nginx_kong.lua
</span><span class="p">@@ -32,6 +32,7 @@</span> lua_shared_dict kong                5m;
 lua_shared_dict kong_cache          $;
 lua_shared_dict kong_process_events 5m;
 lua_shared_dict kong_cluster_events 5m;
<span class="gi">+lua_shared_dict kong_healthchecks   5m;
</span> &gt; if database == "cassandra" then
 lua_shared_dict kong_cassandra      5m;
 &gt; end
</code></pre></div></div>

<hr />

<p>You can now start migrating your cluster from <code class="language-plaintext highlighter-rouge">0.11.x</code> to <code class="language-plaintext highlighter-rouge">0.12</code>. If you are
doing this upgrade “in-place”, against the datastore of a running 0.11 cluster,
then for a short period of time, your database schema won’t be fully compatible
with your 0.11 nodes anymore. This is why we suggest either performing this
upgrade when your 0.11 cluster is warm and most entities are cached, or against
a new database, if you can migrate your data. If you wish to temporarily make
your APIs unavailable, you can leverage the
<a href="https://getkong.org/plugins/request-termination/">request-termination</a> plugin.</p>

<p>The path to upgrade a 0.11 datastore is identical to the one of previous major
releases:</p>

<ol>
  <li>If you are planning on upgrading Kong while 0.11 nodes are running against
the same datastore, make sure those nodes are warm enough (they should have
most of your entities cached already), or temporarily disable your APIs.</li>
  <li>Provision a 0.12 node and configure it as you wish (environment variables/
configuration file). Make sure to point this new 0.12 node to your current
datastore.</li>
  <li><strong>Without starting the 0.12 node</strong>, run the 0.12 migrations against your
current datastore:</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ kong migrations up [-c kong.conf]
</code></pre></div></div>

<p>As usual, this step should be executed from a <strong>single node</strong>.</p>

<ol>
  <li>You can now provision a fresh 0.12 cluster pointing to your migrated
datastore and start your 0.12 nodes.</li>
  <li>Gradually switch your traffic from the 0.11 cluster to the new 0.12 cluster.
Remember, once your database is migrated, your 0.11 nodes will rely on
their cache and not on the underlying database. Your traffic should switch
to the new cluster as quickly as possible.</li>
  <li>Once your traffic is fully migrated to the 0.12 cluster, decommission
your 0.11 cluster.</li>
</ol>

<p>You have now successfully upgraded your cluster to run 0.12 nodes exclusively.</p>

<h2 id="upgrade-to-011x">Upgrade to <code class="language-plaintext highlighter-rouge">0.11.x</code></h2>

<p>Along with the usual database migrations shipped with our major releases, this
particular release introduces quite a few changes in behavior and, most
notably, the enforced manual migrations process and the removal of the Serf
dependency for cache invalidation between Kong nodes of the same cluster.</p>

<p>This document will only highlight the breaking changes that you need to be
aware of, and describe a recommended upgrade path. We recommend that you
consult the full <a href="https://github.com/Kong/kong/blob/master/CHANGELOG.md">0.11.0
Changelog</a> for a
complete list of changes and new features.</p>

<h4 id="breaking-changes-1">Breaking changes</h4>

<h5 id="configuration-6">Configuration</h5>

<ul>
  <li>Several updates were made to the Nginx configuration template. If you are
using a custom template, you <strong>must</strong> apply those modifications. See below
for a list of changes to apply.</li>
</ul>

<h5 id="migrations--deployment">Migrations &amp; Deployment</h5>

<ul>
  <li>Migrations are <strong>not</strong> executed automatically by <code class="language-plaintext highlighter-rouge">kong start</code> anymore.
Migrations are now a <strong>manual</strong> process, which must be executed via the <code class="language-plaintext highlighter-rouge">kong
migrations</code> command. In practice, this means that you have to run <code class="language-plaintext highlighter-rouge">kong
migrations up [-c kong.conf]</code> in one of your nodes <strong>before</strong> starting your
Kong nodes. This command should be run from a <strong>single</strong> node/container to
avoid several nodes running migrations concurrently and potentially
corrupting your database. Once the migrations are up-to-date, it is
considered safe to start multiple Kong nodes concurrently.</li>
  <li>Serf is <strong>not</strong> a dependency anymore. Kong nodes now handle cache
invalidation events via a built-in database polling mechanism. See the new
“Datastore Cache” section of the configuration file which contains 3 new
documented properties: <code class="language-plaintext highlighter-rouge">db_update_frequency</code>, <code class="language-plaintext highlighter-rouge">db_update_propagation</code>, and
<code class="language-plaintext highlighter-rouge">db_cache_ttl</code>.  If you are using Cassandra, you <strong>should</strong> pay a particular
attention to the <code class="language-plaintext highlighter-rouge">db_update_propagation</code> setting, as you <strong>should not</strong> use
the default value of <code class="language-plaintext highlighter-rouge">0</code>.</li>
</ul>

<p><strong>Note for Docker users:</strong> Because of the aforementioned breaking change, if
you are running Kong with Docker, you will now need to run the migrations from
a single, ephemeral container. You can follow the <a href="https://getkong.org/install/docker/">Docker installation
instructions</a> (see “2. Prepare your
database”) for more details about this process.</p>

<h5 id="core-5">Core</h5>

<ul>
  <li>Kong now requires OpenResty <code class="language-plaintext highlighter-rouge">1.11.2.4</code>. OpenResty’s LuaJIT can now be built
with Lua 5.2 compatibility, and the <code class="language-plaintext highlighter-rouge">--without-luajit-lua52</code> flag can be
omitted.</li>
  <li>While Kong now correctly proxies downstream <code class="language-plaintext highlighter-rouge">X-Forwarded-*</code> headers, the
introduction of the new <code class="language-plaintext highlighter-rouge">trusted_ips</code> property also means that Kong will
only do so when the request comes from a trusted client IP. This is also
the condition under which the <code class="language-plaintext highlighter-rouge">X-Real-IP</code> header will be trusted by Kong
or not.
In order to enforce security best practices, we took the stance of <strong>not</strong>
trusting any client IP by default. If you wish to rely on such headers, you
will need to configure <code class="language-plaintext highlighter-rouge">trusted_ips</code> (see the Kong configuration file) to
your needs.</li>
  <li>The API Object property <code class="language-plaintext highlighter-rouge">http_if_terminated</code> is now set to <code class="language-plaintext highlighter-rouge">false</code> by
default. For Kong to evaluate the client <code class="language-plaintext highlighter-rouge">X-Forwarded-Proto</code> header, you must
now configure Kong to trust the client IP (see above change), <strong>and</strong> you
must explicitly set this value to <code class="language-plaintext highlighter-rouge">true</code>. This affects you if you are doing
SSL termination somewhere before your requests hit Kong, and if you have
configured <code class="language-plaintext highlighter-rouge">https_only</code> on the API, or if you use a plugin that requires
HTTPS traffic (e.g. OAuth2).</li>
  <li>The internal DNS resolver now honours the <code class="language-plaintext highlighter-rouge">search</code> and <code class="language-plaintext highlighter-rouge">ndots</code> configuration
options of your <code class="language-plaintext highlighter-rouge">resolv.conf</code> file. Make sure that DNS resolution is still
consistent in your environment, and consider eventually not using FQDNs
anymore.</li>
</ul>

<h5 id="admin-api-5">Admin API</h5>

<ul>
  <li>Due to the removal of Serf, Kong is now entirely stateless. As such, the
<code class="language-plaintext highlighter-rouge">/cluster</code> endpoint has for now disappeared. This endpoint, in previous
versions of Kong, retrieved the state of the Serf agent running on other
nodes to ensure they were part of the same cluster. Starting from 0.11, all
Kong nodes connected to the same datastore are guaranteed to be part of the
same cluster without requiring additional channels of communication.</li>
  <li>The Admin API <code class="language-plaintext highlighter-rouge">/status</code> endpoint does not return a count of the database
entities anymore. Instead, it now returns a <code class="language-plaintext highlighter-rouge">database.reachable</code> boolean
value, which reflects the state of the connection between Kong and the
underlying database. Please note that this flag <strong>does not</strong> reflect the
health of the database itself.</li>
</ul>

<h5 id="plugins-development">Plugins development</h5>

<ul>
  <li>The upstream URI is now determined via the Nginx <code class="language-plaintext highlighter-rouge">$upstream_uri</code> variable.
Custom plugins using the <code class="language-plaintext highlighter-rouge">ngx.req.set_uri()</code> API will not be taken into
consideration anymore. One must now set the <code class="language-plaintext highlighter-rouge">ngx.var.upstream_uri</code> variable
from the Lua land.</li>
  <li>The <code class="language-plaintext highlighter-rouge">hooks.lua</code> module for custom plugins is dropped, along with the
<code class="language-plaintext highlighter-rouge">database_cache.lua</code> module. Database entities caching and eviction has been
greatly improved to simplify and automate most caching use-cases. See the
<a href="https://getkong.org/docs/0.11.x/plugin-development/entities-cache/">plugins development
guide</a>
for more details about the new underlying mechanism, or see the below
section of this document on how to update your plugin’s cache invalidation
mechanism for 0.11.0.</li>
  <li>To ensure that the order of execution of plugins is still the same for
vanilla Kong installations, we had to update the <code class="language-plaintext highlighter-rouge">PRIORITY</code> field of some of
our bundled plugins. If your custom plugin must run after or before a
specific bundled plugin, you might have to update your plugin’s <code class="language-plaintext highlighter-rouge">PRIORITY</code>
field as well. The complete list of plugins and their priorities is available
on the <a href="https://getkong.org/docs/0.11.x/plugin-development/custom-logic/">plugins development
guide</a>.</li>
</ul>

<h4 id="deprecations">Deprecations</h4>

<h5 id="cli-1">CLI</h5>

<ul>
  <li>The <code class="language-plaintext highlighter-rouge">kong compile</code> command has been deprecated. Instead, prefer using
the new <code class="language-plaintext highlighter-rouge">kong prepare</code> command.</li>
</ul>

<hr />

<p>If you use a custom Nginx configuration template from Kong 0.10, before
attempting to run any 0.11 node, make sure to apply the following changes to
your template:</p>

<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gh">diff --git a/kong/templates/nginx_kong.lua b/kong/templates/nginx_kong.lua
index 3c038595..faa97ffe 100644
</span><span class="gd">--- a/kong/templates/nginx_kong.lua
</span><span class="gi">+++ b/kong/templates/nginx_kong.lua
</span><span class="p">@@ -19,25 +19,23 @@</span> error_log $ $;
 &gt;-- reset_timedout_connection on; # disabled until benchmarked
 &gt; end

-client_max_body_size 0;
<span class="gi">+client_max_body_size $;
</span> proxy_ssl_server_name on;
 underscores_in_headers on;

-real_ip_header X-Forwarded-For;
<span class="gd">-set_real_ip_from 0.0.0.0/0;
-real_ip_recursive on;
-
</span> lua_package_path '$;;';
 lua_package_cpath '$;;';
 lua_code_cache $;
 lua_socket_pool_size $;
 lua_max_running_timers 4096;
 lua_max_pending_timers 16384;
<span class="gd">-lua_shared_dict kong 4m;
-lua_shared_dict cache $;
-lua_shared_dict cache_locks 100k;
-lua_shared_dict process_events 1m;
-lua_shared_dict cassandra 5m;
</span><span class="gi">+lua_shared_dict kong                5m;
+lua_shared_dict kong_cache          $;
+lua_shared_dict kong_process_events 5m;
+lua_shared_dict kong_cluster_events 5m;
+&gt; if database == "cassandra" then
+lua_shared_dict kong_cassandra      5m;
+&gt; end
</span> lua_socket_log_errors off;
 &gt; if lua_ssl_trusted_certificate then
 lua_ssl_trusted_certificate '$';
<span class="p">@@ -45,8 +43,6 @@</span> lua_ssl_verify_depth $;
 &gt; end

 init_by_lua_block {
<span class="gd">-    require 'luarocks.loader'
-    require 'resty.core'
</span>     kong = require 'kong'
     kong.init()
 }
<span class="p">@@ -65,28 +61,19 @@</span> upstream kong_upstream {
     keepalive $;
 }

-map $http_upgrade $upstream_connection {
<span class="gd">-    default keep-alive;
-    websocket upgrade;
-}
-
-map $http_upgrade $upstream_upgrade {
-    default '';
-    websocket websocket;
-}
-
</span> server {
     server_name kong;
<span class="gd">-    listen $;
-    error_page 404 408 411 412 413 414 417 /kong_error_handler;
</span><span class="gi">+    listen $$;
+    error_page 400 404 408 411 412 413 414 417 /kong_error_handler;
</span>     error_page 500 502 503 504 /kong_error_handler;

     access_log $;
     error_log $ $;

+    client_body_buffer_size $;

 &gt; if ssl then
<span class="gd">-    listen $ ssl;
</span><span class="gi">+    listen $ ssl$$;
</span>     ssl_certificate $;
     ssl_certificate_key $;
     ssl_protocols TLSv1.1 TLSv1.2;
<span class="p">@@ -105,9 +92,22 @@</span> server {
     proxy_ssl_certificate_key $;
 &gt; end

+    real_ip_header     $;
<span class="gi">+    real_ip_recursive  $;
+&gt; for i = 1, #trusted_ips do
+    set_real_ip_from   $(trusted_ips[i]);
+&gt; end
+
</span>     location / {
<span class="gd">-        set $upstream_host nil;
-        set $upstream_scheme nil;
</span><span class="gi">+        set $upstream_host               '';
+        set $upstream_upgrade            '';
+        set $upstream_connection         '';
+        set $upstream_scheme             '';
+        set $upstream_uri                '';
+        set $upstream_x_forwarded_for    '';
+        set $upstream_x_forwarded_proto  '';
+        set $upstream_x_forwarded_host   '';
+        set $upstream_x_forwarded_port   '';
</span>
         rewrite_by_lua_block {
             kong.rewrite()
<span class="p">@@ -118,17 +118,18 @@</span> server {
         }

         proxy_http_version 1.1;
<span class="gd">-        proxy_set_header X-Real-IP $remote_addr;
-        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
-        proxy_set_header X-Forwarded-Proto $scheme;
-        proxy_set_header Host $upstream_host;
-        proxy_set_header Upgrade $upstream_upgrade;
-        proxy_set_header Connection $upstream_connection;
-        proxy_pass_header Server;
-
-        proxy_ssl_name $upstream_host;
-
-        proxy_pass $upstream_scheme://kong_upstream;
</span><span class="gi">+        proxy_set_header   Host              $upstream_host;
+        proxy_set_header   Upgrade           $upstream_upgrade;
+        proxy_set_header   Connection        $upstream_connection;
+        proxy_set_header   X-Forwarded-For   $upstream_x_forwarded_for;
+        proxy_set_header   X-Forwarded-Proto $upstream_x_forwarded_proto;
+        proxy_set_header   X-Forwarded-Host  $upstream_x_forwarded_host;
+        proxy_set_header   X-Forwarded-Port  $upstream_x_forwarded_port;
+        proxy_set_header   X-Real-IP         $remote_addr;
+        proxy_pass_header  Server;
+        proxy_pass_header  Date;
+        proxy_ssl_name     $upstream_host;
+        proxy_pass         $upstream_scheme://kong_upstream$upstream_uri;
</span>
         header_filter_by_lua_block {
             kong.header_filter()
<span class="p">@@ -146,7 +147,7 @@</span> server {
     location = /kong_error_handler {
         internal;
         content_by_lua_block {
<span class="gd">-            require('kong.core.error_handlers')(ngx)
</span><span class="gi">+            kong.handle_error()
</span>         }
     }
 }
<span class="p">@@ -162,7 +163,7 @@</span> server {
     client_body_buffer_size 10m;

 &gt; if admin_ssl then
<span class="gd">-    listen $ ssl;
</span><span class="gi">+    listen $ ssl$;
</span>     ssl_certificate $;
     ssl_certificate_key $;
     ssl_protocols TLSv1.1 TLSv1.2;
<span class="p">@@ -176,15 +177,7 @@</span> server {
     location / {
         default_type application/json;
         content_by_lua_block {
<span class="gd">-            ngx.header['Access-Control-Allow-Origin'] = '*'
-
-            if ngx.req.get_method() == 'OPTIONS' then
-                ngx.header['Access-Control-Allow-Methods'] = 'GET,HEAD,PUT,PATCH,POST,DELETE'
-                ngx.header['Access-Control-Allow-Headers'] = 'Content-Type'
-                ngx.exit(204)
-            end
-
-            require('lapis').serve('kong.api')
</span><span class="gi">+            kong.serve_admin_api()
</span>         }
     }
</code></pre></div></div>

<p>Once those changes have been applied, you will be able to benefit from the new
configuration properties and bug fixes that 0.11 introduces.</p>

<hr />

<p>If you are maintaining your own plugin, and if you are using the 0.10.x
<code class="language-plaintext highlighter-rouge">database_cache.lua</code> module to cache your datastore entities, you probably
included a <code class="language-plaintext highlighter-rouge">hooks.lua</code> module in your plugin as well.</p>

<p>In 0.11, most of the clutter surrounding cache invalidation is now gone, and
handled automatically by Kong for most use-cases.</p>

<ul>
  <li>The <code class="language-plaintext highlighter-rouge">hooks.lua</code> module is now ignored by Kong. You can safely remove it from
your plugins.</li>
  <li>The <code class="language-plaintext highlighter-rouge">database_cache.lua</code> module is replaced with <code class="language-plaintext highlighter-rouge">singletons.cache</code>. You
should not require <code class="language-plaintext highlighter-rouge">database_cache</code> anymore in your plugin’s code.</li>
</ul>

<p>To update your plugin’s caching mechanism to 0.11, you must implement automatic
or manual invalidation.</p>

<h5 id="automatic-cache-invalidation">Automatic cache invalidation</h5>

<p>Let’s assume your plugin had the following code that we wish to update for
0.11 compatibility:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">local</span> <span class="n">credential</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">cache</span><span class="p">.</span><span class="n">get_or_set</span><span class="p">(</span><span class="n">cache</span><span class="p">.</span><span class="n">keyauth_credential_key</span><span class="p">(</span><span class="n">key</span><span class="p">),</span>
                                         <span class="kc">nil</span><span class="p">,</span> <span class="n">load_credential</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
<span class="k">if</span> <span class="n">err</span> <span class="k">then</span>
  <span class="k">return</span> <span class="n">responses</span><span class="p">.</span><span class="n">send_HTTP_INTERNAL_SERVER_ERROR</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Along with the following <code class="language-plaintext highlighter-rouge">hooks.lua</code> file:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">local</span> <span class="n">events</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">"kong.core.events"</span>
<span class="kd">local</span> <span class="n">cache</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">"kong.tools.database_cache"</span>

<span class="kd">local</span> <span class="k">function</span> <span class="nf">invalidate</span><span class="p">(</span><span class="n">message_t</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">message_t</span><span class="p">.</span><span class="n">collection</span> <span class="o">==</span> <span class="s2">"keyauth_credentials"</span> <span class="k">then</span>
    <span class="n">cache</span><span class="p">.</span><span class="n">delete</span><span class="p">(</span><span class="n">cache</span><span class="p">.</span><span class="n">keyauth_credential_key</span><span class="p">(</span><span class="n">message_t</span><span class="p">.</span><span class="n">old_entity</span>     <span class="ow">and</span>
                                              <span class="n">message_t</span><span class="p">.</span><span class="n">old_entity</span><span class="p">.</span><span class="n">key</span> <span class="ow">or</span>
                                              <span class="n">message_t</span><span class="p">.</span><span class="n">entity</span><span class="p">.</span><span class="n">key</span><span class="p">))</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">return</span> <span class="p">{</span>
  <span class="p">[</span><span class="n">events</span><span class="p">.</span><span class="n">TYPES</span><span class="p">.</span><span class="n">ENTITY_UPDATED</span><span class="p">]</span> <span class="o">=</span> <span class="k">function</span><span class="p">(</span><span class="n">message_t</span><span class="p">)</span>
    <span class="n">invalidate</span><span class="p">(</span><span class="n">message_t</span><span class="p">)</span>
  <span class="k">end</span><span class="p">,</span>
  <span class="p">[</span><span class="n">events</span><span class="p">.</span><span class="n">TYPES</span><span class="p">.</span><span class="n">ENTITY_DELETED</span><span class="p">]</span> <span class="o">=</span> <span class="k">function</span><span class="p">(</span><span class="n">message_t</span><span class="p">)</span>
    <span class="n">invalidate</span><span class="p">(</span><span class="n">message_t</span><span class="p">)</span>
  <span class="k">end</span>
<span class="p">}</span>
</code></pre></div></div>

<p>By adding the following <code class="language-plaintext highlighter-rouge">cache_key</code> property to your custom entity’s schema:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">local</span> <span class="n">SCHEMA</span> <span class="o">=</span> <span class="p">{</span>
  <span class="n">primary_key</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">"id"</span> <span class="p">},</span>
  <span class="n">table</span> <span class="o">=</span> <span class="s2">"keyauth_credentials"</span><span class="p">,</span>
  <span class="n">cache_key</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">"key"</span> <span class="p">},</span> <span class="c1">-- cache key for this entity</span>
  <span class="n">fields</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">id</span> <span class="o">=</span> <span class="p">{</span> <span class="nb">type</span> <span class="o">=</span> <span class="s2">"id"</span> <span class="p">},</span>
    <span class="n">consumer_id</span> <span class="o">=</span> <span class="p">{</span> <span class="nb">type</span> <span class="o">=</span> <span class="s2">"id"</span><span class="p">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span> <span class="n">foreign</span> <span class="o">=</span> <span class="s2">"consumers:id"</span><span class="p">},</span>
    <span class="n">key</span> <span class="o">=</span> <span class="p">{</span> <span class="nb">type</span> <span class="o">=</span> <span class="s2">"string"</span><span class="p">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span> <span class="n">unique</span> <span class="o">=</span> <span class="kc">true</span> <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">return</span> <span class="p">{</span> <span class="n">keyauth_credentials</span> <span class="o">=</span> <span class="n">SCHEMA</span> <span class="p">}</span>
</code></pre></div></div>

<p>You can now generate a unique cache key for that entity and cache it like so
in your business logic and hot code paths:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">local</span> <span class="n">singletons</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">"kong.singletons"</span>

<span class="kd">local</span> <span class="n">apikey</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">get_uri_args</span><span class="p">().</span><span class="n">apikey</span>
<span class="kd">local</span> <span class="n">cache_key</span> <span class="o">=</span> <span class="n">singletons</span><span class="p">.</span><span class="n">dao</span><span class="p">.</span><span class="n">keyauth_credentials</span><span class="p">:</span><span class="n">cache_key</span><span class="p">(</span><span class="n">apikey</span><span class="p">)</span>

<span class="kd">local</span> <span class="n">credential</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">singletons</span><span class="p">.</span><span class="n">cache</span><span class="p">:</span><span class="n">get</span><span class="p">(</span><span class="n">cache_key</span><span class="p">,</span> <span class="kc">nil</span><span class="p">,</span> <span class="n">load_entity_key</span><span class="p">,</span>
                                             <span class="n">apikey</span><span class="p">)</span>
<span class="k">if</span> <span class="n">err</span> <span class="k">then</span>
  <span class="k">return</span> <span class="n">response</span><span class="p">.</span><span class="n">HTTP_INTERNAL_SERVER_ERROR</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
<span class="k">end</span>

<span class="c1">-- do something with the retrieved credential</span>
</code></pre></div></div>

<p>Now, cache invalidation will be an automatic process: every CRUD operation that
affects this API key will make Kong auto-generate the affected <code class="language-plaintext highlighter-rouge">cache_key</code>,
and send broadcast it to all of the other nodes on the cluster so they can
evict that particular value from their cache, and fetch the fresh value from
the datastore on the next request.</p>

<p>When a parent entity is receiving a CRUD operation (e.g. the Consumer owning
this API key, as per our schema’s <code class="language-plaintext highlighter-rouge">consumer_id</code> attribute), Kong performs the
cache invalidation mechanism for both the parent and the child entity.</p>

<p>Thanks to this new property, the <code class="language-plaintext highlighter-rouge">hooks.lua</code> module is not required anymore and
your plugins can perform datastore caching much more easily.</p>

<h5 id="manual-cache-invalidation">Manual cache invalidation</h5>

<p>In some cases, the <code class="language-plaintext highlighter-rouge">cache_key</code> property of an entity’s schema is not flexible
enough, and one must manually invalidate its cache. Reasons for this could be
that the plugin is not defining a relationship with another entity via the
traditional <code class="language-plaintext highlighter-rouge">foreign = "parent_entity:parent_attribute"</code> syntax, or because
it is not using the <code class="language-plaintext highlighter-rouge">cache_key</code> method from its DAO, or even because it is
somehow abusing the caching mechanism.</p>

<p>In those cases, you can manually set up your own subscriber to the same
invalidation channels Kong is listening to, and perform your own, custom
invalidation work. This process is similar to the old <code class="language-plaintext highlighter-rouge">hooks.lua</code> module.</p>

<p>To listen on invalidation channels inside of Kong, implement the following in
your plugin’s <code class="language-plaintext highlighter-rouge">init_worker</code> handler:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">local</span> <span class="n">singletons</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">"kong.singletons"</span>

<span class="k">function</span> <span class="nf">MyCustomHandler</span><span class="p">:</span><span class="n">init_worker</span><span class="p">()</span>
  <span class="kd">local</span> <span class="n">worker_events</span> <span class="o">=</span> <span class="n">singletons</span><span class="p">.</span><span class="n">worker_events</span>

  <span class="c1">-- listen to all CRUD operations made on Consumers</span>
  <span class="n">worker_events</span><span class="p">.</span><span class="n">register</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

  <span class="k">end</span><span class="p">,</span> <span class="s2">"crud"</span><span class="p">,</span> <span class="s2">"consumers"</span><span class="p">)</span>

  <span class="c1">-- or, listen to a specific CRUD operation only</span>
  <span class="n">worker_events</span><span class="p">.</span><span class="n">register</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">operation</span><span class="p">)</span>  <span class="c1">-- "update"</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">old_entity</span><span class="p">)</span> <span class="c1">-- old entity table (only for "update")</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">entity</span><span class="p">)</span>     <span class="c1">-- new entity table</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">schema</span><span class="p">)</span>     <span class="c1">-- entity's schema</span>
  <span class="k">end</span><span class="p">,</span> <span class="s2">"crud"</span><span class="p">,</span> <span class="s2">"consumers:update"</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Once the above listeners are in place for the desired entities, you can perform
manual invalidations of any entity that your plugin has cached as you wish so.
For instance:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">singletons</span><span class="p">.</span><span class="n">worker_events</span><span class="p">.</span><span class="n">register</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">data</span><span class="p">.</span><span class="n">operation</span> <span class="o">==</span> <span class="s2">"delete"</span> <span class="k">then</span>
    <span class="kd">local</span> <span class="n">cache_key</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">entity</span><span class="p">.</span><span class="n">id</span>
    <span class="n">singletons</span><span class="p">.</span><span class="n">cache</span><span class="p">:</span><span class="n">invalidate</span><span class="p">(</span><span class="s2">"prefix:"</span> <span class="o">..</span> <span class="n">cache_key</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span><span class="p">,</span> <span class="s2">"crud"</span><span class="p">,</span> <span class="s2">"consumers"</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<p>You can now start migrating your cluster from <code class="language-plaintext highlighter-rouge">0.10.x</code> to <code class="language-plaintext highlighter-rouge">0.11</code>. If you are
doing this upgrade “in-place”, against the datastore of a running 0.10 cluster,
then for a short period of time, your database schema won’t be fully compatible
with your 0.10 nodes anymore. This is why we suggest either performing this
upgrade when your 0.10 cluster is warm and most entities are cached, or against
a new database, if you can migrate your data. If you wish to temporarily make
your APIs unavailable, you can leverage the new
<a href="https://getkong.org/plugins/request-termination/">request-termination</a> plugin.</p>

<p>The path to upgrade a 0.10 datastore is identical to the one of previous major
releases:</p>

<ol>
  <li>If you are planning on upgrading Kong while 0.10 nodes are running against
the same datastore, make sure those nodes are warm enough (they should have
most of your entities cached already), or temporarily disable your APIs.</li>
  <li>Provision a 0.11 node and configure it as you wish (environment variables/
configuration file). Make sure to point this new 0.11 node to your current
datastore.</li>
  <li><strong>Without starting the 0.11 node</strong>, run the 0.11 migrations against your
current datastore:</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ kong migrations up [-c kong.conf]
</code></pre></div></div>

<p>As usual, this step should be executed from a <strong>single node</strong>.</p>

<ol>
  <li>You can now provision a fresh 0.11 cluster pointing to your migrated
datastore and start your 0.11 nodes.</li>
  <li>Gradually switch your traffic from the 0.10 cluster to the new 0.11 cluster.
Remember, once your database is migrated, your 0.10 nodes will rely on
their cache and not on the underlying database. Your traffic should switch
to the new cluster as quickly as possible.</li>
  <li>Once your traffic is fully migrated to the 0.11 cluster, decommission
your 0.10 cluster.</li>
</ol>

<p>Once all of your 0.10 nodes are fully decommissioned, you can consider removing
the Serf executable from your environment as well, since Kong 0.11 does not
depend on it anymore.</p>

<h2 id="upgrade-to-010x">Upgrade to <code class="language-plaintext highlighter-rouge">0.10.x</code></h2>

<p>Due to the breaking changes introduced in this version, we recommend that you
carefully test your cluster deployment.</p>

<p>Kong 0.10 introduced the following breaking changes:</p>

<ul>
  <li>API Objects (as configured via the Admin API) do <strong>not</strong> support the
<code class="language-plaintext highlighter-rouge">request_host</code> and <code class="language-plaintext highlighter-rouge">request_uri</code> fields anymore. The 0.10 migrations should
upgrade your current API Objects, but make sure to read the new <a href="https://getkong.org/docs/0.10.x/proxy">0.10 Proxy
Guide</a> to learn the new routing
capabilities of Kong. This means that Kong can now route incoming requests
according to a combination of Host headers, URIs, and HTTP
methods.</li>
  <li>The <code class="language-plaintext highlighter-rouge">upstream_url</code> field of API Objects does not accept trailing slashes anymore.</li>
  <li>Dynamic SSL certificates serving is now handled by the core and <strong>not</strong>
through the <code class="language-plaintext highlighter-rouge">ssl</code> plugin anymore. This version introduced the <code class="language-plaintext highlighter-rouge">/certificates</code>
and <code class="language-plaintext highlighter-rouge">/snis</code> endpoints. See the new <a href="https://getkong.org/docs/0.10.x/proxy">0.10 Proxy
Guide</a> to learn more about how to
configure your SSL certificates on your APIs. The <code class="language-plaintext highlighter-rouge">ssl</code> plugin has been
removed.</li>
  <li>The preferred version of OpenResty is now <code class="language-plaintext highlighter-rouge">1.11.2.2</code>. However, this version
requires that you compiled OpenResty with the <code class="language-plaintext highlighter-rouge">--without-luajit-lua52</code> flag.
Make sure to do so if you install OpenResty and Kong from source.</li>
  <li>Dnsmasq is not a dependency anymore (However, be careful before removing it
if you configured it to be your DNS name server via Kong’s <a href="https://getkong.org/docs/0.9.x/configuration/#dns-resolver-section"><code class="language-plaintext highlighter-rouge">resolver</code>
property</a>)</li>
  <li>The <code class="language-plaintext highlighter-rouge">cassandra_contact_points</code> property does not allow specifying a port
anymore. All Cassandra nodes must listen on the same port, which can be
tweaked via the <code class="language-plaintext highlighter-rouge">cassandra_port</code> property.</li>
  <li>If you are upgrading to <code class="language-plaintext highlighter-rouge">0.10.1</code> or <code class="language-plaintext highlighter-rouge">0.10.2</code> and using the CORS plugin, pay
extra attention to a regression that was introduced in <code class="language-plaintext highlighter-rouge">0.10.1</code>:
Previously, the plugin would send the <code class="language-plaintext highlighter-rouge">*</code> wildcard when <code class="language-plaintext highlighter-rouge">config.origin</code> was
not specified. With this change, the plugin <strong>does not</strong> send the <code class="language-plaintext highlighter-rouge">*</code>
wildcard by default anymore. You will need to specify it manually when
configuring the plugin, with <code class="language-plaintext highlighter-rouge">config.origins=*</code>. This behavior is to be fixed
in a future release.</li>
</ul>

<p>We recommend that you consult the full <a href="https://github.com/Kong/kong/blob/master/CHANGELOG.md">0.10.0
Changelog</a> for a full
list of changes and new features, including load balancing capabilities,
support for Cassandra 3.x, SRV records resolution, and much more.</p>

<p>Here is how to ensure a smooth upgrade from a Kong <code class="language-plaintext highlighter-rouge">0.9.x</code> cluster to <code class="language-plaintext highlighter-rouge">0.10</code>:</p>

<ol>
  <li>Make sure your 0.9 cluster is warm because your
datastore will be incompatible with your 0.9 Kong nodes once migrated.
Most of your entities should be cached
by the running Kong nodes already (APIs, Consumers, Plugins).</li>
  <li>Provision a 0.10 node and configure it as you wish (environment variables/
configuration file). Make sure to point this new 0.10 node to your current
datastore.</li>
  <li><strong>Without starting the 0.10 node</strong>, run the 0.10 migrations against your
current datastore:</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ kong migrations up &lt;-c kong.conf&gt;
</code></pre></div></div>

<p>As usual, this step should be executed from a single node.</p>

<ol>
  <li>You can now provision a fresh 0.10 cluster pointing to your migrated
datastore and start your 0.10 nodes.</li>
  <li>Gradually switch your traffic from the 0.9 cluster to the new 0.10 cluster.
Remember, once your database is migrated, your 0.9 nodes will rely on
their cache and not on the underlying database. Your traffic should switch
to the new cluster as quickly as possible.</li>
  <li>Once your traffic is fully migrated to the 0.10 cluster, decommission
your 0.9 cluster.</li>
</ol>

<h2 id="upgrade-to-09x">Upgrade to <code class="language-plaintext highlighter-rouge">0.9.x</code></h2>

<p>PostgreSQL is the new default datastore for Kong. If you were using Cassandra
and you are upgrading, you must explicitly set <code class="language-plaintext highlighter-rouge">cassandra</code> as your <code class="language-plaintext highlighter-rouge">database</code>.</p>

<p>This release introduces a new CLI, which uses the
<a href="https://github.com/openresty/resty-cli">lua-resty-cli</a> interpreter. As such,
the <code class="language-plaintext highlighter-rouge">resty</code> executable (shipped in the OpenResty bundle) must be available in
your <code class="language-plaintext highlighter-rouge">$PATH</code>. Additionally, the <code class="language-plaintext highlighter-rouge">bin/kong</code> executable is not installed through
Luarocks anymore, and must be placed in your <code class="language-plaintext highlighter-rouge">$PATH</code> as well. This change of
behavior is taken care of if you are using one of the official Kong packages.</p>

<p>Once Kong updated, familiarize yourself with its new configuration format, and
consider setting some of its properties via environment variables if the need
arises. This behavior, as well as all available settings, are documented in the
<code class="language-plaintext highlighter-rouge">kong.conf.default</code> file shipped with this version.</p>

<p>Once your nodes configured, we recommend that you seemingly redirect your
traffic through the new Kong 0.9 nodes before decommissioning your old nodes.</p>

<h2 id="upgrade-to-08x">Upgrade to <code class="language-plaintext highlighter-rouge">0.8.x</code></h2>

<p>No important breaking changes for this release, just be careful to not use the
long deprecated routes <code class="language-plaintext highlighter-rouge">/consumers/:consumer/keyauth/</code> and
<code class="language-plaintext highlighter-rouge">/consumers/:consumer/basicauth/</code> as instructed in the Changelog. As always,
also make sure to check the configuration file for new properties (this release
allows you to configure the read/write consistency of Cassandra).</p>

<p>Let’s talk about <strong>PostgreSQL</strong>. To use it instead of Cassandra, follow those
steps:</p>

<ul>
  <li>Get your hands on a 9.4+ server (being compatible with Postgres 9.4 allows
you to use <a href="https://aws.amazon.com/rds/">Amazon RDS</a>)</li>
  <li>Create a database, (maybe a user too?), let’s say <code class="language-plaintext highlighter-rouge">kong</code></li>
  <li>Update your Kong configuration:</li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># as always, be careful about your YAML formatting</span>
<span class="na">database</span><span class="pi">:</span> <span class="s">postgres</span>
<span class="na">postgres</span><span class="pi">:</span>
  <span class="na">host</span><span class="pi">:</span> <span class="s2">"</span><span class="s">127.0.0.1"</span>
  <span class="na">port</span><span class="pi">:</span> <span class="m">5432</span>
  <span class="na">user</span><span class="pi">:</span> <span class="s">kong</span>
  <span class="na">password</span><span class="pi">:</span> <span class="s">kong</span>
  <span class="na">database</span><span class="pi">:</span> <span class="s">kong</span>
</code></pre></div></div>

<p>As usual, migrations should run from kong start, but as a reminder and just in
case, here are some tips:</p>

<p>Reset the database with (careful, you’ll lose all data):</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ kong migrations reset --config kong.yml
</code></pre></div></div>

<p>Run the migrations manually with:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ kong migrations up --config kong.yml
</code></pre></div></div>

<p>If needed, list your migrations for debug purposes with:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ kong migrations list --config kong.yml
</code></pre></div></div>

<p><strong>Note</strong>: This release does not provide a mean to migrate from Cassandra to
PostgreSQL. Additionally, we recommend that you <strong>do not</strong> use <code class="language-plaintext highlighter-rouge">kong reload</code> if
you switch your cluster from Cassandra to PostgreSQL. Instead, we recommend
that you migrate by spawning a new cluster and gradually redirect your traffic
before decommissioning your old nodes.</p>

<h2 id="upgrade-to-07x">Upgrade to <code class="language-plaintext highlighter-rouge">0.7.x</code></h2>

<p>If you are running a source installation, you will need to upgrade OpenResty to
its <code class="language-plaintext highlighter-rouge">1.9.7.*</code> version. The good news is that this family of releases does not
need to patch the NGINX core anymore to enable SSL support. If you install Kong
from one of the distribution packages, they already include the appropriate
OpenResty, simply download and install the appropriate package for your
platform.</p>

<p>As described in the Changelog, this upgrade has benefits, such as the SSL
support and fixes for critical NGINX vulnerabilities, but also requires that
you upgrade the <code class="language-plaintext highlighter-rouge">nginx</code> property of your Kong config because it is not
backwards compatible.</p>

<ul>
  <li>
    <p>We advise that you retrieve the <code class="language-plaintext highlighter-rouge">nginx</code> property from the <code class="language-plaintext highlighter-rouge">0.7.x</code>
configuration file, and use it in yours with the changes you feel are
appropriate.</p>
  </li>
  <li>
    <p>Finally, you can reload Kong as usual:</p>
  </li>
</ul>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kong reload <span class="o">[</span><span class="nt">-c</span> configuration_file]
</code></pre></div></div>

<p><strong>Note</strong>: We expose the underlying NGINX configuration as a way for Kong to be
as flexible as possible and allow you to bend your NGINX instance to your
needs. We are aware that many of you do not need to customize it and such
changes should not affect you. Plans are to embed the NGINX configuration in
Kong, while still allowing customization for the most demanding users.
<a href="https://github.com/Kong/kong/pull/217">#217</a> is the place to discuss this
and share thoughts/needs.</p>

<h2 id="upgrade-to-06x">Upgrade to <code class="language-plaintext highlighter-rouge">0.6.x</code></h2>

<p><strong>Note</strong>: if you are using Kong 0.4.x or earlier, you must first upgrade to
Kong 0.5.x.</p>

<p>The configuration file changed in this release. Make sure to check out the new
default one and update it to your needs. In particular, make sure that:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">plugins_available</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">key-auth</span>
  <span class="pi">-</span> <span class="s">...</span>
  <span class="pi">-</span> <span class="s">custom-plugin</span>
<span class="na">proxy_port</span><span class="pi">:</span> <span class="s">...</span>
<span class="na">proxy_ssl_port</span><span class="pi">:</span> <span class="s">...</span>
<span class="na">admin_api_port</span><span class="pi">:</span> <span class="s">...</span>
<span class="na">databases_available</span><span class="pi">:</span>
  <span class="na">cassandra</span><span class="pi">:</span>
    <span class="na">properties</span><span class="pi">:</span>
      <span class="na">contact_points</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">...</span>
</code></pre></div></div>

<p>becomes:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">custom_plugins</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">only-custom-plugins</span>
<span class="na">proxy_listen</span><span class="pi">:</span> <span class="s">...</span>
<span class="na">proxy_listen_ssl</span><span class="pi">:</span> <span class="s">...</span>
<span class="na">admin_api_listen</span><span class="pi">:</span> <span class="s">...</span>
<span class="na">cassandra</span><span class="pi">:</span>
  <span class="na">contact_points</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">...</span>
</code></pre></div></div>

<p>Secondly, if you installed Kong from source or maintain a development
installation, you will need to have <a href="https://www.serfdom.io">Serf</a> installed on
your system and available in your <code class="language-plaintext highlighter-rouge">$PATH</code>. Serf is included with all the
distribution packages and images available at
<a href="https://getkong.org/install/">getkong.org/install</a>.</p>

<p>The same way, this should already be the case but make sure that LuaJIT is in
your <code class="language-plaintext highlighter-rouge">$PATH</code> too as the CLI interpreter switched from Lua 5.1 to LuaJIT.
Distribution packages also include LuaJIT.</p>

<p>In order to start Kong with its new clustering and cache invalidation
capabilities, you will need to restart your node(s) (and not reload):</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kong restart <span class="o">[</span><span class="nt">-c</span> configuration_file]
</code></pre></div></div>

<p>Read more about the new clustering capabilities of Kong 0.6.0 and its
configurations in the <a href="https://getkong.org/docs/0.6.x/clustering/">Clustering
documentation</a>.</p>

<h2 id="upgrade-to-05x">Upgrade to <code class="language-plaintext highlighter-rouge">0.5.x</code></h2>

<p>Migrating to 0.5.x can be done <strong>without downtime</strong> by following those
instructions. It is important that you be running Kong <code class="language-plaintext highlighter-rouge">0.4.2</code> and have the
latest release of Python 2.7 on your system when executing those steps.</p>

<blockquote>
  <p>Several changes were introduced in this version: some plugins and properties
were renamed and the database schema slightly changed to introduce “plugins
migrations”. Now, each plugin can have its own migration if it needs to store
data in your cluster. This is not a regular migration since the schema of the
table handling the migrations itself changed.</p>
</blockquote>

<h5 id="1-configuration-file">1. Configuration file</h5>

<p>You will need to update your configuration file. Replace the
<code class="language-plaintext highlighter-rouge">plugins_available</code> values with:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">plugins_available</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">ssl</span>
  <span class="pi">-</span> <span class="s">jwt</span>
  <span class="pi">-</span> <span class="s">acl</span>
  <span class="pi">-</span> <span class="s">cors</span>
  <span class="pi">-</span> <span class="s">oauth2</span>
  <span class="pi">-</span> <span class="s">tcp-log</span>
  <span class="pi">-</span> <span class="s">udp-log</span>
  <span class="pi">-</span> <span class="s">file-log</span>
  <span class="pi">-</span> <span class="s">http-log</span>
  <span class="pi">-</span> <span class="s">key-auth</span>
  <span class="pi">-</span> <span class="s">hmac-auth</span>
  <span class="pi">-</span> <span class="s">basic-auth</span>
  <span class="pi">-</span> <span class="s">ip-restriction</span>
  <span class="pi">-</span> <span class="s">mashape-analytics</span>
  <span class="pi">-</span> <span class="s">request-transformer</span>
  <span class="pi">-</span> <span class="s">response-transformer</span>
  <span class="pi">-</span> <span class="s">request-size-limiting</span>
  <span class="pi">-</span> <span class="s">rate-limiting</span>
  <span class="pi">-</span> <span class="s">response-ratelimiting</span>
</code></pre></div></div>

<p>You can still remove plugins you don’t use for a lighter Kong.</p>

<p>Also replace the Cassandra <code class="language-plaintext highlighter-rouge">hosts</code> property with <code class="language-plaintext highlighter-rouge">contact_points</code>:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">properties</span><span class="pi">:</span>
  <span class="na">contact_points</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s2">"</span><span class="s">..."</span>
    <span class="pi">-</span> <span class="s2">"</span><span class="s">..."</span>
  <span class="na">timeout</span><span class="pi">:</span> <span class="m">1000</span>
  <span class="na">keyspace</span><span class="pi">:</span> <span class="s">kong</span>
  <span class="na">keepalive</span><span class="pi">:</span> <span class="m">60000</span>
</code></pre></div></div>

<h5 id="2-migration-script">2. Migration script</h5>

<p><a href="https://github.com/Kong/kong/blob/0.5.0/scripts/migration.py">This Python
script</a> will
take care of migrating your database schema should you execute the following
instructions:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># First, make sure you are already running Kong 0.4.2</span>

<span class="c"># Clone the Kong git repository if you don't already have it:</span>
<span class="nv">$ </span>git clone https://github.com/Kong/kong.git

<span class="c"># Go to the 'scripts/' folder:</span>
<span class="nv">$ </span><span class="nb">cd </span>kong/scripts

<span class="c"># Install the Python script dependencies:</span>
<span class="nv">$ </span>pip <span class="nb">install </span>cassandra-driver<span class="o">==</span>2.7.2 pyyaml

<span class="c"># The script will use the first Cassandra contact point in your Kong configuration file</span>
<span class="c"># (the first of the 'contact_points' property) so make sure it is valid and has the format 'host:port'.</span>

<span class="c"># Run the migration script:</span>
<span class="nv">$ </span>python migration.py <span class="nt">-c</span> /path/to/kong/config
</code></pre></div></div>

<p>If everything went well the script should print a success message. <strong>At this
point, your database is compatible with both Kong 0.4.2 and 0.5.x.</strong> If you are
running more than one Kong node, you simply have to follow step 3. for each one
of them now.</p>

<h5 id="3-upgrade-without-downtime">3. Upgrade without downtime</h5>

<p>You can now upgrade Kong to <code class="language-plaintext highlighter-rouge">0.5.x.</code> Proceed as a regular upgrade and follow
the suggested upgrade path, in particular, the <code class="language-plaintext highlighter-rouge">kong reload</code> command.</p>

<h5 id="4-purge-your-cassandra-cluster">4. Purge your Cassandra cluster</h5>

<p>Finally, once Kong has restarted in 0.5.x, run the migration script again, with
the <code class="language-plaintext highlighter-rouge">--purge</code> flag:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>python migration.py <span class="nt">-c</span> /path/to/kong/config <span class="nt">--purge</span>
</code></pre></div></div>

<p>Your cluster is now fully migrated to <code class="language-plaintext highlighter-rouge">0.5.x</code>.</p>

<h5 id="other-changes-to-acknowledge">Other changes to acknowledge</h5>

<p>Some entities and properties were renamed to avoid confusion:</p>

<ul>
  <li>Properties belonging to APIs entities have been renamed for clarity:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">public_dns</code> -&gt; <code class="language-plaintext highlighter-rouge">request_host</code></li>
      <li><code class="language-plaintext highlighter-rouge">path</code> -&gt; <code class="language-plaintext highlighter-rouge">request_path</code></li>
      <li><code class="language-plaintext highlighter-rouge">strip_path</code> -&gt; <code class="language-plaintext highlighter-rouge">strip_request_path</code></li>
      <li><code class="language-plaintext highlighter-rouge">target_url</code> -&gt; <code class="language-plaintext highlighter-rouge">upstream_url</code></li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">plugins_configurations</code> have been renamed to <code class="language-plaintext highlighter-rouge">plugins</code>, and their <code class="language-plaintext highlighter-rouge">value</code>
property has been renamed to <code class="language-plaintext highlighter-rouge">config</code> to avoid confusions.</li>
  <li>The Key authentication and Basic authentication plugins routes have changed:</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Old route                             New route
/consumers/:consumer/keyauth       -&gt; /consumers/:consumer/key-auth
/consumers/:consumer/keyauth/:id   -&gt; /consumers/:consumer/key-auth/:id
/consumers/:consumer/basicauth     -&gt; /consumers/:consumer/basic-auth
/consumers/:consumer/basicauth/:id -&gt; /consumers/:consumer/basic-auth/:id
</code></pre></div></div>

<p>The old routes are still maintained but will be removed in upcoming versions.
Consider them <strong>deprecated</strong>.</p>

<ul>
  <li>Admin API:
    <ul>
      <li>The route to retrieve enabled plugins is now under <code class="language-plaintext highlighter-rouge">/plugins/enabled</code>.</li>
      <li>The route to retrieve a plugin’s configuration schema is now under
<code class="language-plaintext highlighter-rouge">/plugins/schema/{plugin name}</code>.</li>
    </ul>
  </li>
</ul>

<h2 id="upgrade-to-kong-042">Upgrade to Kong <code class="language-plaintext highlighter-rouge">0.4.2</code></h2>

<p>The configuration format for specifying the port of your Cassandra instance
changed. Replace:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">cassandra</span><span class="pi">:</span>
  <span class="na">properties</span><span class="pi">:</span>
    <span class="na">hosts</span><span class="pi">:</span> <span class="s2">"</span><span class="s">localhost"</span>
    <span class="na">port</span><span class="pi">:</span> <span class="m">9042</span>
</code></pre></div></div>

<p>by:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">cassandra</span><span class="pi">:</span>
  <span class="na">properties</span><span class="pi">:</span>
    <span class="na">hosts</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">localhost:9042"</span>
</code></pre></div></div>

<h2 id="upgrade-to-03x">Upgrade to <code class="language-plaintext highlighter-rouge">0.3.x</code></h2>

<p>Kong now requires a patch on OpenResty for SSL support. On Homebrew you will
need to reinstall OpenResty.</p>

<h4 id="homebrew">Homebrew</h4>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>brew update
<span class="nv">$ </span>brew reinstall mashape/kong/ngx_openresty
<span class="nv">$ </span>brew upgrade kong
</code></pre></div></div>

<h4 id="troubleshoot">Troubleshoot</h4>

<p>If you are seeing a similar error on <code class="language-plaintext highlighter-rouge">kong start</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nginx: [error] [lua] init_by_lua:5: Startup error: Cassandra error: Failed to
prepare statement: "SELECT id FROM apis WHERE path = ?;". Cassandra returned
error (Invalid): "Undefined name path in where clause ('path = ?')"
</code></pre></div></div>

<p>You can run the following command to update your schema:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ kong migrations up
</code></pre></div></div>

<p>Please consider updating to <code class="language-plaintext highlighter-rouge">0.3.1</code> or greater which automatically handles the
schema migration.</p>


          
        </div>
      </div>
    </div>
  </div>
  <div id="scroll-to-top-button">
    <i class="fas fa-chevron-up"></i>
  </div>
  
  <div class="feedback-widget-container">
  <input id="feedback-widget-checkbox" type="checkbox">
  <label for="feedback-widget-checkbox">
    <i class="fas fa-thumbs-up"></i>
  </label>
  <div class="feedback-container">
    <div class="feedback-thankyou">
      Thank you for your feedback.
    </div>
    <div class="feedback-comment">
      <textarea id="feedback-comment-text" rows="3" placeholder="Please let us know what we can improve on this page..."></textarea>
      <div class="feedback-comment-buttons">
        <button id="feedback-comment-button-back">Back</button>
        <button id="feedback-comment-button-submit" class="button-primary">Submit</button>
      </div>
    </div>
    <div class="feedback-options">
      <div class="feedback-options-title">Was this page useful?</div>
      <div class="feedback-options-buttons">
        <i data-feedback-result="yes" class="feedback-options-button far fa-thumbs-up"></i>
        <i data-feedback-result="no" class="feedback-options-button far fa-thumbs-down"></i>
      </div>
    </div>
  </div>
</div>

  
</div>
<style>
  @media (max-width: 768px) {
    .algolia-docsearch-suggestion--subcategory-column{
      display: none !important;
    }
  }
</style>

<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>


<script type="text/javascript">
  docsearch({
    apiKey: '691286ef280379144076a4f8df47a1d1',
    indexName: 'getkong',
    inputSelector: '#getkong-algolia-search-input',
    algoliaOptions: {
      hitsPerPage: 5,
      'facetFilters': ["version: 2.1.x"]
    },
    // Override selected event to allow for local environment navigation
    handleSelected: function (input, event, suggestion) {
      input.setVal('');
      window.location.href = window.location.protocol + "//" + window.location.host + suggestion.url.split(
        "docs.konghq.com")[1]
    }
    // ,debug: true // Set debug to true if you want to inspect the dropdown
  });
</script>




<div id="image-modal" data-image-expand-disabled="">
  <div class="image-modal-backdrop"></div>
  <div class="image-container">
    <img src="" alt="image">
    <i class="fa fa-times"></i>
  </div>
</div>



    <footer class="marketing-footer--light-gray">
  <section>
    <ul class="newsletter">
      <li class="logo-wrapper">
        <div class="logo">
          <img src="/assets/images/KogoBlue.svg" alt="Kong" />
        </div>
        <h5>THE CLOUD CONNECTIVITY COMPANY</h5>
        <p>
          Kong powers reliable digital connections across APIs, hybrid and
          multi-cloud environments.
        </p>
        <div class="form">
          <iframe
            src="https://go.konghq.com/l/392112/2019-02-14/bhxq9c"
            width="100%"
            height="60"
            type="text/html"
            frameborder="0"
            allowTransparency="true"
            scrolling="no"
            style="overflow: hidden; border: 0"
          ></iframe>
        </div>
        <nav>
          <ul>
            <li>
              <a
                href="http://konghq.com/about-kong-inc/?itm_source=website&itm_medium=footer-nav"
                >Company</a
              >
            </li>
            <li>
              <a
                href="http://konghq.com/customers/?itm_source=website&itm_medium=footer-nav"
                >Customers</a
              >
            </li>

            <li>
              <a
                href="http://konghq.com/events/?itm_source=website&itm_medium=footer-nav"
                >Events</a
              >
            </li>
            <li>
              <a
                href="http://konghq.com/investors/?itm_source=website&itm_medium=footer-nav"
                >Investors</a
              >
            </li>
            <li>
              <a
                href="http://konghq.com/careers/?itm_source=website&itm_medium=footer-nav"
                >Careers <span>Hiring!</span></a
              >
            </li>
            <li>
              <a
                href="http://konghq.com/partners/?itm_source=website&itm_medium=footer-nav"
                >Partners</a
              >
            </li>
            <li>
              <a
                href="http://konghq.com/press-room/?itm_source=website&itm_medium=footer-nav"
                >Press</a
              >
            </li>
            <li>
              <a
                href="http://konghq.com/contact/?itm_source=website&itm_medium=footer-nav"
                >Contact</a
              >
            </li>
          </ul>
        </nav>
      </li>
      <li>
        <nav>
          <h5>Products</h5>
          <ul>
            <li>
              <a
                href="http://konghq.com/kong/?itm_source=website&itm_medium=footer-nav"
                >Kong Gateway</a
              >
            </li>
            <li>
              <a
                href="http://konghq.com/kong-enterprise/?itm_source=website&itm_medium=footer-nav"
                >Kong Enterprise</a
              >
            </li>
            <li>
              <a
                href="http://konghq.com/get-started/?itm_source=website&itm_medium=footer-nav"
                >Get Started</a
              >
            </li>
            <li>
              <a
                href="http://konghq.com/subscriptions/?itm_source=website&itm_medium=footer-nav"
                >Subscriptions</a
              >
            </li>
          </ul>
        </nav>
      </li>
      <li>
        <nav>
          <h5>Resources</h5>
          <ul>
            <li>
              <a
                href="https://konghq.com/resources/?content=ebooks&itm_source=website&itm_medium=footer-nav"
                target="blank"
                >eBooks</a
              >
            </li>
            <li>
              <a
                href="https://konghq.com/resources/?content=webinarss&itm_source=website&itm_medium=footer-nav"
                >Webinars</a
              >
            </li>
            <li>
              <a
                href="https://konghq.com/resources/?content=whitepaper,datasheet,case-studies&itm_source=website&itm_medium=footer-nav"
                >Briefs</a
              >
            </li>
            <li>
              <a
                href="https://konghq.com/blog/?itm_source=website&itm_medium=footer-nav"
                >Blog</a
              >
            </li>
            <li>
              <a
                href="https://konghq.com/learning-center/api-gateway/?itm_source=website&itm_medium=footer-nav"
                >API Gateway</a
              >
            </li>
            <li>
              <a
                href="https://konghq.com/learning-center/microservices/?itm_source=website&itm_medium=footer-nav"
                >Microservices</a
              >
            </li>
          </ul>
        </nav>
      </li>
      <li>
        <nav>
          <h5>Open Source</h5>
          <ul>
            <li>
              <a
                href="https://konghq.com/get-started#install?itm_source=website&itm_medium=footer-nav"
                >Install Kong Gateway</a
              >
            </li>
            <li>
              <a
                href="http://konghq.com/community/?itm_source=website&itm_medium=footer-nav"
                >Kong Community</a
              >
            </li>
            <li>
              <a
                href="https://github.com/Kong/kubernetes-ingress-controller/?itm_source=website&itm_medium=footer-nav"
                >Kubernetes Ingress</a
              >
            </li>
            <li>
              <a
                href="https://kuma.io/?itm_source=website&itm_medium=footer-nav"
                >Kuma</a
              >
            </li>
            <li>
              <a
                href="https://insomnia.rest/?itm_source=website&itm_medium=footer-nav"
                >Insomnia</a
              >
            </li>
          </ul>
        </nav>
      </li>
      <li>
        <nav>
          <h5>Solutions</h5>
          <ul>
            <li>
              <a
                href="https://konghq.com/solutions/use-cases/decentralize-applications-and-services/?itm_source=website&itm_medium=footer-nav"
                >Decentralize</a
              >
            </li>
            <li>
              <a
                href="https://konghq.com/solutions/use-cases/secure-and-govern-apis-and-services/?itm_source=website&itm_medium=footer-nav"
                >Secure & Govern</a
              >
            </li>
            <li>
              <a
                href="https://konghq.com/solutions/use-cases/create-a-developer-platform/?itm_source=website&itm_medium=footer-nav"
                >Create a Dev Platform</a
              >
            </li>
            <li>
              <a
                href="https://konghq.com/solutions/gateway/?itm_source=website&itm_medium=footer-nav"
                >API Gateway</a
              >
            </li>
            <li>
              <a
                href="https://konghq.com/solutions/kubernetes-ingress/?itm_source=website&itm_medium=footer-nav"
                >Kubernetes</a
              >
            </li>
            <li>
              <a
                href="https://konghq.com/products/kong-enterprise/kong-mesh/?itm_source=website&itm_medium=footer-nav"
                >Service Mesh</a
              >
            </li>
          </ul>
        </nav>
      </li>
    </ul>
  </section>

  <section class="legal">
    <div class="container d-flex">
      <div class="social">
        <div class="social-link">
          <a href="https://www.facebook.com/konghq/" title="Facebook"
            ><i
              aria-label="Facebook"
              class="fa fa-facebook-official"
              aria-hidden="true"
            ></i
          ></a>
        </div>
        <div class="social-link">
          <a href="https://twitter.com/thekonginc" title="Twitter"
            ><i
              aria-label="Twitter"
              class="fa fa-twitter"
              aria-hidden="true"
            ></i
          ></a>
        </div>
        <div class="social-link">
          <a href="https://www.meetup.com/topics/kong/all/" title="Meetup"
            ><i aria-label="Meetup" class="fa fa-meetup" aria-hidden="true"></i
          ></a>
        </div>
        <div class="social-link">
          <a href="https://linkedin.com/company/278819" title="LinkedIn"
            ><i
              aria-label="GitHub"
              class="fa fa-linkedin"
              aria-hidden="true"
            ></i
          ></a>
        </div>
        <div class="social-link">
          <a href="https://github.com/kong/kong" target="blank" class="btn-gh">
            <i class="fa fa-github" aria-hidden="true" aria-label="GitHub"></i>
            Star
          </a>
        </div>
      </div>
      <ul>
        <li>
          <span class="mashape-footer-content">
            <a href="http://konghq.com/terms/">Terms</a><b>•</b
            ><a href="http://konghq.com/privacy/">Privacy</a></span
          >
        </li>
      </ul>
      <div>
        <span>&copy; Kong Inc. 2020 &nbsp;</span>
      </div>
    </div>
  </section>

  <script type="text/javascript">
    function onSubmit(response) {
      document.getElementById("subscription_form").submit();
      document.getElementById("follow_up_subscription_form").submit();
      if (response.length == 0) {
        alert("reCaptcha verification failed");
      }
    }
  </script>
</footer>
 <script>
  var anchorForId = function (id) {
    var anchor = document.createElement("a");
    anchor.className = "header-link";
    anchor.href      = "#" + id;
    anchor.innerHTML = "<span class=\"sr-only\">Permalink</span><i class=\"fa fa-link\"></i>";
    anchor.title = "Permalink";
    return anchor;
  };

  document.onreadystatechange = function () {
    if (this.readyState === "complete") {
      var className =
        ".show-anchor-links h1, .show-anchor-links h2, .show-anchor-links h3, " +
        ".show-anchor-links h4, .show-anchor-links h5, .show-anchor-links h6";
      var headers = document.querySelectorAll(className);

      for (var i = 0; i < headers.length; i++) {
        var header = headers[i];
        if (typeof header.id !== "undefined" && header.id !== "") {
          header.prepend(anchorForId(header.id));
        }
      }
    }
  };
</script>


    <script src="/assets/app.js?v=1601569374"></script>

    <div id="fb-root"></div>

    <script
      src="https://2tjosk2rxzc21medji3nfn1g-wpengine.netdna-ssl.com/wp-content/themes/konghq/assets/js/vendor/bootstrap.min.js"
      async
      defer
    ></script>

    <script
      id="github-bjs"
      src="https://buttons.github.io/buttons.js"
      async
      defer
    ></script>
    <script
      id="twitter-wjs"
      type="text/javascript"
      src="https://platform.twitter.com/widgets.js"
      async
      defer
    ></script>
    <script
      id="facebook-jssdk"
      type="text/javascript"
      src="https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.3&appId=842731852424506"
      async
      defer
    ></script>

    <script type="text/javascript">
      piAId = '393112';
      piCId = '48375';

      (function() {
        function async_load() {
          var s = document.createElement('script');
          s.type = 'text/javascript';
          s.src =
            ('https:' == document.location.protocol
              ? 'https://pi'
              : 'http://cdn') + '.pardot.com/pd.js';
          var c = document.getElementsByTagName('script')[0];
          c.parentNode.insertBefore(s, c);
        }
        if (window.attachEvent) {
          window.attachEvent('onload', async_load);
        } else {
          window.addEventListener('load', async_load, false);
        }
      })();
    </script>

    <script type="text/javascript">
      var _vwo_code = (function() {
        var account_id = 125292,
          settings_tolerance = 2000,
          library_tolerance = 2500,
          use_existing_jquery = true,
          // DO NOT EDIT BELOW THIS LINE
          f = false,
          d = document;
        return {
          use_existing_jquery: function() {
            return use_existing_jquery;
          },
          library_tolerance: function() {
            return library_tolerance;
          },
          finish: function() {
            if (!f) {
              f = true;
              var a = d.getElementById('_vis_opt_path_hides');
              if (a) a.parentNode.removeChild(a);
            }
          },
          finished: function() {
            return f;
          },
          load: function(a) {
            var b = d.createElement('script');
            b.src = a;
            b.type = 'text/javascript';
            b.innerText;
            b.onerror = function() {
              _vwo_code.finish();
            };
            d.getElementsByTagName('head')[0].appendChild(b);
          },
          init: function() {
            settings_timer = setTimeout(
              '_vwo_code.finish()',
              settings_tolerance
            );
            this.load(
              '//dev.visualwebsiteoptimizer.com/j.php?a=' +
                account_id +
                '&u=' +
                encodeURIComponent(d.URL) +
                '&r=' +
                Math.random()
            );
            var a = d.createElement('style'),
              b = '',
              h = d.getElementsByTagName('head')[0];
            a.setAttribute('id', '_vis_opt_path_hides');
            a.setAttribute('type', 'text/css');
            if (a.styleSheet) a.styleSheet.cssText = b;
            else a.appendChild(d.createTextNode(b));
            h.appendChild(a);
            return settings_timer;
          }
        };
      })();
      _vwo_settings_timer = _vwo_code.init();
    </script>

    <script type="text/javascript">
      !(function() {
        var analytics = (window.analytics = window.analytics || []);
        if (!analytics.initialize)
          if (analytics.invoked)
            window.console &&
              console.error &&
              console.error('Segment snippet included twice.');
          else {
            analytics.invoked = !0;
            analytics.methods = [
              'trackSubmit',
              'trackClick',
              'trackLink',
              'trackForm',
              'pageview',
              'identify',
              'group',
              'track',
              'ready',
              'alias',
              'page',
              'once',
              'off',
              'on'
            ];
            analytics.factory = function(t) {
              return function() {
                var e = Array.prototype.slice.call(arguments);
                e.unshift(t);
                analytics.push(e);
                return analytics;
              };
            };
            for (var t = 0; t < analytics.methods.length; t++) {
              var e = analytics.methods[t];
              analytics[e] = analytics.factory(e);
            }
            analytics.load = function(t) {
              var e = document.createElement('script');
              e.type = 'text/javascript';
              e.async = !0;
              e.src =
                ('https:' === document.location.protocol
                  ? 'https://'
                  : 'http://') +
                'cdn.segment.com/analytics.js/v1/' +
                t +
                '/analytics.min.js';
              var n = document.getElementsByTagName('script')[0];
              n.parentNode.insertBefore(e, n);
            };
            analytics.SNIPPET_VERSION = '3.0.1';
            analytics.load('WDj0nSS7hpyxwL3evgbOzK755s0NUye6');
            analytics.page();
          }
      })();
    </script>

    <script>
      // Collapse Toggler
      $('button[data-toggle="kong-expand"]').on('click', function(e) {
        e.stopPropagation();
        var $this = $(this);
        $('#oss_subnav.expand').toggleClass('slideup');
        $($this.data('target')).toggleClass('kong-navbar-collapse--expand');
        $('nav.navbar.full-width').toggleClass('kong-navbar-collapse--expand');
        $this.toggleClass('active').attr('aria-expanded', true);
        $('.kong-navbar-collapse_section').removeClass('shift');
        $('.subnav, .trigger, .remove').removeClass('active');
        setTimeout(function() {
          $('#menu-primary-nav li').removeClass('active');
          $('.active-tab').removeClass('active-tab');
        }, 100);
      });

      var $window = $(window);

      function checkWidth() {
        var windowsize = $window.width();
        if (windowsize > 1080) {
          $('.navbar').removeClass('mobile-triggers');
          $('#menu-primary-nav li').removeClass('active');
          $('.active-tab').removeClass('active-tab');
        } else {
          $('.navbar').addClass('mobile-triggers');
        }
      }
      // Execute on load
      checkWidth();
      // Bind event listener
      $(window).resize(checkWidth);

      $('#menu-primary-nav .nav1 > a').click(function() {
        if ($('nav.navbar').hasClass('mobile-triggers')) {
          event.preventDefault();
          $('.nav3').removeClass('active');
          var position = $(this)
            .parent()
            .position();
          $(this)
            .parent()
            .toggleClass('active');
          $('body')
            .get(0)
            .style.setProperty(
              '--navPosition',
              (position.top - 75) * -1 + 'px'
            );
          $(this)
            .parent()
            .parent()
            .toggleClass('active-tab');
        }
      });

      $('#menu-primary-nav .nav3 > a').click(function() {
        if ($('nav.navbar').hasClass('mobile-triggers')) {
          event.preventDefault();
          $(this)
            .parent()
            .toggleClass('active');
        }
      });
    </script>
  </body>

  
</html>
