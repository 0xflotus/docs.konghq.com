<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/Article">
  

<head>
  <meta charset="utf-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"/>

  <title>Serverless Functions plugin | Kong</title>
  <meta name="description" content="Secure, Manage &amp; Extend your APIs or Microservices with plugins for authentication, logging, rate-limiting, transformations and more.">
  <meta name="author" content="KongHQ"/>
  <meta property="og:title" content="Open-Source API Management and Microservice Management"/>
  <meta property="og:site_name" content="Kong"/>
  <!-- use share link for facebook -->
  <meta property="og:url" content="https://docs.konghq.com"/>
  <meta property="og:description" content="Secure, Manage &amp; Extend your APIs or Microservices with plugins for authentication, logging, rate-limiting, transformations and more."/>
  <meta property="og:type" content="website"/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:image" content="https://docs.konghq.com/assets/images/share.png"/>
  <meta name="twitter:card" content="summary_large_image"/>
  <meta name="twitter:site" content="@thekonginc"/>
  <meta name="twitter:creator" content="@thekonginc"/>
  <meta name="twitter:url" content="https://docs.konghq.com"/>
  <meta name="twitter:description" content="Secure, Manage &amp; Extend your APIs or Microservices with plugins for authentication, logging, rate-limiting, transformations and more.">
  <meta name="twitter:image" content="https://docs.konghq.com/assets/images/share.png">
  <meta property="fb:admins" content="227304446"/>
  <meta property="fb:admins" content="576641408"/>
  <meta name="google-site-verification" content="CrU3zp02dNKTe8NSAipL4NCPkrIjDXG8fViTZ-MIzP4"/>

  <!-- New Relic -->
  <script type="text/javascript">
/* eslint-disable */
window.NREUM||(NREUM={}),__nr_require=function(t,e,n){function r(n){if(!e[n]){var o=e[n]={exports:{}};t[n][0].call(o.exports,function(e){var o=t[n][1][e];return r(o||e)},o,o.exports)}return e[n].exports}if("function"==typeof __nr_require)return __nr_require;for(var o=0;o<n.length;o++)r(n[o]);return r}({1:[function(t,e,n){function r(t){try{c.console&&console.log(t)}catch(e){}}var o,i=t("ee"),a=t(20),c={};try{o=localStorage.getItem("__nr_flags").split(","),console&&"function"==typeof console.log&&(c.console=!0,o.indexOf("dev")!==-1&&(c.dev=!0),o.indexOf("nr_dev")!==-1&&(c.nrDev=!0))}catch(s){}c.nrDev&&i.on("internal-error",function(t){r(t.stack)}),c.dev&&i.on("fn-err",function(t,e,n){r(n.stack)}),c.dev&&(r("NR AGENT IN DEVELOPMENT MODE"),r("flags: "+a(c,function(t,e){return t}).join(", ")))},{}],2:[function(t,e,n){function r(t,e,n,r,c){try{h?h-=1:o(c||new UncaughtException(t,e,n),!0)}catch(f){try{i("ierr",[f,s.now(),!0])}catch(d){}}return"function"==typeof u&&u.apply(this,a(arguments))}function UncaughtException(t,e,n){this.message=t||"Uncaught error with no additional information",this.sourceURL=e,this.line=n}function o(t,e){var n=e?null:s.now();i("err",[t,n])}var i=t("handle"),a=t(21),c=t("ee"),s=t("loader"),f=t("gos"),u=window.onerror,d=!1,p="nr@seenError",h=0;s.features.err=!0,t(1),window.onerror=r;try{throw new Error}catch(l){"stack"in l&&(t(13),t(12),"addEventListener"in window&&t(6),s.xhrWrappable&&t(14),d=!0)}c.on("fn-start",function(t,e,n){d&&(h+=1)}),c.on("fn-err",function(t,e,n){d&&!n[p]&&(f(n,p,function(){return!0}),this.thrown=!0,o(n))}),c.on("fn-end",function(){d&&!this.thrown&&h>0&&(h-=1)}),c.on("internal-error",function(t){i("ierr",[t,s.now(),!0])})},{}],3:[function(t,e,n){t("loader").features.ins=!0},{}],4:[function(t,e,n){function r(){M++,S=y.hash,this[u]=b.now()}function o(){M--,y.hash!==S&&i(0,!0);var t=b.now();this[l]=~~this[l]+t-this[u],this[d]=t}function i(t,e){E.emit("newURL",[""+y,e])}function a(t,e){t.on(e,function(){this[e]=b.now()})}var c="-start",s="-end",f="-body",u="fn"+c,d="fn"+s,p="cb"+c,h="cb"+s,l="jsTime",m="fetch",v="addEventListener",w=window,y=w.location,b=t("loader");if(w[v]&&b.xhrWrappable){var g=t(10),x=t(11),E=t(8),P=t(6),O=t(13),R=t(7),T=t(14),L=t(9),j=t("ee"),N=j.get("tracer");t(15),b.features.spa=!0;var S,M=0;j.on(u,r),j.on(p,r),j.on(d,o),j.on(h,o),j.buffer([u,d,"xhr-done","xhr-resolved"]),P.buffer([u]),O.buffer(["setTimeout"+s,"clearTimeout"+c,u]),T.buffer([u,"new-xhr","send-xhr"+c]),R.buffer([m+c,m+"-done",m+f+c,m+f+s]),E.buffer(["newURL"]),g.buffer([u]),x.buffer(["propagate",p,h,"executor-err","resolve"+c]),N.buffer([u,"no-"+u]),L.buffer(["new-jsonp","cb-start","jsonp-error","jsonp-end"]),a(T,"send-xhr"+c),a(j,"xhr-resolved"),a(j,"xhr-done"),a(R,m+c),a(R,m+"-done"),a(L,"new-jsonp"),a(L,"jsonp-end"),a(L,"cb-start"),E.on("pushState-end",i),E.on("replaceState-end",i),w[v]("hashchange",i,!0),w[v]("load",i,!0),w[v]("popstate",function(){i(0,M>1)},!0)}},{}],5:[function(t,e,n){function r(t){}if(window.performance&&window.performance.timing&&window.performance.getEntriesByType){var o=t("ee"),i=t("handle"),a=t(13),c=t(12),s="learResourceTimings",f="addEventListener",u="resourcetimingbufferfull",d="bstResource",p="resource",h="-start",l="-end",m="fn"+h,v="fn"+l,w="bstTimer",y="pushState",b=t("loader");b.features.stn=!0,t(8);var g=NREUM.o.EV;o.on(m,function(t,e){var n=t[0];n instanceof g&&(this.bstStart=b.now())}),o.on(v,function(t,e){var n=t[0];n instanceof g&&i("bst",[n,e,this.bstStart,b.now()])}),a.on(m,function(t,e,n){this.bstStart=b.now(),this.bstType=n}),a.on(v,function(t,e){i(w,[e,this.bstStart,b.now(),this.bstType])}),c.on(m,function(){this.bstStart=b.now()}),c.on(v,function(t,e){i(w,[e,this.bstStart,b.now(),"requestAnimationFrame"])}),o.on(y+h,function(t){this.time=b.now(),this.startPath=location.pathname+location.hash}),o.on(y+l,function(t){i("bstHist",[location.pathname+location.hash,this.startPath,this.time])}),f in window.performance&&(window.performance["c"+s]?window.performance[f](u,function(t){i(d,[window.performance.getEntriesByType(p)]),window.performance["c"+s]()},!1):window.performance[f]("webkit"+u,function(t){i(d,[window.performance.getEntriesByType(p)]),window.performance["webkitC"+s]()},!1)),document[f]("scroll",r,{passive:!0}),document[f]("keypress",r,!1),document[f]("click",r,!1)}},{}],6:[function(t,e,n){function r(t){for(var e=t;e&&!e.hasOwnProperty(u);)e=Object.getPrototypeOf(e);e&&o(e)}function o(t){c.inPlace(t,[u,d],"-",i)}function i(t,e){return t[1]}var a=t("ee").get("events"),c=t(23)(a,!0),s=t("gos"),f=XMLHttpRequest,u="addEventListener",d="removeEventListener";e.exports=a,"getPrototypeOf"in Object?(r(document),r(window),r(f.prototype)):f.prototype.hasOwnProperty(u)&&(o(window),o(f.prototype)),a.on(u+"-start",function(t,e){var n=t[1],r=s(n,"nr@wrapped",function(){function t(){if("function"==typeof n.handleEvent)return n.handleEvent.apply(n,arguments)}var e={object:t,"function":n}[typeof n];return e?c(e,"fn-",null,e.name||"anonymous"):n});this.wrapped=t[1]=r}),a.on(d+"-start",function(t){t[1]=this.wrapped||t[1]})},{}],7:[function(t,e,n){function r(t,e,n){var r=t[e];"function"==typeof r&&(t[e]=function(){var t=r.apply(this,arguments);return o.emit(n+"start",arguments,t),t.then(function(e){return o.emit(n+"end",[null,e],t),e},function(e){throw o.emit(n+"end",[e],t),e})})}var o=t("ee").get("fetch"),i=t(20);e.exports=o;var a=window,c="fetch-",s=c+"body-",f=["arrayBuffer","blob","json","text","formData"],u=a.Request,d=a.Response,p=a.fetch,h="prototype";u&&d&&p&&(i(f,function(t,e){r(u[h],e,s),r(d[h],e,s)}),r(a,"fetch",c),o.on(c+"end",function(t,e){var n=this;e?e.clone().arrayBuffer().then(function(t){n.rxSize=t.byteLength,o.emit(c+"done",[null,e],n)}):o.emit(c+"done",[t],n)}))},{}],8:[function(t,e,n){var r=t("ee").get("history"),o=t(23)(r);e.exports=r,o.inPlace(window.history,["pushState","replaceState"],"-")},{}],9:[function(t,e,n){function r(t){function e(){s.emit("jsonp-end",[],p),t.removeEventListener("load",e,!1),t.removeEventListener("error",n,!1)}function n(){s.emit("jsonp-error",[],p),s.emit("jsonp-end",[],p),t.removeEventListener("load",e,!1),t.removeEventListener("error",n,!1)}var r=t&&"string"==typeof t.nodeName&&"script"===t.nodeName.toLowerCase();if(r){var o="function"==typeof t.addEventListener;if(o){var a=i(t.src);if(a){var u=c(a),d="function"==typeof u.parent[u.key];if(d){var p={};f.inPlace(u.parent,[u.key],"cb-",p),t.addEventListener("load",e,!1),t.addEventListener("error",n,!1),s.emit("new-jsonp",[t.src],p)}}}}}function o(){return"addEventListener"in window}function i(t){var e=t.match(u);return e?e[1]:null}function a(t,e){var n=t.match(p),r=n[1],o=n[3];return o?a(o,e[r]):e[r]}function c(t){var e=t.match(d);return e&&e.length>=3?{key:e[2],parent:a(e[1],window)}:{key:t,parent:window}}var s=t("ee").get("jsonp"),f=t(23)(s);if(e.exports=s,o()){var u=/[?&](?:callback|cb)=([^&#]+)/,d=/(.*)\.([^.]+)/,p=/^(\w+)(\.|$)(.*)$/,h=["appendChild","insertBefore","replaceChild"];f.inPlace(HTMLElement.prototype,h,"dom-"),f.inPlace(HTMLHeadElement.prototype,h,"dom-"),f.inPlace(HTMLBodyElement.prototype,h,"dom-"),s.on("dom-start",function(t){r(t[0])})}},{}],10:[function(t,e,n){var r=t("ee").get("mutation"),o=t(23)(r),i=NREUM.o.MO;e.exports=r,i&&(window.MutationObserver=function(t){return this instanceof i?new i(o(t,"fn-")):i.apply(this,arguments)},MutationObserver.prototype=i.prototype)},{}],11:[function(t,e,n){function r(t){var e=a.context(),n=c(t,"executor-",e),r=new f(n);return a.context(r).getCtx=function(){return e},a.emit("new-promise",[r,e],e),r}function o(t,e){return e}var i=t(23),a=t("ee").get("promise"),c=i(a),s=t(20),f=NREUM.o.PR;e.exports=a,f&&(window.Promise=r,["all","race"].forEach(function(t){var e=f[t];f[t]=function(n){function r(t){return function(){a.emit("propagate",[null,!o],i),o=o||!t}}var o=!1;s(n,function(e,n){Promise.resolve(n).then(r("all"===t),r(!1))});var i=e.apply(f,arguments),c=f.resolve(i);return c}}),["resolve","reject"].forEach(function(t){var e=f[t];f[t]=function(t){var n=e.apply(f,arguments);return t!==n&&a.emit("propagate",[t,!0],n),n}}),f.prototype["catch"]=function(t){return this.then(null,t)},f.prototype=Object.create(f.prototype,{constructor:{value:r}}),s(Object.getOwnPropertyNames(f),function(t,e){try{r[e]=f[e]}catch(n){}}),a.on("executor-start",function(t){t[0]=c(t[0],"resolve-",this),t[1]=c(t[1],"resolve-",this)}),a.on("executor-err",function(t,e,n){t[1](n)}),c.inPlace(f.prototype,["then"],"then-",o),a.on("then-start",function(t,e){this.promise=e,t[0]=c(t[0],"cb-",this),t[1]=c(t[1],"cb-",this)}),a.on("then-end",function(t,e,n){this.nextPromise=n;var r=this.promise;a.emit("propagate",[r,!0],n)}),a.on("cb-end",function(t,e,n){a.emit("propagate",[n,!0],this.nextPromise)}),a.on("propagate",function(t,e,n){this.getCtx&&!e||(this.getCtx=function(){if(t instanceof Promise)var e=a.context(t);return e&&e.getCtx?e.getCtx():this})}),r.toString=function(){return""+f})},{}],12:[function(t,e,n){var r=t("ee").get("raf"),o=t(23)(r),i="equestAnimationFrame";e.exports=r,o.inPlace(window,["r"+i,"mozR"+i,"webkitR"+i,"msR"+i],"raf-"),r.on("raf-start",function(t){t[0]=o(t[0],"fn-")})},{}],13:[function(t,e,n){function r(t,e,n){t[0]=a(t[0],"fn-",null,n)}function o(t,e,n){this.method=n,this.timerDuration=isNaN(t[1])?0:+t[1],t[0]=a(t[0],"fn-",this,n)}var i=t("ee").get("timer"),a=t(23)(i),c="setTimeout",s="setInterval",f="clearTimeout",u="-start",d="-";e.exports=i,a.inPlace(window,[c,"setImmediate"],c+d),a.inPlace(window,[s],s+d),a.inPlace(window,[f,"clearImmediate"],f+d),i.on(s+u,r),i.on(c+u,o)},{}],14:[function(t,e,n){function r(t,e){d.inPlace(e,["onreadystatechange"],"fn-",c)}function o(){var t=this,e=u.context(t);t.readyState>3&&!e.resolved&&(e.resolved=!0,u.emit("xhr-resolved",[],t)),d.inPlace(t,y,"fn-",c)}function i(t){b.push(t),l&&(x?x.then(a):v?v(a):(E=-E,P.data=E))}function a(){for(var t=0;t<b.length;t++)r([],b[t]);b.length&&(b=[])}function c(t,e){return e}function s(t,e){for(var n in t)e[n]=t[n];return e}t(6);var f=t("ee"),u=f.get("xhr"),d=t(23)(u),p=NREUM.o,h=p.XHR,l=p.MO,m=p.PR,v=p.SI,w="readystatechange",y=["onload","onerror","onabort","onloadstart","onloadend","onprogress","ontimeout"],b=[];e.exports=u;var g=window.XMLHttpRequest=function(t){var e=new h(t);try{u.emit("new-xhr",[e],e),e.addEventListener(w,o,!1)}catch(n){try{u.emit("internal-error",[n])}catch(r){}}return e};if(s(h,g),g.prototype=h.prototype,d.inPlace(g.prototype,["open","send"],"-xhr-",c),u.on("send-xhr-start",function(t,e){r(t,e),i(e)}),u.on("open-xhr-start",r),l){var x=m&&m.resolve();if(!v&&!m){var E=1,P=document.createTextNode(E);new l(a).observe(P,{characterData:!0})}}else f.on("fn-end",function(t){t[0]&&t[0].type===w||a()})},{}],15:[function(t,e,n){function r(t){var e=this.params,n=this.metrics;if(!this.ended){this.ended=!0;for(var r=0;r<d;r++)t.removeEventListener(u[r],this.listener,!1);if(!e.aborted){if(n.duration=a.now()-this.startTime,4===t.readyState){e.status=t.status;var i=o(t,this.lastSize);if(i&&(n.rxSize=i),this.sameOrigin){var s=t.getResponseHeader("X-NewRelic-App-Data");s&&(e.cat=s.split(", ").pop())}}else e.status=0;n.cbTime=this.cbTime,f.emit("xhr-done",[t],t),c("xhr",[e,n,this.startTime])}}}function o(t,e){var n=t.responseType;if("json"===n&&null!==e)return e;var r="arraybuffer"===n||"blob"===n||"json"===n?t.response:t.responseText;return l(r)}function i(t,e){var n=s(e),r=t.params;r.host=n.hostname+":"+n.port,r.pathname=n.pathname,t.sameOrigin=n.sameOrigin}var a=t("loader");if(a.xhrWrappable){var c=t("handle"),s=t(16),f=t("ee"),u=["load","error","abort","timeout"],d=u.length,p=t("id"),h=t(19),l=t(18),m=window.XMLHttpRequest;a.features.xhr=!0,t(14),f.on("new-xhr",function(t){var e=this;e.totalCbs=0,e.called=0,e.cbTime=0,e.end=r,e.ended=!1,e.xhrGuids={},e.lastSize=null,h&&(h>34||h<10)||window.opera||t.addEventListener("progress",function(t){e.lastSize=t.loaded},!1)}),f.on("open-xhr-start",function(t){this.params={method:t[0]},i(this,t[1]),this.metrics={}}),f.on("open-xhr-end",function(t,e){"loader_config"in NREUM&&"xpid"in NREUM.loader_config&&this.sameOrigin&&e.setRequestHeader("X-NewRelic-ID",NREUM.loader_config.xpid)}),f.on("send-xhr-start",function(t,e){var n=this.metrics,r=t[0],o=this;if(n&&r){var i=l(r);i&&(n.txSize=i)}this.startTime=a.now(),this.listener=function(t){try{"abort"===t.type&&(o.params.aborted=!0),("load"!==t.type||o.called===o.totalCbs&&(o.onloadCalled||"function"!=typeof e.onload))&&o.end(e)}catch(n){try{f.emit("internal-error",[n])}catch(r){}}};for(var c=0;c<d;c++)e.addEventListener(u[c],this.listener,!1)}),f.on("xhr-cb-time",function(t,e,n){this.cbTime+=t,e?this.onloadCalled=!0:this.called+=1,this.called!==this.totalCbs||!this.onloadCalled&&"function"==typeof n.onload||this.end(n)}),f.on("xhr-load-added",function(t,e){var n=""+p(t)+!!e;this.xhrGuids&&!this.xhrGuids[n]&&(this.xhrGuids[n]=!0,this.totalCbs+=1)}),f.on("xhr-load-removed",function(t,e){var n=""+p(t)+!!e;this.xhrGuids&&this.xhrGuids[n]&&(delete this.xhrGuids[n],this.totalCbs-=1)}),f.on("addEventListener-end",function(t,e){e instanceof m&&"load"===t[0]&&f.emit("xhr-load-added",[t[1],t[2]],e)}),f.on("removeEventListener-end",function(t,e){e instanceof m&&"load"===t[0]&&f.emit("xhr-load-removed",[t[1],t[2]],e)}),f.on("fn-start",function(t,e,n){e instanceof m&&("onload"===n&&(this.onload=!0),("load"===(t[0]&&t[0].type)||this.onload)&&(this.xhrCbStart=a.now()))}),f.on("fn-end",function(t,e){this.xhrCbStart&&f.emit("xhr-cb-time",[a.now()-this.xhrCbStart,this.onload,e],e)})}},{}],16:[function(t,e,n){e.exports=function(t){var e=document.createElement("a"),n=window.location,r={};e.href=t,r.port=e.port;var o=e.href.split("://");!r.port&&o[1]&&(r.port=o[1].split("/")[0].split("@").pop().split(":")[1]),r.port&&"0"!==r.port||(r.port="https"===o[0]?"443":"80"),r.hostname=e.hostname||n.hostname,r.pathname=e.pathname,r.protocol=o[0],"/"!==r.pathname.charAt(0)&&(r.pathname="/"+r.pathname);var i=!e.protocol||":"===e.protocol||e.protocol===n.protocol,a=e.hostname===document.domain&&e.port===n.port;return r.sameOrigin=i&&(!e.hostname||a),r}},{}],17:[function(t,e,n){function r(){}function o(t,e,n){return function(){return i(t,[f.now()].concat(c(arguments)),e?null:this,n),e?void 0:this}}var i=t("handle"),a=t(20),c=t(21),s=t("ee").get("tracer"),f=t("loader"),u=NREUM;"undefined"==typeof window.newrelic&&(newrelic=u);var d=["setPageViewName","setCustomAttribute","setErrorHandler","finished","addToTrace","inlineHit","addRelease"],p="api-",h=p+"ixn-";a(d,function(t,e){u[e]=o(p+e,!0,"api")}),u.addPageAction=o(p+"addPageAction",!0),u.setCurrentRouteName=o(p+"routeName",!0),e.exports=newrelic,u.interaction=function(){return(new r).get()};var l=r.prototype={createTracer:function(t,e){var n={},r=this,o="function"==typeof e;return i(h+"tracer",[f.now(),t,n],r),function(){if(s.emit((o?"":"no-")+"fn-start",[f.now(),r,o],n),o)try{return e.apply(this,arguments)}catch(t){throw s.emit("fn-err",[arguments,this,t],n),t}finally{s.emit("fn-end",[f.now()],n)}}}};a("setName,setAttribute,save,ignore,onEnd,getContext,end,get".split(","),function(t,e){l[e]=o(h+e)}),newrelic.noticeError=function(t){"string"==typeof t&&(t=new Error(t)),i("err",[t,f.now()])}},{}],18:[function(t,e,n){e.exports=function(t){if("string"==typeof t&&t.length)return t.length;if("object"==typeof t){if("undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer&&t.byteLength)return t.byteLength;if("undefined"!=typeof Blob&&t instanceof Blob&&t.size)return t.size;if(!("undefined"!=typeof FormData&&t instanceof FormData))try{return JSON.stringify(t).length}catch(e){return}}}},{}],19:[function(t,e,n){var r=0,o=navigator.userAgent.match(/Firefox[\/\s](\d+\.\d+)/);o&&(r=+o[1]),e.exports=r},{}],20:[function(t,e,n){function r(t,e){var n=[],r="",i=0;for(r in t)o.call(t,r)&&(n[i]=e(r,t[r]),i+=1);return n}var o=Object.prototype.hasOwnProperty;e.exports=r},{}],21:[function(t,e,n){function r(t,e,n){e||(e=0),"undefined"==typeof n&&(n=t?t.length:0);for(var r=-1,o=n-e||0,i=Array(o<0?0:o);++r<o;)i[r]=t[e+r];return i}e.exports=r},{}],22:[function(t,e,n){e.exports={exists:"undefined"!=typeof window.performance&&window.performance.timing&&"undefined"!=typeof window.performance.timing.navigationStart}},{}],23:[function(t,e,n){function r(t){return!(t&&t instanceof Function&&t.apply&&!t[a])}var o=t("ee"),i=t(21),a="nr@original",c=Object.prototype.hasOwnProperty,s=!1;e.exports=function(t,e){function n(t,e,n,o){function nrWrapper(){var r,a,c,s;try{a=this,r=i(arguments),c="function"==typeof n?n(r,a):n||{}}catch(f){p([f,"",[r,a,o],c])}u(e+"start",[r,a,o],c);try{return s=t.apply(a,r)}catch(d){throw u(e+"err",[r,a,d],c),d}finally{u(e+"end",[r,a,s],c)}}return r(t)?t:(e||(e=""),nrWrapper[a]=t,d(t,nrWrapper),nrWrapper)}function f(t,e,o,i){o||(o="");var a,c,s,f="-"===o.charAt(0);for(s=0;s<e.length;s++)c=e[s],a=t[c],r(a)||(t[c]=n(a,f?c+o:o,i,c))}function u(n,r,o){if(!s||e){var i=s;s=!0;try{t.emit(n,r,o,e)}catch(a){p([a,n,r,o])}s=i}}function d(t,e){if(Object.defineProperty&&Object.keys)try{var n=Object.keys(t);return n.forEach(function(n){Object.defineProperty(e,n,{get:function(){return t[n]},set:function(e){return t[n]=e,e}})}),e}catch(r){p([r])}for(var o in t)c.call(t,o)&&(e[o]=t[o]);return e}function p(e){try{t.emit("internal-error",e)}catch(n){}}return t||(t=o),n.inPlace=f,n.flag=a,n}},{}],ee:[function(t,e,n){function r(){}function o(t){function e(t){return t&&t instanceof r?t:t?s(t,c,i):i()}function n(n,r,o,i){if(!p.aborted||i){t&&t(n,r,o);for(var a=e(o),c=l(n),s=c.length,f=0;f<s;f++)c[f].apply(a,r);var d=u[y[n]];return d&&d.push([b,n,r,a]),a}}function h(t,e){w[t]=l(t).concat(e)}function l(t){return w[t]||[]}function m(t){return d[t]=d[t]||o(n)}function v(t,e){f(t,function(t,n){e=e||"feature",y[n]=e,e in u||(u[e]=[])})}var w={},y={},b={on:h,emit:n,get:m,listeners:l,context:e,buffer:v,abort:a,aborted:!1};return b}function i(){return new r}function a(){(u.api||u.feature)&&(p.aborted=!0,u=p.backlog={})}var c="nr@context",s=t("gos"),f=t(20),u={},d={},p=e.exports=o();p.backlog=u},{}],gos:[function(t,e,n){function r(t,e,n){if(o.call(t,e))return t[e];var r=n();if(Object.defineProperty&&Object.keys)try{return Object.defineProperty(t,e,{value:r,writable:!0,enumerable:!1}),r}catch(i){}return t[e]=r,r}var o=Object.prototype.hasOwnProperty;e.exports=r},{}],handle:[function(t,e,n){function r(t,e,n,r){o.buffer([t],r),o.emit(t,e,n)}var o=t("ee").get("handle");e.exports=r,r.ee=o},{}],id:[function(t,e,n){function r(t){var e=typeof t;return!t||"object"!==e&&"function"!==e?-1:t===window?0:a(t,i,function(){return o++})}var o=1,i="nr@id",a=t("gos");e.exports=r},{}],loader:[function(t,e,n){function r(){if(!x++){var t=g.info=NREUM.info,e=p.getElementsByTagName("script")[0];if(setTimeout(u.abort,3e4),!(t&&t.licenseKey&&t.applicationID&&e))return u.abort();f(y,function(e,n){t[e]||(t[e]=n)}),s("mark",["onload",a()+g.offset],null,"api");var n=p.createElement("script");n.src="https://"+t.agent,e.parentNode.insertBefore(n,e)}}function o(){"complete"===p.readyState&&i()}function i(){s("mark",["domContent",a()+g.offset],null,"api")}function a(){return E.exists&&performance.now?Math.round(performance.now()):(c=Math.max((new Date).getTime(),c))-g.offset}var c=(new Date).getTime(),s=t("handle"),f=t(20),u=t("ee"),d=window,p=d.document,h="addEventListener",l="attachEvent",m=d.XMLHttpRequest,v=m&&m.prototype;NREUM.o={ST:setTimeout,SI:d.setImmediate,CT:clearTimeout,XHR:m,REQ:d.Request,EV:d.Event,PR:d.Promise,MO:d.MutationObserver};var w=""+location,y={beacon:"bam.nr-data.net",errorBeacon:"bam.nr-data.net",agent:"js-agent.newrelic.com/nr-spa-1071.min.js"},b=m&&v&&v[h]&&!/CriOS/.test(navigator.userAgent),g=e.exports={offset:c,now:a,origin:w,features:{},xhrWrappable:b};t(17),p[h]?(p[h]("DOMContentLoaded",i,!1),d[h]("load",r,!1)):(p[l]("onreadystatechange",o),d[l]("onload",r)),s("mark",["firstbyte",c],null,"api");var x=0,E=t(22)},{}]},{},["loader",2,15,5,3,4]);
;NREUM.info={beacon:"bam.nr-data.net",errorBeacon:"bam.nr-data.net",licenseKey:"13e44ec848",applicationID:"187820761",sa:1}
</script>


  <!-- FullStory -->
  <!-- <script>
/* eslint-disable */
window['_fs_debug'] = false;
window['_fs_host'] = 'fullstory.com';
window['_fs_org'] = '7JS2S';
window['_fs_namespace'] = 'FS';
(function(m,n,e,t,l,o,g,y){
    if (e in m) {if(m.console && m.console.log) { m.console.log('FullStory namespace conflict. Please set window["_fs_namespace"].');} return;}
    g=m[e]=function(a,b){g.q?g.q.push([a,b]):g._api(a,b);};g.q=[];
    o=n.createElement(t);o.async=1;o.src='https://'+_fs_host+'/s/fs.js';
    y=n.getElementsByTagName(t)[0];y.parentNode.insertBefore(o,y);
    g.identify=function(i,v){g(l,{uid:i});if(v)g(l,v)};g.setUserVars=function(v){g(l,v)};g.event=function(i,v){g('event',{n:i,p:v})};
    g.shutdown=function(){g("rec",!1)};g.restart=function(){g("rec",!0)};
    g.consent=function(a){g("consent",!arguments.length||a)};
    g.identifyAccount=function(i,v){o='account';v=v||{};v.acctId=i;g(o,v)};
    g.clearUserCookie=function(){};
})(window,document,window['_fs_namespace'],'script','user');
</script>
 -->

  <!-- Delighted -->
  <script type="text/javascript">
/* eslint-disable */
  !function(e,t,r,n,a){if(!e[a]){for(var i=e[a]=[],s=0;s<r.length;s++){var c=r[s];i[c]=i[c]||function(e){return function(){var t=Array.prototype.slice.call(arguments);i.push([e,t])}}(c)}i.SNIPPET_VERSION="1.0.1";var o=t.createElement("script");o.type="text/javascript",o.async=!0,o.src="https://d2yyd1h5u9mauk.cloudfront.net/integrations/web/v1/library/"+n+"/"+a+".js";var u=t.getElementsByTagName("script")[0];u.parentNode.insertBefore(o,u)}}(window,document,["survey","reset","config","init","set","get","event","identify","track","page","screen","group","alias"],"Mvwmq6n6DhInaFYu","delighted");

  delighted.survey();
</script>


  <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "Organization",
      "name": "KongHQ",
      "url": "https://docs.konghq.com",
      "logo": "https://docs.konghq.com/assets/images/logo.png",
      "sameAs": [
        "https://www.facebook.com/konginc",
        "https://twitter.com/thekonginc",
        "https://plus.google.com/+mashape"
      ]
    }
  </script>

  <!-- Preload assets -->
  <link rel="dns-prefetch" href="//cloud.typography.com">
  <link rel="dns-prefetch" href="//dev.visualwebsiteoptimizer.com">
  <link rel="dns-prefetch" href="//cdn.segment.com">
  <!-- ##gulp-resource-hints## -->

  <link rel="icon" type="image/x-icon" href="/assets/images/favicon.ico"/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
  <link rel="stylesheet" href="/assets/styles.css?v=1546444101"/>
  
</head>

<!-- Kong Cookie Policy -->
<div class="cookie-policy-container">
  <p>In order to give you better service we use cookies. By continuing to use our website, you agree to the use of cookies as described in our <a href=" https://konghq.com/cookie-policy/">Cookie Policy</a>
  <button class="cookie-policy-accept btn button" type="submit">I Agree</button>
</div>



  <body id="/hub/kong-inc/serverless-functions/index"  data-spy="scroll" data-target="#scroll-sidebar" data-offset="350">
    <header class="site-header fixed-top">
  <div class="enterprise">

    <!-- Kong Summit Announcement Banner -->

    <div class="container">
      <nav class="enterprise-sites one-half column">
        <ul>
          <li>
            <a href="https://konghq.com/kong-enterprise-edition">Enterprise</a>
          </li>
          <li>
            <a href="https://konghq.com/kong-community-edition">Kong API Gateway</a>
          </li>
        </ul>
      </nav>
      <nav class="enterprise-contact one-half column">
        <ul>
          <li>
            <a href="https://support.konghq.com/">Support</a>
          </li>
          <li>
            <a href="https://konghq.com/request-demo">Request Demo</a>
          </li>
        </ul>
      </nav>
    </div>
  </div>
  <!-- .enterprise -->
  <div class="navbar">
    <div class="container">
      <a href="https://konghq.com" class="navbar-brand">
        <img src="/assets/images/Kogo.svg" alt="Kong">
      </a>
      <iframe class="header-star" src="https://ghbtns.com/github-btn.html?user=Kong&amp;repo=kong&amp;type=star" frameborder="0"
        scrolling="0" width="55" height="20"></iframe>
      <button data-toggle="collapse" data-target="#navbar" aria-expanded="true" aria-controls="navbar" class="navbar-toggle">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <nav id="navbar" class="navbar-nav">
        <ul>
          <li>
            <a href="/" class="active">Docs</a>
          </li>
          <li>
            <a href="https://konghq.com/about-kong-inc/">About</a>
          </li>
          <li>
            <a href="/hub/">Hub</a>
          </li>
          <li>
            <a href="https://konghq.com/community-resources/">Community</a>
          </li>
          <li>
            <a href="https://konghq.com/kong-enterprise-edition/">Enterprise</a>
          </li>
          <li>
            <a href="https://github.com/Kong/kong" target="_blank">GitHub</a>
          </li>
          <li class="hidden-lg">
            <a href="https://support.konghq.com/">Support</a>
          </li>
          <li>
            <a href="https://konghq.com/install" class="button button-dark" data-analytics='{"event": "Clicked download", "type": "button", "location": "header"}'>Installation</a>
          </li>
        </ul>
      </nav>
    </div>
  </div>
  <!-- .navbar -->
</header>


    















<!-- BEGIN PAGE OUTPUT -->

<div class="page page-extension-profile">
  
    


  <header class="page-header">
    <div class="container">
      
        <div class="page-header-icon">
          <img src="/assets/images/icons/hub/kong-inc_serverless-functions.png" />
        </div>
      

      <div class="page-header-title">
        

        <h1>Serverless Functions</h1>

        
      </div>

      

      
    </div>
  </header>


  

  <div class="container">

    
      <div class="versions-dropdown dropdown page-header-right">
        <button class="page-header-btn" id="version-dropdown" type="button" data-toggle="dropdown" aria-haspopup="true"
                aria-expanded="false">
          Plugin Version 1.0-x
          <em>(latest)</em>
          <span class="caret"></span>
        </button>
        <ul class="dropdown-menu dropdown-menu-right" role="menu" aria-labelledby="version-dropdown">
          
            
            <li  class="active" >
              <a href="/hub/kong-inc/serverless-functions/">
                1.0-x <em>(latest)</em>
              </a>
            </li>
          
            
            <li >
              <a href="/hub/kong-inc/serverless-functions/0.1-x.html">
                0.1-x 
              </a>
            </li>
          
        </ul>
      </div>
    

    

    <aside class="page-navigation">

      
        <nav>
          <ul>
  <li><a href="#terminology">Terminology</a></li>
  <li><a href="#configuration">Configuration</a>
    <ul>
      <li><a href="#enabling-the-plugin-on-a-service">Enabling the plugin on a Service</a></li>
      <li><a href="#enabling-the-plugin-on-a-route">Enabling the plugin on a Route</a></li>
      <li><a href="#">Global plugins</a></li>
      <li><a href="#">Parameters</a></li>
    </ul>
  </li>
  <li><a href="#plugin-names">Plugin Names</a></li>
  <li><a href="#demonstration">Demonstration</a>
    <ul>
      <li><a href="#notes">Notes</a></li>
    </ul>
  </li>
</ul>

        </nav>
      

      <table id="about-extn">
        <tr>
          <th colspan="2">About this Plugin</th>
        </tr>
        <tr class="publisher">
          <td>Made by</td>
          <td>
          
            
<svg width="78" height="15" xmlns="http://www.w3.org/2000/svg">
  <g fill="none" fill-rule="evenodd">
    <path d="M23.685 7.372l-1.217 1.265V12h-1.313V2.047h1.313v4.922l4.423-4.922h1.586L24.56 6.442 28.784 12h-1.572l-3.527-4.628zm5.714.861c0-.724.143-1.376.428-1.955a3.187 3.187 0 0 1 1.19-1.34c.507-.314 1.087-.471 1.739-.471 1.007 0 1.822.348 2.444 1.046.622.697.933 1.624.933 2.782v.089c0 .72-.138 1.366-.414 1.938a3.14 3.14 0 0 1-1.182 1.336c-.513.32-1.102.479-1.767.479-1.003 0-1.815-.349-2.437-1.046-.623-.697-.934-1.62-.934-2.769v-.089zm1.272.15c0 .821.19 1.48.57 1.976.381.497.89.745 1.529.745.642 0 1.153-.251 1.53-.755.379-.503.568-1.209.568-2.116 0-.81-.192-1.468-.577-1.972-.386-.503-.897-.755-1.535-.755-.624 0-1.128.248-1.51.745-.384.497-.575 1.208-.575 2.133zm8.244-3.78l.041.93c.565-.71 1.303-1.066 2.215-1.066 1.563 0 2.351.882 2.365 2.645V12h-1.265V7.105c-.004-.533-.126-.927-.365-1.182-.24-.255-.612-.383-1.118-.383-.41 0-.77.11-1.08.328-.31.219-.551.506-.725.861V12H37.72V4.604h1.196zm6.228 3.637c0-1.153.266-2.07.8-2.751.533-.682 1.239-1.022 2.119-1.022.902 0 1.606.319 2.112.957l.061-.82h1.156v7.218c0 .957-.284 1.712-.851 2.263-.568.551-1.33.827-2.287.827a3.804 3.804 0 0 1-1.566-.342c-.51-.228-.9-.54-1.168-.936l.656-.759c.542.67 1.205 1.005 1.99 1.005.614 0 1.094-.173 1.438-.52.344-.346.516-.834.516-1.463v-.635c-.506.583-1.196.875-2.071.875-.866 0-1.567-.349-2.102-1.046-.536-.697-.803-1.648-.803-2.85zm1.271.144c0 .834.171 1.489.513 1.965.342.476.82.714 1.435.714.798 0 1.383-.362 1.757-1.086V6.6c-.387-.707-.968-1.06-1.743-1.06-.615 0-1.096.24-1.442.718-.347.478-.52 1.187-.52 2.126zM58.37 12h-1.312V2.047h1.312V12zm3.398-7.396l.04.93c.566-.712 1.304-1.067 2.215-1.067 1.564 0 2.352.882 2.366 2.645V12h-1.265V7.105c-.005-.533-.126-.927-.366-1.182-.239-.255-.612-.383-1.117-.383-.41 0-.77.11-1.08.328-.31.219-.552.506-.725.861V12H60.57V4.604h1.197zm9.495 6.5c.45 0 .845-.136 1.182-.41.338-.273.524-.615.56-1.025h1.197a2.293 2.293 0 0 1-.437 1.21 2.881 2.881 0 0 1-1.077.916 3.107 3.107 0 0 1-1.425.342c-1.007 0-1.808-.336-2.403-1.009-.595-.672-.892-1.591-.892-2.758v-.212c0-.72.132-1.36.396-1.92a3.02 3.02 0 0 1 1.138-1.306c.495-.31 1.08-.465 1.754-.465.83 0 1.519.248 2.068.745.549.497.842 1.142.878 1.934h-1.196c-.037-.478-.218-.871-.544-1.179-.325-.307-.728-.461-1.206-.461-.643 0-1.14.231-1.494.694-.353.462-.53 1.131-.53 2.006v.24c0 .852.176 1.508.527 1.968.35.46.852.69 1.504.69zm4.388.233c0-.219.065-.401.195-.547.13-.146.325-.219.585-.219.26 0 .457.073.591.219a.776.776 0 0 1 .202.547c0 .21-.068.385-.202.526-.134.142-.332.212-.591.212-.26 0-.455-.07-.585-.212a.748.748 0 0 1-.195-.526z" fill="#002A49"/>
    <path fill="#149DCB" d="M5.143 11.531l-.385.487.87 1.355-.09.627H9.23l.255-.627-1.484-1.842z"/>
    <path fill="#0EB399" d="M7.162 3.284l-1.335 2.33 6.514 7.682-.186.704h2.988l.542-2.499-6.971-8.22z"/>
    <path fill="#3DB664" d="M9.93 0L8.049 1.532l-.635 1.166H8.99l2.705 3.207 1.608-1.316v-.836l-.559-.781.413-.428z"/>
    <path fill="#17BDCB" d="M3.2 8.024h-.88L0 10.96V14h2.489l.438-.57 1.921-2.478h2.776l.855-1.304-3.01-3.562z"/>
  </g>
</svg>


          
          </td>
        </tr>
        <tr class="categories">
          <td>Categories</td>
          <td>
            <ul class="categories">
            
              
              <li><a href="/hub/#serverless">Serverless</a></li>
            
            </ul>
          </td>
        </tr>
        
        
          <tr class="source-code">
            <td>Source</td>
            <td>
              <ul>
              
                <li>
                  <a href="https://github.com/Kong/kong-plugin-serverless-functions">Code</a>
                </li>
              
              
              </ul>
            </td>
          </tr>
        
        
        
          <tr class="kong-editions">
            <th colspan="2">
              
                Bundled with...
              
            </th>
          </tr>
          <tr class="kong-compatibility">
            <td colspan="2">
              <ul class="compat-list">
              
                
                  
                  <h6>Kong Enterprise</h6>
                  
                  <li>
                  
                    <i class="fa fa-check"></i>
                  0.34-x
                  </li>
                
              
                
                  
                  <li>
                  
                    <i class="fa fa-check"></i>
                  0.33-x
                  </li>
                
              
                
                  
                  <li>
                  
                    <i class="fa fa-check"></i>
                  0.32-x
                  </li>
                
              
                
              
              </ul><ul class="compat-list">
              
                
                  
                  <h6>Kong</h6>
                  
                  <li>
                  
                    <i class="fa fa-check"></i>
                  1.0.x
                  </li>
                
              
                
                  
                  <li>
                  
                    <i class="fa fa-check"></i>
                  0.14.x
                  </li>
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
              </ul>
            </td>
          </tr>
        
        
          <tr>
            <th colspan="2">Other Versions</th>
          </tr>
          <tr>
            <td colspan="2">
              <ul class="extn-versions">
              
                
              
                
                  
                  <li>
                    <a href="/hub/kong-inc/serverless-functions/0.1-x.html">
                      0.1-x </a>
                      
                  </li>
                
              
              </ul>
            </td>
          </tr>
        
      </table>

    </aside>

    <div class="page-content-container">
      <div class="page-content">
        <div class="content">
          
      

      

      <p>Dynamically run Lua code from Kong during access phase.</p>


      
        <hr>
        <h2 id="terminology">Terminology</h2>
        <ul>
          <li><code>plugin</code>: a plugin executing actions inside Kong before or after a request has been proxied to the upstream API.</li>

          
            <li><code>Service</code>: the Kong entity representing an external <em>upstream</em> API or microservice.</li>
          
          
            <li><code>Route</code>: the Kong entity representing a way to map downstream requests to upstream services.</li>
          
          
            <li><code>upstream service</code>: this refers to your own API/service sitting behind Kong, to which client requests are forwarded.</li>
          
        </ul>
      

      

      
        <h2 id="configuration">Configuration</h2>
        
          
<h3 id="enabling-the-plugin-on-a-service">Enabling the plugin on a Service</h3>

<p>Configure this plugin on a <a href="/latest/admin-api/#service-object">Service</a> by
making the following request:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>curl -X POST http://kong:8001/services/<span class="o">{</span>service<span class="o">}</span>/plugins <span class="se">\</span>
    --data <span class="s2">"name=serverless-functions"</span>  <span class="se">\</span>
    --data <span class="s2">"config.functions=[]"</span>

</code></pre>
</div>

<ul>
  <li><code class="highlighter-rouge">service</code>: the id or name of the Service that this plugin configuration will
target.</li>
</ul>

        
        
          
<h3 id="enabling-the-plugin-on-a-route">Enabling the plugin on a Route</h3>

<p>Configure this plugin on a <a href="/latest/admin-api/#Route-object">Route</a> with:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>curl -X POST http://kong:8001/routes/<span class="o">{</span>route_id<span class="o">}</span>/plugins <span class="se">\</span>
    --data <span class="s2">"name=serverless-functions"</span>  <span class="se">\</span>
    --data <span class="s2">"config.functions=[]"</span>

</code></pre>
</div>

<ul>
  <li><code class="highlighter-rouge">route_id</code>: the id of the Route that this plugin configuration will target.</li>
</ul>

        
        
        

        <h3>Global plugins</h3>

        <p>All plugins can be configured using the <code>http://kong:8001/plugins/</code> endpoint. A plugin which is not associated to any Service,
          Route or Consumer (or API, if you are using an older version of Kong) is considered "global", and will be run on every request.
          Read the <a href="/latest/admin-api/#add-plugin">Plugin Reference</a> and the
          <a href="/latest/admin-api/#precedence">Plugin Precedence</a> sections for more information.
        </p>

        <h3>Parameters</h3>

        <p>Here's a list of all the parameters which can be used in this plugin's configuration: </p>

        
<table>
  <thead>
    <tr><th>form parameter</th><th>default</th><th>description</th></tr>
  </thead>
  <tbody>
    <tr><td><code>name</code></td><td></td><td>The name of the plugin to use, in this case <code>serverless-functions</code></td></tr>

    
      <tr><td><code>service_id</code></td><td></td><td>The id of the Service which this plugin will target.</td></tr>
    
    
      <tr><td><code>route_id</code></td><td></td><td>The id of the Route which this plugin will target.</td></tr>
    
      <tr><td><code>enabled</code></td><td><code>true</code></td><td>Whether this plugin will be applied.</td></tr>
    
    
    
      <tr>
        <td><code>config.functions</code>
          
          
        </td>
        <td><p>[]</p>
</td>
        <td><p>Array of stringified Lua code to be cached and run in sequence during access phase.</p>
</td>
      </tr>
    
  </tbody>
</table>


      

      


      <h2 id="plugin-names">Plugin Names</h2>

<p>Serverless Functions come as two separate plugins. Each one runs with a
different priority in the plugin chain.</p>

<ul>
  <li><code class="highlighter-rouge">pre-function</code>
    <ul>
      <li>Runs before other plugins run during access phase.</li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">post-function</code>
    <ul>
      <li>Runs after other plugins in the access phase.</li>
    </ul>
  </li>
</ul>

<h2 id="demonstration">Demonstration</h2>

<ol>
  <li>
    <p>Create a Service on Kong:</p>

    <div class="language-bash highlighter-rouge"><pre class="highlight"><code> <span class="nv">$ </span>curl -i -X  POST http://localhost:8001/services/ <span class="se">\</span>
   --data <span class="s2">"name=plugin-testing"</span> <span class="se">\</span>
   --data <span class="s2">"url=http://httpbin.org/headers"</span>

 HTTP/1.1 201 Created
 ...
</code></pre>
    </div>
  </li>
  <li>
    <p>Add a Route to the Service:</p>

    <div class="language-bash highlighter-rouge"><pre class="highlight"><code> <span class="nv">$ </span>curl -i -X  POST http://localhost:8001/services/plugin-testing/routes <span class="se">\</span>
   --data <span class="s2">"paths[]=/test"</span>

 HTTP/1.1 201 Created
 ...
</code></pre>
    </div>
  </li>
  <li>
    <p>Create a file named <code class="highlighter-rouge">custom-auth.lua</code> with the following content:</p>

    <div class="language-lua highlighter-rouge"><pre class="highlight"><code> <span class="c1">-- Get list of request headers</span>
 <span class="kd">local</span> <span class="n">custom_auth</span> <span class="o">=</span> <span class="n">kong</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">get_header</span><span class="p">(</span><span class="s2">"x-custom-auth"</span><span class="p">)</span>

 <span class="c1">-- Terminate request early if our custom authentication header</span>
 <span class="c1">-- does not exist</span>
 <span class="k">if</span> <span class="ow">not</span> <span class="n">custom_auth</span> <span class="k">then</span>
   <span class="k">return</span> <span class="n">kong</span><span class="p">.</span><span class="n">response</span><span class="p">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">401</span><span class="err">\</span><span class="p">,</span> <span class="s2">"Invalid Credentials"</span><span class="p">)</span>
 <span class="k">end</span>

 <span class="c1">-- Remove custom authentication header from request</span>
 <span class="n">kong</span><span class="p">.</span><span class="n">service</span><span class="p">.</span><span class="n">request</span><span class="p">.</span><span class="n">clear_header</span><span class="p">(</span><span class="s1">'x-custom-auth'</span><span class="p">)</span>
</code></pre>
    </div>
  </li>
  <li>
    <p>Ensure the file contents:</p>

    <div class="language-bash highlighter-rouge"><pre class="highlight"><code> <span class="nv">$ </span>cat custom-auth.lua
</code></pre>
    </div>
  </li>
  <li>
    <p>Apply our Lua code using the <code class="highlighter-rouge">pre-function</code> plugin using cURL file upload:</p>

    <div class="language-bash highlighter-rouge"><pre class="highlight"><code> <span class="nv">$ </span>curl -i -X POST http://localhost:8001/services/plugin-testing/plugins <span class="se">\</span>
     -F <span class="s2">"name=pre-function"</span> <span class="se">\</span>
     -F <span class="s2">"config.functions=@custom-auth.lua"</span>

 HTTP/1.1 201 Created
 ...
</code></pre>
    </div>
  </li>
  <li>
    <p>Test that our Lua code will terminate the request when no header is passed:</p>

    <div class="language-bash highlighter-rouge"><pre class="highlight"><code> curl -i -X GET http://localhost:8000/test

 HTTP/1.1 401 Unauthorized
 ...
 <span class="s2">"Invalid Credentials"</span>
</code></pre>
    </div>
  </li>
  <li>
    <p>Test the Lua code we just applied by making a valid request:</p>

    <div class="language-bash highlighter-rouge"><pre class="highlight"><code> curl -i -X GET http://localhost:8000/test <span class="se">\</span>
   --header <span class="s2">"x-custom-auth: demo"</span>

 HTTP/1.1 200 OK
 ...
</code></pre>
    </div>
  </li>
</ol>

<p>This is just a small demonstration of the power these plugins grant. We were
able to dynamically inject Lua code into the plugin access phase to dynamically
terminate, or transform the request without creating a custom plugin or
reloading / redeploying Kong.</p>

<p>In short, serverless functions give you the full capabilities of a custom plugin
in the access phase without ever redeploying / restarting Kong.</p>

<hr />

<h3 id="notes">Notes</h3>

<h4 id="fake-upstreams">Fake Upstreams</h4>

<p>Since the <a href="https://getkong.org/docs/latest/admin-api/#service-object">Service</a> entity requires defining an upstream you may
define a fake upstream and take care to terminate the request. See the
<a href="https://github.com/openresty/lua-nginx-module#ngxexit"><code class="highlighter-rouge">lua-ngx-module</code></a>
documentation for more information.</p>

<h4 id="escaping-commas">Escaping Commas</h4>

<p>Since the Lua code blocks are sent in an Array, when using <code class="highlighter-rouge">form-data</code> you might
run into an issue with code being split when using commas. To avoid this situation
escape commas using the backslash character <code class="highlighter-rouge">\,</code>.</p>

<h4 id="minifying-lua">Minifying Lua</h4>

<p>Since we send our code over in a string format, it is advisable to use either
curl file upload <code class="highlighter-rouge">@file.lua</code> (see demonstration) or to minify your Lua code
using a <a href="https://mothereff.in/lua-minifier">minifier</a>.</p>



      

      
    
        </div>
      </div>
    </div>
  </div>
</div>

<!-- <script>
/* eslint-disable */
  window.intercomSettings = {
    app_id: "gwoi3d8y"
  };
</script>

<script>
/* eslint-disable */
(function(){var w=window;var ic=w.Intercom;if(typeof ic==="function"){ic('reattach_activator');ic('update',intercomSettings);}else{var d=document;var i=function(){i.c(arguments)};i.q=[];i.c=function(args){i.q.push(args)};w.Intercom=i;function l(){var s=d.createElement('script');s.type='text/javascript';s.async=true;s.src='https://widget.intercom.io/widget/gwoi3d8y';var x=d.getElementsByTagName('script')[0];x.parentNode.insertBefore(s,x);}if(w.attachEvent){w.attachEvent('onload',l);}else{w.addEventListener('load',l,false);}}})()
</script>
 -->


    
  <section class="section subscribe-section" id="newsletter">
  <div class="container">
    <div class="row">
      <div class="one-half column">
        <div class="newsletter-icon col-md-2 mx-auto mx-md-0 mb-1x mb-md-0x">
          <i class="fa fa-envelope" aria-hidden="true"></i>
        </div>
        <div class="newsletter-headline col-auto text-center text-md-left">
          Keep up-to-date with Kong <span class="hidden-sm-down">product releases and</span> news.
        </div>
      </div>
      <div class="one-half column">
        <form accept-charset="UTF-8" method="post" action="https://go.pardot.com/l/392112/2018-10-02/bh8cfd" class="form" id = "subscription_form">
          <input type="text" name="email" id="email" class="text" size="30" placeholder="Email" maxlength="255">
          <div class="error-message message"></div>
          <div class="success-message message"></div>
          <input type="hidden" name="utm_source">
          <input type="hidden" name="utm_campaign">
          <input type="hidden" name="utm_medium">
          <input type="hidden" name="utm_content">
          <input type="hidden" name="utm_term">
          <input type="submit" class="button" accesskey="s" value="Subscribe">
      </div>
    </div>
  </div>
</section>



<footer class="marketing-footer--light-gray">
  <section>
    <ul>
      <li class="logo-wrapper">
        <div class="logo">
          <img src="/assets/images/kong-blue.png" alt="Kong Inc">
        </div>
      </li>
      <li>
        <nav>
          <h4>Company</h4>
          <ul>
            <li><a href="https://konghq.com/about-kong-inc/">About</a></li>
            <li><a href="https://konghq.com/investors/">Investors</a></li>
            <li><a href="http://konghq.com/blog/">Blog</a></li>
            <li><a href="https://konghq.com/jobs/">Jobs</a></li>
            <li><a href="https://konghq.com/contact/">Contact</a></li>
            <li><a href="https://support.konghq.com">Support</a></li>
          </ul>
        </nav>
      </li>
      <li>
        <nav>
          <h4>Products</h4>
          <ul>
            <li><a href="https://docs.konghq.com/">Kong</a></li>
            <li><a href="https://konghq.com/api-dev-portal/">Dev Portal</a></li>
            <li><a href="https://konghq.com/api-analytics/">API Analytics</a></li>
            <li><a href="https://konghq.com/kong-enterprise-edition/">Enterprise</a></li>
          </ul>
        </nav>
      </li>
      <li>
        <nav>
          <h4>Open Source</h4>
          <ul>
            <li><a href="http://mockbin.org/">Mockbin</a></li>
            <li><a href="http://apiembed.com/">API Embed</a></li>
            <li><a href="http://unirest.io/">Unirest</a></li>
            <li><a href="http://guardianjs.com/">Guardian JS</a></li>
            <li><a href="http://oauthbible.com/">OAuth Bible</a></li>
          </ul>
        </nav>
      </li>
      <li>
        <nav>
          <h4>Legal</h4>
          <ul>
            <li><a href="https://konghq.com/terms/">Terms of Service</a></li>
            <li><a href="https://konghq.com/privacy/">Privacy Policy</a></li>
          </ul>
        </nav>
      </li>
    </ul>
  </section>

  <section class="legal">
    <ul>
      <li>
        <span class="mashape-footer-content">&copy; Kong Inc. 2019</span>
      </li>
      <li>
        <div class="social-link">
          <a href="https://github.com/Kong" title="GitHub"><i aria-label="GitHub" class="fa fa-github" aria-hidden="true"></i></a></div>
        <div class="social-link">
          <a href="https://www.facebook.com/konghq/" title="Facebook"><i aria-label="Facebook" class="fa fa-facebook-official" aria-hidden="true"></i></a></div>
        <div class="social-link">
          <a href="https://www.meetup.com/topics/kong/all/" title="Meetup"><img aria-label="Meetup" alt="Meetup" src="/assets/images/footer/icn-meetup-black.svg"></a>
        </div>
        <div class="social-link">
          <a href="https://twitter.com/thekonginc" title="Twitter"><i aria-label="Twitter" class="fa fa-twitter" aria-hidden="true"></i></a>
        </div>
      </li>
    </ul>
  </section>
</footer>

    <script>
  var anchorForId = function (id) {
    var anchor = document.createElement("a");
    anchor.className = "header-link";
    anchor.href      = "#" + id;
    anchor.innerHTML = "<span class=\"sr-only\">Permalink</span><i class=\"fa fa-link\"></i>";
    anchor.title = "Permalink";
    return anchor;
  };
  var linkifyAnchors = function (level, containingElement) {
    var headers = containingElement.getElementsByTagName("h" + level);
    for (var h = 0; h < headers.length; h++) {
      var header = headers[h];
      if (typeof header.id !== "undefined" && header.id !== "") {
        header.prepend(anchorForId(header.id));
      }
    }
  };
  document.onreadystatechange = function () {
    if (this.readyState === "complete") {
      var contentBlock = document.getElementById("documentation");
      if (!contentBlock) {
        return;
      }
      for (var level = 1; level <= 6; level++) {
        linkifyAnchors(level, contentBlock);
      }
    }
  };
</script>


    <script src="/assets/app.js?v=1546444101"></script>

    <div id="fb-root"></div>

    <script src="https://2tjosk2rxzc21medji3nfn1g-wpengine.netdna-ssl.com/wp-content/themes/konghq/assets/js/vendor/bootstrap.min.js" async defer></script>

    <script id="github-bjs" src="https://buttons.github.io/buttons.js" async defer></script>
    <script id="twitter-wjs" type="text/javascript" src="https://platform.twitter.com/widgets.js" async defer></script>
    <script id="facebook-jssdk" type="text/javascript" src="https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.3&appId=842731852424506" async defer></script>

    <script type="text/javascript">
      piAId = '393112';
      piCId = '48375';

      (function() {
        function async_load(){
          var s = document.createElement('script'); s.type = 'text/javascript';
          s.src = ('https:' == document.location.protocol ? 'https://pi' : 'http://cdn') + '.pardot.com/pd.js';
          var c = document.getElementsByTagName('script')[0]; c.parentNode.insertBefore(s, c);
        }
        if(window.attachEvent) { window.attachEvent('onload', async_load); }
        else { window.addEventListener('load', async_load, false); }
      })();
    </script>

    <script type='text/javascript'>
      var _vwo_code=(function(){
      var account_id=125292,
      settings_tolerance=2000,
      library_tolerance=2500,
      use_existing_jquery=true,
      // DO NOT EDIT BELOW THIS LINE
      f=false,d=document;return{use_existing_jquery:function(){return use_existing_jquery;},library_tolerance:function(){return library_tolerance;},finish:function(){if(!f){f=true;var a=d.getElementById('_vis_opt_path_hides');if(a)a.parentNode.removeChild(a);}},finished:function(){return f;},load:function(a){var b=d.createElement('script');b.src=a;b.type='text/javascript';b.innerText;b.onerror=function(){_vwo_code.finish();};d.getElementsByTagName('head')[0].appendChild(b);},init:function(){settings_timer=setTimeout('_vwo_code.finish()',settings_tolerance);this.load('//dev.visualwebsiteoptimizer.com/j.php?a='+account_id+'&u='+encodeURIComponent(d.URL)+'&r='+Math.random());var a=d.createElement('style'),b='',h=d.getElementsByTagName('head')[0];a.setAttribute('id','_vis_opt_path_hides');a.setAttribute('type','text/css');if(a.styleSheet)a.styleSheet.cssText=b;else a.appendChild(d.createTextNode(b));h.appendChild(a);return settings_timer;}};}());_vwo_settings_timer=_vwo_code.init();
    </script>

    <script type="text/javascript">
      !function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","group","track","ready","alias","page","once","off","on"];analytics.factory=function(t){return function(){var e=Array.prototype.slice.call(arguments);e.unshift(t);analytics.push(e);return analytics}};for(var t=0;t<analytics.methods.length;t++){var e=analytics.methods[t];analytics[e]=analytics.factory(e)}analytics.load=function(t){var e=document.createElement("script");e.type="text/javascript";e.async=!0;e.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)};analytics.SNIPPET_VERSION="3.0.1";
        analytics.load("WDj0nSS7hpyxwL3evgbOzK755s0NUye6");
        analytics.page()
      }}();
    </script>

  </body>


</html>
